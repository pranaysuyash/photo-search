var Hn=Object.defineProperty;var Wn=(a,t,s)=>t in a?Hn(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var ne=(a,t,s)=>Wn(a,typeof t!="symbol"?t+"":t,s);import{j as e,P as pt,H as Ot,S as rs,D as _e,R as Ms,A as Kn,a as Gn,b as Yn,c as Qn,C as Jn,M as er,d as tr,X as je,e as _s,f as Ts,g as Pt,h as gt,I as st,T as Fs,i as Ds,k as Mt,l as _t,m as vt,n as Rt,o as Os,p as ns,q as De,r as Rs,s as It,E as Ls,t as As,u as sr,K as ar,v as Es,Z as Xn,w as Zn,x as ei,y as ti,z as si,B as ai,F as zs,G as Ia,J as $a,V as ri,L as ni,N as ii,O as oi,Q as rr,U as Ps,W as li,Y as Ke,_ as Ma,$ as Us,a0 as Yt,a1 as ci,a2 as Ge,a3 as is,a4 as di,a5 as ui,a6 as hi,a7 as nr,a8 as xt,a9 as Te,aa as mi,ab as xi,ac as ir,ad as ft,ae as Bs,af as Qt,ag as pi,ah as gi,ai as qs,aj as Vs,ak as bt,al as Ye,am as fi,an as bi,ao as yi,ap as Hs,aq as or,ar as _a,as as vi,at as ji,au as wi,av as Ni,aw as lr,ax as Jt,ay as ki,az as Fa,aA as Da,aB as Oa,aC as Si,aD as Ci,aE as Ti,aF as cr,aG as Ei,aH as dr,aI as Ra,aJ as Pi,aK as Ii,aL as $i,aM as Mi,aN as _i}from"./ui-BdivYFuA.js";import{a as Fi,r as o,b as Di,R as at}from"./vendor-DfJzhmxv.js";import{c as ur}from"./utils-0qZyvErh.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var hr,La=Fi;hr=La.createRoot,La.hydrateRoot;const Oi="modulepreload",Ri=function(a,t){return new URL(a,t).href},Aa={},pe=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){const u=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");n=Promise.allSettled(s.map(d=>{if(d=Ri(d,r),d in Aa)return;Aa[d]=!0;const p=d.endsWith(".css"),f=p?'[rel="stylesheet"]':"";if(!!r)for(let j=u.length-1;j>=0;j--){const b=u[j];if(b.href===d&&(!p||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${f}`))return;const w=document.createElement("link");if(w.rel=p?"stylesheet":Oi,p||(w.as="script"),w.crossOrigin="",w.href=d,l&&w.setAttribute("nonce",l),document.head.appendChild(w),p)return new Promise((j,b)=>{w.addEventListener("load",j),w.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(u){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=u,window.dispatchEvent(c),!c.defaultPrevented)throw u}return n.then(u=>{for(const c of u||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})};function Li(a,t){const[s]=o.useState(()=>{let r=null;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{a(...n),r=null},t)}});return s}function Ai(a,t=300){const[s,r]=o.useState(a);return o.useEffect(()=>{if(a.length<=2){r(a);return}const n=setTimeout(()=>{r(a)},t);return()=>{clearTimeout(n)}},[a,t]),s}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ft(){return Ft=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},Ft.apply(this,arguments)}var et;(function(a){a.Pop="POP",a.Push="PUSH",a.Replace="REPLACE"})(et||(et={}));const za="popstate";function zi(a){a===void 0&&(a={});function t(n,i){let{pathname:u="/",search:c="",hash:l=""}=Lt(n.location.hash.substr(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),Is("",{pathname:u,search:c,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){let u=n.document.querySelector("base"),c="";if(u&&u.getAttribute("href")){let l=n.location.href,d=l.indexOf("#");c=d===-1?l:l.slice(0,d)}return c+"#"+(typeof i=="string"?i:mr(i))}function r(n,i){Ui(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return qi(t,s,r,a)}function Re(a,t){if(a===!1||a===null||typeof a>"u")throw new Error(t)}function Ui(a,t){if(!a){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Bi(){return Math.random().toString(36).substr(2,8)}function Ua(a,t){return{usr:a.state,key:a.key,idx:t}}function Is(a,t,s,r){return s===void 0&&(s=null),Ft({pathname:typeof a=="string"?a:a.pathname,search:"",hash:""},typeof t=="string"?Lt(t):t,{state:s,key:t&&t.key||r||Bi()})}function mr(a){let{pathname:t="/",search:s="",hash:r=""}=a;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Lt(a){let t={};if(a){let s=a.indexOf("#");s>=0&&(t.hash=a.substr(s),a=a.substr(0,s));let r=a.indexOf("?");r>=0&&(t.search=a.substr(r),a=a.substr(0,r)),a&&(t.pathname=a)}return t}function qi(a,t,s,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:i=!1}=r,u=n.history,c=et.Pop,l=null,d=p();d==null&&(d=0,u.replaceState(Ft({},u.state,{idx:d}),""));function p(){return(u.state||{idx:null}).idx}function f(){c=et.Pop;let C=p(),P=C==null?null:C-d;d=C,l&&l({action:c,location:b.location,delta:P})}function y(C,P){c=et.Push;let S=Is(b.location,C,P);s&&s(S,C),d=p()+1;let m=Ua(S,d),h=b.createHref(S);try{u.pushState(m,"",h)}catch(v){if(v instanceof DOMException&&v.name==="DataCloneError")throw v;n.location.assign(h)}i&&l&&l({action:c,location:b.location,delta:1})}function w(C,P){c=et.Replace;let S=Is(b.location,C,P);s&&s(S,C),d=p();let m=Ua(S,d),h=b.createHref(S);u.replaceState(m,"",h),i&&l&&l({action:c,location:b.location,delta:0})}function j(C){let P=n.location.origin!=="null"?n.location.origin:n.location.href,S=typeof C=="string"?C:mr(C);return S=S.replace(/ $/,"%20"),Re(P,"No window.location.(origin|href) available to create URL for href: "+S),new URL(S,P)}let b={get action(){return c},get location(){return a(n,u)},listen(C){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(za,f),l=C,()=>{n.removeEventListener(za,f),l=null}},createHref(C){return t(n,C)},createURL:j,encodeLocation(C){let P=j(C);return{pathname:P.pathname,search:P.search,hash:P.hash}},push:y,replace:w,go(C){return u.go(C)}};return b}var Ba;(function(a){a.data="data",a.deferred="deferred",a.redirect="redirect",a.error="error"})(Ba||(Ba={}));function Vi(a,t){if(t==="/")return a;if(!a.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,r=a.charAt(s);return r&&r!=="/"?null:a.slice(s)||"/"}function Hi(a,t){t===void 0&&(t="/");let{pathname:s,search:r="",hash:n=""}=typeof a=="string"?Lt(a):a;return{pathname:s?s.startsWith("/")?s:Wi(s,t):t,search:Ji(r),hash:Xi(n)}}function Wi(a,t){let s=t.replace(/\/+$/,"").split("/");return a.split("/").forEach(n=>{n===".."?s.length>1&&s.pop():n!=="."&&s.push(n)}),s.length>1?s.join("/"):"/"}function ks(a,t,s,r){return"Cannot include a '"+a+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ki(a){return a.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function Gi(a,t){let s=Ki(a);return t?s.map((r,n)=>n===s.length-1?r.pathname:r.pathnameBase):s.map(r=>r.pathnameBase)}function Yi(a,t,s,r){r===void 0&&(r=!1);let n;typeof a=="string"?n=Lt(a):(n=Ft({},a),Re(!n.pathname||!n.pathname.includes("?"),ks("?","pathname","search",n)),Re(!n.pathname||!n.pathname.includes("#"),ks("#","pathname","hash",n)),Re(!n.search||!n.search.includes("#"),ks("#","search","hash",n)));let i=a===""||n.pathname==="",u=i?"/":n.pathname,c;if(u==null)c=s;else{let f=t.length-1;if(!r&&u.startsWith("..")){let y=u.split("/");for(;y[0]==="..";)y.shift(),f-=1;n.pathname=y.join("/")}c=f>=0?t[f]:"/"}let l=Hi(n,c),d=u&&u!=="/"&&u.endsWith("/"),p=(i||u===".")&&s.endsWith("/");return!l.pathname.endsWith("/")&&(d||p)&&(l.pathname+="/"),l}const Qi=a=>a.join("/").replace(/\/\/+/g,"/"),Ji=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Xi=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a,xr=["post","put","patch","delete"];new Set(xr);const Zi=["get",...xr];new Set(Zi);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Xt(){return Xt=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},Xt.apply(this,arguments)}const pr=o.createContext(null),Ws=o.createContext(null),Ks=o.createContext(null),Gs=o.createContext({outlet:null,matches:[],isDataRoute:!1});function Ys(){return o.useContext(Ks)!=null}function Qs(){return Ys()||Re(!1),o.useContext(Ks).location}function gr(a){o.useContext(Ws).static||o.useLayoutEffect(a)}function fr(){let{isDataRoute:a}=o.useContext(Gs);return a?ro():eo()}function eo(){Ys()||Re(!1);let a=o.useContext(pr),{basename:t,future:s,navigator:r}=o.useContext(Ws),{matches:n}=o.useContext(Gs),{pathname:i}=Qs(),u=JSON.stringify(Gi(n,s.v7_relativeSplatPath)),c=o.useRef(!1);return gr(()=>{c.current=!0}),o.useCallback(function(d,p){if(p===void 0&&(p={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let f=Yi(d,JSON.parse(u),i,p.relative==="path");a==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Qi([t,f.pathname])),(p.replace?r.replace:r.push)(f,p.state,p)},[t,r,u,i,a])}var br=function(a){return a.UseBlocker="useBlocker",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a}(br||{}),yr=function(a){return a.UseBlocker="useBlocker",a.UseLoaderData="useLoaderData",a.UseActionData="useActionData",a.UseRouteError="useRouteError",a.UseNavigation="useNavigation",a.UseRouteLoaderData="useRouteLoaderData",a.UseMatches="useMatches",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a.UseRouteId="useRouteId",a}(yr||{});function to(a){let t=o.useContext(pr);return t||Re(!1),t}function so(a){let t=o.useContext(Gs);return t||Re(!1),t}function ao(a){let t=so(),s=t.matches[t.matches.length-1];return s.route.id||Re(!1),s.route.id}function ro(){let{router:a}=to(br.UseNavigateStable),t=ao(yr.UseNavigateStable),s=o.useRef(!1);return gr(()=>{s.current=!0}),o.useCallback(function(n,i){i===void 0&&(i={}),s.current&&(typeof n=="number"?a.navigate(n):a.navigate(n,Xt({fromRouteId:t},i)))},[a,t])}function no(a,t){a?.v7_startTransition,a?.v7_relativeSplatPath}function io(a){let{basename:t="/",children:s=null,location:r,navigationType:n=et.Pop,navigator:i,static:u=!1,future:c}=a;Ys()&&Re(!1);let l=t.replace(/^\/*/,"/"),d=o.useMemo(()=>({basename:l,navigator:i,static:u,future:Xt({v7_relativeSplatPath:!1},c)}),[l,c,i,u]);typeof r=="string"&&(r=Lt(r));let{pathname:p="/",search:f="",hash:y="",state:w=null,key:j="default"}=r,b=o.useMemo(()=>{let C=Vi(p,l);return C==null?null:{location:{pathname:C,search:f,hash:y,state:w,key:j},navigationType:n}},[l,p,f,y,w,j,n]);return b==null?null:o.createElement(Ws.Provider,{value:d},o.createElement(Ks.Provider,{children:s,value:b}))}new Promise(()=>{});/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const oo="6";try{window.__reactRouterVersion=oo}catch{}const lo="startTransition",qa=Di[lo];function co(a){let{basename:t,children:s,future:r,window:n}=a,i=o.useRef();i.current==null&&(i.current=zi({window:n,v5Compat:!0}));let u=i.current,[c,l]=o.useState({action:u.action,location:u.location}),{v7_startTransition:d}=r||{},p=o.useCallback(f=>{d&&qa?qa(()=>l(f)):l(f)},[l,d]);return o.useLayoutEffect(()=>u.listen(p),[u,p]),o.useEffect(()=>no(r),[r]),o.createElement(io,{basename:t,children:s,location:c.location,navigationType:c.action,navigator:u,future:r})}var Va;(function(a){a.UseScrollRestoration="useScrollRestoration",a.UseSubmit="useSubmit",a.UseSubmitFetcher="useSubmitFetcher",a.UseFetcher="useFetcher",a.useViewTransitionState="useViewTransitionState"})(Va||(Va={}));var Ha;(function(a){a.UseFetcher="useFetcher",a.UseFetchers="useFetchers",a.UseScrollRestoration="useScrollRestoration"})(Ha||(Ha={}));const uo={};function os(){return typeof window<"u"&&(window.electronAPI!==void 0||window.process?.type==="renderer"||navigator.userAgent.toLowerCase().includes("electron"))}const he=uo?.VITE_API_BASE||typeof window<"u"&&window.location&&window.location.origin||"http://127.0.0.1:8000";async function le(a,t){const s=await fetch(`${he}${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(await s.text());return s.json()}async function Dt(a,t,s=32,r,n){return le("/index",{dir:a,provider:t,batch_size:s,hf_token:r,openai_key:n})}async function ho(a,t,s,r){const n=new URLSearchParams({dir:a,provider:t});s&&n.set("hf_token",s),r&&n.set("openai_key",r);const i=await fetch(`${he}/index/status?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function mo(a){return le("/index/pause",{dir:a})}async function xo(a){return le("/index/resume",{dir:a})}async function ls(a,t,s,r=24,n){if(!t?.trim())throw new Error("Search query cannot be empty");if(!a?.trim())throw new Error("Directory must be specified");if(r<1||r>1e3)throw new Error("Top K must be between 1 and 1000");try{const i=new URLSearchParams({dir:a,query:t,provider:s,top_k:String(r)});n?.hfToken&&i.set("hf_token",n.hfToken),n?.openaiKey&&i.set("openai_key",n.openaiKey),n?.favoritesOnly&&i.set("favorites_only","true"),n?.tags&&i.set("tags",n.tags.join(",")),n?.dateFrom!==void 0&&i.set("date_from",String(n.dateFrom)),n?.dateTo!==void 0&&i.set("date_to",String(n.dateTo)),n?.useFast&&i.set("use_fast","true"),n?.fastKind&&i.set("fast_kind",n.fastKind),n?.useCaptions&&i.set("use_captions","true"),n?.useOcr&&i.set("use_ocr","true"),n?.camera&&i.set("camera",n.camera),n?.isoMin!==void 0&&i.set("iso_min",String(n.isoMin)),n?.isoMax!==void 0&&i.set("iso_max",String(n.isoMax)),n?.fMin!==void 0&&i.set("f_min",String(n.fMin)),n?.fMax!==void 0&&i.set("f_max",String(n.fMax)),n?.flash&&i.set("flash",n.flash),n?.wb&&i.set("wb",n.wb),n?.metering&&i.set("metering",n.metering),n?.altMin!==void 0&&i.set("alt_min",String(n.altMin)),n?.altMax!==void 0&&i.set("alt_max",String(n.altMax)),n?.headingMin!==void 0&&i.set("heading_min",String(n.headingMin)),n?.headingMax!==void 0&&i.set("heading_max",String(n.headingMax)),n?.place&&i.set("place",n.place),n?.hasText&&i.set("has_text","true"),n?.person&&i.set("person",n.person),n?.persons&&i.set("persons",n.persons.join(",")),n?.sharpOnly&&i.set("sharp_only","true"),n?.excludeUnder&&i.set("exclude_underexp","true"),n?.excludeOver&&i.set("exclude_overexp","true");const u=await fetch(`${he}/search?${i.toString()}`);if(!u.ok)throw new Error(await u.text());const c=await u.json();try{const{searchHistoryService:l}=await pe(async()=>{const{searchHistoryService:d}=await Promise.resolve().then(()=>dc);return{searchHistoryService:d}},void 0,import.meta.url);l.addToHistory({query:t.trim(),timestamp:Date.now(),resultCount:c.results?.length||0,filters:{tags:n?.tags,favOnly:n?.favoritesOnly,dateFrom:n?.dateFrom,dateTo:n?.dateTo,person:n?.person,place:n?.place}})}catch(l){console.warn("Failed to save search to history:",l)}return c}catch(i){if(i instanceof Error){if(i.message.includes("network"))throw new Error("Network error: Please check your connection");if(i.message.includes("timeout"))throw new Error("Search timeout: Try a simpler query or check your connection");if(i.message.includes("401"))throw new Error("Authentication error: Please check your API keys");if(i.message.includes("403"))throw new Error("Access denied: Please check your permissions");if(i.message.includes("500"))throw new Error("Server error: Please try again later")}throw i}}async function vr(a,t,s,r=24,n,i=.5){return le("/search_like_plus",{dir:a,path:t,provider:s,top_k:r,text:n,weight:i})}async function Js(a,t,s,r){return le("/share",{dir:a,provider:t,paths:s,expiry_hours:r?.expiryHours??24,password:r?.password,view_only:r?.viewOnly??!0})}async function jr(a){const t=a?`${he}/share?dir=${encodeURIComponent(a)}`:`${he}/share`,s=await fetch(t);if(!s.ok)throw new Error(await s.text());return s.json()}async function wr(a){return le("/share/revoke",{token:a})}async function Zt(a,t=200){const s=await fetch(`${he}/analytics?dir=${encodeURIComponent(a)}&limit=${t}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function Nr(a,t,s,r,n){return le("/captions/build",{dir:a,vlm_model:t,provider:s,hf_token:r,openai_key:n})}async function kr(a,t,s,r,n){return le("/feedback",{dir:a,search_id:t,query:s,positives:r,note:n})}async function Xs(a){const t=await fetch(`${he}/favorites?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function $t(a,t,s){return le("/favorites",{dir:a,path:t,favorite:s})}async function Zs(a){const t=await fetch(`${he}/saved?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Sr(a,t,s,r){return le("/saved",{dir:a,name:t,query:s,top_k:r})}async function Cr(a,t){return le("/saved/delete",{dir:a,name:t})}async function po(a){const t=await fetch(`${he}/presets?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function go(a,t,s){return le("/presets",{dir:a,name:t,query:s})}async function fo(a,t){return le("/presets/delete",{dir:a,name:t})}async function ea(a){const t=await fetch(`${he}/map?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function ta(a,t,s,r){const n=new URLSearchParams({dir:a});t&&n.set("provider",t),r&&n.set("hf_token",r),s&&n.set("openai_key",s);const i=await fetch(`${he}/diagnostics?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function At(a,t,s=120,r=0,n){const i=new URLSearchParams({dir:a,provider:t,limit:String(s),offset:String(r)});n?.hfToken&&i.set("hf_token",n.hfToken),n?.openaiKey&&i.set("openai_key",n.openaiKey);const u=await fetch(`${he}/library?${i.toString()}`);if(!u.ok)throw new Error(await u.text());return u.json()}async function sa(a,t,s,r,n){return le("/fast/build",{dir:a,kind:t,provider:s,hf_token:r,openai_key:n})}async function aa(a,t,s,r,n){return le("/ocr/build",{dir:a,provider:t,languages:s,hf_token:r,openai_key:n})}async function Tr(a,t=5){const s=await fetch(`${he}/lookalikes?dir=${encodeURIComponent(a)}&max_distance=${t}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function Er(a,t){return le("/lookalikes/resolve",{dir:a,group_paths:t})}async function ra(){const a=await fetch(`${he}/workspace`);if(!a.ok)throw new Error(await a.text());return a.json()}async function tt(a){return le("/workspace/add",{path:a})}async function Pr(a){return le("/workspace/remove",{path:a})}async function yt(a,t){const s=await fetch(`${he}/metadata/detail?dir=${encodeURIComponent(a)}&path=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function na(a,t,s,r=24,n){return le("/search_workspace",{dir:a,provider:s,query:t,top_k:r,favorites_only:n?.favoritesOnly,tags:n?.tags,date_from:n?.dateFrom,date_to:n?.dateTo,place:n?.place,has_text:n?.hasText,person:n?.person,persons:n?.persons})}async function ia(a){const t=await fetch(`${he}/tags?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Ir(a,t,s){return le("/tags",{dir:a,path:t,tags:s})}function ke(a,t,s,r=256){if(os())return`file://${s.startsWith("/")?s:`${a}/${s}`}`;const n=new URLSearchParams({dir:a,provider:t,path:s,size:String(r)});return`${he}/thumb?${n.toString()}`}function oa(a,t,s,r,n=196){if(os())return`file://${s.startsWith("/")?s:`${a}/${s}`}`;const i=new URLSearchParams({dir:a,provider:t,path:s,emb:String(r),size:String(n)});return`${he}/thumb_face?${i.toString()}`}async function $r(a,t){return le("/open",{dir:a,path:t})}async function Mr(a,t,s){return le("/edit/ops",{dir:a,path:t,rotate:s.rotate||0,flip:s.flip,crop:s.crop})}async function _r(a,t,s=2,r="pil"){return le("/edit/upscale",{dir:a,path:t,scale:s,engine:r})}async function jt(a,t,s,r="copy",n=!1,i=!1,u){return le("/export",{dir:a,paths:t,dest:s,mode:r,strip_exif:n,overwrite:i,strip_gps:u?.stripGps,keep_copyright_only:u?.keepCopyrightOnly,preset:u?.preset,resize_long:u?.resizeLong,quality:u?.quality})}async function la(a,t,s,r){return le("/metadata/build",{dir:a,provider:t,hf_token:s,openai_key:r})}async function ca(a){const t=await fetch(`${he}/metadata?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Fr(a,t,s,r=24){return le("/search_like",{dir:a,path:t,provider:s,top_k:r})}async function Dr(a){const t=await fetch(`${he}/collections?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function es(a,t,s){return le("/collections",{dir:a,name:t,paths:s})}async function Or(a,t){return le("/collections/delete",{dir:a,name:t})}async function Rr(a){const t=await fetch(`${he}/smart_collections?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Lr(a,t,s){return le("/smart_collections",{dir:a,name:t,rules:s})}async function Ar(a,t){return le("/smart_collections/delete",{dir:a,name:t})}async function zr(a,t,s,r=24){return le("/smart_collections/resolve",{dir:a,name:t,provider:s,top_k:r})}async function Ur(a,t,s=160){return le("/ocr/snippets",{dir:a,paths:t,limit:s})}async function bo(a){const t=await fetch(`${he}/ocr/status?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function da(a,t){return le("/faces/build",{dir:a,provider:t})}async function ua(a){const t=await fetch(`${he}/faces/clusters?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function ha(a,t,s){return le("/faces/name",{dir:a,cluster_id:t,name:s})}async function Br(a,t){return le("/trips/build",{dir:a,provider:t})}async function qr(a){const t=await fetch(`${he}/trips?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function ts(){const a=await fetch(`${he}/todo`);if(!a.ok)throw new Error(await a.text());return a.json()}async function ma(a,t){return le("/autotag",{dir:a,provider:t})}async function xa(a,t,s){const r=await fetch(`${he}/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:a,paths:t,os_trash:!!s})});if(!r.ok)throw new Error(await r.text());return r.json()}async function pa(a){const t=await fetch(`${he}/undo_delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:a})});if(!t.ok)throw new Error(await t.text());return t.json()}async function Vr(a){const t=await fetch(`${he}/videos?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Hr(a,t){const s=await fetch(`${he}/video/metadata?dir=${encodeURIComponent(a)}&path=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}function Wr(a,t,s=1,r=256){if(os())return`file://${t.startsWith("/")?t:`${a}/${t}`}`;const n=new URLSearchParams({dir:a,path:t,frame_time:String(s),size:String(r)});return`${he}/video/thumbnail?${n.toString()}`}async function Kr(a,t="local"){return le("/videos/index",{dir:a,provider:t})}async function yo(a,t,s=!1){return le("/batch/delete",{dir:a,paths:t,os_trash:s})}async function vo(a,t,s,r="add"){return le("/batch/tag",{dir:a,paths:t,tags:s,operation:r})}async function Gr(a,t){const s=await fetch(`${he}/faces/photos?dir=${encodeURIComponent(a)}&cluster_id=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}const ge=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:he,apiAddPreset:go,apiAddSaved:Sr,apiAnalytics:Zt,apiAutotag:ma,apiBatchDelete:yo,apiBatchTag:vo,apiBuildCaptions:Nr,apiBuildFaces:da,apiBuildFast:sa,apiBuildMetadata:la,apiBuildOCR:aa,apiCreateShare:Js,apiDelete:xa,apiDeleteCollection:Or,apiDeletePreset:fo,apiDeleteSaved:Cr,apiDeleteSmart:Ar,apiDiagnostics:ta,apiEditOps:Mr,apiExport:jt,apiFacesClusters:ua,apiFacesName:ha,apiFeedback:kr,apiGetCollections:Dr,apiGetFacePhotos:Gr,apiGetFavorites:Xs,apiGetMetadata:ca,apiGetPresets:po,apiGetSaved:Zs,apiGetSmart:Rr,apiGetTags:ia,apiGetVideoMetadata:Hr,apiIndex:Dt,apiIndexPause:mo,apiIndexResume:xo,apiIndexStatus:ho,apiIndexVideos:Kr,apiLibrary:At,apiListShares:jr,apiListVideos:Vr,apiLookalikes:Tr,apiMap:ea,apiMetadataDetail:yt,apiOcrSnippets:Ur,apiOcrStatus:bo,apiOpen:$r,apiResolveLookalike:Er,apiResolveSmart:zr,apiRevokeShare:wr,apiSearch:ls,apiSearchLike:Fr,apiSearchLikePlus:vr,apiSearchWorkspace:na,apiSetCollection:es,apiSetFavorite:$t,apiSetSmart:Lr,apiSetTags:Ir,apiTodo:ts,apiTripsBuild:Br,apiTripsList:qr,apiUndoDelete:pa,apiUpscale:_r,apiWorkspaceAdd:tt,apiWorkspaceList:ra,apiWorkspaceRemove:Pr,isElectron:os,thumbFaceUrl:oa,thumbUrl:ke,videoThumbnailUrl:Wr},Symbol.toStringTag,{value:"Module"})),jo={settings:{dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"faiss",useCaps:!1,vlmModel:"gpt-4o",useOcr:!1,hasText:!1,useOsTrash:!1,camera:"",isoMin:0,isoMax:25600,fMin:.7,fMax:32,place:"",showInfoOverlay:!1,resultView:"grid",timelineBucket:"day",includeVideos:!0},photo:{results:[],searchId:"",query:"",topK:24,fav:[],favOnly:!1,tags:{allTags:[],tagsMap:{},tagFilter:""},saved:[],collections:{},smart:{},library:[],libHasMore:!0},ui:{busy:"",note:"",viewMode:"grid",showWelcome:!1,showHelp:!1},workspace:{workspace:"",wsToggle:!1,persons:[],clusters:[],groups:[],points:[],diag:null}},Yr=o.createContext(null),wo=({children:a})=>{const[t,s]=o.useState(jo),r=o.useCallback(c=>{s(l=>({...l,settings:{...l.settings,...c}}))},[]),n=o.useCallback(c=>{s(l=>({...l,photo:{...l.photo,...typeof c=="function"?c(l):c}}))},[]),i=o.useCallback(c=>{s(l=>({...l,ui:{...l.ui,...c}}))},[]),u=o.useCallback(c=>{s(l=>({...l,workspace:{...l.workspace,...c}}))},[]);return e.jsx(Yr.Provider,{value:{state:t,setSettings:r,setPhoto:n,setUI:i,setWorkspace:u},children:a})},ae=()=>{const a=o.useContext(Yr);if(!a)throw new Error("useSimpleStore must be used within SimpleStoreProvider");return a},No=()=>ae().state.settings.dir,ko=()=>ae().state.settings.engine,So=()=>ae().state.settings.hfToken,Co=()=>ae().state.settings.openaiKey,To=()=>ae().state.settings.engine.startsWith("hf"),Eo=()=>ae().state.settings.engine==="openai",Po=()=>ae().state.settings.camera,Io=()=>ae().state.settings.isoMin,$o=()=>ae().state.settings.isoMax,Mo=()=>ae().state.settings.fMin,_o=()=>ae().state.settings.fMax,Fo=()=>ae().state.settings.place,Do=()=>ae().state.settings.showInfoOverlay,Oo=()=>ae().state.settings.useCaps,Ro=()=>ae().state.settings.useOcr,Lo=()=>ae().state.settings.hasText,Ao=()=>ae().state.settings.useFast,zo=()=>ae().state.settings.fastKind,Uo=()=>ae().state.settings.useOsTrash,Bo=()=>ae().state.photo.results,qo=()=>ae().state.photo.query,Vo=()=>ae().state.photo.topK,Ho=()=>ae().state.photo.fav,Wo=()=>ae().state.photo.favOnly,Ko=()=>ae().state.photo.tags.tagFilter,Go=()=>ae().state.photo.tags.allTags,Yo=()=>ae().state.photo.tags.tagsMap,Qo=()=>ae().state.photo.saved,Jo=()=>ae().state.photo.collections,Xo=()=>ae().state.photo.smart,Qr=()=>ae().state.photo.library,Jr=()=>ae().state.photo.libHasMore,Zo=()=>ae().state.ui.busy,el=()=>ae().state.ui.note,tl=()=>ae().state.ui.showWelcome,sl=()=>ae().state.ui.showHelp,al=()=>ae().state.workspace.wsToggle,rl=()=>ae().state.workspace.persons,nl=()=>ae().state.workspace.clusters,il=()=>ae().state.workspace.points,ol=()=>ae().state.workspace.diag,Xr=()=>{const{setSettings:a}=ae();return at.useMemo(()=>({setDir:t=>a({dir:t}),setEngine:t=>a({engine:t}),setHfToken:t=>a({hfToken:t}),setOpenaiKey:t=>a({openaiKey:t}),setUseFast:t=>a({useFast:t}),setFastKind:t=>a({fastKind:t}),setUseCaps:t=>a({useCaps:t}),setVlmModel:t=>a({vlmModel:t}),setUseOcr:t=>a({useOcr:t}),setHasText:t=>a({hasText:t}),setUseOsTrash:t=>a({useOsTrash:t}),setCamera:t=>a({camera:t}),setIsoMin:t=>a({isoMin:t}),setIsoMax:t=>a({isoMax:t}),setFMin:t=>a({fMin:t}),setFMax:t=>a({fMax:t}),setPlace:t=>a({place:t}),setShowInfoOverlay:t=>a({showInfoOverlay:t}),setResultView:t=>a({resultView:t}),setTimelineBucket:t=>a({timelineBucket:t}),setIncludeVideos:t=>a({includeVideos:t})}),[a])},Zr=()=>{const{setPhoto:a}=ae();return at.useMemo(()=>({setResults:t=>a({results:t}),setSearchId:t=>a({searchId:t}),setQuery:t=>a({query:t}),setTopK:t=>a({topK:t}),setFavorites:t=>a({fav:t}),setFavOnly:t=>a({favOnly:t}),setAllTags:t=>a(s=>({tags:{...s.photo.tags,allTags:t}})),setTagsMap:t=>a(s=>({tags:{...s.photo.tags,tagsMap:t}})),setTagFilter:t=>a(s=>({tags:{...s.photo.tags,tagFilter:t}})),setSaved:t=>a({saved:t}),setCollections:t=>a({collections:t}),setSmart:t=>a({smart:t}),setLibrary:t=>a({library:t}),setLibHasMore:t=>a({libHasMore:t}),appendLibrary:t=>a(s=>({library:[...s.photo.library,...t]})),resetSearch:()=>a({results:[],searchId:"",query:""})}),[a])},ll=()=>{const{setUI:a}=ae();return at.useMemo(()=>({setBusy:t=>a({busy:t}),setNote:t=>a({note:t}),setViewMode:t=>a({viewMode:t}),setShowWelcome:t=>a({showWelcome:t}),setShowHelp:t=>a({showHelp:t})}),[a])},cl=()=>{const{setWorkspace:a}=ae();return at.useMemo(()=>({setWorkspace:t=>a({workspace:t}),setWsToggle:t=>a({wsToggle:t}),setPersons:t=>a({persons:t}),setClusters:t=>a({clusters:t}),setGroups:t=>a({groups:t}),setPoints:t=>a({points:t}),setDiag:t=>a({diag:t})}),[a])},dl=a=>(t,s,r)=>{const n=r.subscribe;return r.subscribe=(u,c,l)=>{let d=u;if(c){const p=l?.equalityFn||Object.is;let f=u(r.getState());d=y=>{const w=u(y);if(!p(f,w)){const j=f;c(f=w,j)}},l?.fireImmediately&&c(f,f)}return n(d)},a(t,s,r)},en=dl;function ul(a,t){let s;try{s=a()}catch{return}return{getItem:n=>{var i;const u=l=>l===null?null:JSON.parse(l,void 0),c=(i=s.getItem(n))!=null?i:null;return c instanceof Promise?c.then(u):u(c)},setItem:(n,i)=>s.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>s.removeItem(n)}}const $s=a=>t=>{try{const s=a(t);return s instanceof Promise?s:{then(r){return $s(r)(s)},catch(r){return this}}}catch(s){return{then(r){return this},catch(r){return $s(r)(s)}}}},hl=(a,t)=>(s,r,n)=>{let i={storage:ul(()=>localStorage),partialize:b=>b,version:0,merge:(b,C)=>({...C,...b}),...t},u=!1;const c=new Set,l=new Set;let d=i.storage;if(!d)return a((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...b)},r,n);const p=()=>{const b=i.partialize({...r()});return d.setItem(i.name,{state:b,version:i.version})},f=n.setState;n.setState=(b,C)=>(f(b,C),p());const y=a((...b)=>(s(...b),p()),r,n);n.getInitialState=()=>y;let w;const j=()=>{var b,C;if(!d)return;u=!1,c.forEach(S=>{var m;return S((m=r())!=null?m:y)});const P=((C=i.onRehydrateStorage)==null?void 0:C.call(i,(b=r())!=null?b:y))||void 0;return $s(d.getItem.bind(d))(i.name).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==i.version){if(i.migrate){const m=i.migrate(S.state,S.version);return m instanceof Promise?m.then(h=>[!0,h]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,S.state];return[!1,void 0]}).then(S=>{var m;const[h,v]=S;if(w=i.merge(v,(m=r())!=null?m:y),s(w,!0),h)return p()}).then(()=>{P?.(w,void 0),w=r(),u=!0,l.forEach(S=>S(w))}).catch(S=>{P?.(void 0,S)})};return n.persist={setOptions:b=>{i={...i,...b},b.storage&&(d=b.storage)},clearStorage:()=>{d?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>j(),hasHydrated:()=>u,onHydrate:b=>(c.add(b),()=>{c.delete(b)}),onFinishHydration:b=>(l.add(b),()=>{l.delete(b)})},i.skipHydration||j(),w||y},tn=hl,Ee=ur()(tn(en((a,t)=>({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0,setThemeMode:s=>a({themeMode:s}),setColorScheme:s=>a({colorScheme:s}),setDensity:s=>a({density:s}),setCustomColors:s=>a({customColors:s}),resetTheme:()=>a({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0})})),{name:"photo-search-theme",partialize:a=>({themeMode:a.themeMode,colorScheme:a.colorScheme,density:a.density,customColors:a.customColors})})),cs=ur()(tn(en((a,t)=>({dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"",useCaps:!1,vlmModel:"Qwen/Qwen2-VL-2B-Instruct",useOcr:!1,hasText:!1,useOsTrash:!1,showExplain:!1,showInfoOverlay:!1,highContrast:!1,camera:"",isoMin:"",isoMax:"",fMin:"",fMax:"",place:"",setDir:s=>a({dir:s}),setEngine:s=>a({engine:s}),setHfToken:s=>a({hfToken:s}),setOpenaiKey:s=>a({openaiKey:s}),setUseFast:s=>a({useFast:s}),setFastKind:s=>a({fastKind:s}),setUseCaps:s=>a({useCaps:s}),setVlmModel:s=>a({vlmModel:s}),setUseOcr:s=>a({useOcr:s}),setHasText:s=>a({hasText:s}),setUseOsTrash:s=>a({useOsTrash:s}),setShowExplain:s=>a({showExplain:s}),setShowInfoOverlay:s=>a({showInfoOverlay:s}),setHighContrast:s=>a({highContrast:s}),setCamera:s=>a({camera:s}),setIsoMin:s=>a({isoMin:s}),setIsoMax:s=>a({isoMax:s}),setFMin:s=>a({fMin:s}),setFMax:s=>a({fMax:s}),setPlace:s=>a({place:s})})),{name:"photo-search-settings",partialize:a=>({dir:a.dir,engine:a.engine,useFast:a.useFast,fastKind:a.fastKind,useCaps:a.useCaps,vlmModel:a.vlmModel,useOcr:a.useOcr,hasText:a.hasText,useOsTrash:a.useOsTrash,showExplain:a.showExplain,showInfoOverlay:a.showInfoOverlay,camera:a.camera,isoMin:a.isoMin,isoMax:a.isoMax,fMin:a.fMin,fMax:a.fMax,place:a.place})})),sn=()=>cs(a=>a.dir),ml=()=>cs(a=>a.engine),ga=()=>cs(a=>a.highContrast);class Oe{static isVideoFile(t){const s=t.toLowerCase().substring(t.lastIndexOf("."));return this.supportedFormats.includes(s)}static async extractMetadata(t){return new Promise((s,r)=>{const n=document.createElement("video");n.preload="metadata",n.onloadedmetadata=()=>{const i={duration:n.duration,width:n.videoWidth,height:n.videoHeight,codec:this.detectCodec(t),fps:30,bitrate:0,hasAudio:n.mozHasAudio||n.webkitAudioDecodedByteCount>0||n.audioTracks?.length>0||!0};n.remove(),s(i)},n.onerror=()=>{n.remove(),r(new Error("Failed to load video metadata"))},n.src=t})}static async generateThumbnail(t,s=2,r=320,n=240){return new Promise((i,u)=>{const c=document.createElement("video"),l=document.createElement("canvas"),d=l.getContext("2d");if(!d){u(new Error("Canvas context not available"));return}c.crossOrigin="anonymous",c.currentTime=s,c.onseeked=()=>{l.width=r,l.height=n;const p=c.videoWidth/c.videoHeight,f=r/n;let y=r,w=n,j=0,b=0;p>f?(w=r/p,b=(n-w)/2):(y=n*p,j=(r-y)/2),d.drawImage(c,j,b,y,w);const C=l.toDataURL("image/jpeg",.8);c.remove(),l.remove(),i(C)},c.onerror=()=>{c.remove(),l.remove(),u(new Error("Failed to generate thumbnail"))},c.src=t})}static async extractKeyframes(t,s=10,r=160,n=90){const u=(await this.extractMetadata(t)).duration/(s+1),c=[];for(let l=1;l<=s;l++)try{const d=u*l,p=await this.generateThumbnail(t,d,r,n);c.push(p)}catch(d){console.warn(`Failed to extract keyframe at ${u*l}s:`,d)}return c}static detectCodec(t){const s=t.toLowerCase().substring(t.lastIndexOf(".")+1);return{mp4:"H.264",mov:"H.264/ProRes",webm:"VP8/VP9",mkv:"H.264/H.265",avi:"Various",wmv:"WMV",flv:"FLV"}[s]||"Unknown"}static async getVideoInfo(t,s){if(this.videoCache.has(t))return this.videoCache.get(t);try{const r=await this.extractMetadata(s),n=await this.generateThumbnail(s),i={path:t,type:"video",format:t.substring(t.lastIndexOf(".")+1).toUpperCase(),metadata:r,thumbnailUrl:n,streamUrl:s};if(this.videoCache.set(t,i),this.videoCache.size>100){const u=this.videoCache.keys().next().value;this.videoCache.delete(u)}return i}catch(r){throw console.error("Failed to get video info:",r),r}}static clearCache(){this.videoCache.clear()}static formatDuration(t){const s=Math.floor(t/3600),r=Math.floor(t%3600/60),n=Math.floor(t%60);return s>0?`${s}:${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${r}:${n.toString().padStart(2,"0")}`}static getResolutionLabel(t,s){return s>=2160?"4K":s>=1440?"2K":s>=1080?"Full HD":s>=720?"HD":s>=480?"SD":"Low"}}ne(Oe,"supportedFormats",[".mp4",".mov",".avi",".webm",".mkv",".m4v",".mpg",".mpeg",".wmv",".flv"]),ne(Oe,"videoCache",new Map);class xl{constructor(t={}){ne(this,"intersectionObserver",null);ne(this,"imageCache",new Map);ne(this,"loadingQueue",new Set);ne(this,"maxCacheSize",100*1024*1024);ne(this,"currentCacheSize",0);ne(this,"options");this.options={threshold:t.threshold??.1,rootMargin:t.rootMargin??"50px",quality:t.quality??"medium",enableProgressiveLoading:t.enableProgressiveLoading??!0},this.initIntersectionObserver()}initIntersectionObserver(){typeof window>"u"||!window.IntersectionObserver||(this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(s=>{if(s.isIntersecting){const r=s.target,n=r.dataset.src;n&&!r.src&&(this.loadImage(n,r),this.intersectionObserver?.unobserve(r))}})},{threshold:this.options.threshold,rootMargin:this.options.rootMargin}))}observeImage(t,s){if(!this.intersectionObserver){this.loadImage(s,t);return}t.dataset.src=s,this.options.enableProgressiveLoading&&(t.style.backgroundColor="#f3f4f6",t.style.backgroundImage="linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",t.style.backgroundSize="200% 100%",t.style.animation="shimmer 2s infinite linear"),this.intersectionObserver.observe(t)}async loadImage(t,s){if(this.loadingQueue.has(t))return;const r=this.imageCache.get(t);if(r){this.applyImageToElement(r.url,s),this.imageCache.delete(t),this.imageCache.set(t,r);return}this.loadingQueue.add(t);try{const n=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(!n.ok)throw new Error(`Failed to load image: ${n.status}`);const i=await n.blob(),u=URL.createObjectURL(i),c={blob:i,url:u,timestamp:Date.now(),size:i.size};this.addToCache(t,c),this.applyImageToElement(u,s)}catch(n){console.warn("Failed to load image:",t,n),s.style.backgroundColor="#fee2e2",s.alt="Failed to load"}finally{this.loadingQueue.delete(t)}}applyImageToElement(t,s){s.onload=()=>{s.style.backgroundColor="",s.style.backgroundImage="",s.style.animation=""},s.src=t}addToCache(t,s){for(this.currentCacheSize+=s.size;this.currentCacheSize>this.maxCacheSize&&this.imageCache.size>0;){const[r,n]=this.imageCache.entries().next().value;this.imageCache.delete(r),this.currentCacheSize-=n.size,URL.revokeObjectURL(n.url)}this.imageCache.set(t,s)}preloadImages(t,s="low"){s==="low"?window.requestIdleCallback?window.requestIdleCallback(()=>{this.preloadImageBatch(t)}):setTimeout(()=>this.preloadImageBatch(t),100):this.preloadImageBatch(t)}async preloadImageBatch(t){const s=t.filter(r=>!this.imageCache.has(r)&&!this.loadingQueue.has(r)).slice(0,10).map(r=>this.preloadSingleImage(r));await Promise.allSettled(s)}async preloadSingleImage(t){if(!(this.imageCache.has(t)||this.loadingQueue.has(t))){this.loadingQueue.add(t);try{const s=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(s.ok){const r=await s.blob(),n=URL.createObjectURL(r),i={blob:r,url:n,timestamp:Date.now(),size:r.size};this.addToCache(t,i)}}catch{}finally{this.loadingQueue.delete(t)}}}clearCache(){for(const t of this.imageCache.values())URL.revokeObjectURL(t.url);this.imageCache.clear(),this.currentCacheSize=0}getCacheStats(){return{size:this.imageCache.size,totalSize:this.currentCacheSize,maxSize:this.maxCacheSize,hitRate:this.imageCache.size>0?Array.from(this.imageCache.values()).filter(t=>Date.now()-t.timestamp<3e5).length/this.imageCache.size:0}}destroy(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.clearCache(),this.loadingQueue.clear()}}const an=new xl;if(typeof document<"u"){const a=document.createElement("style");a.textContent=`
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
  `,document.head.appendChild(a)}const fa=o.memo(({src:a,alt:t,onLoad:s,onError:r,className:n="",enableProgressiveLoading:i=!0,quality:u="medium",...c})=>{const l=o.useRef(null),[d,p]=o.useState(!1),[f,y]=o.useState(!1);o.useEffect(()=>{const j=l.current;if(!j||!a)return;const b=()=>{p(!0),s?.()},C=()=>{y(!0),r?.()};return j.addEventListener("load",b),j.addEventListener("error",C),an.observeImage(j,a),()=>{j.removeEventListener("load",b),j.removeEventListener("error",C)}},[a,s,r]);const w=`
    ${n}
    ${i&&!d?"transition-opacity duration-300 opacity-0":""}
    ${d?"opacity-100":""}
    ${f?"bg-red-100":""}
  `.trim();return e.jsx("img",{ref:l,alt:t,className:w,...c,style:{...c.style,...i&&!d?{backgroundColor:"#f3f4f6",backgroundImage:"linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",backgroundSize:"200% 100%",animation:"shimmer 2s infinite linear"}:{}}})});fa.displayName="LazyImage";const rn=o.memo(({dir:a,engine:t,items:s,gap:r=8,targetRowHeight:n=196,scrollContainerRef:i,selected:u,onToggleSelect:c,onOpen:l,focusIndex:d=null,onLayout:p,ratingMap:f,showInfoOverlay:y})=>{const w=o.useRef(null),[j,b]=o.useState(0),[C,P]=o.useState({}),[S,m]=o.useState(null),[h,v]=o.useState({}),k=4/3,[E,T]=o.useState({});o.useEffect(()=>{const V=i.current;if(!V)return;const Y=new ResizeObserver(()=>b(V.clientWidth));return Y.observe(V),b(V.clientWidth),()=>Y.disconnect()},[i]),o.useEffect(()=>{let V=!1;return s.slice(0,200).forEach(({path:R})=>{if(C[R])return;const H=new Image;H.onload=()=>{!V&&H.naturalWidth&&H.naturalHeight&&P($=>({...$,[R]:H.naturalWidth/H.naturalHeight}))},H.src=ke(a,t,R,256)}),()=>{V=!0}},[s,a,t]);const N=o.useMemo(()=>{if(!j||s.length===0)return[];const V=[];let Y=[],R=0;const $=Math.max(0,j-2*16);if(s.forEach((G,J)=>{const L=C[G.path]||k;if(Y.push(G),R+=L,R*n+r*(Y.length-1)>=$){const ce=Math.max(120,Math.floor(($-r*(Y.length-1))/R));V.push({items:Y,height:ce}),Y=[],R=0}}),Y.length>0){const G=Math.min(n,Math.floor(($-r*(Y.length-1))/Math.max(1,R)));V.push({items:Y,height:G})}return V},[s,C,j,r,n]),O=o.useMemo(()=>{const V=[];if(!s.length||N.length===0)return V;let Y=0;for(const R of N){const H=[];for(let $=0;$<R.items.length;$++)H.push(Y++);V.push(H)}return V},[N,s.length]);o.useEffect(()=>{p&&p(O)},[O,p]);const U=(V,Y)=>{const R=Y.touches[0],H=Date.now();h[V]?.longPressTimer&&clearTimeout(h[V].longPressTimer);const $={startX:R.clientX,startY:R.clientY,startTime:H,isLongPress:!1,longPressTimer:window.setTimeout(()=>{v(G=>({...G,[V]:{...G[V],isLongPress:!0}})),m(V)},500)};v(G=>({...G,[V]:$}))},Z=(V,Y)=>{const R=Y.touches[0],H=h[V];if(!H)return;const $=Math.abs(R.clientX-H.startX),G=Math.abs(R.clientY-H.startY);($>10||G>10)&&H.longPressTimer&&(clearTimeout(H.longPressTimer),v(J=>({...J,[V]:{...J[V],longPressTimer:null}})))},F=(V,Y)=>{const R=h[V];if(!R)return;R.longPressTimer&&clearTimeout(R.longPressTimer);const $=Date.now()-R.startTime;R.isLongPress||($<200&&c(V),setTimeout(()=>{v(G=>{const J={...G};return delete J[V],J})},100))},K=(V,Y)=>{switch(m(null),Y){case"open":l(V);break;case"favorite":console.log("Favorite:",V);break;case"share":console.log("Share:",V);break;case"download":console.log("Download:",V);break}},[_,M]=o.useState(0),W=i.current?.clientHeight||0;o.useEffect(()=>{const V=i.current;if(!V)return;const Y=()=>M(V.scrollTop);return V.addEventListener("scroll",Y,{passive:!0}),M(V.scrollTop),()=>V.removeEventListener("scroll",Y)},[i]);const{totalH:se,offsets:B}=o.useMemo(()=>{let V=0;const Y=[];for(const R of N)Y.push(V),V+=R.height+r;return{totalH:V,offsets:Y}},[N,r]),me=600,A=o.useMemo(()=>{const V=Math.max(0,_-me);let Y=0;for(;Y<B.length&&B[Y]+N[Y].height<V;)Y++;return Y},[B,N,_]),ee=o.useMemo(()=>{const V=_+W+me;let Y=A;for(;Y<B.length&&B[Y]<V;)Y++;return Math.min(Y+5,N.length)},[B,N,_,W,A]);o.useEffect(()=>{const V=N.slice(ee,ee+3).flatMap(Y=>Y.items.map(R=>ke(a,t,R.path,256)));V.length>0&&an.preloadImages(V,"low")},[ee,N,a,t]),o.useEffect(()=>{if(!y)return;const V=[];N.slice(A,ee).forEach(($,G)=>{$.items.forEach(J=>{V.push(J.path)})});const Y=V.filter($=>!E[$]);if(Y.length===0)return;const R=Y.slice(0,16);let H=!1;return Promise.all(R.map(async $=>{try{const G=await yt(a,$);!H&&G&&G.meta&&T(J=>J[$]?J:{...J,[$]:G.meta})}catch{}})),()=>{H=!0}},[y,N,A,ee,a,E]),o.useEffect(()=>{if(!y)return;const V=s.slice(0,48).map(R=>R.path).filter(R=>!E[R]);if(V.length===0)return;let Y=!1;return Promise.all(V.slice(0,24).map(async R=>{try{const H=await yt(a,R);!Y&&H&&H.meta&&T($=>$[R]?$:{...$,[R]:H.meta})}catch{}})),()=>{Y=!0}},[y,s,a]);const ie=d!==null?`photo-${d}`:void 0;return e.jsx("div",{id:"modern-results-grid",ref:w,className:"relative",style:{height:se},role:"grid","aria-multiselectable":"true","aria-activedescendant":ie,tabIndex:0,children:N.slice(A,ee).map((V,Y)=>{const R=A+Y,H=B[R],$=Math.max(0,j-2*16),G=V.items.reduce((L,z)=>L+(C[z.path]||k),0),J=Math.max(120,Math.floor(($-r*(V.items.length-1))/Math.max(.01,G)));return e.jsx("div",{className:"absolute left-0 right-0",style:{top:H},children:e.jsx("div",{className:"flex",style:{gap:r},children:V.items.map((L,z)=>{const ce=O[R]?.[z],Q=C[L.path]||k,re=Math.floor(J*Q),ue=u.has(L.path),Ne=d!==null&&ce===d,oe=L.path.split("/").pop()||L.path;return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden transition-all duration-200 hover:shadow ${ue?"ring-2 ring-blue-500":""} ${Ne?"outline outline-2 outline-indigo-500":""} ${h[L.path]?"scale-95":""}`,style:{width:re,height:J},onClick:()=>c(L.path),onDoubleClick:()=>l(L.path),onTouchStart:X=>U(L.path,X),onTouchMove:X=>Z(L.path,X),onTouchEnd:X=>F(L.path),title:L.path,"data-photo-idx":ce,id:`photo-${ce}`,role:"gridcell","aria-selected":ue,tabIndex:Ne?0:-1,children:[e.jsx(fa,{src:ke(a,t,L.path,256),alt:L.path,className:"w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",enableProgressiveLoading:!0}),Oe.isVideoFile(L.path)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(pt,{className:"w-6 h-6 text-white ml-1"})})}),y&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:oe,children:oe}),e.jsx("div",{className:"flex items-center gap-1",children:(()=>{const X=E[L.path],ye=[];return X&&(X.camera&&ye.push(String(X.camera)),typeof X.fnumber=="number"&&ye.push(`f/${X.fnumber}`),typeof X.iso=="number"&&ye.push(`ISO ${X.iso}`)),typeof L.score=="number"&&ye.push(L.score.toFixed(2)),ye.slice(0,3).map((rt,Pe)=>e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:rt},Pe))})()})]}),f&&typeof f[L.path]=="number"&&f[L.path]>0&&e.jsxs("div",{className:"absolute bottom-1 left-1 px-1 py-0.5 rounded bg-black/50 text-yellow-300 text-[10px] flex items-center gap-0.5",children:[e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M12 .587l3.668 7.431 8.2 1.193-5.934 5.787 1.401 8.168L12 18.896l-7.335 3.87 1.401-8.168L.132 9.211l8.2-1.193z"})}),e.jsx("span",{children:f[L.path]})]}),ue&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),S===L.path&&e.jsxs("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center gap-3",onClick:()=>m(null),children:[e.jsx("div",{className:"text-white text-sm font-medium mb-2",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:X=>{X.stopPropagation(),K(L.path,"open")},onKeyDown:X=>{(X.key==="Enter"||X.key===" ")&&(X.preventDefault(),X.stopPropagation(),K(L.path,"open"))},className:"w-12 h-12 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Open",children:e.jsx(pt,{className:"w-5 h-5 ml-0.5"})}),e.jsx("button",{type:"button",onClick:X=>{X.stopPropagation(),K(L.path,"favorite")},onKeyDown:X=>{(X.key==="Enter"||X.key===" ")&&(X.preventDefault(),X.stopPropagation(),K(L.path,"favorite"))},className:"w-12 h-12 bg-pink-500 hover:bg-pink-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Favorite",children:e.jsx(Ot,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:X=>{X.stopPropagation(),K(L.path,"share")},onKeyDown:X=>{(X.key==="Enter"||X.key===" ")&&(X.preventDefault(),X.stopPropagation(),K(L.path,"share"))},className:"w-12 h-12 bg-green-500 hover:bg-green-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Share",children:e.jsx(rs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:X=>{X.stopPropagation(),K(L.path,"download")},onKeyDown:X=>{(X.key==="Enter"||X.key===" ")&&(X.preventDefault(),X.stopPropagation(),K(L.path,"download"))},className:"w-12 h-12 bg-purple-500 hover:bg-purple-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Download",children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsx("button",{type:"button",onClick:X=>{X.stopPropagation(),m(null)},onKeyDown:X=>{(X.key==="Enter"||X.key===" ")&&(X.preventDefault(),X.stopPropagation(),m(null))},className:"mt-4 text-white/70 hover:text-white text-xs",children:"Tap anywhere to close"})]})]},L.path)})})},R)})})});rn.displayName="JustifiedResults";class pl{constructor(t){ne(this,"config");this.config=t}async search(t,s=24){return ls(this.config.dir,t,this.config.provider,s)}async searchWorkspace(t,s=24){return na(this.config.dir,t,this.config.provider,s)}async searchSimilar(t,s=24){return Fr(this.config.dir,t,this.config.provider,s)}async searchSimilarPlus(t,s,r=.5,n=24){return vr(this.config.dir,t,this.config.provider,n,s,r)}async buildIndex(t=32){return Dt(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async buildFastIndex(t){return sa(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async buildCaptions(t){return Nr(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getCollections(){return Dr(this.config.dir)}async setCollection(t,s){return es(this.config.dir,t,s)}async deleteCollection(t){return Or(this.config.dir,t)}async getSmartCollections(){return Rr(this.config.dir)}async setSmartCollection(t,s){return Lr(this.config.dir,t,s)}async deleteSmartCollection(t){return Ar(this.config.dir,t)}async resolveSmartCollection(t,s=24){return zr(this.config.dir,t,this.config.provider,s)}async buildTrips(){return Br(this.config.dir,this.config.provider)}async getTrips(){return qr(this.config.dir)}async buildFaces(){return da(this.config.dir,this.config.provider)}async getFaceClusters(){return ua(this.config.dir)}async nameFaceCluster(t,s){return ha(this.config.dir,t,s)}async buildOCR(t){return aa(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async getOCRSnippets(t,s=160){return Ur(this.config.dir,t,s)}async getMetadata(){return ca(this.config.dir)}async getMetadataDetail(t){return yt(this.config.dir,t)}async buildMetadata(){return la(this.config.dir,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getTags(){return ia(this.config.dir)}async setTags(t,s){return Ir(this.config.dir,t,s)}async getMapData(){return ea(this.config.dir)}async getFavorites(){return Xs(this.config.dir)}async setFavorite(t,s){return $t(this.config.dir,t,s)}async getSavedSearches(){return Zs(this.config.dir)}async addSavedSearch(t,s,r){return Sr(this.config.dir,t,s,r)}async deleteSavedSearch(t){return Cr(this.config.dir,t)}async editImage(t,s){return Mr(this.config.dir,t,s)}async upscaleImage(t,s=2,r="pil"){return _r(this.config.dir,t,s,r)}async exportImages(t,s,r="copy",n=!1,i=!1){return jt(this.config.dir,t,s,r,n,i)}async openExternal(t){return $r(this.config.dir,t)}async getLibrary(t=120,s=0){return At(this.config.dir,this.config.provider,t,s,{hfToken:this.config.hfToken,openaiKey:this.config.openaiKey})}async getWorkspace(){return ra()}async addToWorkspace(t){return tt(t)}async removeFromWorkspace(t){return Pr(t)}async deleteImages(t,s=!0){return xa(this.config.dir,t,s)}async undoDelete(){return pa(this.config.dir)}async findLookalikes(t=5){return Tr(this.config.dir,t)}async resolveLookalikes(t){return Er(this.config.dir,t)}async runDiagnostics(){return ta(this.config.dir,this.config.provider,this.config.openaiKey,this.config.hfToken)}async submitFeedback(t,s,r,n){return kr(this.config.dir,t,s,r,n)}async getTodos(){return ts()}getThumbnailUrl(t){return ke(this.config.dir,this.config.provider,t)}getFaceThumbnailUrl(t,s,r=196){return oa(this.config.dir,this.config.provider,t,s,r)}async autoTag(){return ma(this.config.dir,this.config.provider)}}let ss=null;function gl(a){return ss=new pl(a),ss}function Me(){if(!ss)throw new Error("PhotoVault API not initialized. Call initializeAPI first.");return ss}function nn({imagePath:a,onClose:t,onSave:s}){const[r,n]=o.useState(a),[i,u]=o.useState(a),[c,l]=o.useState(0),[d,p]=o.useState(!1),[f,y]=o.useState(!1),[w,j]=o.useState(!1),[b,C]=o.useState({x:0,y:0,w:100,h:100}),[P,S]=o.useState(2),[m,h]=o.useState("pil"),[v,k]=o.useState(!1),[E,T]=o.useState([a]),[N,O]=o.useState(0),[U,Z]=o.useState(!1),[F,K]=o.useState({brightness:100,contrast:100,saturation:100}),_=Me(),M=o.useRef(null),W=o.useRef(null),se=async G=>{k(!0);try{const J={rotate:G},L=await _.editImage(r,J);ie(L.out_path),n(L.out_path),l(0)}catch(J){console.error("Failed to rotate image:",J)}finally{k(!1)}},B=async G=>{k(!0);try{const J={flip:G},L=await _.editImage(r,J);ie(L.out_path),n(L.out_path),G==="h"?p(!1):y(!1)}catch(J){console.error("Failed to flip image:",J)}finally{k(!1)}},me=async()=>{if(M.current){k(!0);try{const G=M.current,L={crop:{x:Math.round(b.x/100*G.naturalWidth),y:Math.round(b.y/100*G.naturalHeight),w:Math.round(b.w/100*G.naturalWidth),h:Math.round(b.h/100*G.naturalHeight)}},z=await _.editImage(r,L);ie(z.out_path),n(z.out_path),j(!1)}catch(G){console.error("Failed to crop image:",G)}finally{k(!1)}}},A=async()=>{k(!0);try{const G=await _.upscaleImage(r,P,m);ie(G.out_path),n(G.out_path)}catch(G){console.error("Failed to upscale image:",G)}finally{k(!1)}},ee=async()=>{if(!(F.brightness===100&&F.contrast===100&&F.saturation===100)){k(!0);try{alert("Adjustments would be applied here. In a full implementation, this would process the image with the selected adjustments.")}catch(G){console.error("Failed to apply adjustments:",G)}finally{k(!1)}}},ie=G=>{const J=E.slice(0,N+1);J.push(G),T(J),O(J.length-1)},V=()=>{N>0&&(O(N-1),n(E[N-1]))},Y=()=>{N<E.length-1&&(O(N+1),n(E[N+1]))},R=()=>{n(i),T([i]),O(0),K({brightness:100,contrast:100,saturation:100})},H=()=>{s&&s(r),t&&t()},$=async()=>{try{const G=prompt("Enter export destination folder:");if(!G)return;const J=await _.exportImages([r],G,"copy",!1,!1);alert(`Exported to: ${J.dest}`)}catch(G){console.error("Failed to export image:",G)}};return e.jsxs("div",{className:"image-editor",children:[e.jsxs("div",{className:"editor-toolbar",children:[e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:()=>se(90),disabled:v,className:"toolbar-btn",title:"Rotate 90",children:e.jsx(Ms,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>B("h"),disabled:v,className:"toolbar-btn",title:"Flip Horizontal",children:[e.jsx(Kn,{className:"w-4 h-4"}),e.jsx(Gn,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>B("v"),disabled:v,className:"toolbar-btn",title:"Flip Vertical",children:[e.jsx(Yn,{className:"w-4 h-4"}),e.jsx(Qn,{className:"w-4 h-4"})]}),e.jsx("button",{onClick:()=>j(!w),disabled:v,className:`toolbar-btn ${w?"active":""}`,title:"Crop",children:e.jsx(Jn,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"toolbar-group",children:e.jsx("button",{onClick:()=>Z(!U),className:"toolbar-btn",title:"Before/After Toggle",children:e.jsx("span",{children:"Before/After"})})}),e.jsxs("div",{className:"toolbar-group",children:[e.jsxs("select",{value:P,onChange:G=>S(Number(G.target.value)),className:"toolbar-select",children:[e.jsx("option",{value:2,children:"2x"}),e.jsx("option",{value:4,children:"4x"})]}),e.jsxs("select",{value:m,onChange:G=>h(G.target.value),className:"toolbar-select",children:[e.jsx("option",{value:"pil",children:"PIL"}),e.jsx("option",{value:"realesrgan",children:"RealESRGAN"})]}),e.jsx("button",{onClick:A,disabled:v,className:"toolbar-btn",title:"Upscale",children:e.jsx(er,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:V,disabled:N===0||v,className:"toolbar-btn",children:"Undo"}),e.jsx("button",{onClick:Y,disabled:N===E.length-1||v,className:"toolbar-btn",children:"Redo"})]}),e.jsxs("div",{className:"toolbar-group ml-auto",children:[e.jsx("button",{onClick:R,className:"toolbar-btn",title:"Revert to Original",children:"Revert"}),e.jsxs("button",{onClick:$,className:"toolbar-btn",children:[e.jsx(_e,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:H,className:"btn btn-primary",children:[e.jsx(tr,{className:"w-4 h-4"}),"Save"]}),t&&e.jsx("button",{onClick:t,className:"toolbar-btn",children:e.jsx(je,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"adjustment-panel",children:[e.jsxs("div",{className:"adjustment-control",children:[e.jsx(_s,{className:"w-4 h-4"}),e.jsx("label",{children:"Brightness"}),e.jsx("input",{type:"range",min:"0",max:"200",value:F.brightness,onChange:G=>K({...F,brightness:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[F.brightness,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(Ts,{className:"w-4 h-4"}),e.jsx("label",{children:"Contrast"}),e.jsx("input",{type:"range",min:"0",max:"200",value:F.contrast,onChange:G=>K({...F,contrast:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[F.contrast,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(Pt,{className:"w-4 h-4"}),e.jsx("label",{children:"Saturation"}),e.jsx("input",{type:"range",min:"0",max:"200",value:F.saturation,onChange:G=>K({...F,saturation:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[F.saturation,"%"]})]}),e.jsx("button",{onClick:ee,disabled:v,className:"btn btn-secondary",children:"Apply Adjustments"})]}),e.jsxs("div",{className:"editor-canvas",children:[v&&e.jsxs("div",{className:"processing-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),e.jsxs("div",{className:"image-container",children:[U?e.jsxs("div",{className:"before-after-container",children:[e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"Before"}),e.jsx("img",{src:_.getThumbnailUrl(i),alt:"Original"})]}),e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"After"}),e.jsx("img",{src:_.getThumbnailUrl(r),alt:"Edited"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{ref:M,src:_.getThumbnailUrl(r),alt:"Editing",style:{transform:`rotate(${c}deg) ${d?"scaleX(-1)":""} ${f?"scaleY(-1)":""}`,filter:`brightness(${F.brightness}%) contrast(${F.contrast}%) saturate(${F.saturation}%)`}}),e.jsx("canvas",{ref:W,style:{display:"none"}})]}),w&&e.jsx("div",{className:"crop-overlay",style:{left:`${b.x}%`,top:`${b.y}%`,width:`${b.w}%`,height:`${b.h}%`},children:e.jsxs("div",{className:"crop-controls",children:[e.jsxs("button",{onClick:me,className:"btn btn-primary btn-sm",children:[e.jsx(gt,{className:"w-3 h-3"}),"Apply"]}),e.jsxs("button",{onClick:()=>j(!1),className:"btn btn-secondary btn-sm",children:[e.jsx(je,{className:"w-3 h-3"}),"Cancel"]})]})})]})]}),e.jsx("style",{jsx:!0,children:`
        .image-editor {
          display: flex;
          flex-direction: column;
          height: 100vh;
          background: var(--bg-primary);
        }

        .editor-toolbar {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .toolbar-group {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .toolbar-group.ml-auto {
          margin-left: auto;
        }

        .toolbar-btn {
          display: flex;
          align-items: center;
          gap: 0.25rem;
          padding: 0.5rem 0.75rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .toolbar-btn:hover:not(:disabled) {
          background: var(--bg-tertiary);
          border-color: var(--accent-primary);
        }

        .toolbar-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .toolbar-btn.active {
          background: var(--accent-primary);
          color: white;
        }

        .toolbar-select {
          padding: 0.5rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
        }

        .adjustment-panel {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 0.5rem 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .adjustment-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .adjustment-control label {
          font-size: 0.875rem;
          white-space: nowrap;
        }

        .adjustment-slider {
          width: 100px;
        }

        .editor-canvas {
          flex: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .processing-overlay {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 10;
          color: white;
        }

        .image-container {
          position: relative;
          max-width: 90%;
          max-height: 90%;
        }

        .before-after-container {
          display: flex;
          gap: 2rem;
          max-width: 100%;
          max-height: 100%;
        }

        .before-after-panel {
          flex: 1;
          text-align: center;
        }

        .before-after-panel h3 {
          margin-bottom: 0.5rem;
          color: white;
        }

        .before-after-panel img {
          max-width: 100%;
          max-height: 80vh;
          object-fit: contain;
        }

        .image-container img {
          max-width: 100%;
          max-height: 100%;
          transition: transform 0.3s;
        }

        .crop-overlay {
          position: absolute;
          border: 2px solid var(--accent-primary);
          background: rgba(0, 122, 255, 0.1);
          cursor: move;
        }

        .crop-controls {
          position: absolute;
          bottom: -40px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 0.5rem;
          white-space: nowrap;
        }

        .btn-sm {
          padding: 0.25rem 0.5rem;
          font-size: 0.875rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .editor-toolbar {
            flex-direction: column;
            align-items: stretch;
          }
          
          .toolbar-group {
            flex-wrap: wrap;
            justify-content: center;
          }
          
          .adjustment-panel {
            flex-direction: column;
            align-items: stretch;
          }
          
          .adjustment-control {
            justify-content: space-between;
          }
        }
      `})]})}class mt{static async verifyFaces(t,s,r){const n=[];for(const i of s){let u={clusterId:"",confidence:0};for(const[c,l]of r){const d=this.calculateFaceSimilarity(i.embedding,l.centroid);d>u.confidence&&(u={clusterId:c,confidence:d})}u.confidence>this.faceThreshold&&n.push({clusterId:u.clusterId,confidence:u.confidence,suggested:!0,faceBox:i.box})}return n}static async detectPets(t){const s=[],r=[{type:"dog",breed:"Golden Retriever",confidence:.92},{type:"cat",breed:"Siamese",confidence:.88}];for(const n of r)n.confidence>this.petThreshold&&s.push({...n,box:{x:100,y:100,width:200,height:200}});return s}static async analyzeScene(t){const s={wedding:["bride","groom","ceremony","cake","dress"],birthday:["cake","candles","balloons","party","celebration"],hiking:["mountain","trail","backpack","forest","outdoors"],beach:["ocean","sand","waves","sunset","swimming"],sports:["ball","field","court","team","game"],concert:["stage","crowd","lights","music","performance"],graduation:["cap","gown","diploma","ceremony","academic"]},r={primary:"outdoor",categories:["nature","landscape"],activities:[],events:[],objects:[{name:"mountain",confidence:.95},{name:"trees",confidence:.89},{name:"sky",confidence:.92}],confidence:.88};for(const[n,i]of Object.entries(s))i.filter(c=>r.objects.some(l=>l.name.includes(c))).length>=2&&r.events.push(n);return r.objects.some(n=>n.name.includes("sport"))&&r.activities.push("sports"),r.objects.some(n=>n.name.includes("mountain")||n.name.includes("trail"))&&r.activities.push("hiking"),r}static async assessQuality(t,s){const r={overall:0,sharpness:0,exposure:0,composition:0,colorBalance:0,noise:0,issues:[]};return s?(r.sharpness=this.calculateSharpness(s),r.exposure=this.calculateExposure(s),r.composition=this.calculateComposition(s),r.colorBalance=this.calculateColorBalance(s),r.noise=this.calculateNoise(s)):(r.sharpness=Math.random()*100,r.exposure=Math.random()*100,r.composition=Math.random()*100,r.colorBalance=Math.random()*100,r.noise=100-Math.random()*30),r.overall=r.sharpness*this.qualityWeights.sharpness+r.exposure*this.qualityWeights.exposure+r.composition*this.qualityWeights.composition+r.colorBalance*this.qualityWeights.colorBalance+r.noise*this.qualityWeights.noise,r.sharpness<40&&r.issues.push("Blurry"),r.exposure<30&&r.issues.push("Underexposed"),r.exposure>85&&r.issues.push("Overexposed"),r.composition<40&&r.issues.push("Poor composition"),r.noise<70&&r.issues.push("Noisy"),r}static async generateAutoTags(t){const s=[];t.scene&&(s.push({tag:t.scene.primary,confidence:t.scene.confidence}),t.scene.categories.forEach(n=>s.push({tag:n,confidence:t.scene.confidence*.9})),t.scene.activities.forEach(n=>s.push({tag:n,confidence:.85})),t.scene.events.forEach(n=>s.push({tag:n,confidence:.9}))),t.quality&&(t.quality.overall>80&&s.push({tag:"high-quality",confidence:.95}),t.quality.sharpness>85&&s.push({tag:"sharp",confidence:.9}),t.quality.issues.forEach(n=>s.push({tag:n.toLowerCase(),confidence:.8}))),t.pets&&t.pets.length>0&&t.pets.forEach(n=>{s.push({tag:n.type,confidence:n.confidence}),n.breed&&s.push({tag:n.breed,confidence:n.confidence*.8})});const r=new Map;return s.forEach(n=>{const i=r.get(n.tag);(!i||n.confidence>i)&&r.set(n.tag,n.confidence)}),Array.from(r.entries()).map(([n,i])=>({tag:n,confidence:i})).sort((n,i)=>i.confidence-n.confidence)}static calculateFaceSimilarity(t,s){let r=0,n=0,i=0;for(let u=0;u<t.length;u++)r+=t[u]*s[u],n+=t[u]*t[u],i+=s[u]*s[u];return r/(Math.sqrt(n)*Math.sqrt(i))}static calculateSharpness(t){const{data:s,width:r,height:n}=t;let i=0,u=0,c=0;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const p=(l*r+d)*4,y=-((s[p]+s[p+1]+s[p+2])/3)+(s[((l-1)*r+d)*4]+s[((l+1)*r+d)*4]+s[(l*r+(d-1))*4]+s[(l*r+(d+1))*4])/4;u+=y,c++}u/=c;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const p=(l*r+d)*4,y=-((s[p]+s[p+1]+s[p+2])/3)+(s[((l-1)*r+d)*4]+s[((l+1)*r+d)*4]+s[(l*r+(d-1))*4]+s[(l*r+(d+1))*4])/4;i+=Math.pow(y-u,2)}return i/=c,Math.min(100,Math.sqrt(i)*10)}static calculateExposure(t){const{data:s}=t,r=new Array(256).fill(0);for(let l=0;l<s.length;l+=4){const d=(s[l]+s[l+1]+s[l+2])/3;r[Math.floor(d)]++}const n=s.length/4,i=r.slice(0,20).reduce((l,d)=>l+d,0)/n,u=r.slice(235,256).reduce((l,d)=>l+d,0)/n;let c=100;return c-=i*200,c-=u*200,Math.max(0,Math.min(100,c))}static calculateComposition(t){const{width:s,height:r}=t;return 70+Math.random()*30}static calculateColorBalance(t){const{data:s}=t;let r=0,n=0,i=0;const u=s.length/4;for(let w=0;w<s.length;w+=4)r+=s[w],n+=s[w+1],i+=s[w+2];const c=r/u,l=n/u,d=i/u,p=Math.max(c,l,d),f=Math.min(c,l,d);return(1-(p-f)/p)*100}static calculateNoise(t){const{data:s,width:r,height:n}=t;let i=0,u=0;for(let c=1;c<n-1;c+=10)for(let l=1;l<r-1;l+=10){const d=(c*r+l)*4,p=(s[d]+s[d+1]+s[d+2])/3;let f=0;for(let y=-1;y<=1;y++)for(let w=-1;w<=1;w++){const j=((c+y)*r+(l+w))*4,b=(s[j]+s[j+1]+s[j+2])/3;f+=Math.pow(b-p,2)}i+=Math.sqrt(f/9),u++}return i/=u,Math.max(0,100-i)}}ne(mt,"faceThreshold",.85),ne(mt,"petThreshold",.7),ne(mt,"sceneThreshold",.6),ne(mt,"qualityWeights",{sharpness:.3,exposure:.25,composition:.25,colorBalance:.15,noise:.05});function fl({imagePath:a,detectedFaces:t=[],knownPeople:s,onVerify:r,onCreateNew:n}){const[i,u]=o.useState([]),[c,l]=o.useState(0),[d,p]=o.useState(""),[f,y]=o.useState(!1),[w,j]=o.useState(!1);o.useEffect(()=>{async function P(){if(t.length){j(!0);try{const S=await mt.verifyFaces(a,t,s);u(S)}catch(S){console.error("Face verification failed:",S)}finally{j(!1)}}}P()},[a,t,s]);const b=(P,S)=>{r(P,S),u(m=>m.map(h=>h.clusterId===P?{...h,verified:S}:h))},C=()=>{d.trim()&&(n(d),p(""),y(!1))};return t.length?w?e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Analyzing faces..."})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Face Recognition"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," face",t.length!==1?"s":""," detected"]})]}),t.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:t.map((P,S)=>e.jsx("button",{onClick:()=>l(S),className:`relative w-16 h-16 rounded overflow-hidden border-2 transition-colors ${c===S?"border-blue-500":"border-gray-300"}`,children:e.jsx("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium",children:S+1})})},S))}),i[c]&&e.jsxs("div",{className:"space-y-3",children:[i[c].suggested?e.jsx("div",{className:"p-3 bg-blue-50 rounded",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Suggested: ",s.get(i[c].clusterId)?.name||"Unknown"]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Confidence: ",(i[c].confidence*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(i[c].clusterId,!0),className:`px-3 py-1 text-xs rounded ${i[c].verified===!0?"bg-green-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:" Correct"}),e.jsx("button",{onClick:()=>b(i[c].clusterId,!1),className:`px-3 py-1 text-xs rounded ${i[c].verified===!1?"bg-red-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:" Wrong"})]})]})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-600",children:"No match found"})}),f?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:P=>p(P.target.value),onKeyPress:P=>P.key==="Enter"&&C(),placeholder:"Enter person's name",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:border-blue-500",autoFocus:!0}),e.jsx("button",{onClick:C,className:"px-3 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Add"}),e.jsx("button",{onClick:()=>{y(!1),p("")},className:"px-3 py-2 text-sm bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"})]}):e.jsx("button",{onClick:()=>y(!0),className:"w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50",children:"+ Tag as new person"})]})]}):e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No faces detected in this photo"})})}function bl({imagePath:a,show:t,imageData:s}){const[r,n]=o.useState(null),[i,u]=o.useState(!1);if(o.useEffect(()=>{if(!t)return;async function p(){u(!0);try{const f=await mt.assessQuality(a,s);n(f)}catch(f){console.error("Quality assessment failed:",f)}finally{u(!1)}}p()},[a,t,s]),!t)return null;const c=p=>p>=80?"text-green-600":p>=60?"text-yellow-600":p>=40?"text-orange-600":"text-red-600",l=p=>p>=80?"Excellent":p>=60?"Good":p>=40?"Fair":"Poor",d=(p,f)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:f}),e.jsx("span",{className:c(p),children:p.toFixed(0)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all ${p>=80?"bg-green-500":p>=60?"bg-yellow-500":p>=40?"bg-orange-500":"bg-red-500"}`,style:{width:`${p}%`}})})]});return i?e.jsx("div",{className:"absolute top-2 left-2 bg-white/90 backdrop-blur rounded-lg p-3 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Analyzing quality..."})]})}):r?e.jsxs("div",{className:"absolute top-2 left-2 bg-white/95 backdrop-blur rounded-lg p-3 shadow-lg max-w-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:"Quality Score"}),e.jsx("p",{className:`text-2xl font-bold ${c(r.overall)}`,children:r.overall.toFixed(0)})]}),e.jsx("div",{className:`text-sm ${c(r.overall)}`,children:l(r.overall)})]}),e.jsxs("div",{className:"space-y-2",children:[d(r.sharpness,"Sharpness"),d(r.exposure,"Exposure"),d(r.composition,"Composition"),d(r.colorBalance,"Color Balance"),d(r.noise,"Noise Level")]}),r.issues.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Issues Detected:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.issues.map((p,f)=>e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded",children:p},f))})]})]}):null}class yl{constructor(){ne(this,"cache",new Map);ne(this,"pendingRequests",new Map)}async getMetadata(t,s){const r=`${t}:${s}`;if(this.cache.has(r))return this.cache.get(r)||null;if(this.pendingRequests.has(r))return this.pendingRequests.get(r)||null;const n=this.fetchMetadata(t,s);this.pendingRequests.set(r,n);try{const i=await n;return this.cache.set(r,i),i}catch(i){return console.warn(`Failed to fetch metadata for ${s}:`,i),null}finally{this.pendingRequests.delete(r)}}async fetchMetadata(t,s){const n=(await yt(t,s)).meta||{},i={make:n.make||n.Make,model:n.model||n.Model,lens_make:n.lens_make||n.LensMake,lens_model:n.lens_model||n.LensModel,iso:this.parseNumber(n.iso||n.ISO),aperture:this.parseNumber(n.aperture||n.FNumber),shutter_speed:n.shutter_speed||n.ExposureTime,exposure_time:this.parseNumber(n.exposure_time),focal_length:this.parseNumber(n.focal_length||n.FocalLength),date_taken:n.date_taken||n.DateTime||n.DateTimeOriginal,date_modified:n.date_modified||n.ModifyDate,latitude:this.parseNumber(n.latitude||n.GPSLatitude),longitude:this.parseNumber(n.longitude||n.GPSLongitude),altitude:this.parseNumber(n.altitude||n.GPSAltitude),gps_direction:this.parseNumber(n.gps_direction),location_name:n.location_name,width:this.parseNumber(n.width||n.ImageWidth),height:this.parseNumber(n.height||n.ImageHeight),orientation:this.parseNumber(n.orientation||n.Orientation),color_space:n.color_space||n.ColorSpace,flash:n.flash||n.Flash,flash_fired:n.flash_fired,white_balance:n.white_balance||n.WhiteBalance,metering_mode:n.metering_mode||n.MeteringMode,quality:n.quality,compression:n.compression,software:n.software||n.Software,title:n.title||n.Title,description:n.description||n.Description,keywords:this.parseKeywords(n.keywords||n.Keywords),copyright:n.copyright||n.Copyright,artist:n.artist||n.Artist,rating:this.parseNumber(n.rating||n.Rating)},u={path:s,fileSize:this.parseNumber(n.file_size),mimeType:n.mime_type,exif:i,displayName:s.split("/").pop()||s};return i.width&&i.height&&(u.megapixels=Math.round(i.width*i.height/1e6*10)/10,u.aspectRatio=this.calculateAspectRatio(i.width,i.height)),u}parseNumber(t){if(typeof t=="number")return t;if(typeof t=="string"){const s=parseFloat(t);return isNaN(s)?void 0:s}}parseKeywords(t){if(Array.isArray(t))return t.filter(s=>typeof s=="string");if(typeof t=="string")return t.split(/[,;]/).map(s=>s.trim()).filter(Boolean)}calculateAspectRatio(t,s){const r=(l,d)=>d===0?l:r(d,l%d),n=r(t,s),i=t/n,u=s/n,c=i/u;return Math.abs(c-1.5)<.01?"3:2":Math.abs(c-1.33)<.01?"4:3":Math.abs(c-1.78)<.01?"16:9":Math.abs(c-1)<.01?"1:1":`${i}:${u}`}formatExifValue(t,s){if(s==null)return"N/A";switch(t){case"aperture":return`f/${s}`;case"shutter_speed":case"exposure_time":return typeof s=="number"?s>=1?`${s}s`:`1/${Math.round(1/s)}s`:String(s);case"focal_length":return`${s}mm`;case"iso":return`ISO ${s}`;case"file_size":return this.formatFileSize(s);case"megapixels":return`${s}MP`;case"date_taken":case"date_modified":return this.formatDate(s);case"latitude":case"longitude":return`${s.toFixed(6)}`;case"altitude":return`${s}m`;default:return String(s)}}formatFileSize(t){if(t===0)return"0 B";const s=1024,r=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(s));return`${parseFloat((t/Math.pow(s,n)).toFixed(1))} ${r[n]}`}formatDate(t){try{const s=new Date(t);return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return t}}getFilterValues(t){const s=new Set,r=new Set,n=[],i=[],u=[],c=new Set;return t.forEach(l=>{const d=l.exif;if(d&&(d.make&&d.model&&s.add(`${d.make} ${d.model}`),d.lens_make&&d.lens_model?r.add(`${d.lens_make} ${d.lens_model}`):d.lens_model&&r.add(d.lens_model),d.iso&&n.push(d.iso),d.aperture&&i.push(d.aperture),d.focal_length&&u.push(d.focal_length),d.date_taken))try{const p=new Date(d.date_taken).getFullYear();isNaN(p)||c.add(p)}catch{}}),{cameras:Array.from(s).sort(),lenses:Array.from(r).sort(),isoRange:n.length>0?[Math.min(...n),Math.max(...n)]:[0,0],apertureRange:i.length>0?[Math.min(...i),Math.max(...i)]:[0,0],focalLengthRange:u.length>0?[Math.min(...u),Math.max(...u)]:[0,0],years:Array.from(c).sort((l,d)=>d-l)}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}}const vl=new yl;function ht({className:a="",width:t,height:s,variant:r="rectangular"}){const n={text:"h-4 rounded",circular:"rounded-full",rectangular:"rounded"},i={...t&&{width:typeof t=="number"?`${t}px`:t},...s&&{height:typeof s=="number"?`${s}px`:s}};return e.jsx("div",{className:`bg-gray-200 animate-pulse ${n[r]} ${a}`,style:i})}function jl(){return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ht,{height:16,width:"60%"}),e.jsx(ht,{height:14,width:"80%"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ht,{height:16,width:"40%"}),e.jsx(ht,{height:14,width:"70%"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ht,{height:16,width:"50%"}),e.jsx(ht,{height:14,width:"90%"})]})]})}const on=o.createContext(null);function ba(){const a=o.useContext(on);if(!a)throw new Error("useToast must be used within ToastProvider");return a}function wl({children:a}){const[t,s]=o.useState([]),r=o.useCallback(p=>{const f=Math.random().toString(36).substring(2,9),y={id:f,duration:p.duration??5e3,...p};return s(w=>[...w,y]),y.duration&&y.duration>0&&setTimeout(()=>{n(f)},y.duration),f},[]),n=o.useCallback(p=>{s(f=>f.filter(y=>y.id!==p))},[]),i=o.useCallback((p,f,y)=>r({type:"success",title:p,description:f,...y}),[r]),u=o.useCallback((p,f,y)=>r({type:"error",title:p,description:f,duration:0,...y}),[r]),c=o.useCallback((p,f,y)=>r({type:"warning",title:p,description:f,...y}),[r]),l=o.useCallback((p,f,y)=>r({type:"info",title:p,description:f,...y}),[r]),d={toasts:t,addToast:r,removeToast:n,success:i,error:u,warning:c,info:l};return e.jsxs(on.Provider,{value:d,children:[a,e.jsx(Nl,{})]})}function Nl(){const{toasts:a}=ba();return e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:a.map(t=>e.jsx(kl,{toast:t},t.id))})}function kl({toast:a}){const{removeToast:t}=ba(),[s,r]=o.useState(!1);o.useEffect(()=>{const l=setTimeout(()=>r(!0),10);return()=>clearTimeout(l)},[]);const n=()=>{r(!1),setTimeout(()=>t(a.id),200)},u={success:{icon:Mt,bgColor:"bg-green-50",borderColor:"border-green-200",iconColor:"text-green-600",titleColor:"text-green-900",descColor:"text-green-700"},error:{icon:Ds,bgColor:"bg-red-50",borderColor:"border-red-200",iconColor:"text-red-600",titleColor:"text-red-900",descColor:"text-red-700"},warning:{icon:Fs,bgColor:"bg-yellow-50",borderColor:"border-yellow-200",iconColor:"text-yellow-600",titleColor:"text-yellow-900",descColor:"text-yellow-700"},info:{icon:st,bgColor:"bg-blue-50",borderColor:"border-blue-200",iconColor:"text-blue-600",titleColor:"text-blue-900",descColor:"text-blue-700"}}[a.type],c=u.icon;return e.jsx("div",{className:`
        ${u.bgColor} ${u.borderColor} 
        border rounded-lg shadow-lg p-4 transition-all duration-300 ease-in-out transform
        ${s?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(c,{className:`w-5 h-5 ${u.iconColor} flex-shrink-0 mt-0.5`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium ${u.titleColor}`,children:a.title}),a.description&&e.jsx("p",{className:`mt-1 text-sm ${u.descColor}`,children:a.description}),a.action&&e.jsx("button",{onClick:a.action.onClick,className:`mt-2 text-sm font-medium underline ${u.iconColor} hover:no-underline`,children:a.action.label})]}),e.jsx("button",{onClick:n,className:`ml-2 flex-shrink-0 p-1 rounded-full hover:bg-black/5 ${u.iconColor}`,children:e.jsx(je,{className:"w-4 h-4"})})]})})}function Sl(){const a=ba();return{photoAdded:t=>a.success("Photo added",`${t} has been added to your collection`),photoDeleted:t=>a.success("Photo deleted",`${t} has been moved to trash`),photoFavorited:t=>a.success("Added to favorites",`${t} has been marked as favorite`),photoCopied:t=>a.success("Photos copied",`${t} photo${t>1?"s":""} copied to clipboard`),searchCompleted:(t,s)=>a.info("Search completed",`Found ${t} photo${t!==1?"s":""} matching "${s}"`),indexingProgress:(t,s)=>a.info("Indexing photos",`Processing ${t}/${s} photos...`,{duration:1e3}),exportCompleted:(t,s)=>a.success("Export completed",`${t} photo${t>1?"s":""} exported to ${s}`),errorLoading:t=>a.error("Failed to load photo",`Unable to load ${t}. The file may be corrupted or missing.`),errorNetwork:()=>a.error("Network error","Unable to connect to the photo service. Please check your connection."),copyToClipboard:async(t,s="text")=>{try{await navigator.clipboard.writeText(t),a.success("Copied to clipboard",`${s} has been copied to your clipboard`)}catch{a.error("Copy failed","Unable to copy to clipboard. Please copy manually.")}}}}const Wa=[{id:"camera",title:"Camera Information",icon:_t,collapsible:!0,defaultOpen:!0,fields:[{key:"make",label:"Camera Make",copyable:!0},{key:"model",label:"Camera Model",copyable:!0},{key:"lens_make",label:"Lens Make",copyable:!0},{key:"lens_model",label:"Lens Model",copyable:!0},{key:"software",label:"Software",copyable:!0}]},{id:"settings",title:"Camera Settings",icon:vt,collapsible:!0,defaultOpen:!0,fields:[{key:"aperture",label:"Aperture",formatter:a=>a?`f/${a}`:void 0,copyable:!0},{key:"shutter_speed",label:"Shutter Speed",copyable:!0},{key:"iso",label:"ISO",formatter:a=>a?`ISO ${a}`:void 0,copyable:!0},{key:"focal_length",label:"Focal Length",formatter:a=>a?`${a}mm`:void 0,copyable:!0},{key:"flash",label:"Flash",copyable:!0},{key:"white_balance",label:"White Balance",copyable:!0},{key:"metering_mode",label:"Metering Mode",copyable:!0}]},{id:"image",title:"Image Properties",icon:Rt,collapsible:!0,defaultOpen:!0,fields:[{key:"width",label:"Width",formatter:a=>a?`${a}px`:void 0},{key:"height",label:"Height",formatter:a=>a?`${a}px`:void 0},{key:"megapixels",label:"Megapixels",formatter:a=>a?`${a}MP`:void 0},{key:"aspectRatio",label:"Aspect Ratio"},{key:"colorSpace",label:"Color Space",copyable:!0},{key:"bitDepth",label:"Bit Depth",formatter:a=>a?`${a} bit`:void 0}]},{id:"datetime",title:"Date & Time",icon:Os,collapsible:!0,defaultOpen:!0,fields:[{key:"date_taken",label:"Date Taken",formatter:a=>a?new Date(a).toLocaleString():void 0,copyable:!0},{key:"date_modified",label:"Date Modified",formatter:a=>a?new Date(a).toLocaleString():void 0,copyable:!0}]},{id:"location",title:"Location",icon:ns,collapsible:!0,defaultOpen:!1,fields:[{key:"location_name",label:"Location",copyable:!0,linkable:!0},{key:"latitude",label:"Latitude",formatter:a=>a?`${a.toFixed(6)}`:void 0,copyable:!0},{key:"longitude",label:"Longitude",formatter:a=>a?`${a.toFixed(6)}`:void 0,copyable:!0},{key:"altitude",label:"Altitude",formatter:a=>a?`${a}m`:void 0}]}];function Cl({dir:a,path:t,onClose:s,compact:r=!1,className:n=""}){const[i,u]=o.useState(null),[c,l]=o.useState(!0),[d,p]=o.useState(null),[f,y]=o.useState(new Set(Wa.filter(S=>!S.defaultOpen).map(S=>S.id))),w=Sl();o.useEffect(()=>{let S=!1;async function m(){if(t)try{l(!0),p(null);const h=await vl.getMetadata(a,t);S||u(h)}catch(h){S||p(h instanceof Error?h.message:"Failed to load metadata")}finally{S||l(!1)}}return m(),()=>{S=!0}},[a,t]);const j=S=>{const m=new Set(f);m.has(S)?m.delete(S):m.add(S),y(m)},b=async(S,m)=>{await w.copyToClipboard(S,m)},C=S=>{const m=encodeURIComponent(S);window.open(`https://maps.google.com/maps?q=${m}`,"_blank")};if(c)return e.jsxs("div",{className:`bg-white rounded-lg shadow-lg ${r?"p-3":"p-4"} ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Image Information"}),s&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close metadata panel",children:e.jsx(De,{size:16})})]}),e.jsx(jl,{})]});if(d)return e.jsxs("div",{className:`bg-white rounded-lg shadow-lg ${r?"p-3":"p-4"} ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Image Information"}),s&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(De,{size:16})})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(st,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:d})]})]});if(!i)return e.jsxs("div",{className:`bg-white rounded-lg shadow-lg ${r?"p-3":"p-4"} ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Image Information"}),s&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(De,{size:16})})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(st,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No metadata available"})]})]});const P={...i.exif,megapixels:i.megapixels,aspectRatio:i.aspectRatio,fileSize:i.fileSize,colorSpace:i.exif?.color_space||"sRGB",bitDepth:8};return e.jsxs("div",{className:`bg-white rounded-lg shadow-lg ${r?"p-3":"p-4"} ${n} max-h-96 overflow-y-auto`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sticky top-0 bg-white pb-2 border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Image Information"}),s&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close metadata panel",children:e.jsx(De,{size:16})})]}),e.jsxs("div",{className:"space-y-3",children:[Wa.map(S=>{const m=f.has(S.id),h=S.fields.filter(k=>{const E=P[k.key];return E!=null&&E!==""});if(h.length===0)return null;const v=S.icon;return e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[S.collapsible?e.jsxs("button",{onClick:()=>j(S.id),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"font-medium text-sm text-gray-900",children:S.title}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",h.length,")"]})]}),e.jsx(Rs,{size:16,className:`text-gray-400 transition-transform ${m?"-rotate-90":""}`})]}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50",children:[e.jsx(v,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"font-medium text-sm text-gray-900",children:S.title})]}),!m&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("div",{className:"space-y-2",children:h.map(k=>{const E=P[k.key],T=k.formatter?k.formatter(E):E;return e.jsxs("div",{className:"flex justify-between items-center group",children:[e.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[k.label,":"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-900 font-mono",children:T}),e.jsxs("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity",children:[k.copyable&&e.jsx("button",{onClick:()=>b(String(T),k.label),className:"p-1 hover:bg-gray-100 rounded",title:`Copy ${k.label}`,children:e.jsx(It,{size:12,className:"text-gray-400"})}),k.linkable&&k.key==="place"&&e.jsx("button",{onClick:()=>C(String(T)),className:"p-1 hover:bg-gray-100 rounded",title:"Open in Google Maps",children:e.jsx(Ls,{size:12,className:"text-gray-400"})})]})]})]},k.key)})})})]},S.id)}),i.exif?.keywords&&i.exif.keywords.length>0&&e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50",children:[e.jsx(As,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"font-medium text-sm text-gray-900",children:"Keywords"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.exif.keywords.length,")"]})]}),e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:i.exif.keywords.map((S,m)=>e.jsx("button",{onClick:()=>b(S,"Keyword"),className:"px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-xs font-medium transition-colors",title:"Click to copy",children:S},m))})})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50",children:[e.jsx(sr,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"font-medium text-sm text-gray-900",children:"File Information"})]}),e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center group",children:[e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Filename:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-900 font-mono max-w-48 truncate",children:i.displayName}),e.jsx("button",{onClick:()=>b(i.displayName||"","Filename"),className:"p-1 hover:bg-gray-100 rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Copy filename",children:e.jsx(It,{size:12,className:"text-gray-400"})})]})]}),e.jsxs("div",{className:"flex justify-between items-center group",children:[e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Full Path:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-900 font-mono max-w-48 truncate",children:i.path}),e.jsx("button",{onClick:()=>b(i.path,"File path"),className:"p-1 hover:bg-gray-100 rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Copy full path",children:e.jsx(It,{size:12,className:"text-gray-400"})})]})]})]})]})]})]})}const Tl={minSwipeDistance:50,maxSwipeTime:300,minPinchDistance:10,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!0,pullToRefreshThreshold:80};class El{constructor(t={}){ne(this,"config");ne(this,"touchStartPoints",[]);ne(this,"gestureState",{isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0});ne(this,"touchStartTime",0);ne(this,"lastTouchEndTime",0);ne(this,"doubleTapTimer",null);ne(this,"pullStartY",0);ne(this,"isPulling",!1);ne(this,"onSwipeCallback");ne(this,"onPinchCallback");ne(this,"onPanCallback");ne(this,"onDoubleTapCallback");ne(this,"onPullToRefreshCallback");this.config={...Tl,...t}}onSwipe(t){return this.onSwipeCallback=t,this}onPinch(t){return this.onPinchCallback=t,this}onPan(t){return this.onPanCallback=t,this}onDoubleTap(t){return this.onDoubleTapCallback=t,this}onPullToRefresh(t){return this.onPullToRefreshCallback=t,this}handleTouchStart(t){this.touchStartTime=Date.now(),this.touchStartPoints=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));const s=Date.now();this.doubleTapTimer&&s-this.lastTouchEndTime<300?(this.handleDoubleTap(this.touchStartPoints[0].x,this.touchStartPoints[0].y),this.clearDoubleTapTimer()):this.startDoubleTapTimer(),this.gestureState.lastScale=this.gestureState.scale,this.gestureState.lastTranslateX=this.gestureState.translateX,this.gestureState.lastTranslateY=this.gestureState.translateY,this.config.enablePullToRefresh&&this.isAtTopOfPage()&&(this.pullStartY=this.touchStartPoints[0].y,this.isPulling=!0)}handleTouchMove(t){t.preventDefault();const s=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));s.length===1?this.handleSingleTouchMove(s[0]):s.length===2&&this.handlePinchMove(s)}handleTouchEnd(t){const s=Date.now()-this.touchStartTime;this.lastTouchEndTime=Date.now(),this.gestureState.isSwiping&&s<this.config.maxSwipeTime&&this.handleSwipe(t.changedTouches[0]),this.gestureState.isPinching=!1,this.gestureState.isPanning=!1,this.gestureState.isSwiping=!1,this.isPulling=!1}handleSingleTouchMove(t){const s=this.touchStartPoints[0];if(!s)return;const r=t.x-s.x,n=t.y-s.y,i=Math.sqrt(r*r+n*n);if(this.isPulling&&this.config.enablePullToRefresh&&t.y-this.pullStartY>this.config.pullToRefreshThreshold){this.triggerPullToRefresh(),this.isPulling=!1;return}if(this.gestureState.scale>1){this.gestureState.isPanning=!0,this.gestureState.translateX=this.gestureState.lastTranslateX+r,this.gestureState.translateY=this.gestureState.lastTranslateY+n,this.onPanCallback&&this.onPanCallback(r,n);return}i>this.config.minSwipeDistance&&!this.gestureState.isPanning&&(this.gestureState.isSwiping=!0)}handlePinchMove(t){if(t.length!==2)return;const s=this.touchStartPoints.find(u=>u.id===t[0].id),r=this.touchStartPoints.find(u=>u.id===t[1].id);if(!s||!r)return;const n=this.getDistance(s,r),i=this.getDistance(t[0],t[1]);if(Math.abs(i-n)>this.config.minPinchDistance){this.gestureState.isPinching=!0;const u=i/n*this.gestureState.lastScale,c=Math.max(this.config.minScale,Math.min(this.config.maxScale,u)),l=(t[0].x+t[1].x)/2,d=(t[0].y+t[1].y)/2;this.gestureState.scale=c,this.onPinchCallback&&this.onPinchCallback(c,l,d)}}handleSwipe(t){const s=this.touchStartPoints[0];if(!s)return;const r=t.clientX-s.x,n=t.clientY-s.y,i=Math.abs(r),u=Math.abs(n);if(i>u&&i>this.config.minSwipeDistance){const c={left:r<0,right:r>0,up:!1,down:!1};this.onSwipeCallback&&this.onSwipeCallback(c)}}handleDoubleTap(t,s){this.onDoubleTapCallback&&this.onDoubleTapCallback(t,s)}triggerPullToRefresh(){this.onPullToRefreshCallback&&this.onPullToRefreshCallback()}getDistance(t,s){const r=s.x-t.x,n=s.y-t.y;return Math.sqrt(r*r+n*n)}isAtTopOfPage(){return window.scrollY<=10}startDoubleTapTimer(){this.clearDoubleTapTimer(),this.doubleTapTimer=window.setTimeout(()=>{this.doubleTapTimer=null},300)}clearDoubleTapTimer(){this.doubleTapTimer&&(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null)}reset(){this.gestureState={isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0},this.touchStartPoints=[],this.isPulling=!1}getScale(){return this.gestureState.scale}getTranslation(){return{x:this.gestureState.translateX,y:this.gestureState.translateY}}isGestureActive(){return this.gestureState.isPinching||this.gestureState.isPanning||this.gestureState.isSwiping}}function Pl(a,t){const s=React.useRef();return React.useEffect(()=>{if(!a.current)return;s.current=new El(t);const r=a.current,n=c=>{s.current?.handleTouchStart(c)},i=c=>{s.current?.handleTouchMove(c)},u=c=>{s.current?.handleTouchEnd(c)};return r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("touchmove",i,{passive:!1}),r.addEventListener("touchend",u,{passive:!1}),()=>{r.removeEventListener("touchstart",n),r.removeEventListener("touchmove",i),r.removeEventListener("touchend",u)}},[a,t]),s.current}function Il({dir:a,engine:t,path:s,onPrev:r,onNext:n,onClose:i,onReveal:u,onFavorite:c,onMoreLikeThis:l,currentIndex:d,totalCount:p}){if(!s)return null;const f=o.useRef(null),y=o.useRef(null),[w,j]=o.useState(1),[b,C]=o.useState(0),[P,S]=o.useState(0),[m,h]=o.useState(!1),[v,k]=o.useState(!0),[E,T]=o.useState(!1),[N,O]=o.useState(!0),[U,Z]=o.useState(!1),[F,K]=o.useState(!1),[_,M]=o.useState(!1),[W,se]=o.useState(!1),[B,me]=o.useState(!1),[A,ee]=o.useState(""),ie=o.useRef({x:0,y:0,tx:0,ty:0}),V=o.useRef(),Y=o.useCallback(()=>{V.current&&clearTimeout(V.current),O(!0),V.current=setTimeout(()=>{O(!1)},3e3)},[]);o.useEffect(()=>(Y(),()=>{V.current&&clearTimeout(V.current)}),[Y]),Pl(f,{minSwipeDistance:50,maxSwipeTime:300,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!1});const R=o.useCallback(oe=>{ee(oe),setTimeout(()=>ee(""),2e3)},[]);o.useEffect(()=>{function oe(X){if(!(F||B))switch(X.key){case"Escape":i();break;case"ArrowLeft":r();break;case"ArrowRight":n();break;case" ":X.preventDefault(),n();break;case"i":Z(ye=>!ye);break;case"f":c(),R("Added to favorites");break;case"e":K(!0);break;case"r":$(),R("Zoom reset");break;case"+":case"=":G();break;case"-":J();break;case"?":me(!0);break}}return document.addEventListener("keydown",oe),()=>document.removeEventListener("keydown",oe)},[i,r,n,c,F,B]);function H(oe,X,ye){const rt=w,Pe=Math.min(5,Math.max(.5,+(rt+oe).toFixed(2)));if(Pe===rt)return;const ds=y.current;if(ds&&X!==void 0&&ye!==void 0){const zt=ds.getBoundingClientRect(),Ut=X-zt.left,nt=ye-zt.top,ze=Pe/rt;C(b+(Ut-Ut*ze)),S(P+(nt-nt*ze))}j(Pe),R(`Zoom: ${Math.round(Pe*100)}%`)}function $(){j(1),C(0),S(0)}function G(){H(.2)}function J(){H(-.2)}function L(oe){oe.preventDefault(),Y();const X=oe.deltaY<0?.1:-.1;H(X,oe.clientX,oe.clientY)}function z(oe){w!==1&&(h(!0),ie.current={x:oe.clientX,y:oe.clientY,tx:b,ty:P},Y())}function ce(oe){if(Y(),!m)return;const X=oe.clientX-ie.current.x,ye=oe.clientY-ie.current.y;C(ie.current.tx+X),S(ie.current.ty+ye)}function Q(){h(!1)}function re(){h(!1)}function ue(oe){Y(),w===1?H(1,oe.clientX,oe.clientY):$()}o.useEffect(()=>{k(!0),T(!1),$()},[s]);const Ne=o.useCallback(async()=>{try{await navigator.clipboard.writeText(s),R("Path copied to clipboard")}catch{R("Failed to copy path")}},[s,R]);return e.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:i,onMouseMove:Y,children:e.jsxs("div",{className:"relative w-full h-full flex flex-col",onClick:oe=>oe.stopPropagation(),ref:f,role:"dialog","aria-modal":"true","aria-label":`Photo viewer: ${s}`,tabIndex:-1,children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/60 to-transparent p-4 transition-opacity duration-300 ${N?"opacity-100":"opacity-0"}`,children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 text-sm bg-white/10 hover:bg-white/20 px-3 py-1 rounded transition-colors",title:"Copy path (filename)",children:[e.jsx(It,{size:16}),e.jsx("span",{className:"truncate max-w-96",children:s.split("/").pop()})]}),d!==void 0&&p&&e.jsxs("span",{className:"text-sm bg-white/10 px-2 py-1 rounded",children:[d+1," / ",p]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>me(!0),className:"p-2 bg-white/10 hover:bg-white/20 rounded transition-colors",title:"Keyboard shortcuts (?)",children:e.jsx(ar,{size:18})}),e.jsx("button",{onClick:i,className:"p-2 bg-white/10 hover:bg-white/20 rounded transition-colors",title:"Close (Esc)",children:e.jsx(je,{size:18})})]})]})}),e.jsxs("div",{className:"flex-1 relative overflow-hidden",onWheel:L,onMouseDown:z,onMouseMove:ce,onMouseUp:Q,onMouseLeave:re,onDoubleClick:ue,style:{cursor:w>1&&m?"grabbing":w>1?"grab":"default"},children:[v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"})}),E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl mb-2",children:"Failed to load image"}),e.jsx("div",{className:"text-sm opacity-75",children:s})]})}),e.jsx("img",{ref:y,src:ke(a,t,s,1024),className:"w-full h-full object-contain select-none",style:{transform:`translate(${b}px, ${P}px) scale(${w})`,transformOrigin:"0 0"},alt:s,draggable:!1,onLoad:()=>k(!1),onError:()=>{k(!1),T(!0)}}),e.jsx(bl,{imagePath:s,show:_}),e.jsx("button",{onClick:r,className:`absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-black/30 hover:bg-black/50 text-white rounded-full transition-all duration-300 ${N?"opacity-100":"opacity-0"}`,title:"Previous ()",children:e.jsx(Es,{size:24})}),e.jsx("button",{onClick:n,className:`absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-black/30 hover:bg-black/50 text-white rounded-full transition-all duration-300 ${N?"opacity-100":"opacity-0"}`,title:"Next ( or Space)",children:e.jsx(De,{size:24})})]}),e.jsx("div",{className:`absolute bottom-0 left-0 right-0 z-10 bg-gradient-to-t from-black/60 to-transparent p-4 transition-opacity duration-300 ${N?"opacity-100":"opacity-0"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-white/10 rounded p-1",children:[e.jsx("button",{onClick:J,className:"p-2 hover:bg-white/20 text-white rounded transition-colors",title:"Zoom out (-)",children:e.jsx(Xn,{size:18})}),e.jsxs("div",{className:"text-white text-sm min-w-12 text-center px-2",children:[Math.round(w*100),"%"]}),e.jsx("button",{onClick:G,className:"p-2 hover:bg-white/20 text-white rounded transition-colors",title:"Zoom in (+)",children:e.jsx(Zn,{size:18})}),e.jsx("button",{onClick:$,className:"p-2 hover:bg-white/20 text-white rounded transition-colors",title:"Reset zoom (R)",children:e.jsx(ei,{size:18})})]}),e.jsx("button",{onClick:()=>{Z(oe=>!oe)},className:`p-2 rounded transition-colors ${U?"bg-blue-600 text-white":"bg-white/10 hover:bg-white/20 text-white"}`,title:"Toggle info (I)",children:e.jsx(st,{size:18})}),e.jsx("button",{onClick:()=>{M(oe=>!oe)},className:`p-2 rounded transition-colors ${_?"bg-green-600 text-white":"bg-white/10 hover:bg-white/20 text-white"}`,title:"Toggle quality overlay",children:e.jsx(ti,{size:18})}),e.jsx("button",{onClick:()=>K(!0),className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded transition-colors",title:"Edit image (E)",children:e.jsx(si,{size:18})}),e.jsx("button",{onClick:()=>{c(),R("Added to favorites")},className:"p-2 bg-white/10 hover:bg-pink-600/80 text-white rounded transition-colors",title:"Add to favorites (F)",children:e.jsx(Ot,{size:18})}),e.jsx("button",{onClick:u,className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded transition-colors",title:"Reveal in file explorer",children:e.jsx(Ls,{size:18})}),l&&e.jsx("button",{onClick:l,className:"p-2 bg-white/10 hover:bg-blue-600/80 text-white rounded transition-colors",title:"Find similar images",children:e.jsx(ai,{size:18})})]})}),A&&e.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 bg-black/80 text-white px-4 py-2 rounded animate-fade-in-out",children:A}),U&&e.jsx("div",{className:"absolute top-16 right-4 w-96",children:e.jsx(Cl,{dir:a,path:s,onClose:()=>Z(!1),compact:!1,className:"animate-slide-in-right"})}),B&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:()=>me(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(je,{size:20})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Next image"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:" or Space"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Previous image"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:""})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Close"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"Esc"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Toggle info"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"I"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Add to favorites"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"F"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Edit image"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"E"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Zoom in/out"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"+ / -"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Reset zoom"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"R"})]})]})]})}),W&&e.jsx("div",{className:"absolute bottom-20 left-4 right-4 bg-white/95 backdrop-blur text-gray-900 rounded-lg p-4 shadow-lg",children:e.jsx(fl,{imagePath:s,detectedFaces:[],knownPeople:new Map,onVerify:(oe,X)=>{console.log("Face verified:",oe,X)},onCreateNew:oe=>{console.log("New person created:",oe)}})}),F&&e.jsx(nn,{imagePath:s,onSave:oe=>{R("Image saved successfully"),K(!1)},onClose:()=>K(!1)})]})})}function $l({videoPath:a,videoUrl:t,onClose:s,onNext:r,onPrevious:n}){const i=o.useRef(null),u=o.useRef(null),[c,l]=o.useState(null),[d,p]=o.useState(!1),[f,y]=o.useState(!1),[w,j]=o.useState(0),[b,C]=o.useState(0),[P,S]=o.useState(1),[m,h]=o.useState(!0),[v,k]=o.useState(!0),[E,T]=o.useState(0),[N,O]=o.useState(!1),[U,Z]=o.useState([]),[F,K]=o.useState(null),[_,M]=o.useState(!1),W=o.useRef();o.useEffect(()=>(se(),()=>{W.current&&clearTimeout(W.current)}),[a,t]);const se=async()=>{k(!0);try{const Q=await Oe.getVideoInfo(a,t);l(Q),Oe.extractKeyframes(t,10,120,68).then(re=>Z(re)).catch(console.error)}catch(Q){console.error("Failed to load video info:",Q)}finally{k(!1)}},B=()=>{i.current&&(d?i.current.pause():i.current.play(),p(!d))},me=()=>{i.current&&(i.current.muted=!f,y(!f))},A=Q=>{const re=parseFloat(Q.target.value);S(re),i.current&&(i.current.volume=re,y(re===0))},ee=Q=>{if(i.current&&u.current){const re=u.current.getBoundingClientRect(),Ne=(Q.clientX-re.left)/re.width*b;i.current.currentTime=Ne,j(Ne)}},ie=()=>{if(i.current&&(j(i.current.currentTime),i.current.buffered.length>0)){const Q=i.current.buffered.end(i.current.buffered.length-1);T(Q/b*100)}},V=()=>{i.current&&C(i.current.duration)},Y=Q=>{i.current&&(i.current.currentTime+=Q)},R=()=>{i.current&&(document.fullscreenElement?document.exitFullscreen():i.current.requestFullscreen())},H=()=>{h(!0),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{d&&h(!1)},3e3)},$=Q=>{switch(Q.key){case" ":Q.preventDefault(),B();break;case"ArrowLeft":Y(-10);break;case"ArrowRight":Y(10);break;case"ArrowUp":S(Math.min(1,P+.1));break;case"ArrowDown":S(Math.max(0,P-.1));break;case"m":me();break;case"f":R();break;case"Escape":s();break}},G=Q=>{if(Q.touches.length===1){const re=Q.touches[0];K({x:re.clientX,y:re.clientY}),M(!1)}},J=Q=>{if(!F||Q.touches.length!==1)return;const re=Q.touches[0],ue=re.clientX-F.x,Ne=re.clientY-F.y,oe=Math.abs(ue),X=Math.abs(Ne);oe>X&&oe>30&&M(!0)},L=Q=>{if(!F||!_){K(null),M(!1);return}const ue=Q.changedTouches[0].clientX-F.x;Math.abs(ue)>50&&(ue>0?n&&n():r&&r()),K(null),M(!1)},z=Q=>Oe.formatDuration(Q),ce=b>0?w/b*100:0;return e.jsxs("div",{className:"video-lightbox",onMouseMove:H,onKeyDown:$,onTouchStart:G,onTouchMove:J,onTouchEnd:L,tabIndex:0,children:[e.jsx("div",{className:"video-container",children:v?e.jsxs("div",{className:"loading-spinner",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading video..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:i,src:t,onTimeUpdate:ie,onLoadedMetadata:V,onEnded:()=>p(!1),onClick:B,className:"video-player"}),e.jsxs("div",{className:`video-controls ${m?"visible":"hidden"}`,children:[e.jsxs("div",{className:"timeline-container",children:[e.jsxs("div",{ref:u,className:"progress-bar",onClick:ee,children:[e.jsx("div",{className:"buffered-bar",style:{width:`${E}%`}}),e.jsx("div",{className:"progress-fill",style:{width:`${ce}%`}}),e.jsx("div",{className:"progress-handle",style:{left:`${ce}%`}}),U.length>0&&e.jsx("div",{className:"keyframes",children:U.map((Q,re)=>e.jsx("img",{src:Q,className:"keyframe",style:{left:`${(re+1)*(100/(U.length+1))}%`},alt:""},re))})]}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:z(w)}),e.jsx("span",{className:"separator",children:"/"}),e.jsx("span",{children:z(b)})]})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsxs("div",{className:"controls-left",children:[e.jsx("button",{onClick:B,className:"control-btn",children:d?e.jsx(zs,{}):e.jsx(pt,{})}),e.jsx("button",{onClick:()=>Y(-10),className:"control-btn",children:e.jsx(Ia,{})}),e.jsx("button",{onClick:()=>Y(10),className:"control-btn",children:e.jsx($a,{})}),e.jsxs("div",{className:"volume-control",children:[e.jsx("button",{onClick:me,className:"control-btn",children:f||P===0?e.jsx(ri,{}):e.jsx(ni,{})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:P,onChange:A,className:"volume-slider"})]})]}),e.jsxs("div",{className:"controls-right",children:[e.jsx("button",{onClick:()=>O(!N),className:"control-btn",children:e.jsx(st,{})}),e.jsx("button",{onClick:R,className:"control-btn",children:e.jsx(er,{})}),e.jsx("a",{href:t,download:a.split("/").pop(),className:"control-btn",children:e.jsx(_e,{})})]})]})]}),N&&c&&e.jsxs("div",{className:"video-info-overlay",children:[e.jsx("h3",{children:a.split("/").pop()}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{children:["Format: ",c.format]}),e.jsxs("div",{children:["Resolution: ",c.metadata.width,"",c.metadata.height]}),e.jsxs("div",{children:["Duration: ",z(c.metadata.duration)]}),e.jsxs("div",{children:["Codec: ",c.metadata.codec]}),e.jsxs("div",{children:["Quality: ",Oe.getResolutionLabel(c.metadata.width,c.metadata.height)]}),e.jsxs("div",{children:["Audio: ",c.metadata.hasAudio?"Yes":"No"]})]})]})]})}),n&&e.jsx("button",{onClick:n,className:"nav-btn nav-prev",children:e.jsx(Ia,{})}),r&&e.jsx("button",{onClick:r,className:"nav-btn nav-next",children:e.jsx($a,{})}),e.jsx("button",{onClick:s,className:"close-btn",children:""}),e.jsx("style",{jsx:!0,children:`
        .video-lightbox {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.95);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
        }

        .video-container {
          position: relative;
          width: 90%;
          max-width: 1200px;
          height: 80vh;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .video-player {
          width: 100%;
          height: 100%;
          object-fit: contain;
          cursor: pointer;
        }

        .video-controls {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
          padding: 2rem 1rem 1rem;
          transition: opacity 0.3s;
        }

        .video-controls.hidden {
          opacity: 0;
          pointer-events: none;
        }

        .timeline-container {
          margin-bottom: 1rem;
        }

        .progress-bar {
          position: relative;
          height: 6px;
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
          cursor: pointer;
          margin-bottom: 0.5rem;
        }

        .progress-bar:hover {
          height: 10px;
        }

        .buffered-bar {
          position: absolute;
          height: 100%;
          background: rgba(255, 255, 255, 0.3);
          border-radius: 3px;
        }

        .progress-fill {
          position: absolute;
          height: 100%;
          background: var(--accent-primary);
          border-radius: 3px;
        }

        .progress-handle {
          position: absolute;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 14px;
          height: 14px;
          background: white;
          border-radius: 50%;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .keyframes {
          position: absolute;
          top: -80px;
          left: 0;
          right: 0;
          height: 68px;
          opacity: 0;
          transition: opacity 0.2s;
          pointer-events: none;
        }

        .progress-bar:hover .keyframes {
          opacity: 1;
        }

        .keyframe {
          position: absolute;
          height: 68px;
          width: 120px;
          object-fit: cover;
          border: 2px solid white;
          border-radius: 4px;
          transform: translateX(-50%);
        }

        .time-display {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: white;
          font-size: 0.875rem;
        }

        .control-buttons {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .controls-left, .controls-right {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .control-btn {
          background: none;
          border: none;
          color: white;
          cursor: pointer;
          padding: 0.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: opacity 0.2s;
        }

        .control-btn:hover {
          opacity: 0.7;
        }

        .control-btn svg {
          width: 20px;
          height: 20px;
        }

        .volume-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .volume-slider {
          width: 80px;
          opacity: 0;
          transition: opacity 0.2s;
        }

        .volume-control:hover .volume-slider {
          opacity: 1;
        }

        .video-info-overlay {
          position: absolute;
          top: 2rem;
          left: 2rem;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 1.5rem;
          border-radius: 8px;
          max-width: 400px;
        }

        .video-info-overlay h3 {
          margin-bottom: 1rem;
          font-size: 1.125rem;
        }

        .info-grid {
          display: grid;
          gap: 0.5rem;
          font-size: 0.875rem;
        }

        .nav-btn {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(0, 0, 0, 0.5);
          border: none;
          color: white;
          padding: 1rem;
          cursor: pointer;
          transition: background 0.2s;
        }

        .nav-btn:hover {
          background: rgba(0, 0, 0, 0.8);
        }

        .nav-prev {
          left: 1rem;
        }

        .nav-next {
          right: 1rem;
        }

        .close-btn {
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: none;
          border: none;
          color: white;
          font-size: 2rem;
          cursor: pointer;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .loading-spinner {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 1rem;
          color: white;
        }

        .spinner {
          width: 48px;
          height: 48px;
          border: 3px solid rgba(255, 255, 255, 0.2);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Ml({dir:a,engine:t,library:s,onLoadLibrary:r,selected:n=new Set,onToggleSelect:i,onOpen:u,tagsMap:c={}}){const[l,d]=o.useState("name"),[p,f]=o.useState("asc"),[y,w]=o.useState(!1),j=o.useCallback(h=>{const v=h.split("/").pop()||h,k=v.split(".").pop()?.toLowerCase()||"",T=(c[h]||[]).find(O=>O.startsWith("rating:")),N=T?parseInt(T.split(":")[1]):0;return{name:v,ext:k,rating:N,isVideo:Oe.isVideoFile(h)}},[c]),b=o.useMemo(()=>s.length?[...s].sort((h,v)=>{const k=j(h),E=j(v);let T=0;switch(l){case"name":T=k.name.localeCompare(E.name);break;case"rating":T=E.rating-k.rating;break;case"date":T=h.localeCompare(v);break;case"size":T=k.name.localeCompare(E.name);break;case"camera":T=k.name.localeCompare(E.name);break;default:T=0}return p==="desc"?-T:T}):[],[s,l,p,j]),C=o.useMemo(()=>{const h=s.length,v=s.filter(N=>Oe.isVideoFile(N)).length,k=h-v,E=n.size,T={1:0,2:0,3:0,4:0,5:0};return s.forEach(N=>{const U=(c[N]||[]).find(Z=>Z.startsWith("rating:"));if(U){const Z=parseInt(U.split(":")[1]);Z>=1&&Z<=5&&T[Z]++}}),{total:h,photos:k,videos:v,selected:E,ratings:T}},[s,n,c]),P=h=>{l===h?f(v=>v==="asc"?"desc":"asc"):(d(h),f("asc"))},S=()=>{i&&s.forEach(h=>{n.has(h)||i(h)})},m=()=>{i&&Array.from(n).forEach(h=>{i(h)})};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"font-semibold",children:"Library"}),e.jsx("button",{onClick:()=>w(!y),className:`p-1 rounded ${y?"bg-blue-100 text-blue-600":"text-gray-500 hover:bg-gray-100"}`,title:"Toggle statistics",children:e.jsx(ii,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oi,{className:"w-3 h-3 text-gray-400"}),e.jsxs("select",{value:l,onChange:h=>P(h.target.value),className:"text-xs border rounded px-1 py-0.5",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"rating",children:"Rating"}),e.jsx("option",{value:"size",children:"Size"}),e.jsx("option",{value:"camera",children:"Camera"})]}),e.jsx("button",{onClick:()=>f(h=>h==="asc"?"desc":"asc"),className:"text-xs text-gray-500 hover:text-gray-700",title:`Sort ${p==="asc"?"descending":"ascending"}`,children:p==="asc"?"":""})]}),i&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("button",{onClick:S,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"All"}),e.jsx("button",{onClick:m,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"None"})]}),e.jsx("button",{onClick:()=>r(120,0),className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Reload"})]})]}),y&&s.length>0&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 rounded text-xs",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Total: ",C.total]}),e.jsxs("div",{className:"text-gray-600",children:["Photos: ",C.photos]}),e.jsxs("div",{className:"text-gray-600",children:["Videos: ",C.videos]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Selected: ",C.selected]}),e.jsx("div",{className:"text-gray-600",children:C.selected>0&&`${(C.selected/C.total*100).toFixed(1)}%`})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Ratings:"}),e.jsx("div",{className:"flex gap-1",children:Object.entries(C.ratings).map(([h,v])=>e.jsxs("span",{className:"text-gray-600",title:`${h} stars: ${v} photos`,children:[h,":",v]},h))})]})]})}),n.size>0&&e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[n.size," item",n.size!==1?"s":""," selected"]}),s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No items yet. Build the index, then click Reload."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:b.map((h,v)=>{const k=n.has(h),E=j(h);return e.jsxs("div",{className:`relative group cursor-pointer rounded overflow-hidden ${k?"ring-2 ring-blue-500":""}`,onClick:()=>u?u(h):void 0,children:[i&&e.jsx("button",{onClick:T=>{T.stopPropagation(),i(h)},className:`absolute top-1 left-1 z-10 w-5 h-5 rounded border-2 flex items-center justify-center
                      ${k?"bg-blue-600 border-blue-600":"bg-white/80 border-gray-300 opacity-0 group-hover:opacity-100"} transition-opacity`,children:k&&e.jsx(gt,{className:"w-3 h-3 text-white"})}),e.jsx("img",{src:ke(a,t,h,196),alt:E.name,title:`${E.name}${E.rating>0?` - ${"".repeat(E.rating)}`:""}`,className:"w-full h-24 object-cover"}),E.isVideo&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-8 h-8 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(pt,{className:"w-4 h-4 text-white ml-0.5"})})}),E.rating>0&&e.jsx("div",{className:"absolute top-1 right-1 bg-black/60 text-white text-xs px-1 rounded",children:"".repeat(E.rating)}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"p-1 text-white text-xs truncate",children:E.name})})]},h)})})]})}function _l({dir:a,engine:t,clusters:s,persons:r,setPersons:n,busy:i,setBusy:u,setNote:c,onLoadFaces:l,onOpenPhotos:d}){const[p,f]=o.useState(null),[y,w]=o.useState([]),[j,b]=o.useState(!1),C=async P=>{try{u("Loading photos...");const S=await Gr(a,P);w(S.photos),f(P),b(!0),u(""),c(`Found ${S.photos.length} photos in cluster`)}catch(S){u(""),c(S.message)}};return j&&p?e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Photos in Cluster"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!1),className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Back"}),e.jsxs("button",{onClick:()=>d?.(y),className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:["View All (",y.length,")"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:y.map((P,S)=>e.jsx("img",{src:ke(a,t,P,196),alt:`Photo ${S+1}`,className:"w-full h-24 object-cover rounded cursor-pointer hover:ring-2 hover:ring-blue-500",onClick:()=>d?.([P])},S))})]}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"People"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{try{u("Scanning faces");const P=await da(a,t);u(""),c(`Faces: ${P.faces}, clusters: ${P.clusters}`),await l()}catch(P){u(""),c(P.message)}},className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build/Update"}),e.jsx("button",{onClick:l,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No face clusters yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-sm",children:s.map(P=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:P.name||`Cluster ${P.id}`,children:P.name||`Cluster ${P.id}`}),e.jsx("div",{className:"text-xs text-gray-600",children:P.size})]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-1",children:P.examples.map(([S,m],h)=>e.jsx("img",{src:oa(a,t,S,m,196),className:"w-full h-16 object-cover rounded"},h))}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{const S=P.name||"";if(!S)return;const m=r.includes(S)?r.filter(h=>h!==S):[...r,S];n(m)},disabled:!P.name,className:`px-2 py-1 rounded text-xs ${P.name&&r.includes(P.name)?"bg-blue-700 text-white":P.name?"bg-blue-600 text-white":"bg-gray-200"}`,children:P.name&&r.includes(P.name)?"Remove":"Add"}),e.jsx("button",{onClick:async()=>{const S=prompt("Name this person as",P.name||"")||"";if(S.trim())try{await ha(a,String(P.id),S.trim()),await l()}catch{}},className:"px-2 py-1 rounded bg-gray-200 text-xs",children:"Name"})]}),e.jsxs("button",{onClick:()=>C(P.id),className:"px-2 py-1 rounded bg-green-600 text-white text-xs w-full",children:["View Photos (",P.size,")"]})]})]},P.id))}),r.length>0&&e.jsxs("div",{className:"mt-2 text-sm flex items-center gap-2 flex-wrap",children:[r.map(P=>e.jsxs("span",{className:"px-2 py-1 bg-blue-600 text-white rounded flex items-center gap-2",children:[P," ",e.jsx("button",{onClick:()=>n(r.filter(S=>S!==P)),className:"bg-white/20 rounded px-1",children:""})]},P)),e.jsx("button",{onClick:()=>n([]),className:"px-2 py-1 bg-gray-200 rounded",children:"Clear"})]})]})}function Fl({points:a,onLoadMap:t}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Map (GPS)"}),e.jsx("button",{onClick:t,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Load"})]}),a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No GPS points found."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 text-xs",children:a.map((s,r)=>e.jsxs("div",{className:"border rounded p-2",children:[s.lat.toFixed(5),", ",s.lon.toFixed(5)]},r))})]})}function Dl({dir:a,engine:t,collections:s,onLoadCollections:r,onOpen:n,onDelete:i,onShare:u,onExport:c,selectedPhotos:l=[],onCollectionUpdate:d}){const[p,f]=o.useState(null),[y,w]=o.useState(null),[j,b]=o.useState(!1),[C,P]=o.useState(""),[S,m]=o.useState(!1),[h,v]=o.useState(null),k=o.useRef(0),E=o.useCallback(async()=>{if(!(!C.trim()||S)){m(!0);try{if(await es(a,C.trim(),l),P(""),b(!1),r(),d){const _={...s,[C.trim()]:l};d(_)}}catch(_){console.error("Failed to create collection:",_),alert(_ instanceof Error?_.message:"Failed to create collection")}finally{m(!1)}}},[C,l,a,r,s,d]),T=o.useCallback((_,M)=>{const W={type:"collection",data:M,name:M};f(W),_.dataTransfer.effectAllowed="move",_.dataTransfer.setData("text/plain",JSON.stringify(W))},[]),N=o.useCallback((_,M)=>{_.preventDefault(),_.dataTransfer.dropEffect="copy",w(M)},[]),O=o.useCallback((_,M)=>{_.preventDefault(),k.current++,w(M)},[]),U=o.useCallback(_=>{k.current--,k.current===0&&w(null)},[]),Z=o.useCallback(async(_,M)=>{_.preventDefault(),k.current=0,w(null);try{const W=_.dataTransfer.getData("text/plain");let se;if(W)se=JSON.parse(W);else{if(!p)return;se=p}if(se.type==="photo"){const B=Array.isArray(se.data)?se.data:[se.data],me=s[M]||[],A=Array.from(new Set([...me,...B]));if(await es(a,M,A),r(),d){const ee={...s,[M]:A};d(ee)}}}catch(W){console.error("Failed to update collection:",W),alert("Failed to update collection")}finally{f(null)}},[s,a,r,d,p]),F=o.useCallback(async _=>{if(u)u(_,s[_]||[]);else try{const M=s[_]||[];if(M.length===0){alert("Collection is empty");return}const W=await Js(a,t,M,{expiryHours:24,viewOnly:!0});await navigator.clipboard.writeText(window.location.origin+W.url),alert("Share link copied to clipboard!")}catch(M){console.error("Failed to share collection:",M),alert(M instanceof Error?M.message:"Failed to share collection")}},[u,s,a,t]),K=o.useCallback(async _=>{if(c)c(_,s[_]||[]);else{const M=prompt(`Export collection "${_}" to folder:`,_);if(!M)return;try{const W=s[_]||[];if(W.length===0){alert("Collection is empty");return}await jt(a,W,M,"copy",!1,!1),alert(`Exported ${W.length} photos to ${M}`)}catch(W){console.error("Failed to export collection:",W),alert(W instanceof Error?W.message:"Failed to export collection")}}},[c,s,a]);return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-semibold",children:"Collections"}),l.length>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[l.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.length>0&&e.jsxs("button",{onClick:()=>b(!0),className:"bg-green-600 text-white rounded px-3 py-1 text-sm hover:bg-green-700 flex items-center gap-1",children:[e.jsx(rr,{className:"w-3 h-3"}),"New"]}),e.jsx("button",{onClick:r,className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Refresh"})]})]}),j&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"w-4 h-4 text-blue-600"}),e.jsx("input",{type:"text",placeholder:"Collection name",value:C,onChange:_=>P(_.target.value),className:"flex-1 border rounded px-2 py-1 text-sm",onKeyDown:_=>{_.key==="Enter"&&E(),_.key==="Escape"&&b(!1)},autoFocus:!0}),e.jsx("button",{onClick:E,disabled:!C.trim()||S,className:"bg-blue-600 text-white px-3 py-1 text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:S?"Creating...":"Create"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-500 hover:text-gray-700 px-2 py-1 text-sm",children:"Cancel"})]}),l.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["Will add ",l.length," selected photo",l.length!==1?"s":""]})]}),Object.keys(s||{}).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ps,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"No collections yet"}),l.length>0?e.jsxs("button",{onClick:()=>b(!0),className:"text-sm text-blue-600 hover:text-blue-800",children:["Create your first collection with ",l.length," selected photo",l.length!==1?"s":""]}):e.jsx("div",{className:"text-xs text-gray-500",children:"Select photos and create collections to organize them"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:Object.keys(s).map(_=>{const M=y===_,W=s[_]||[];return e.jsxs("div",{draggable:!0,onDragStart:se=>T(se,_),onDragOver:se=>N(se,_),onDragEnter:se=>O(se,_),onDragLeave:U,onDrop:se=>Z(se,_),className:`border rounded-lg p-3 transition-all cursor-move ${M?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"} ${h===_?"ring-2 ring-blue-200":""}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(li,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:_,children:_}),e.jsxs("div",{className:"text-xs text-gray-600",children:[W.length," item",W.length!==1?"s":"",M&&e.jsx("span",{className:"ml-2 text-blue-600 font-medium",children:"Drop here to add"})]})]})]}),e.jsxs("div",{className:"flex gap-1 mb-3 overflow-hidden",children:[W.slice(0,4).map((se,B)=>e.jsx("img",{src:ke(a,t,se,96),alt:se.split("/").pop()||se,className:`object-cover rounded ${W.length===1?"w-full h-20":W.length===2?"w-1/2 h-16":"w-1/4 h-12"}`},se)),W.length>4&&e.jsxs("div",{className:"w-1/4 h-12 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:["+",W.length-4]}),W.length===0&&e.jsx("div",{className:"w-full h-16 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:"Empty collection"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>n(_),className:"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 text-xs",children:"Open"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>F(_),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-blue-600",title:"Share collection",disabled:W.length===0,children:e.jsx(rs,{className:"w-3 h-3"})}),e.jsx("button",{type:"button",onClick:()=>K(_),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-green-600",title:"Export collection",disabled:W.length===0,children:e.jsx(_e,{className:"w-3 h-3"})}),i&&e.jsx("button",{type:"button",onClick:()=>i(_),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-red-600",title:"Delete collection",children:e.jsx(Ke,{className:"w-3 h-3"})})]})]})]},_)})}),l.length>0&&Object.keys(s||{}).length>0&&e.jsx("div",{className:"mt-3 text-xs text-center text-gray-500 border-t pt-2",children:" Drag photos onto collections to add them, or create a new collection above"})]})}function Ol(){const a=Qs(),t=fr(),s=o.useMemo(()=>a.pathname.split("/").filter(Boolean)[1]||"",[a.pathname]),[r,n]=o.useState(null),[i,u]=o.useState(""),[c,l]=o.useState(""),[d,p]=o.useState(!1);async function f(){p(!0),l("");try{const w=new URLSearchParams({token:s});i.trim()&&w.set("password",i.trim());const b=await(await fetch(`${he}/share/detail?${w.toString()}`)).json();n(b),b.ok||(b.error==="expired"?l("This link has expired"):b.error==="password_required"?l("Password required or incorrect"):l("Unable to open share"))}catch(w){l(w instanceof Error?w.message:"Failed to load share")}finally{p(!1)}}if(o.useEffect(()=>{s&&f()},[s]),!s)return e.jsx("div",{className:"h-screen bg-gray-950 text-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl mb-2",children:"Invalid share link"}),e.jsx("button",{className:"px-3 py-1 rounded bg-gray-800 border border-gray-700",onClick:()=>t("/"),children:"Back"})]})});const y=r?.ok&&r?.paths&&r?.dir;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-gray-100",children:[e.jsxs("header",{className:"px-4 py-3 border-b border-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:"Shared Photos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r?.expires&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Expires ",new Date(r.expires).toLocaleString()]}),e.jsx("button",{className:"px-2 py-1 rounded bg-gray-800 border border-gray-700 text-sm",onClick:()=>t("/"),children:"Back"})]})]}),e.jsxs("main",{className:"p-4",children:[(!r||!r.ok&&r.error==="password_required")&&e.jsxs("div",{className:"max-w-md mx-auto",children:[c&&e.jsx("div",{className:"mb-2 text-red-400 text-sm",children:c}),e.jsx("label",{className:"block text-sm mb-1",children:"Password"}),e.jsx("input",{className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded",value:i,onChange:w=>u(w.target.value),placeholder:"Enter password (if required)",type:"password"}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:f,disabled:d,children:d?"Opening":"Open"})})]}),r&&!r.ok&&r.error==="expired"&&e.jsx("div",{className:"text-center text-gray-300",children:"This link has expired."}),y&&e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))"},children:r.paths.map(w=>e.jsx("div",{className:"border border-gray-800 rounded overflow-hidden bg-gray-900",children:e.jsx("img",{src:ke(r.dir,r.provider||"local",w,256),alt:"photo",className:"w-full h-[140px] object-cover"})},w))})]})]})}function Rl({dir:a,engine:t,topK:s,smart:r,setSmart:n,setResults:i,setSearchId:u,setNote:c,query:l,favOnly:d,tagFilter:p,useCaps:f,useOcr:y,hasText:w,camera:j,isoMin:b,isoMax:C,fMin:P,fMax:S,place:m,persons:h}){const v=async()=>{const N=(prompt("Save current search as Smart (name):")||"").trim();if(N)try{const O=p.split(",").map(M=>M.trim()).filter(Boolean),U={query:l,favoritesOnly:d,tags:O,useCaptions:f,useOcr:y,hasText:w,camera:j||void 0,isoMin:b?parseInt(b,10):void 0,isoMax:C?parseInt(C,10):void 0,fMin:P?parseFloat(P):void 0,fMax:S?parseFloat(S):void 0,place:m||void 0},Z=h.filter(Boolean);Z.length===1?U.person=Z[0]:Z.length>1&&(U.persons=Z);const{apiSetSmart:F,apiGetSmart:K}=await pe(async()=>{const{apiSetSmart:M,apiGetSmart:W}=await Promise.resolve().then(()=>ge);return{apiSetSmart:M,apiGetSmart:W}},void 0,import.meta.url);await F(a,N,U);const _=await K(a);n(_.smart||{}),c("Saved smart collection")}catch(O){c(O.message||"Failed to save smart")}},k=async()=>{try{const{apiGetSmart:N}=await pe(async()=>{const{apiGetSmart:U}=await Promise.resolve().then(()=>ge);return{apiGetSmart:U}},void 0,import.meta.url),O=await N(a);n(O.smart||{})}catch(N){c(N.message||"Failed to load smart")}},E=async N=>{try{const{apiResolveSmart:O}=await pe(async()=>{const{apiResolveSmart:Z}=await Promise.resolve().then(()=>ge);return{apiResolveSmart:Z}},void 0,import.meta.url),U=await O(a,N,t,s);i(U.results||[]),u(U.search_id||""),c(`Opened smart: ${N}`)}catch(O){c(O.message)}},T=async N=>{if(confirm(`Delete smart collection "${N}"?`))try{const{apiDeleteSmart:O,apiGetSmart:U}=await pe(async()=>{const{apiDeleteSmart:F,apiGetSmart:K}=await Promise.resolve().then(()=>ge);return{apiDeleteSmart:F,apiGetSmart:K}},void 0,import.meta.url);await O(a,N);const Z=await U(a);n(Z.smart||{})}catch(O){c(O.message)}};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Smart Collections"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"}),e.jsx("button",{onClick:v,className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:"Save current as Smart"})]})]}),Object.keys(r||{}).length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No smart collections yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.keys(r).map(N=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:N,children:N}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E(N),className:"px-2 py-1 bg-blue-600 text-white rounded",children:"Open"}),e.jsx("button",{onClick:()=>T(N),className:"px-2 py-1 bg-red-600 text-white rounded",children:"Delete"})]})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 truncate",children:JSON.stringify(r[N])})]},N))})]})}function Ka({dir:a,engine:t,setBusy:s,setNote:r,setResults:n}){const i=async()=>{try{const{apiTripsBuild:l}=await pe(async()=>{const{apiTripsBuild:p}=await Promise.resolve().then(()=>ge);return{apiTripsBuild:p}},void 0,import.meta.url);s("Grouping trips");const d=await l(a,t);s(""),window._trips=d.trips||[],r(`Trips: ${d.trips?.length||0}`)}catch(l){s(""),r(l.message)}},u=async()=>{try{const{apiTripsList:l}=await pe(async()=>{const{apiTripsList:p}=await Promise.resolve().then(()=>ge);return{apiTripsList:p}},void 0,import.meta.url),d=await l(a);window._trips=d.trips||[],r(`Loaded ${d.trips.length} trips`)}catch(l){r(l.message)}},c=l=>{n((l.paths||[]).map(d=>({path:d,score:1}))),r("Opened trip")};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Trips"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:i,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build"}),e.jsx("button",{onClick:u,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:window._trips?.slice(0,6)?.map((l,d)=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:l.place||"",children:l.place||"Trip"}),e.jsx("div",{children:l.count})]}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-1",children:(l.paths||[]).slice(0,3).map((p,f)=>e.jsx("img",{src:ke(a,t,p,196),className:"w-full h-16 object-cover rounded"},f))}),e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx("button",{onClick:()=>c(l),className:"bg-blue-600 text-white rounded px-3 py-1",children:"Open"})})]},l.id||d))})]})}function Ll({saved:a,onRun:t,onDelete:s}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"font-semibold",children:"Saved Searches"})}),!a||a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No saved searches yet."}):e.jsx("div",{className:"mt-2 divide-y",children:a.map(r=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:r.name,children:r.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:r.query,children:r.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:()=>t(r.name,r.query,r.top_k),className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{onClick:()=>s(r.name),className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},r.name))})]})}function Al(a){const t=a.split(/\r?\n/),s=[];let r=[];function n(){r.length&&(s.push(e.jsx("ul",{className:"list-disc ml-6 space-y-1",children:r.map((i,u)=>e.jsx("li",{children:i},u))},`ul-${s.length}`)),r=[])}return t.forEach((i,u)=>{const c=i.match(/^(#+)\s+(.*)$/);if(c){n();const d=c[1].length,p=c[2],f=d===1?"h1":d===2?"h2":"h3";s.push(e.jsx(f,{className:"font-semibold mt-4",children:p},`h-${u}`));return}const l=i.match(/^[-*]\s+(.*)$/);if(l){const d=l[1],p=d.match(/^\[( |x|X)\]\s+(.*)$/);if(p){const f=p[1].toLowerCase()==="x",y=p[2];r.push(e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",disabled:!0,checked:f}),e.jsx("span",{children:y})]}))}else r.push(e.jsx("span",{children:d}));return}if(i.trim()===""){n(),s.push(e.jsx("div",{className:"h-2"},`sp-${u}`));return}n(),s.push(e.jsx("p",{children:i},`p-${u}`))}),n(),s}function zl(){const a=sn(),t=ml(),[s,r]=o.useState(""),[n,i]=o.useState(!0),[u,c]=o.useState(""),[l,d]=o.useState([]),[p,f]=o.useState(!1),[y,w]=o.useState(null),[j,b]=o.useState(!1),C=async()=>{try{i(!0);const h=await ts();r(h.text||"")}catch(h){c(String(h))}finally{i(!1)}},P=async()=>{if(!a){d([]);return}try{b(!0);const h=await Zt(a,200);d(h.events||[])}catch{}finally{b(!1)}},S=h=>{try{const v=new Date(h).getTime(),k=Date.now(),E=Math.max(0,k-v),T=Math.floor(E/1e3);if(T<60)return`${T}s ago`;const N=Math.floor(T/60);if(N<60)return`${N}m ago`;const O=Math.floor(N/60);return O<24?`${O}h ago`:`${Math.floor(O/24)}d ago`}catch{return h}};o.useEffect(()=>{let h=!1;return ts().then(v=>{h||(r(v.text||""),i(!1))}).catch(v=>{h||(c(String(v)),i(!1))}),()=>{h=!0}},[]),o.useEffect(()=>{let h=!1;if(!a){d([]);return}Zt(a,200).then(k=>{h||d(k.events||[])}).catch(()=>{});const v=window.setInterval(()=>{h||P()},3e4);return()=>{h=!0,window.clearInterval(v)}},[a]);const m=async()=>{if(a)try{f(!0),w(null);const h=await ma(a,t),v=typeof h.updated=="number"?h.updated:0;if(v>0)w(`Updated tags for ${v} photo${v===1?"":"s"}`);else if(h.tags){const k=Object.keys(h.tags||{}).length;w(`Generated tags for ${k} photo${k===1?"":"s"}`)}else w("No changes")}catch(h){w(`Error: ${h.message}`)}finally{f(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Project Tasks (TODO.md)"}),e.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:C,disabled:n,title:"Refresh TODO.md",children:"Refresh"})]}),n?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading"}):u?e.jsx("div",{className:"text-sm text-red-600",children:u}):e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:Al(s)}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Auto-tag Photos"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 border rounded p-3 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Generate smart tags for your photos using AI analysis. This will analyze photo content and automatically assign relevant tags."}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:m,disabled:p||!a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Generating Tags...":"Generate Auto Tags"})}),y&&e.jsx("div",{className:`p-2 rounded text-sm ${y.startsWith("Error:")?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"}`,children:y})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Recent Events"}),e.jsx("button",{className:"text-sm px-2 py-1 border rounded disabled:opacity-50",onClick:P,disabled:j||!a,title:"Refresh events",children:j?"Refreshing":"Refresh"})]}),e.jsx("div",{className:"border rounded divide-y",children:l.length===0?e.jsx("div",{className:"p-2 text-sm text-gray-600",children:"No recent events."}):l.map((h,v)=>e.jsxs("div",{className:"p-2 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:h.type}),e.jsx("span",{children:h.query?`"${h.query}"`:h.token?`share:${h.token.slice(0,6)}`:""})]}),e.jsx("div",{className:"text-gray-500",title:new Date(h.time).toLocaleString(),children:S(h.time)})]},v))})]})]})}function Ul({dir:a,engine:t,items:s,selected:r,onToggleSelect:n,onOpen:i,showInfoOverlay:u,bucket:c="day"}){const[l,d]=o.useState({}),[p,f]=o.useState(new Set);o.useEffect(()=>{const h=s.slice(0,200).map(E=>E.path).filter(E=>!l[E]&&!p.has(E)).slice(0,32);if(h.length===0)return;const v=new Set(p);h.forEach(E=>v.add(E)),f(v);let k=!1;return Promise.all(h.map(async E=>{try{const T=await yt(a,E);!k&&T&&T.meta&&d(N=>({...N,[E]:{mtime:T.meta.mtime,camera:T.meta.camera,fnumber:T.meta.fnumber,iso:T.meta.iso}}))}catch{}})).finally(()=>{k||f(E=>{const T=new Set(E);return h.forEach(N=>T.delete(N)),T})}),()=>{k=!0}},[s,a,l,p]);const y=o.useMemo(()=>{const h=U=>!U||!isFinite(U)?"Unknown":new Date(U*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),v=U=>!U||!isFinite(U)?"Unknown":new Date(U*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}),k=U=>{if(!U||!isFinite(U))return"Unknown";const Z=new Date(U*1e3),F=new Date(Date.UTC(Z.getFullYear(),Z.getMonth(),Z.getDate())),K=F.getUTCDay()||7;F.setUTCDate(F.getUTCDate()+4-K);const _=new Date(Date.UTC(F.getUTCFullYear(),0,1)),M=Math.ceil(((F.getTime()-_.getTime())/864e5+1)/7);return`${F.getUTCFullYear()}  W${String(M).padStart(2,"0")}`},E=U=>c==="month"?v(U):c==="week"?k(U):h(U),T=s.map(U=>({it:U,ts:l[U.path]?.mtime}));T.sort((U,Z)=>(Z.ts||0)-(U.ts||0));const N={};for(const{it:U,ts:Z}of T){const F=E(Z);N[F]||(N[F]=[]),N[F].push(U)}const O=Object.keys(N);return O.sort((U,Z)=>U==="Unknown"?1:Z==="Unknown"?-1:0),O.map(U=>({key:U,items:N[U]}))},[s,l,c]),w=o.useMemo(()=>{const h=new Set;if(c==="week")for(const v of y){const k=v.items[0]?.path,E=k?l[k]?.mtime:void 0;if(E&&isFinite(E)){const T=new Date(E*1e3);h.add(T.toLocaleDateString(void 0,{year:"numeric",month:"short"}))}}else for(const v of y){const k=v.key.split(" ");k.length>=2&&h.add(`${k[0]} ${k[1]}`)}return Array.from(h)},[y,c,l]),j=o.useMemo(()=>{const h={};if(c==="week")for(const v of y){const k=v.items[0]?.path,E=k?l[k]?.mtime:void 0;if(E&&isFinite(E)){const N=new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});h[N]=(h[N]||0)+v.items.length}}else for(const v of y){const k=v.key.split(" ").slice(0,2).join(" ");h[k]=(h[k]||0)+v.items.length}return h},[y,c,l]),b=o.useMemo(()=>Object.values(j).reduce((h,v)=>Math.max(h,v||0),0)||1,[j]),C=o.useRef({}),P=o.useRef(null),[S,m]=o.useState(null);return o.useEffect(()=>{const h=P.current;if(!h)return;const v=new IntersectionObserver(k=>{for(const E of k)if(E.isIntersecting){const T=E.target.dataset.month||null;T&&m(T)}},{root:h,threshold:.1});return Object.values(C.current).forEach(k=>k&&v.observe(k)),()=>v.disconnect()},[y]),o.useEffect(()=>{const h=v=>{try{const k=v?.detail?.kind;if(!k)return;const E=Date.now()/1e3;if(k==="today"){const T=c==="month"?new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const O=new Date(E*1e3),U=new Date(Date.UTC(O.getFullYear(),O.getMonth(),O.getDate())),Z=U.getUTCDay()||7;U.setUTCDate(U.getUTCDate()+4-Z);const F=new Date(Date.UTC(U.getUTCFullYear(),0,1)),K=Math.ceil(((U.getTime()-F.getTime())/864e5+1)/7);return`${U.getUTCFullYear()}  W${String(K).padStart(2,"0")}`})():new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"});C.current[T]?.scrollIntoView({behavior:"smooth",block:"start"})}else if(k==="this-month"){const T=new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(C.current).find(O=>O?.dataset.month&&O.dataset.month.startsWith(T))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(k==="last-month"){const T=new Date,O=new Date(T.getFullYear(),T.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(C.current).find(Z=>Z?.dataset.month&&Z.dataset.month.startsWith(O))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(k==="oldest"){const T=Object.keys(C.current);T.length>0&&C.current[T[T.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})}}catch{}};return window.addEventListener("timeline-jump",h),()=>window.removeEventListener("timeline-jump",h)},[c]),e.jsxs("div",{ref:P,className:"space-y-8 relative",style:{scrollSnapType:"y proximity"},children:[e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-4 z-10 bg-blue-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=Date.now()/1e3,v=c==="month"?new Date(h*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const E=new Date(h*1e3),T=new Date(Date.UTC(E.getFullYear(),E.getMonth(),E.getDate())),N=T.getUTCDay()||7;T.setUTCDate(T.getUTCDate()+4-N);const O=new Date(Date.UTC(T.getUTCFullYear(),0,1)),U=Math.ceil(((T.getTime()-O.getTime())/864e5+1)/7);return`${T.getUTCFullYear()}  W${String(U).padStart(2,"0")}`})():new Date(h*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),k=C.current[v];k&&k.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to today",children:"Today"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-14 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=Date.now()/1e3,v=new Date(h*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(C.current).find(E=>E?.dataset.month&&E.dataset.month.startsWith(v))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to this month",children:"This Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-20 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=new Date,k=new Date(h.getFullYear(),h.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(C.current).find(T=>T?.dataset.month&&T.dataset.month.startsWith(k))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to last month",children:"Last Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-24 z-10 bg-gray-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=Object.keys(C.current);h.length>0&&C.current[h[h.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to oldest",children:"Oldest"}),w.length>1&&e.jsx("div",{className:"hidden md:flex flex-col gap-1 fixed right-4 top-1/2 -translate-y-1/2 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur p-2 rounded shadow max-h-[60vh] overflow-auto",children:w.map(h=>e.jsxs("button",{type:"button",className:`text-xs px-2 py-0.5 rounded flex items-center gap-1 ${S===h?"bg-blue-600 text-white":"text-blue-700 hover:bg-blue-100"}`,onClick:()=>{Object.values(C.current).find(k=>k?.dataset.month===h)?.scrollIntoView({behavior:"smooth",block:"start"})},children:[e.jsx("span",{children:h}),e.jsxs("span",{className:"opacity-70",children:["(",j[h]||0,")"]}),e.jsx("span",{className:"inline-block h-1 bg-current opacity-50",style:{width:`${Math.max(6,Math.round((j[h]||0)/b*60))}px`}})]},h))}),y.map(h=>e.jsxs("section",{"aria-label":h.key,ref:v=>{v&&(C.current[h.key]=v)},"data-month":h.key.split(" ").slice(0,2).join(" "),style:{scrollSnapAlign:"start"},children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur px-2 py-1 border-b text-sm font-medium",children:[h.key,"  ",h.items.length]}),e.jsx("div",{className:"mt-3 grid gap-2 grid-cols-[repeat(auto-fill,minmax(160px,1fr))]",children:h.items.map(v=>{const k=r.has(v.path),E=v.path.split("/").pop()||v.path,T=l[v.path];return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden border ${k?"ring-2 ring-blue-500":"border-transparent"}`,onClick:()=>n(v.path),onDoubleClick:()=>i(v.path),title:v.path,children:[e.jsx(fa,{src:ke(a,t,v.path,256),alt:v.path,className:"w-full h-[160px] object-cover",enableProgressiveLoading:!0}),u&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:E,children:E}),e.jsxs("div",{className:"flex items-center gap-1",children:[T?.camera&&e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:T.camera}),typeof T?.fnumber=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["f/",T.fnumber]}),typeof T?.iso=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["ISO ",T.iso]})]})]})]},v.path)})})]},h.key))]})}function Bl({open:a,onClose:t}){const s=sn(),[r,n]=o.useState([]),[i,u]=o.useState(!1);return o.useEffect(()=>{let c;async function l(){if(s){u(!0);try{const d=await Zt(s,200);n(d.events||[])}catch{}u(!1),c=setTimeout(l,3500)}}return a&&l(),()=>{c&&clearTimeout(c)}},[s,a]),a?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:t}),e.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-full sm:w-[420px] bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-800 p-3 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Jobs"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:t,children:"Close"})]}),i&&e.jsx("div",{className:"text-sm text-gray-600",children:"Loading"}),e.jsxs("div",{className:"space-y-2",children:[r.map((c,l)=>e.jsxs("div",{className:"p-2 border rounded text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:c.type}),c.type==="export"&&e.jsxs("span",{children:[c.copied," copied, ",c.skipped," skipped",c.errors?`, ${c.errors} errors`:""]}),c.type==="backup_run"&&e.jsxs("span",{children:[c.copied," backed up, ",c.skipped," skipped"]}),c.type==="backup_restore"&&e.jsxs("span",{children:[c.restored," restored"]}),c.type==="captions_build"&&e.jsxs("span",{children:[c.updated," captions"]}),c.type==="ocr_build"&&e.jsxs("span",{children:[c.updated," OCR"]}),c.type==="fast_build"&&e.jsxs("span",{children:[c.kind," index ",c.ok?"ok":"failed"]}),c.type==="trips_build"&&e.jsxs("span",{children:[c.trips," trips"]}),c.type==="thumbs_build"&&e.jsxs("span",{children:[c.made," thumbs"]}),c.type==="metadata_build"&&e.jsxs("span",{children:[c.updated," metadata"]}),c.type==="share_created"&&e.jsxs("span",{children:["link  ",c.count," items"]}),c.type==="share_open"&&e.jsx("span",{children:"link opened"}),c.type==="search"&&e.jsxs("span",{children:["",c.query,""]})]}),e.jsx("div",{className:"text-gray-500",children:new Date(c.time).toLocaleString()})]},l)),r.length===0&&!i&&e.jsx("div",{className:"text-sm text-gray-600",children:"No recent jobs."})]})]})]}):null}function ql({onStartDemo:a,onSelectFolder:t,onClose:s}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",onClick:r=>r.stopPropagation(),children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto flex items-center justify-center mb-6",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-12 h-12 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Find any photo instantly"}),e.jsx("p",{className:"text-gray-600 mb-8 max-w-xl mx-auto",children:`Just describe what you're looking for - like "that beach sunset" or "my daughter's birthday" - and we'll find it. No more endless scrolling!`}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Search naturally"}),e.jsx("p",{className:"text-gray-600 text-sm",children:`Type what you remember - "kids at the park" or "that amazing sunset" - we'll find it.`})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Find people instantly"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"We recognize faces so you can find all photos of someone special in seconds."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx("button",{onClick:a,className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:"See it in action"}),e.jsx("button",{onClick:t,className:"px-8 py-4 bg-white border-2 border-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-50 transition-all shadow-md",children:"Use my photos"})]}),e.jsx("button",{onClick:s,className:"mt-6 text-gray-500 hover:text-gray-700 transition-colors",children:"Maybe later"})]})})})})}function Vl(){try{const a=navigator.userAgent,t=a.includes("Windows")||a.includes("Win64"),s=a.includes("Macintosh")||a.includes("Mac OS");return t?["~/Pictures","~/Desktop","~/Downloads","~/OneDrive/Pictures"]:s?["~/Pictures","~/Desktop","~/Downloads","~/Documents/Screenshots"]:["~/Pictures","~/Downloads","~/Desktop"]}catch{return["~/Pictures","~/Downloads"]}}function Hl({open:a,onClose:t,onQuickStart:s,onCustom:r,onDemo:n,onTour:i}){const[u,c]=o.useState([]),[l,d]=o.useState(!1),[p,f]=o.useState(Vl()),y=ae(),w=y.state.settings.includeVideos,j=y.setSettings,[b,C]=o.useState(w),P=o.useMemo(()=>u.reduce((E,T)=>E+(T.files||0),0),[u]),[S,m]=o.useState(!1),[h,v]=o.useState("");o.useEffect(()=>{if(!a)return;let E=!1;return(async()=>{d(!0);try{const N=await fetch(`${he}/scan_count?include_videos=${b?"1":"0"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!N.ok)throw new Error(await N.text());const O=await N.json();E||c(O.items||[])}catch{E||c([])}finally{E||d(!1)}})(),()=>{E=!0}},[a,p,b]);const k=E=>{if(!E)return"0 B";const T=["B","KB","MB","GB","TB"];let N=0,O=E;for(;O>=1024&&N<T.length-1;)O/=1024,N++;return`${O.toFixed(O<10?1:0)} ${T[N]}`};return a?e.jsxs("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center",children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1101] bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl p-5",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Welcome  lets find your photos"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Get started fast (no cloud, localonly)."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:" Quick Start (Recommended)"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Index common locations (local only)"}),e.jsx("ul",{className:"text-xs text-gray-700 mb-2",children:u.map(E=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:E.path}),e.jsx("span",{children:E.exists?`${E.files}  ${k(E.bytes)} (Found)`:"Not found"})]},E.path))}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 mb-2",children:[e.jsx("input",{id:"incl-videos",type:"checkbox",checked:b,onChange:E=>{C(E.target.checked);try{j({includeVideos:E.target.checked})}catch{}}}),e.jsx("label",{htmlFor:"incl-videos",children:"Include videos (may take longer)"})]}),e.jsx("button",{className:"px-3 py-1 rounded bg-blue-600 text-white text-sm disabled:opacity-50",disabled:l||S,onClick:async()=>{m(!0),v("Starting indexing");try{s(p);const E=u.find(N=>N.exists)?.path||p[0],T=Date.now()+7e3;for(;Date.now()<T;){try{const N=await fetch(`${he}/analytics?dir=${encodeURIComponent(E)}&limit=5`);if(N.ok){const U=((await N.json()).events||[]).find(Z=>Z.type==="index");if(U){v(`Indexed ${U.new}+${U.updated} (total ${U.total})`);break}}}catch{}await new Promise(N=>setTimeout(N,1e3))}}finally{setTimeout(()=>{m(!1),t()},1e3)}},children:l?"Calculating":S?h||"Starting":`Start indexing (${P} files  ${k(u.reduce((E,T)=>E+(T.bytes||0),0))})`}),!S&&!l&&e.jsx("div",{className:"mt-2 text-[11px] text-gray-600",children:"Runs in the background; you can start searching."})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:" Custom Setup"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Choose specific folders to index"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:r,children:"Select Folders"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:" Demo Mode"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Try with sample photos first"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:n,children:"Try Demo"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:" Guided Tour"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Learn the basics in under a minute"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:()=>i&&i(),children:"Start Tour"})]})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-600",children:"This runs locally; nothing leaves your device."}),e.jsx("div",{className:"text-xs text-gray-600",children:"You can add or remove folders anytime."}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:t,children:"Skip"})})]})]}):null}function Wl(){const[a,t]=o.useState(navigator.onLine),[s,r]=o.useState(!1),[n,i]=o.useState(!1),[u,c]=o.useState(!1),[l,d]=o.useState(!1);o.useEffect(()=>{const j=()=>t(!0),b=()=>t(!1);window.addEventListener("online",j),window.addEventListener("offline",b);const C=!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);return r(C),c("ontouchstart"in window),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(()=>{d(!0)}),window.matchMedia("(display-mode: standalone)").matches&&i(!0),()=>{window.removeEventListener("online",j),window.removeEventListener("offline",b)}},[]);const p=[{name:"Touch Gestures",icon:Ma,status:u,description:"Pinch-to-zoom, swipe navigation"},{name:"Camera Access",icon:_t,status:s,description:"Native photo capture"},{name:"Offline Support",icon:a?Us:Yt,status:l,description:"Works without internet"},{name:"PWA Installation",icon:ci,status:n,description:"Install as app"}],f=async()=>{try{if("caches"in window){const j=await caches.open("test-cache");await j.put("/test",new Response("Hello from cache!"));const C=await(await j.match("/test"))?.text();alert(`Cache test: ${C||"Failed"}`)}else alert("Cache API not supported")}catch(j){alert(`Cache test failed: ${j}`)}},y=async()=>{try{const j=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});alert("Camera access successful!"),j.getTracks().forEach(b=>b.stop())}catch(j){alert(`Camera test failed: ${j}`)}},w=()=>{alert("Touch the screen to test gestures! Try pinching, swiping, or long-pressing.")};return e.jsx("div",{className:"p-4 max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Mobile PWA Features Test"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Test the mobile PWA features that were just implemented. This page helps verify that all the mobile enhancements are working correctly."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:p.map((j,b)=>{const C=j.icon;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(C,{className:`w-6 h-6 mr-2 ${j.status?"text-green-500":"text-gray-400"}`}),e.jsx("h3",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`ml-auto px-2 py-1 text-xs rounded ${j.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:j.status?"Available":"Not Available"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:j.description})]},b)})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Interactive Tests"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:f,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:!l,children:[e.jsx(_e,{className:"w-4 h-4 inline mr-2"}),"Test Cache API"]}),e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",disabled:!s,children:[e.jsx(_t,{className:"w-4 h-4 inline mr-2"}),"Test Camera Access"]}),e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",disabled:!u,children:[e.jsx(Ma,{className:"w-4 h-4 inline mr-2"}),"Test Touch Gestures"]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Current Status"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Online Status:"," ",e.jsx("span",{className:a?"text-green-600":"text-red-600",children:a?"Online":"Offline"})]}),e.jsxs("div",{children:["Service Worker:"," ",e.jsx("span",{className:l?"text-green-600":"text-red-600",children:l?"Ready":"Not Ready"})]}),e.jsxs("div",{children:["Display Mode:"," ",e.jsx("span",{className:"text-blue-600",children:n?"Standalone (Installed)":"Browser"})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2",children:"Instructions"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:" Test this page on a mobile device for best results"}),e.jsx("li",{children:" Try installing the app to test PWA features"}),e.jsx("li",{children:" Go offline to test cached functionality"}),e.jsx("li",{children:" Use touch gestures on photos to test interactions"})]})]})]})})}function Ga({onSearch:a}){const t=["photos from last summer","my kids playing","that trip to Paris","birthday celebrations","sunset at the beach","our dog running","Christmas morning","backyard BBQ","first day of school","weekend adventures","family dinner","vacation memories","funny moments","beautiful landscapes","selfies with friends"];return e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Try searching for:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.map(s=>e.jsx("button",{type:"button",onClick:()=>a(s),className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-600 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 text-left",children:s},s))}),e.jsx("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:" Just describe what you're looking for in your own words"})]})}function Kl({onSelectDirectory:a,onImport:t,onHelp:s}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-6",children:[e.jsxs("button",{type:"button",onClick:a,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(Ge,{className:"w-8 h-8 text-blue-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Select Directory"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose a folder with your photos"})]}),e.jsxs("button",{type:"button",onClick:t,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(_e,{className:"w-8 h-8 text-green-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Import Photos"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Import from camera or device"})]}),e.jsxs("button",{type:"button",onClick:s,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(is,{className:"w-8 h-8 text-purple-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Get Help"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View tutorials and documentation"})]})]})}function Ss({type:a,searchQuery:t,onAction:s,onDemoAction:r,onClearSearch:n,onOpenFilters:i,onOpenAdvanced:u,onOpenHelp:c,onStartTour:l,onOpenJobs:d,sampleQueries:p,onRunSample:f,hasActiveFilters:y,indexingProgress:w=0,estimatedTime:j}){const[b,C]=o.useState(!1),P=["beach sunset","birthday cake","mountain hike","red car"],S=Array.isArray(p)&&p.length>0?p:P,h=(()=>{switch(a){case"no-directory":return{icon:e.jsx(Ge,{className:"w-16 h-16 text-gray-400"}),title:"Welcome to Photo Search",description:"Get started by selecting a folder containing your photos. We'll analyze them to make them searchable.",actionLabel:"Select Photo Folder",action:s,demoActionLabel:"Try Demo Photos",demoAction:r,tips:["Choose a folder with JPEG, PNG, or other common photo formats","We'll scan and analyze your photos using AI for natural language search","Your photos stay on your device - we only create searchable indexes","You can always add more folders later from the settings"]};case"no-photos":return{icon:e.jsx(Rt,{className:"w-16 h-16 text-gray-400"}),title:"No Photos Found",description:"This folder doesn't contain any photos yet. Add some photos or select a different folder.",actionLabel:"Select Different Folder",action:s,tips:["Make sure your photos are in common formats like JPEG, PNG, or TIFF","Check that the folder contains actual photo files, not just subfolders","If you just added photos, try refreshing the library","You can also import photos from other locations"]};case"no-results":return{icon:e.jsx(Te,{className:"w-16 h-16 text-gray-400"}),title:`No results for "${t}"`,description:"Try adjusting your search terms or filters. Here are some suggestions:",suggestions:["Use simpler words or phrases","Try searching for colors, objects, or locations","Check your spelling","Remove filters if any are applied","Try searching for people or events"],actionLabel:"Clear Search",action:s};case"indexing":return{icon:e.jsx(xt,{className:"w-16 h-16 text-blue-500 animate-pulse"}),title:"Indexing Your Photos",description:`Analyzing your photos to make them searchable. ${w}% complete.`,progress:w,estimatedTime:j,tips:["This process analyzes each photo using AI to understand its content","You'll be able to search by objects, scenes, colors, and more","The process typically takes about 30 seconds per 100 photos","You can continue using other features while indexing runs"]};default:return{icon:e.jsx(is,{className:"w-16 h-16 text-gray-400"}),title:"Something went wrong",description:"We're having trouble loading this content.",actionLabel:"Try Again",action:s}}})();return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8 text-center",role:a==="indexing"?"status":void 0,"aria-live":a==="indexing"?"polite":void 0,children:[e.jsx("div",{className:"mb-6",children:h.icon}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-3",children:h.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md leading-relaxed",children:h.description}),h.progress!==void 0&&e.jsxs("div",{className:"w-full max-w-md mb-6",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${h.progress}%`}})}),h.estimatedTime&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Estimated time remaining: ",h.estimatedTime]})]}),h.suggestions&&e.jsxs("div",{className:"mb-6 text-left max-w-md",children:[e.jsx("ul",{className:"space-y-2",children:h.suggestions.map((v,k)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:""}),v]},`suggestion-${v.substring(0,10)}-${k}`))}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[i&&e.jsxs("button",{type:"button",onClick:i,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx(di,{className:"w-4 h-4"})," Filters"]}),u&&e.jsxs("button",{type:"button",onClick:u,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx(ui,{className:"w-4 h-4"})," Advanced"]}),y&&n&&e.jsx("button",{type:"button",onClick:n,className:"px-3 py-1.5 rounded border text-sm",children:"Clear filters"})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:S.map(v=>e.jsx("button",{type:"button",onClick:()=>f&&f(v),className:"px-2 py-1.5 rounded bg-gray-100 dark:bg-gray-800 text-xs",children:v},v))})]}),e.jsxs("div",{className:"flex gap-3 mb-6 flex-wrap justify-center",children:[h.action&&e.jsx("button",{type:"button",onClick:h.action,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:h.actionLabel}),h.demoAction&&e.jsx("button",{type:"button",onClick:h.demoAction,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:h.demoActionLabel}),a==="no-directory"&&l&&e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Start Tour"}),a==="indexing"&&d&&e.jsx("button",{type:"button",onClick:d,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"View Progress"}),c&&e.jsxs("button",{type:"button",onClick:c,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[e.jsx(hi,{className:"w-4 h-4"})," Help"]})]}),h.tips&&e.jsxs("div",{className:"max-w-md",children:[e.jsxs("button",{type:"button",onClick:()=>C(!b),className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:[b?e.jsx(nr,{className:"w-4 h-4"}):e.jsx(Rs,{className:"w-4 h-4"}),b?"Hide tips":"Show tips"]}),b&&e.jsx("div",{className:"mt-4 text-left",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-3",children:" Tips"}),e.jsx("ul",{className:"space-y-2",children:h.tips.map((v,k)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:""}),v]},`tip-${v.substring(0,10)}-${k}`))})]})})]})]})}function Gl({isVisible:a,onDismiss:t,context:s,userActions:r}){const[n,i]=o.useState(0),[u,c]=o.useState(!1),d={search:[{title:"Natural Language Search",content:"Try searching for 'sunset at beach' or 'family birthday party' - our AI understands what you're looking for naturally.",trigger:!r.includes("searched")},{title:"Search by Colors & Objects",content:"Search for colors like 'red car' or objects like 'mountains' - our AI can find visual elements in your photos.",trigger:r.includes("searched")&&!r.includes("filtered")},{title:"Advanced Filters",content:"Use the filter panel to narrow by date, camera, location, or rating for more precise results.",trigger:r.includes("searched")&&r.length>3}],library:[{title:"Getting Started",content:"Select a folder with your photos to begin. We'll analyze them to make them searchable.",trigger:!r.includes("selected_directory")},{title:"Indexing Process",content:"After selecting photos, we'll index them using AI. This takes about 30 seconds per 100 photos.",trigger:r.includes("selected_directory")&&!r.includes("indexed")},{title:"Browse Your Photos",content:"Once indexed, you can browse all your photos here. Use the search bar above to find specific ones.",trigger:r.includes("indexed")}],results:[{title:"Photo Actions",content:"Select photos to share, favorite, tag, or organize them into collections.",trigger:!r.includes("selected_photo")},{title:"Quick Actions",content:"Use keyboard shortcuts: Space to select, Enter to view full size, F to favorite.",trigger:r.includes("selected_photo")&&!r.includes("used_keyboard")},{title:"Save Searches",content:"Save your favorite searches to quickly access them later from the Saved Searches section.",trigger:r.includes("searched")&&r.length>5}],collections:[{title:"Organize Your Photos",content:"Create collections to group related photos together, like 'Vacation 2024' or 'Family Events'.",trigger:!r.includes("created_collection")},{title:"Smart Collections",content:"Set up smart collections that automatically include photos based on your criteria.",trigger:r.includes("created_collection")}],settings:[{title:"Customize Your Experience",content:"Configure AI models, indexing preferences, and interface settings to match your needs.",trigger:!r.includes("changed_setting")},{title:"Performance Tuning",content:"Adjust indexing speed and search accuracy based on your hardware and preferences.",trigger:r.includes("changed_setting")}]}[s]?.filter(y=>y.trigger)||[];if(o.useEffect(()=>{if(d.length>0&&!u){const f=setInterval(()=>{i(y=>(y+1)%d.length)},8e3);return()=>clearInterval(f)}},[d.length,u]),!a||d.length===0)return null;const p=d[n];return e.jsx("div",{className:"fixed bottom-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mi,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Tip"})]}),e.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Dismiss tip",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:p.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed",children:p.content})]}),d.length>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:d.map((f,y)=>e.jsx("button",{type:"button",onClick:()=>i(y),className:`w-2 h-2 rounded-full transition-colors ${y===n?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`,"aria-label":`Go to tip ${y+1}`},`tip-${f.title}-${y}`))}),e.jsxs("button",{type:"button",onClick:()=>i((n+1)%d.length),className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:["Next",e.jsx(De,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:()=>{c(!0),t()},className:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Don't show tips like this"})})]})})}function Yl({isVisible:a,onComplete:t,completedSteps:s,onStepComplete:r,onStepAction:n,inProgressStepId:i}){const[u,c]=o.useState(!1),l=[{id:"select_directory",title:"Select Photo Directory",description:"Choose a folder containing your photos",action:"Get Started"},{id:"index_photos",title:"Index Your Photos",description:"Let AI analyze your photos for search",action:"Start Indexing"},{id:"first_search",title:"Try Your First Search",description:'Search for something like "beach sunset"',action:"Search Now"},{id:"explore_features",title:"Explore Features",description:"Try collections, favorites, and sharing",action:"Explore"}],d=s.length,p=l.length,f=d===p;return o.useEffect(()=>{if(f){const y=setTimeout(t,2e3);return()=>clearTimeout(y)}},[f,t]),a?e.jsx("div",{className:"fixed top-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>c(!u),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${f?"bg-green-100 dark:bg-green-900/20":"bg-blue-100 dark:bg-blue-900/20"}`,children:f?e.jsx(Mt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(is,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Getting Started"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d," of ",p," steps complete"]})]})]}),e.jsx(De,{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${d/p*100}%`}})})}),u&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-h-80 overflow-y-auto",children:l.map((y,w)=>{const j=s.includes(y.id),b=s.length===w;return e.jsx("div",{className:`px-4 py-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0 ${j?"bg-green-50 dark:bg-green-900/10":b?"bg-blue-50 dark:bg-blue-900/10":"bg-gray-50 dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 ${j?"bg-green-100 dark:bg-green-900/20":"bg-gray-200 dark:bg-gray-600"}`,children:j?e.jsx(Mt,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:w+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-medium text-sm ${j?"text-green-800 dark:text-green-200":"text-gray-900 dark:text-white"}`,children:y.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:y.description}),!j&&b&&(i===y.id?e.jsx("span",{className:"mt-2 inline-flex items-center px-3 py-1 bg-gray-500 text-white text-xs rounded",children:"In progress"}):e.jsx("button",{type:"button",onClick:()=>n?n(y.id):r(y.id),className:"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",children:y.action}))]})]})},y.id)})})})]})}):null}function Ql({photoCount:a=0,indexedCount:t=0,searchProvider:s="local",isIndexing:r=!1,isConnected:n=!0,currentDirectory:i="",lastSync:u,activeJobs:c=0}){const[l,d]=o.useState(0),[p,f]=o.useState(0);o.useEffect(()=>{const j=setInterval(()=>{d(Math.random()*30+(r?40:10)),f(Math.random()*20+30)},2e3);return()=>clearInterval(j)},[r]);const y=j=>{if(!j)return"No directory selected";const b=j.split("/");return b.length>3?`.../${b.slice(-2).join("/")}`:j},w=j=>{if(!j)return"Never";const C=new Date().getTime()-j.getTime(),P=Math.floor(C/6e4);if(P<1)return"Just now";if(P<60)return`${P}m ago`;const S=Math.floor(P/60);return S<24?`${S}h ago`:`${Math.floor(S/24)}d ago`};return e.jsx("div",{className:"status-bar",children:e.jsxs("div",{className:"status-content",children:[e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(xi,{className:"status-icon"}),e.jsx("span",{className:"status-text",children:y(i)})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(Rt,{className:"status-icon"}),e.jsxs("span",{children:[a.toLocaleString()," photos"]})]}),r?e.jsxs("div",{className:"status-item",children:[e.jsx("div",{className:"status-spinner"}),e.jsxs("span",{className:"status-text processing",children:["Indexing... ",t,"/",a]})]}):e.jsxs("div",{className:"status-item",children:[e.jsx(Mt,{className:"status-icon"}),e.jsxs("span",{className:"status-text success",children:[t.toLocaleString()," indexed"]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Te,{className:"status-icon"}),e.jsx("span",{className:"capitalize",children:s})]}),c>0&&e.jsxs("div",{className:"status-item",children:[e.jsx(ir,{className:"status-icon"}),e.jsxs("span",{className:"status-text warning",children:[c," active job",c!==1?"s":""]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(ft,{className:"status-icon"}),e.jsxs("span",{children:["Synced ",w(u)]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Bs,{className:"status-icon"}),e.jsxs("span",{children:[l.toFixed(0),"%"]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(Qt,{className:"status-icon"}),e.jsxs("span",{children:[p.toFixed(0),"%"]})]}),e.jsx("div",{className:"status-item",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:"status-icon"}),e.jsx("span",{className:"status-text success",children:"Connected"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"status-icon"}),e.jsx("span",{className:"status-text error",children:"Offline"})]})})]})]})})}function Jl({jobs:a,onPause:t,onResume:s,onCancel:r,onRetry:n,onClear:i,onClearAll:u}){const[c,l]=o.useState(!1),[d,p]=o.useState(new Set),f=a.filter(m=>m.status==="running"||m.status==="paused"),y=a.filter(m=>m.status==="completed"||m.status==="failed"||m.status==="cancelled"),w=m=>{const h=new Set(d);h.has(m)?h.delete(m):h.add(m),p(h)},j=m=>({index:e.jsx(Qt,{className:"w-4 h-4"}),search:e.jsx(Te,{className:"w-4 h-4"}),edit:e.jsx(Rt,{className:"w-4 h-4"}),export:e.jsx(_e,{className:"w-4 h-4"}),import:e.jsx(xt,{className:"w-4 h-4"}),backup:e.jsx(Qt,{className:"w-4 h-4"}),analyze:e.jsx(Bs,{className:"w-4 h-4"}),restore:e.jsx(Ms,{className:"w-4 h-4"})})[m],b=m=>({queued:"text-gray-500",running:"text-blue-500",paused:"text-yellow-500",completed:"text-green-500",failed:"text-red-500",cancelled:"text-gray-400"})[m],C=m=>{switch(m){case"queued":return e.jsx(ft,{className:"w-4 h-4"});case"running":return e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"});case"paused":return e.jsx(zs,{className:"w-4 h-4"});case"completed":return e.jsx(Mt,{className:"w-4 h-4"});case"failed":return e.jsx(pi,{className:"w-4 h-4"});case"cancelled":return e.jsx(Ds,{className:"w-4 h-4"})}},P=(m,h)=>{if(!m)return"";const k=(h||new Date).getTime()-m.getTime(),E=Math.floor(k/1e3),T=Math.floor(E/60),N=Math.floor(T/60);return N>0?`${N}h ${T%60}m`:T>0?`${T}m ${E%60}s`:`${E}s`},S=m=>{const h=Math.floor(m/60),v=Math.floor(h/60);return v>0?`${v} hour${v>1?"s":""}`:h>0?`${h} minute${h>1?"s":""}`:`${m} second${m>1?"s":""}`};return a.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:e.jsxs("button",{onClick:()=>l(!c),className:"bg-white dark:bg-gray-800 rounded-full shadow-lg p-3 flex items-center gap-2 hover:shadow-xl transition-shadow",children:[e.jsx(ir,{className:"w-5 h-5 text-blue-500"}),f.length>0&&e.jsx("span",{className:"bg-blue-500 text-white text-xs rounded-full px-2 py-0.5",children:f.length})]})}),c&&e.jsxs("div",{className:"fixed bottom-20 right-4 w-96 max-h-[600px] bg-white dark:bg-gray-800 rounded-lg shadow-2xl z-40 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold",children:"What's happening"}),e.jsxs("div",{className:"flex items-center gap-2",children:[y.length>0&&e.jsx("button",{onClick:u,className:"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Clear All"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(je,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[f.length>0&&e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Working on"}),e.jsx("div",{className:"space-y-2",children:f.map(m=>e.jsx(Ya,{job:m,isExpanded:d.has(m.id),onToggleExpanded:()=>w(m.id),onPause:t,onResume:s,onCancel:r,getJobIcon:j,getStatusIcon:C,getStatusColor:b,formatDuration:P,formatTimeRemaining:S},m.id))})]}),y.length>0&&e.jsxs("div",{className:"p-3 border-t dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Recently finished"}),e.jsx("div",{className:"space-y-2",children:y.map(m=>e.jsx(Ya,{job:m,isExpanded:d.has(m.id),onToggleExpanded:()=>w(m.id),onRetry:n,onClear:i,getJobIcon:j,getStatusIcon:C,getStatusColor:b,formatDuration:P,formatTimeRemaining:S},m.id))})]})]})]})]})}function Ya({job:a,isExpanded:t,onToggleExpanded:s,onPause:r,onResume:n,onCancel:i,onRetry:u,onClear:c,getJobIcon:l,getStatusIcon:d,getStatusColor:p,formatDuration:f,formatTimeRemaining:y}){const w=a.total?(a.progress||0)/a.total*100:0;return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("div",{className:"mt-0.5",children:l(a.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:a.title}),e.jsxs("div",{className:`flex items-center gap-1 ${p(a.status)}`,children:[d(a.status),e.jsx("span",{className:"text-xs capitalize",children:a.status})]})]}),a.status==="running"&&a.total&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:[a.progress||0," of ",a.total,a.type==="backup"?" photos saved":a.type==="index"?" photos found":a.type==="export"?" photos exported":" items"]}),e.jsxs("span",{children:[w.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all",style:{width:`${w}%`}})}),(a.estimatedTimeRemaining||a.speed)&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mt-1",children:[a.estimatedTimeRemaining&&e.jsxs("span",{children:["About ",y(a.estimatedTimeRemaining)," left"]}),a.speed&&e.jsx("span",{children:a.speed})]}),a.currentItem&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:[a.type==="backup"?"Saving: ":a.type==="index"?"Looking at: ":"Processing: ",a.currentItem]})]}),a.startTime&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[a.status==="completed"?"Finished in ":a.status==="failed"?"Failed after ":a.status==="running"?"Running for ":"",f(a.startTime,a.endTime),a.status==="completed"&&e.jsxs("span",{className:"ml-2",children:[a.successCount&&e.jsxs("span",{className:"text-green-500",children:[" ",a.successCount]}),a.warningCount&&e.jsxs("span",{className:"text-yellow-500 ml-1",children:[" ",a.warningCount]}),a.errorCount&&e.jsxs("span",{className:"text-red-500 ml-1",children:[" ",a.errorCount]})]})]}),t&&(a.error||a.description)&&e.jsx("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300",children:a.error?e.jsx("div",{className:"text-red-500",children:a.error}):e.jsx("div",{children:a.description})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[a.status==="running"&&a.canPause&&e.jsx("button",{onClick:()=>r?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(zs,{className:"w-3 h-3"})}),a.status==="paused"&&e.jsx("button",{onClick:()=>n?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(pt,{className:"w-3 h-3"})}),(a.status==="running"||a.status==="paused")&&a.canCancel&&e.jsx("button",{onClick:()=>i?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded text-red-500",children:e.jsx(je,{className:"w-3 h-3"})}),a.status==="failed"&&a.canRetry&&e.jsx("button",{onClick:()=>u?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Ms,{className:"w-3 h-3"})}),(a.status==="completed"||a.status==="failed"||a.status==="cancelled")&&e.jsx("button",{onClick:()=>c?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Ke,{className:"w-3 h-3"})}),(a.error||a.description)&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:t?e.jsx(nr,{className:"w-3 h-3"}):e.jsx(Rs,{className:"w-3 h-3"})})]})]})})}function Xl({dir:a}){const[t,s]=o.useState([]),[r,n]=o.useState(!1),[i,u]=o.useState("");async function c(){n(!0),u("");try{const l=await jr(a||void 0);s(l.shares||[])}catch(l){u(l instanceof Error?l.message:"Failed to load shares")}finally{n(!1)}}return o.useEffect(()=>{c()},[a]),e.jsxs("div",{children:[i&&e.jsx("div",{className:"text-red-700 text-sm mb-2",children:i}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," link",t.length!==1?"s":""]}),e.jsx("button",{onClick:c,className:"px-2 py-1 border rounded text-sm",children:"Refresh"})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 pr-2",children:"Token"}),e.jsx("th",{className:"py-1 pr-2",children:"Created"}),e.jsx("th",{className:"py-1 pr-2",children:"Expires"}),e.jsx("th",{className:"py-1 pr-2",children:"Count"}),e.jsx("th",{className:"py-1 pr-2",children:"Access"}),e.jsx("th",{className:"py-1 pr-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[t.map(l=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 pr-2 font-mono text-xs",children:l.token}),e.jsx("td",{className:"py-1 pr-2",children:new Date(l.created).toLocaleString()}),e.jsxs("td",{className:"py-1 pr-2",children:[l.expires?new Date(l.expires).toLocaleString():"",l.expired?e.jsx("span",{className:"ml-1 text-red-700",children:"(expired)"}):null,!l.expired&&l.expires&&(()=>{const d=new Date(l.expires).getTime()-Date.now();return d>0&&d<24*3600*1e3?e.jsx("span",{className:"ml-1 text-amber-700",children:"(expires soon)"}):null})()]}),e.jsx("td",{className:"py-1 pr-2",children:l.count}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:l.view_only?"View-only":"Downloadable"}),l.has_password?e.jsx("span",{className:"text-xs bg-gray-200 rounded px-1",children:"Protected"}):null]})}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;window.open(d,"_blank")},children:"Open"}),e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;await navigator.clipboard.writeText(d),alert("Copied link to clipboard")},children:"Copy Link"}),e.jsx("button",{className:"px-2 py-0.5 border rounded text-red-700",onClick:async()=>{if(confirm("Revoke this share link?"))try{await wr(l.token),await c()}catch{}},children:"Revoke"})]})})]},l.token)),t.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"No share links yet."})}),r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"Loading"})})]})]})})]})}function Zl({cameras:a=[],popularISOs:t=[100,200,400,800,1600,3200],popularApertures:s=[1.4,1.8,2.8,4,5.6,8],yearRange:r,camera:n,setCamera:i,isoMin:u,setIsoMin:c,isoMax:l,setIsoMax:d,fMin:p,setFMin:f,fMax:y,setFMax:w,dateFrom:j,setDateFrom:b,dateTo:C,setDateTo:P,onApplyFilters:S,onClearFilters:m,compact:h=!1}){const[v,k]=o.useState("camera"),E=n||u||l||p||y||j||C,T=[{id:"camera",label:"Camera",icon:_t,content:e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>i(""),className:`px-2 py-1 text-xs rounded border ${n?"bg-white border-gray-300 hover:bg-gray-50":"bg-blue-600 text-white border-blue-600"}`,children:"Any Camera"}),a.slice(0,h?4:8).map(N=>e.jsx("button",{type:"button",onClick:()=>i(n===N?"":N),className:`px-2 py-1 text-xs rounded border truncate max-w-32 ${n===N?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,title:N,children:N.length>20?N.substring(0,20)+"...":N},N))]})})},{id:"aperture",label:"Aperture",icon:gi,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select f-stop range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{f(""),w("")},className:`px-2 py-1 text-xs rounded border ${!p&&!y?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),s.map(N=>e.jsxs("button",{type:"button",onClick:()=>{const O=N.toString();p===O&&y===O?(f(""),w("")):(f(O),w(O))},className:`px-2 py-1 text-xs rounded border ${p===N.toString()&&y===N.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:["f/",N]},N))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:p,onChange:N=>f(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"1.4"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:y,onChange:N=>w(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"8.0"})]})]})]})},{id:"iso",label:"ISO",icon:qs,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select ISO range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{c(""),d("")},className:`px-2 py-1 text-xs rounded border ${!u&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),e.jsx("button",{type:"button",onClick:()=>{c(""),d("800")},className:`px-2 py-1 text-xs rounded border ${!u&&l==="800"?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Low (800)"}),e.jsx("button",{type:"button",onClick:()=>{c("800"),d("")},className:`px-2 py-1 text-xs rounded border ${u==="800"&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"High (800)"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(N=>e.jsx("button",{type:"button",onClick:()=>{const O=N.toString();u===O&&l===O?(c(""),d("")):(c(O),d(O))},className:`px-2 py-1 text-xs rounded border ${u===N.toString()&&l===N.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:N},N))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:u,onChange:N=>c(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:l,onChange:N=>d(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"3200"})]})]})]})},{id:"date",label:"Date",icon:Os,content:e.jsxs("div",{className:"space-y-2",children:[r&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>{b(""),P("")},className:`px-2 py-1 text-xs rounded border ${!j&&!C?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any Year"}),Array.from({length:Math.min(6,r[0]-r[1]+1)},(N,O)=>r[0]-O).map(N=>e.jsx("button",{type:"button",onClick:()=>{const O=`${N}-01-01`,U=`${N}-12-31`;j===O&&C===U?(b(""),P("")):(b(O),P(U))},className:`px-2 py-1 text-xs rounded border ${j===`${N}-01-01`&&C===`${N}-12-31`?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:N},N))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From"}),e.jsx("input",{type:"date",value:j,onChange:N=>b(N.target.value),className:"w-full text-xs border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To"}),e.jsx("input",{type:"date",value:C,onChange:N=>P(N.target.value),className:"w-full text-xs border rounded px-2 py-1"})]})]})]})}];return h?e.jsxs("div",{className:"bg-white border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Quick Filters"}),E&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:S,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700",children:"Apply"}),E&&e.jsx("button",{type:"button",onClick:m,className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",children:"Clear"})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:T.map(N=>{const O=N.icon;return e.jsxs("div",{className:"flex-shrink-0 min-w-48",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(O,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:N.label})]}),e.jsx("div",{className:"text-xs",children:N.content})]},N.id)})})]}):e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Quick Filters"}),E&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[[n,u,l,p,y,j,C].filter(Boolean).length," active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:S,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"Apply"}),E&&e.jsx("button",{type:"button",onClick:m,className:"text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300",children:"Clear All"})]})]}),e.jsx("div",{className:"flex border-b",children:T.map(N=>{const O=N.icon;return e.jsxs("button",{type:"button",onClick:()=>k(N.id),className:`flex-1 flex items-center justify-center gap-2 p-3 text-sm border-r last:border-r-0 ${v===N.id?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(O,{className:"w-4 h-4"}),N.label]},N.id)})}),e.jsx("div",{className:"p-4",children:T.find(N=>N.id===v)?.content})]})}function ec(a,t){const s=Date.now();return{id:`preset_${s}_${Math.random().toString(36).substr(2,9)}`,name:a,createdAt:s,updatedAt:s,filters:t}}function tc(a,t){const{filters:s}=a;s.favOnly!==void 0&&t.setFavOnly(s.favOnly),s.tagFilter!==void 0&&t.setTagFilter(s.tagFilter),s.place!==void 0&&t.setPlace(s.place),s.camera!==void 0&&t.setCamera(s.camera),s.isoMin!==void 0&&t.setIsoMin(s.isoMin),s.isoMax!==void 0&&t.setIsoMax(s.isoMax),s.fMin!==void 0&&t.setFMin(s.fMin),s.fMax!==void 0&&t.setFMax(s.fMax),s.dateFrom!==void 0&&t.setDateFrom(s.dateFrom),s.dateTo!==void 0&&t.setDateTo(s.dateTo),s.useCaps!==void 0&&t.setUseCaps(s.useCaps),s.useOcr!==void 0&&t.setUseOcr(s.useOcr),s.hasText!==void 0&&t.setHasText(s.hasText),s.ratingMin!==void 0&&t.setRatingMin(s.ratingMin)}function sc({show:a,onClose:t,onApply:s,favOnly:r,setFavOnly:n,tagFilter:i,setTagFilter:u,camera:c,setCamera:l,isoMin:d,setIsoMin:p,isoMax:f,setIsoMax:y,dateFrom:w,setDateFrom:j,dateTo:b,setDateTo:C,fMin:P,setFMin:S,fMax:m,setFMax:h,place:v,setPlace:k,useCaps:E,setUseCaps:T,useOcr:N,setUseOcr:O,hasText:U,setHasText:Z,ratingMin:F,setRatingMin:K,availableCameras:_,yearRange:M,filterPresets:W,onSavePreset:se,onLoadPreset:B,onDeletePreset:me}){const[A,ee]=o.useState(!1),[ie,V]=o.useState(""),[Y,R]=o.useState(!1);if(!a)return null;const H=()=>({favOnly:r,tagFilter:i,place:v,camera:c,isoMin:d,isoMax:f,fMin:P,fMax:m,dateFrom:w,dateTo:b,useCaps:E,useOcr:N,hasText:U,ratingMin:F}),$=()=>{n(!1),u(""),k(""),l(""),p(""),y(""),S(""),h(""),j(""),C(""),T(!1),O(!1),Z(!1),K(0)},G=()=>{if(!ie.trim())return;const L=ec(ie.trim(),H());se(L),V(""),R(!1)},J=L=>{tc(L,{setFavOnly:n,setTagFilter:u,setPlace:k,setCamera:l,setIsoMin:p,setIsoMax:y,setFMin:S,setFMax:h,setDateFrom:j,setDateTo:C,setUseCaps:T,setUseOcr:O,setHasText:Z,setRatingMin:K}),ee(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40 flex",children:e.jsxs("div",{className:"ml-auto w-full max-w-md bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Vs,{className:"w-5 h-5"}),"Filters"]}),e.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-gray-100",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsx("button",{type:"button",className:`flex-1 py-3 text-sm font-medium ${A?"text-gray-500":"border-b-2 border-blue-500 text-blue-600"}`,onClick:()=>ee(!1),children:"Filters"}),e.jsx("button",{type:"button",className:`flex-1 py-3 text-sm font-medium ${A?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>ee(!0),children:"Presets"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:A?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-medium",children:"Saved Filter Presets"}),e.jsxs("button",{type:"button",onClick:()=>R(!0),className:"flex items-center gap-1 text-sm bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx(tr,{className:"w-4 h-4"}),"Save Current"]})]}),Y&&e.jsxs("div",{className:"border rounded p-3 bg-blue-50",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Save Current Filters"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ie,onChange:L=>V(L.target.value),placeholder:"Preset name",className:"flex-1 border rounded px-2 py-1 text-sm",autoFocus:!0}),e.jsx("button",{type:"button",onClick:G,disabled:!ie.trim(),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm disabled:opacity-50",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>{R(!1),V("")},className:"px-3 py-1 border rounded text-sm",children:"Cancel"})]})]}),W.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ge,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"No saved presets yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Save your filter combinations for quick access"})]}):e.jsx("div",{className:"space-y-2",children:W.map(L=>e.jsx("div",{className:"border rounded p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium truncate",title:L.name,children:L.name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Object.keys(L.filters).length," filters"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>J(L),className:"p-1 rounded hover:bg-gray-200",title:"Apply preset",children:e.jsx(qs,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>me(L.id),className:"p-1 rounded hover:bg-red-100 text-red-600",title:"Delete preset",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})},L.id))})]}):e.jsxs(e.Fragment,{children:[e.jsx(Zl,{cameras:_,yearRange:M,camera:c,setCamera:l,isoMin:d,setIsoMin:p,isoMax:f,setIsoMax:y,fMin:P,setFMin:S,fMax:m,setFMax:h,dateFrom:w,setDateFrom:j,dateTo:b,setDateTo:C,onApplyFilters:s,onClearFilters:$,compact:!0}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Basic Filters"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"flt-fav",children:"Favorites only"}),e.jsx("input",{id:"flt-fav",type:"checkbox",checked:r,onChange:L=>n(L.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-tags",children:"Tags (comma-separated)"}),e.jsx("input",{id:"flt-tags",className:"w-full border rounded px-2 py-1",value:i,onChange:L=>u(L.target.value),placeholder:"portrait, landscape, vacation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-place",children:"Location/Place"}),e.jsx("input",{id:"flt-place",className:"w-full border rounded px-2 py-1",value:v,onChange:L=>k(L.target.value),placeholder:"New York, Beach, Mountains"})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Search Features"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-caps",children:[e.jsx("span",{children:"Use AI captions"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search in generated image descriptions"})]}),e.jsx("input",{id:"flt-caps",type:"checkbox",checked:E,onChange:L=>T(L.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-ocr",children:[e.jsx("span",{children:"Use OCR"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search for text within images"})]}),e.jsx("input",{id:"flt-ocr",type:"checkbox",checked:N,onChange:L=>O(L.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-hastext",children:[e.jsx("span",{children:"Has text"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Only images containing readable text"})]}),e.jsx("input",{id:"flt-hastext",type:"checkbox",checked:U,onChange:L=>Z(L.target.checked)})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Minimum rating:"}),[0,1,2,3,4,5].map(L=>e.jsx("button",{type:"button",className:`px-2 py-1 rounded text-sm ${F===L?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,onClick:()=>K(L),children:L===0?"Any":"".repeat(L)},L))]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Date Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-from-manual",children:"Date From"}),e.jsx("input",{id:"flt-date-from-manual",type:"date",className:"w-full border rounded px-2 py-1",value:w,onChange:L=>j(L.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-to-manual",children:"Date To"}),e.jsx("input",{id:"flt-date-to-manual",type:"date",className:"w-full border rounded px-2 py-1",value:b,onChange:L=>C(L.target.value)})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t bg-gray-50",children:[e.jsx("button",{type:"button",onClick:$,className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear All Filters"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded border border-gray-300 hover:bg-gray-50",onClick:t,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",onClick:s,children:"Apply Filters"})]})]})]})})}function ac({selectedView:a,onViewChange:t,library:s=[],favorites:r=[],collections:n=[],clusters:i=[],savedSearches:u=[],smart:c=[],trips:l=[],isOpen:d=!1,onClose:p}){const f=[{id:"library",label:"All Photos",icon:bt,count:s?.length||0},{id:"results",label:"Search Results",icon:Te},{id:"favorites",label:"Favorites",icon:Ot,count:r?.length||0}],y=[{id:"people",label:"People",icon:Ye,count:i?.length||0},{id:"map",label:"Places",icon:ns},{id:"calendar",label:"Calendar",icon:Os},{id:"collections",label:"Collections",icon:As,count:n?.length||0},{id:"trips",label:"Trips",icon:fi,count:l?.length||0}],w=[{id:"smart",label:"Smart Collections",icon:bi,count:c?.length||0},{id:"saved",label:"Saved Searches",icon:Te,count:u?.length||0},{id:"tasks",label:"Tasks",icon:yi}],j=b=>e.jsxs("button",{type:"button",onClick:()=>t(b.id),className:`nav-item ${a===b.id?"active":""}`,children:[e.jsxs("div",{className:"nav-item-content",children:[e.jsx(b.icon,{className:"nav-item-icon"}),e.jsx("span",{className:"nav-item-label",children:b.label})]}),b.count!==void 0&&e.jsx("span",{className:"nav-item-count",children:b.count})]},b.id);return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:p}),e.jsxs("div",{className:`sidebar-container ${d?"open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"sidebar-title",children:"PhotoVault"}),e.jsx("p",{className:"sidebar-subtitle",children:"AI-Powered Photo Management"})]}),e.jsx("button",{type:"button",onClick:p,className:"sidebar-close",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Library"}),e.jsx("div",{className:"nav-items",children:f.map(j)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Organize"}),e.jsx("div",{className:"nav-items",children:y.map(j)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Smart Features"}),e.jsx("div",{className:"nav-items",children:w.map(j)})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsx("button",{type:"button",className:"sidebar-settings-button",onClick:()=>window.location.href="/settings",children:"Settings"})})]})]})}class rc extends o.Component{constructor(s){super(s);ne(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});ne(this,"handleReload",()=>{window.location.reload()});ne(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),this.setState(n=>({errorInfo:r,errorCount:n.errorCount+1})),this.props.onError&&this.props.onError(s,r),typeof window<"u"&&window.logErrorToService&&window.logErrorToService({error:s.toString(),errorInfo:r.componentStack,timestamp:new Date().toISOString()})}render(){return this.state.hasError?this.props.fallback?e.jsx(e.Fragment,{children:this.props.fallback}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx(Fs,{className:"w-6 h-6 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 mb-2",children:"Oops! Something unexpected happened"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Don't worry - your photos are safe. Let's get you back on track."}),!1,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:this.handleReset,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Hs,{className:"w-4 h-4"}),"Try again"]}),e.jsx("button",{onClick:this.handleReload,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Reload page"}),e.jsxs("button",{onClick:this.handleGoHome,className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(or,{className:"w-4 h-4"}),"Go to home"]})]}),this.state.errorCount>2&&e.jsx("p",{className:"mt-4 text-xs text-center text-gray-500",children:"Having trouble? A quick refresh usually helps."})]})}):this.props.children}}class Qa extends o.Component{constructor(s){super(s);ne(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error(`Error in ${this.props.sectionName||"section"}:`,s),this.setState({errorInfo:r})}render(){return this.state.hasError?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fs,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-red-900",children:["Couldn't load ",this.props.sectionName||"this section"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:this.state.error?.message||"Something went wrong, but we can fix it"}),e.jsx("button",{onClick:this.handleReset,className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"Try again"})]})]})}):this.props.children}}class nc{constructor(){ne(this,"QUEUE_KEY","offline_action_queue");ne(this,"MAX_RETRIES",3);ne(this,"isOnline");ne(this,"syncInProgress",!1);ne(this,"listeners",new Set);this.isOnline=navigator.onLine,this.setupEventListeners(),this.checkConnection()}setupEventListeners(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),setInterval(()=>this.checkConnection(),3e4)}async checkConnection(){try{const t=await fetch("/api/ping",{method:"HEAD",cache:"no-cache"});this.setOnlineStatus(t.ok)}catch{this.setOnlineStatus(!1)}}setOnlineStatus(t){this.isOnline!==t&&(this.isOnline=t,this.notifyListeners(t),t&&this.syncQueue())}handleOnline(){console.log("[Offline Service] Connection restored"),this.setOnlineStatus(!0)}handleOffline(){console.log("[Offline Service] Connection lost"),this.setOnlineStatus(!1)}notifyListeners(t){this.listeners.forEach(s=>s(t))}onStatusChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}getStatus(){return this.isOnline}async queueAction(t){const s={...t,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),retries:0},r=this.getQueue();return r.push(s),this.saveQueue(r),this.isOnline&&this.syncQueue(),s.id}getQueue(){try{const t=localStorage.getItem(this.QUEUE_KEY);return t?JSON.parse(t):[]}catch{return[]}}saveQueue(t){try{localStorage.setItem(this.QUEUE_KEY,JSON.stringify(t))}catch(s){console.error("[Offline Service] Failed to save queue:",s)}}async syncQueue(){if(!this.isOnline||this.syncInProgress)return;this.syncInProgress=!0;const t=this.getQueue(),s=[];for(const r of t)try{await this.processAction(r),console.log(`[Offline Service] Synced action: ${r.id}`)}catch(n){console.error(`[Offline Service] Failed to sync action: ${r.id}`,n),r.retries++,r.retries<this.MAX_RETRIES?s.push(r):console.error(`[Offline Service] Max retries reached for action: ${r.id}`)}this.saveQueue(s),this.syncInProgress=!1,s.length>0&&setTimeout(()=>this.syncQueue(),6e4)}async processAction(t){const{apiSearch:s,apiSetCollection:r,apiBatchTag:n,apiBatchDelete:i}=await pe(async()=>{const{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}=await Promise.resolve().then(()=>ge);return{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}},void 0,import.meta.url);switch(t.type){case"search":await s(t.payload.dir,t.payload.query,t.payload.topK);break;case"collection":await r(t.payload.dir,t.payload.name,t.payload.paths);break;case"tag":await n(t.payload.dir,t.payload.paths,t.payload.tags,t.payload.operation);break;case"delete":await i(t.payload.dir,t.payload.paths,t.payload.useOsTrash);break;default:throw new Error(`Unknown action type: ${t.type}`)}}async precacheImages(t){if("caches"in window)try{await(await caches.open("photovault-images")).addAll(t)}catch(s){console.error("[Offline Service] Failed to precache images:",s)}}async getCachedImage(t){if(!("caches"in window))return null;try{return await(await caches.open("photovault-images")).match(t)}catch{return null}}async registerBackgroundSync(t){if(!(!("serviceWorker"in navigator)||!("sync"in ServiceWorkerRegistration.prototype)))try{await(await navigator.serviceWorker.ready).sync.register(t),console.log(`[Offline Service] Background sync registered: ${t}`)}catch(s){console.error("[Offline Service] Failed to register background sync:",s)}}async clearOfflineData(){if(localStorage.removeItem(this.QUEUE_KEY),"caches"in window){const t=await caches.keys();await Promise.all(t.filter(s=>s.startsWith("photovault-")).map(s=>caches.delete(s)))}console.log("[Offline Service] Offline data cleared")}}const Cs=new nc;function ic(){const[a,t]=o.useState(!0),[s,r]=o.useState(!1),[n,i]=o.useState(!1);return o.useEffect(()=>(t(Cs.getStatus()),Cs.onStatusChange(c=>{t(c),r(!0),c&&(i(!0),Cs.syncQueue().then(()=>{i(!1)})),setTimeout(()=>r(!1),3e3)})),[]),a&&!s&&!n?null:e.jsxs(e.Fragment,{children:[!a&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg shadow-lg",children:[e.jsx(Yt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Offline Mode"})]}),s&&e.jsx("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg transition-all duration-300 ${a?"bg-green-500 text-white":"bg-orange-500 text-white"}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Back Online"}),n&&e.jsx("div",{className:"text-sm opacity-90",children:"Syncing changes..."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"You're Offline"}),e.jsx("div",{className:"text-sm opacity-90",children:"Changes will sync when reconnected"})]})]})}),n&&a&&!s&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Syncing offline changes..."})]})]})}function ln({size:a="md",message:t,className:s="",inline:r=!1}){const n={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"};return r?e.jsxs("span",{className:`inline-flex items-center gap-2 ${s}`,children:[e.jsx(_a,{className:`${n[a]} animate-spin text-blue-600`}),t&&e.jsx("span",{className:"text-sm text-gray-600",children:t})]}):e.jsxs("div",{className:`flex flex-col items-center justify-center ${s}`,children:[e.jsx(_a,{className:`${n[a]} animate-spin text-blue-600`}),t&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t})]})}const cn=o.createContext(null);function oc({children:a}){const[t,s]=o.useState(!0),[r,n]=o.useState(()=>localStorage.getItem("ps_theme")||"light"),[i,u]=o.useState({help:!1,onboarding:!1});o.useEffect(()=>{localStorage.setItem("ps_theme",r),r==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[r]);const c=o.useMemo(()=>({state:{sidebarOpen:t,theme:r,modals:i},actions:{toggleSidebar:()=>s(l=>!l),setTheme:n,openModal:l=>u(d=>({...d,[l]:!0})),closeModal:l=>u(d=>({...d,[l]:!1}))}}),[t,r,i]);return e.jsx(cn.Provider,{value:c,children:a})}function lc(){const a=o.useContext(cn);if(!a)throw new Error("useUIContext must be used within UIProvider");return a}class cc{constructor(){ne(this,"STORAGE_KEY","photo_search_history");ne(this,"MAX_HISTORY_ENTRIES",100);ne(this,"MAX_SUGGESTIONS",20)}getHistory(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?s:[]}catch{return[]}}addToHistory(t){try{const r=this.getHistory().filter(i=>i.query.toLowerCase()!==t.query.toLowerCase());r.unshift(t);const n=r.slice(0,this.MAX_HISTORY_ENTRIES);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(s){console.warn("Failed to save search history:",s)}}getSuggestions(t){const s=t.toLowerCase().trim();if(!s)return this.getRecentSuggestions();const r=this.getHistory(),n=[];return r.forEach(u=>{u.query.toLowerCase().includes(s)&&n.push({query:u.query,type:"history",score:this.calculateHistoryScore(u,s),metadata:{lastUsed:u.timestamp,useCount:this.getUseCount(u.query)}})}),this.generateSimilarQueries(s,r).forEach(u=>{n.push({query:u,type:"similar",score:this.calculateSimilarityScore(s,u)})}),n.sort((u,c)=>c.score-u.score).slice(0,this.MAX_SUGGESTIONS)}getRecentSuggestions(){return this.getHistory().slice(0,10).map(s=>({query:s.query,type:"history",score:this.calculateRecencyScore(s),metadata:{lastUsed:s.timestamp,useCount:this.getUseCount(s.query)}}))}calculateHistoryScore(t,s){const r=this.calculateRecencyScore(t),n=this.getUseCount(t.query)/10,i=this.calculateMatchScore(t.query,s);return r*.3+n*.3+i*.4}calculateRecencyScore(t){const r=Date.now()-t.timestamp,n=30*24*60*60*1e3;return Math.max(0,1-r/n)}calculateMatchScore(t,s){const r=t.toLowerCase(),n=s.toLowerCase();if(r===n)return 1;if(r.startsWith(n))return .9;if(r.includes(n))return .7;const i=r.split(/\s+/),u=n.split(/\s+/);return i.filter(l=>u.includes(l)).length/Math.max(i.length,u.length)}calculateSimilarityScore(t,s){return this.calculateMatchScore(s,t)*.6}getUseCount(t){return this.getHistory().filter(r=>r.query.toLowerCase()===t.toLowerCase()).length}generateSimilarQueries(t,s){const r=t.split(/\s+/),n=[];return s.forEach(i=>{const u=i.query.toLowerCase().split(/\s+/);r.filter(l=>u.some(d=>d.includes(l.toLowerCase()))).length>0&&i.query.toLowerCase()!==t.toLowerCase()&&n.push(i.query)}),Array.from(new Set(n)).slice(0,5)}clearHistory(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(t){console.warn("Failed to clear search history:",t)}}getPopularSearches(t=10){const s=this.getHistory(),r=new Map;return s.forEach(n=>{const i=n.query.toLowerCase();r.set(i,(r.get(i)||0)+1)}),Array.from(r.entries()).sort((n,i)=>i[1]-n[1]).slice(0,t).map(([n])=>n)}}const as=new cc,dc=Object.freeze(Object.defineProperty({__proto__:null,searchHistoryService:as},Symbol.toStringTag,{value:"Module"})),uc=({onSearch:a,onClose:t})=>{const[s,r]=o.useState([]),[n,i]=o.useState(!1);o.useEffect(()=>{u()},[]);const u=()=>{const f=as.getHistory();r(f)},c=f=>{a(f),t()},l=()=>{as.clearHistory(),r([]),i(!1)},d=f=>{const w=Date.now()-f,j=Math.floor(w/(1e3*60)),b=Math.floor(w/(1e3*60*60)),C=Math.floor(w/(1e3*60*60*24));return j<1?"Just now":j<60?`${j}m ago`:b<24?`${b}h ago`:C<7?`${C}d ago`:new Date(f).toLocaleDateString()},p=f=>new Date(f).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"search-history-panel",children:[e.jsxs("div",{className:"search-history-header",children:[e.jsxs("div",{className:"search-history-title",children:[e.jsx(ft,{className:"w-5 h-5"}),e.jsx("span",{children:"Search History"})]}),e.jsxs("div",{className:"search-history-actions",children:[e.jsx("button",{onClick:()=>i(!0),className:"clear-history-btn",title:"Clear search history",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:t,className:"close-btn",title:"Close",children:e.jsx(je,{className:"w-4 h-4"})})]})]}),n&&e.jsx("div",{className:"clear-confirm-overlay",children:e.jsxs("div",{className:"clear-confirm-dialog",children:[e.jsx("p",{children:"Are you sure you want to clear your search history?"}),e.jsxs("div",{className:"clear-confirm-actions",children:[e.jsx("button",{onClick:()=>i(!1),className:"cancel-btn",children:"Cancel"}),e.jsx("button",{onClick:l,className:"confirm-btn",children:"Clear History"})]})]})}),e.jsx("div",{className:"search-history-content",children:s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(ft,{className:"w-12 h-12 text-gray-300"}),e.jsx("p",{children:"No search history yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your recent searches will appear here"})]}):e.jsx("div",{className:"search-history-list",children:s.map((f,y)=>e.jsx("div",{className:"search-history-item",children:e.jsxs("button",{onClick:()=>c(f.query),className:"search-history-button",children:[e.jsx(Te,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"search-query-container",children:[e.jsx("span",{className:"search-query",children:f.query}),e.jsxs("div",{className:"search-meta",children:[e.jsxs("span",{className:"result-count",children:[f.resultCount," results"]}),e.jsx("span",{className:"search-time",title:p(f.timestamp),children:d(f.timestamp)})]})]})]})},y))})}),e.jsx("style",{jsx:!0,children:`
        .search-history-panel {
          position: fixed;
          top: 0;
          right: 0;
          bottom: 0;
          width: 100%;
          max-width: 400px;
          background: white;
          border-left: 1px solid #e5e7eb;
          display: flex;
          flex-direction: column;
          z-index: 1000;
          box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .search-history-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
          background: #f9fafb;
        }

        .search-history-title {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: 600;
          font-size: 1.125rem;
        }

        .search-history-actions {
          display: flex;
          gap: 0.5rem;
        }

        .clear-history-btn,
        .close-btn {
          padding: 0.5rem;
          border-radius: 0.375rem;
          background: transparent;
          border: none;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s;
        }

        .clear-history-btn:hover {
          background: #fee2e2;
          color: #ef4444;
        }

        .close-btn:hover {
          background: #f3f4f6;
          color: #374151;
        }

        .search-history-content {
          flex: 1;
          overflow-y: auto;
        }

        .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          padding: 2rem;
          text-align: center;
          color: #6b7280;
        }

        .empty-state p {
          margin: 1rem 0 0.5rem;
        }

        .search-history-list {
          padding: 0.5rem;
        }

        .search-history-item {
          margin-bottom: 0.25rem;
        }

        .search-history-button {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          width: 100%;
          padding: 0.75rem;
          border-radius: 0.5rem;
          border: none;
          background: transparent;
          text-align: left;
          cursor: pointer;
          transition: background-color 0.2s;
        }

        .search-history-button:hover {
          background: #f3f4f6;
        }

        .search-query-container {
          flex: 1;
          min-width: 0;
        }

        .search-query {
          display: block;
          font-size: 0.875rem;
          font-weight: 500;
          color: #1f2937;
          margin-bottom: 0.25rem;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .search-meta {
          display: flex;
          gap: 0.75rem;
          font-size: 0.75rem;
          color: #6b7280;
        }

        .result-count::after {
          content: "";
          margin-left: 0.75rem;
        }

        .clear-confirm-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1001;
        }

        .clear-confirm-dialog {
          background: white;
          border-radius: 0.5rem;
          padding: 1.5rem;
          max-width: 300px;
          width: 90%;
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .clear-confirm-dialog p {
          margin-bottom: 1.5rem;
          text-align: center;
          font-size: 0.875rem;
          color: #374151;
        }

        .clear-confirm-actions {
          display: flex;
          gap: 0.75rem;
          justify-content: center;
        }

        .cancel-btn,
        .confirm-btn {
          padding: 0.5rem 1rem;
          border-radius: 0.375rem;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .cancel-btn {
          background: #f3f4f6;
          color: #374151;
        }

        .cancel-btn:hover {
          background: #e5e7eb;
        }

        .confirm-btn {
          background: #ef4444;
          color: white;
        }

        .confirm-btn:hover {
          background: #dc2626;
        }

        @media (max-width: 640px) {
          .search-history-panel {
            max-width: 100%;
          }
        }
      `})]})},dn=o.memo(({searchText:a,setSearchText:t,onSearch:s,clusters:r=[],allTags:n=[],meta:i={}})=>{const[u,c]=o.useState(!1),[l,d]=o.useState([]),[p,f]=o.useState(!1),y=o.useRef(null),w=Ai(a,150);o.useEffect(()=>{if(u){const m=as.getSuggestions(w);d(m)}},[w,u]);const j=m=>{s(m),c(!1)},b=m=>{const v=Date.now()-m,k=Math.floor(v/(1e3*60)),E=Math.floor(v/(1e3*60*60)),T=Math.floor(v/(1e3*60*60*24));return k<60?`${k}m ago`:E<24?`${E}h ago`:`${T}d ago`},P=u?(()=>{const m=a.toLowerCase(),h=[];l.length>0&&l.forEach(T=>{(!m||T.query.toLowerCase().includes(m))&&h.push({cat:T.type==="history"?"Recent":"Similar",label:T.query,icon:T.type==="history"?ft:ji,subtitle:T.metadata?.lastUsed?`${T.metadata.useCount||1} times, ${b(T.metadata.lastUsed)}`:void 0,type:"history"})});const v=(r||[]).map(T=>T.name).filter(Boolean);for(const T of v)(!m||T.toLowerCase().includes(m))&&h.push({cat:"People",label:T,type:"metadata"});for(const T of n||[])(!m||T.toLowerCase().includes(m))&&h.push({cat:"Tag",label:T,type:"metadata"});for(const T of i.cameras||[])(!m||T.toLowerCase().includes(m))&&h.push({cat:"Camera",label:T,type:"metadata"});for(const T of i.places||[])(!m||String(T).toLowerCase().includes(m))&&h.push({cat:"Place",label:String(T),type:"metadata"});const k=h.filter(T=>T.type==="history").slice(0,8),E=h.filter(T=>T.type==="metadata").slice(0,12);return[...k,...E].slice(0,20)})():[],S=(()=>{const m=[],h=(a||"").trim();if(!h)return m;try{let v=0;for(const T of h)if(T==="("?v++:T===")"&&v--,v<0){m.push("Unbalanced parentheses");break}v>0&&m.push("Unbalanced parentheses");const k=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),E=h.split(/\s+/);for(const T of E){const N=T.indexOf(":");if(N>0){const O=T.slice(0,N).toLowerCase();k.has(O)||m.push(`Unknown field: ${O}`)}}}catch{}return Array.from(new Set(m))})();return e.jsxs("div",{className:"search-bar-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(Te,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"What are you looking for? Try 'kids at the park' or 'last summer'",value:a,onChange:m=>{t(m.target.value),c(!0)},onKeyDown:m=>{m.key==="Enter"&&j(a)},onFocus:()=>c(!0),onBlur:()=>setTimeout(()=>c(!1),120),ref:y,className:"search-input"}),e.jsx("button",{type:"button",onClick:()=>f(!0),className:"history-button",title:"View search history",children:e.jsx(vi,{className:"history-icon"})}),S.length>0&&e.jsx("div",{className:"ml-2 text-red-600 text-xs",title:S.join(`
`),"aria-label":"Query warnings",children:"!"})]}),S.length>0&&e.jsx("div",{className:"text-[11px] text-red-600 mt-1 px-1",children:S.slice(0,2).map((m,h)=>e.jsx("div",{children:m},h))}),u&&e.jsx("div",{className:"suggestions-dropdown",children:P.length===0?e.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No suggestions"}):P.map(m=>e.jsxs("button",{type:"button",className:"suggestion-item",onMouseDown:h=>{h.preventDefault();let v=m.label;m.cat==="People"?v=`person:"${m.label}"`:m.cat==="Camera"?v=`camera:"${m.label}"`:m.cat==="Place"?v=`place:"${m.label}"`:m.cat==="Tag"&&(v=`tag:${m.label}`);const k=(a||"").trim(),E=k?`${k} ${v}`:v;t(E),c(!1),setTimeout(()=>j(E),0)},children:[e.jsxs("div",{className:"suggestion-content",children:[m.icon&&e.jsx(m.icon,{className:"suggestion-icon"}),e.jsxs("div",{className:"suggestion-text",children:[e.jsxs("div",{className:"suggestion-main",children:[e.jsxs("span",{className:"suggestion-category",children:[m.cat,":"]}),e.jsx("span",{className:"suggestion-label",children:m.label})]}),m.subtitle&&e.jsx("div",{className:"suggestion-subtitle",children:m.subtitle})]})]}),e.jsx("span",{className:"suggestion-hint",children:""})]},`${m.cat}:${m.label}`))}),p&&e.jsx(uc,{onSearch:m=>{t(m),j(m)},onClose:()=>f(!1)})]})});dn.displayName="SearchBar";const Ja={};function hc({searchText:a,setSearchText:t,onSearch:s,clusters:r,allTags:n,meta:i,busy:u,gridSize:c,setGridSize:l,selectedView:d,setSelectedView:p,currentFilter:f,setCurrentFilter:y,ratingMin:w,setRatingMin:j,setModal:b,setIsMobileMenuOpen:C,setShowFilters:P,selected:S,setSelected:m,dir:h,engine:v,topK:k,useOsTrash:E,showInfoOverlay:T,onToggleInfoOverlay:N,resultView:O,onChangeResultView:U,timelineBucket:Z,onChangeTimelineBucket:F,diag:K,isIndexing:_,onIndex:M,activeJobs:W,onOpenJobs:se,progressPct:B,etaSeconds:me,paused:A,onPause:ee,onResume:ie,tooltip:V,ocrReady:Y,photoActions:R,uiActions:H,toastTimerRef:$,setToast:G,onOpenThemeModal:J}){const{state:L}=lc();return e.jsxs("div",{className:"top-bar top-bar-mobile",children:[u&&e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill"})}),e.jsxs("div",{className:"top-bar-content",children:[e.jsxs("div",{className:"top-bar-left",children:[e.jsx("button",{type:"button",className:"mobile-menu-button",onClick:()=>C(!0),"aria-label":"Open menu",children:e.jsx(wi,{className:"w-5 h-5"})}),e.jsx(dn,{searchText:a,setSearchText:t,onSearch:s,clusters:r,allTags:n,meta:i}),e.jsxs("div",{className:"quick-filters hidden md:flex items-center gap-2 ml-2",children:[(i?.cameras||[]).slice(0,3).map(z=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const ce=`camera:"${z}"`,Q=(a||"").trim(),re=Q?`${Q} ${ce}`:ce;t(re),s(re)},title:`Filter camera: ${z}`,children:String(z)},`cam-${z}`)),(n||[]).slice(0,6).map(z=>e.jsxs("button",{type:"button",className:"chip",onClick:()=>{const ce=`tag:${z}`,Q=(a||"").trim(),re=Q?`${Q} ${ce}`:ce;t(re),s(re)},title:`Filter tag: ${z}`,children:["#",z]},`tag-${z}`)),(r||[]).filter(z=>z.name).slice(0,6).map(z=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const Q=`person:"${String(z.name)}"`,re=(a||"").trim(),ue=re?`${re} ${Q}`:Q;t(ue),s(ue)},title:`Filter person: ${String(z.name)}`,children:String(z.name)},`person-${z.name}`)),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const z="has_text:true",ce=(a||"").trim(),Q=ce?`${ce} ${z}`:z;t(Q),s(Q)},title:"Filter photos that contain text",children:"Text"}),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const z="(filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi) AND duration:>30",ce=(a||"").trim(),Q=ce?`${ce} ${z}`:z;t(Q),s(Q)},title:"Find videos longer than 30 seconds",children:"Videos > 30s"})]}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>P(z=>!z),"aria-label":"Show filters",children:[e.jsx(Vs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Filters"})]}),/(camera:|tag:|person:|has_text:|iso:|fnumber:|width:|height:|place:)/i.test(a||"")&&e.jsx("button",{type:"button",className:"chip",onClick:()=>{const z=(a||"").replace(/\b(camera|tag|person|has_text|iso|fnumber|width|height|place):[^\s]+/gi,"").replace(/\s{2,}/g," ").trim();t(z),s(z)},title:"Clear filter tokens from query","aria-label":"Clear filter tokens",children:"Clear filters"}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>b({kind:"save"}),title:"Save this search for later","aria-label":"Save current search",children:[e.jsx(Ni,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Remember"})]})]}),e.jsxs("div",{className:"top-bar-right",children:[K&&(K.engines?.length||0)>=1&&e.jsxs("div",{className:"indexed-chip relative",children:[e.jsx("span",{className:"indexed-label",children:"Indexed"}),e.jsx("span",{className:"indexed-count",children:K.engines?.[0]?.count||0}),e.jsx("button",{type:"button",className:"indexed-action",onClick:()=>M&&M(),disabled:!!_,"aria-label":_?"Indexing photos (indeterminate)":K.engines?.[0]?.count?"Reindex your library":"Start indexing your library",title:_?"Indexing runs in the background. You can keep working.":K.engines?.[0]?.count?"Reindex photos":"Start indexing",children:_?"Indexing":K.engines?.[0]?.count?"Reindex":"Index"}),_&&e.jsx("div",{className:"indexed-progress","aria-hidden":!0,children:e.jsx("div",{className:"indexed-progress-bar",style:typeof B=="number"&&B>=0&&B<=1?{width:`${Math.max(4,Math.round(B*100))}%`}:void 0})}),_&&typeof me=="number"&&isFinite(me)&&me>0&&e.jsxs("span",{className:"ml-2 text-[11px] text-gray-600",title:"Estimated time remaining",children:["~",Math.max(1,Math.ceil(me/60)),"m"]}),_&&e.jsx("button",{type:"button",className:"ml-2 chip",onClick:()=>A?ie?.():ee?.(),"aria-label":A?"Resume indexing":"Pause indexing",title:A?"Resume indexing":"Pause indexing",children:A?"Resume":"Pause"}),V&&e.jsx("div",{className:"tooltip-card",role:"tooltip","aria-hidden":!0,children:(V.split("  ")||[]).map((z,ce)=>e.jsx("div",{className:"tooltip-line",children:z},ce))})]}),Y&&e.jsx("span",{className:"chip",title:"OCR ready: search text inside images",children:"OCR"}),typeof W=="number"&&W>0&&e.jsxs("button",{type:"button",className:"chip",onClick:()=>se&&se(),title:"View running tasks","aria-label":`Open Jobs (${W})`,children:["Jobs (",W,")"]}),e.jsx("div",{className:"grid-size-control",children:["small","medium","large"].map(z=>e.jsx("button",{type:"button",onClick:()=>l(z),className:`grid-size-button ${c===z?"active":""}`,"aria-label":`Set grid size to ${z}`,children:z.charAt(0).toUpperCase()+z.slice(1)},z))}),e.jsxs("div",{className:"view-mode-control",children:[e.jsx("button",{type:"button",onClick:()=>p("results"),className:`view-mode-button ${d==="results"?"active":""}`,"aria-label":"Grid view",children:e.jsx(bt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>p("library"),className:`view-mode-button ${d==="library"?"active":""}`,"aria-label":"List view",children:e.jsx(lr,{className:"w-4 h-4"})})]}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Settings & Indexing",onClick:()=>b({kind:"folder"}),"aria-label":"Open settings and indexing options",children:e.jsx(vt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Open theme settings","aria-label":"Open theme settings",onClick:()=>J?.(),children:e.jsx(Pt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"filter-chips",children:["All","Today","This Week","This Month","Favorites","People","Screenshots"].map(z=>e.jsx("button",{type:"button",onClick:()=>{y(z.toLowerCase()),z==="Favorites"&&(R.setFavOnly(!0),s(a))},className:`chip ${f===z.toLowerCase()?"active":""}`,"aria-label":`Filter by ${z}`,children:z},z))}),e.jsxs("div",{className:"rating-filter",children:[e.jsx("span",{children:"Min rating:"}),[0,1,2,3,4,5].map(z=>e.jsx("button",{type:"button",className:`rating-button ${w===z?"active":""}`,onClick:()=>j(z),"aria-label":`Filter by minimum rating of ${z}`,children:z===0?"Any":`${"".repeat(z)}`},z))]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"View:"}),e.jsx("button",{type:"button",className:`view-button ${O==="grid"?"active":""}`,onClick:()=>U("grid"),"aria-pressed":O==="grid",children:"Grid"}),e.jsx("button",{type:"button",className:`view-button ${O==="timeline"?"active":""}`,onClick:()=>U("timeline"),"aria-pressed":O==="timeline",children:"Timeline"})]}),e.jsxs("div",{className:"text-[11px] text-gray-600 mt-1",children:["Boolean: AND, OR, NOT, ( )  Fields:"," ",e.jsx("span",{className:"font-mono",children:"camera:"})," ",e.jsx("span",{className:"font-mono",children:"place:"})," ",e.jsx("span",{className:"font-mono",children:"tag:"})," ",e.jsx("span",{className:"font-mono",children:"rating:"})," ",e.jsx("span",{className:"font-mono",children:"person:"})," ",e.jsx("span",{className:"font-mono",children:"has_text:"})," ",e.jsx("span",{className:"font-mono",children:"filetype:"}),"  Numeric:"," ",e.jsx("span",{className:"font-mono",children:"iso:"})," ",e.jsx("span",{className:"font-mono",children:"fnumber:"})," ",e.jsx("span",{className:"font-mono",children:"width:"})," ",e.jsx("span",{className:"font-mono",children:"height:"})," ",e.jsx("span",{className:"font-mono",children:"mtime:"})," ",e.jsx("span",{className:"font-mono",children:"brightness:"})," ",e.jsx("span",{className:"font-mono",children:"sharpness:"})," ",e.jsx("span",{className:"font-mono",children:"exposure:"})," ",e.jsx("span",{className:"font-mono",children:"focal:"})," ",e.jsx("span",{className:"font-mono",children:"duration:"})," (supports >=, <=, >, <, =)"]}),e.jsx("div",{className:"preset-filters hidden md:flex flex-wrap gap-2 mt-1",children:[{label:"High ISO",expr:"iso:>=1600"},{label:"Shallow DoF",expr:"fnumber:<2.8"},{label:"Text in Image",expr:"has_text:true"},{label:"Large",expr:"width:>=3000 height:>=2000"},{label:"Recent (30d)",expr:`mtime:>=${Math.floor(Date.now()/1e3-30*24*3600)}`},{label:"Underexposed",expr:"brightness:<50"},{label:"Sharp Only",expr:"sharpness:>=60"},{label:"Video > 30s",expr:"filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi AND duration:>30"}].map(z=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const ce=z.expr,Q=(a||"").trim(),re=Q?`${Q} ${ce}`:ce;t(re),s(re)},title:z.expr,children:z.label},z.label))}),O==="timeline"&&e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"Bucket:"}),["day","week","month"].map(z=>e.jsx("button",{type:"button",className:`view-button ${Z===z?"active":""}`,onClick:()=>F&&F(z),"aria-pressed":Z===z,children:z[0].toUpperCase()+z.slice(1)},z))]}),S.size>0&&e.jsxs("div",{className:"selected-actions",children:[e.jsxs("span",{className:"selected-count",children:[S.size," photo",S.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{type:"button",className:"action-button",onClick:()=>b({kind:"export"}),"aria-label":"Export selected photos",children:[e.jsx(_e,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>b({kind:"enhanced-share"}),"aria-label":"Share selected photos",children:[e.jsx(Te,{className:"w-4 h-4"}),"Share"]}),Ja?.VITE_FF_SHARING_V1==="1"&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>b({kind:"share"}),"aria-label":"Share selected photos",children:[e.jsx(Te,{className:"w-4 h-4"})," Share"]}),Ja?.VITE_FF_SHARING_V1==="1"&&e.jsx("button",{type:"button",className:"action-button",onClick:()=>b({kind:"shareManage"}),"aria-label":"Manage shared links",children:"Manage Shares"}),e.jsxs("button",{type:"button",className:`action-button ${T?"active":""}`,onClick:N,"aria-pressed":T,"aria-label":"Toggle info overlay on grid items",children:[e.jsx(st,{className:"w-4 h-4"})," Info"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>b({kind:"advanced"}),"aria-label":"Open advanced search",children:"Advanced"}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>b({kind:"tag"}),"aria-label":"Tag selected photos",children:[e.jsx(As,{className:"w-4 h-4"}),"Tag"]}),S.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:async()=>{const z=Array.from(S)[0],{apiSearchLike:ce}=await pe(async()=>{const{apiSearchLike:Q}=await Promise.resolve().then(()=>ge);return{apiSearchLike:Q}},void 0,import.meta.url);H.setBusy("Searching similar");try{const Q=await ce(h,z,v,k);R.setResults(Q.results||[]),p("results")}catch(Q){H.setNote(Q instanceof Error?Q.message:"Search failed")}finally{H.setBusy("")}},"aria-label":"Find similar photos to the selected photo",children:[e.jsx(Te,{className:"w-4 h-4"})," Similar"]}),S.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>b({kind:"likeplus"}),"aria-label":"Find similar photos with additional text query",children:[e.jsx(Te,{className:"w-4 h-4"})," Similar + Text"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>b({kind:"collect"}),"aria-label":"Add selected photos to a collection",children:[e.jsx(Ge,{className:"w-4 h-4"})," Add to Collection"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>b({kind:"removeCollect"}),"aria-label":"Remove selected photos from a collection",children:[e.jsx(Ge,{className:"w-4 h-4 rotate-180"})," Remove from Collection"]}),e.jsxs("button",{type:"button",className:"action-button danger",onClick:async()=>{if(S.size!==0&&confirm(`Move ${S.size} item(s) to Trash?`))try{H.setBusy("Deleting");const z=await xa(h,Array.from(S),E);H.setNote(`Moved ${z.moved} to ${E?"OS Trash":"Trash"}`),m(new Set),E?G({message:`Moved ${z.moved} to OS Trash`}):($.current&&window.clearTimeout($.current),G({message:`Moved ${z.moved} to Trash`,actionLabel:"Undo",onAction:async()=>{try{const ce=await pa(h);H.setNote(`Restored ${ce.restored}`)}catch{}G(null),$.current&&(window.clearTimeout($.current),$.current=null)}}),$.current=window.setTimeout(()=>{G(null),$.current=null},1e4))}catch(z){H.setNote(z instanceof Error?z.message:"Delete failed")}finally{H.setBusy("")}},"aria-label":"Delete selected photos",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function mc({items:a,note:t,diag:s,engine:r}){const n=a.length,i=(s?.engines||[]).find(c=>c.key===r),u=i?.fast&&(i.fast.annoy||i.fast.faiss||i.fast.hnsw);return e.jsx("div",{className:"stats-bar",children:e.jsxs("div",{className:"stats-content",children:[e.jsxs("div",{className:"stats-left",children:[e.jsxs("span",{children:[n," photos"]}),t?e.jsx("span",{className:"text-gray-800",children:t}):null]}),e.jsxs("div",{className:"stats-right",children:[e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${i?.count?"ready":"empty"}`}),e.jsxs("span",{children:["AI Index ",i?.count?"Ready":"Empty"]})]}),e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${u?"fast-ready":"empty"}`}),e.jsxs("span",{children:["Fast Index ",u?"Ready":""]})]})]})]})})}function xc({activeTab:a,onTabChange:t,onShowFilters:s,onShowUpload:r,onShowLibrary:n,showSecondaryActions:i=!0}){const u=[{id:"home",icon:or,label:"Home"},{id:"search",icon:Te,label:"Search"},{id:"favorites",icon:Ot,label:"Favorites"},{id:"settings",icon:vt,label:"Settings"}];return e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 md:hidden",children:[i&&e.jsxs("div",{className:"flex items-center justify-around py-2 px-4 border-b border-gray-100",children:[e.jsxs("button",{type:"button",onClick:s,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-blue-600 transition-colors","aria-label":"Show filters",children:[e.jsx(Vs,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Filters"})]}),e.jsxs("button",{type:"button",onClick:r,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-green-600 transition-colors","aria-label":"Upload",children:[e.jsx(xt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Upload"})]}),e.jsxs("button",{type:"button",onClick:n,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-purple-600 transition-colors","aria-label":"Library",children:[e.jsx(Ge,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Library"})]})]}),e.jsx("div",{className:"flex items-center justify-around py-2 px-4",children:u.map(({id:c,icon:l,label:d})=>e.jsxs("button",{type:"button",onClick:()=>t(c),className:`flex flex-col items-center gap-1 p-2 min-w-[64px] transition-colors ${a===c?"text-blue-600":"text-gray-600 hover:text-gray-900"}`,"aria-label":d,"aria-current":a===c,children:[e.jsx(l,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs font-medium",children:d}),a===c&&e.jsx("div",{className:"w-1 h-1 bg-blue-600 rounded-full mt-1"})]},c))})]})}function pc({currentDir:a,provider:t}){const[s,r]=o.useState([]),[n,i]=o.useState(!1),[u,c]=o.useState(!1),[l,d]=o.useState(null),[p,f]=o.useState(null),[y,w]=o.useState(null);o.useEffect(()=>{a&&j()},[a]);const j=async()=>{try{i(!0),w(null);const m=await Vr(a);r(m.videos)}catch(m){w(m instanceof Error?m.message:"Failed to load videos")}finally{i(!1)}},b=async()=>{try{c(!0),w(null);const m=await Kr(a,t);alert(`Indexed ${m.indexed} out of ${m.total} videos`),await j()}catch(m){w(m instanceof Error?m.message:"Failed to index videos")}finally{c(!1)}},C=async m=>{d(m);try{const h=await Hr(a,m.path);f(h.metadata)}catch(h){console.error("Failed to load video metadata:",h),f(null)}},P=m=>{const h=["Bytes","KB","MB","GB","TB"];if(m===0)return"0 Bytes";const v=Math.floor(Math.log(m)/Math.log(1024));return Math.round(m/Math.pow(1024,v)*100)/100+" "+h[v]},S=m=>{const h=Math.floor(m/60),v=Math.floor(m%60);return`${h}:${v.toString().padStart(2,"0")}`};return n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(ln,{})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Video Manager"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:j,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"Refresh"}),e.jsx("button",{onClick:b,disabled:u||s.length===0,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:u?"Indexing...":"Index Videos"})]})]}),y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:y}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Videos (",s.length,")"]}),s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No videos found in this directory"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.map((m,h)=>e.jsxs("div",{onClick:()=>C(m),className:`p-3 border rounded cursor-pointer transition-colors ${l?.path===m.path?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium truncate",title:m.path,children:m.path.split("/").pop()||m.path}),e.jsxs("div",{className:"text-sm text-gray-500",children:[P(m.size),"  ",new Date(m.mtime*1e3).toLocaleDateString()]})]},h))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Video Details"}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video bg-gray-100 rounded overflow-hidden",children:e.jsx("img",{src:Wr(a,l.path),alt:"Video thumbnail",className:"w-full h-full object-cover",onError:m=>{m.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjNjM2MzYzIi8+Cjwvc3ZnPgo="}})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded space-y-2",children:[e.jsx("div",{className:"font-medium",children:"File Information"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Path:"})," ",l.path]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",P(l.size)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Modified:"})," ",new Date(l.mtime*1e3).toLocaleString()]})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium mt-4",children:"Video Metadata"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Dimensions:"})," ",p.width,"  ",p.height]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Rate:"})," ",p.fps?.toFixed(2)," fps"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",S(p.duration)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Count:"})," ",p.frame_count?.toLocaleString()]})]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Select a video to view details"})]})]})]})}const un=o.memo(()=>{const[a,t]=o.useState(null),[s,r]=o.useState(!1);return o.useEffect(()=>{},[]),o.useEffect(()=>{const n=i=>{i.ctrlKey&&i.shiftKey&&i.key==="P"&&r(u=>!u)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[]),null});un.displayName="PerformanceMonitor";function gc({open:a,onClose:t,onApply:s,onSave:r,allTags:n,cameras:i,people:u}){const[c,l]=o.useState(""),[d,p]=o.useState(""),[f,y]=o.useState(""),[w,j]=o.useState(""),[b,C]=o.useState(""),[P,S]=o.useState("any"),[m,h]=o.useState(""),[v,k]=o.useState(""),[E,T]=o.useState(""),[N,O]=o.useState(""),[U,Z]=o.useState(""),[F,K]=o.useState(""),[_,M]=o.useState(""),W=o.useMemo(()=>{const B=[];return c.trim()&&B.push(c.trim()),d.trim()&&B.push(`camera:"${d.trim()}"`),f.trim()&&B.push(`place:"${f.trim()}"`),w.trim()&&B.push(`tag:${w.trim()}`),b.trim()&&B.push(`person:"${b.trim()}"`),P==="true"&&B.push("has_text:true"),P==="false"&&B.push("has_text:false"),m.trim()&&B.push(`iso:>=${m.trim()}`),v.trim()&&B.push(`fnumber:<${v.trim()}`),E.trim()&&B.push(`width:>=${E.trim()}`),N.trim()&&B.push(`height:>=${N.trim()}`),U.trim()&&B.push(`filetype:${U.trim().toLowerCase()}`),F.trim()&&B.push(`duration:>${F.trim()}`),B.join(" AND ")},[c,d,f,w,b,P,m,v,E,N,U,F]),se=o.useMemo(()=>{const B=[],me=W||"";let A=0;for(const ee of me)if(ee==="("?A++:ee===")"&&A--,A<0){B.push("Unbalanced parentheses");break}A>0&&B.push("Unbalanced parentheses");try{const ee=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),ie=me.split(/\s+/);for(const V of ie){const Y=V.indexOf(":");if(Y>0){const R=V.slice(0,Y).toLowerCase();ee.has(R)||B.push(`Unknown field: ${R}`)}}}catch{}return Array.from(new Set(B))},[W]);return a?e.jsxs("div",{className:"fixed inset-0 z-[1080] flex items-center justify-center",onKeyDown:B=>{B.key==="Escape"&&t()},children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1081] bg-white dark:bg-gray-900 rounded-lg shadow p-4 w-full max-w-2xl",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Advanced Search"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Base Text"}),e.jsx("input",{className:"input",value:c,onChange:B=>l(B.target.value),placeholder:'e.g., "golden hour" OR beach'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Camera"}),e.jsx("input",{list:"cam-list",className:"input",value:d,onChange:B=>p(B.target.value),placeholder:"Canon, Sony..."}),e.jsx("datalist",{id:"cam-list",children:i.map(B=>e.jsx("option",{value:B},B))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Place"}),e.jsx("input",{className:"input",value:f,onChange:B=>y(B.target.value),placeholder:"City, location..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Tag"}),e.jsx("input",{list:"tag-list",className:"input",value:w,onChange:B=>j(B.target.value),placeholder:"Any tag"}),e.jsx("datalist",{id:"tag-list",children:n.map(B=>e.jsx("option",{value:B},B))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Person"}),e.jsx("input",{list:"person-list",className:"input",value:b,onChange:B=>C(B.target.value),placeholder:"Person name"}),e.jsx("datalist",{id:"person-list",children:u.map(B=>e.jsx("option",{value:B},B))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Has Text"}),e.jsxs("select",{className:"input",value:P,onChange:B=>S(B.target.value),children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"ISO "}),e.jsx("input",{className:"input",value:m,onChange:B=>h(B.target.value),placeholder:"e.g., 1600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"f-number <"}),e.jsx("input",{className:"input",value:v,onChange:B=>k(B.target.value),placeholder:"e.g., 2.8"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Width "}),e.jsx("input",{className:"input",value:E,onChange:B=>T(B.target.value),placeholder:"e.g., 3000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Height "}),e.jsx("input",{className:"input",value:N,onChange:B=>O(B.target.value),placeholder:"e.g., 2000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Filetype"}),e.jsx("input",{className:"input",value:U,onChange:B=>Z(B.target.value),placeholder:"jpg, png, mp4, ..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Duration > (s)"}),e.jsx("input",{className:"input",value:F,onChange:B=>K(B.target.value),placeholder:"e.g., 30"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Preview"}),e.jsx("div",{className:"text-sm font-mono bg-gray-100 dark:bg-gray-800 rounded p-2 break-words",style:{minHeight:"2.2rem"},children:W||""}),se.length>0&&e.jsx("ul",{className:"mt-2 text-xs text-red-600 list-disc pl-5",children:se.map((B,me)=>e.jsx("li",{children:B},me))})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",placeholder:"Preset name",value:_,onChange:B=>M(B.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{_.trim()&&(r(_.trim(),W),M(""))},children:"Save Preset"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"Close"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(W),children:"Apply"})]})]})]})]}):null}const fc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),bc=({selected:a,dir:t,onClose:s,uiActions:r})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:n=>{n.key==="Escape"&&s()},children:e.jsx(fc,{onEscape:s,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Export Selected"}),e.jsxs("form",{onSubmit:n=>{n.preventDefault();const i=n.target,u=i.elements.namedItem("dest").value.trim();if(!u)return;const c=i.elements.namedItem("preset")?.value||"web",l=i.elements.namedItem("strip_all")?.checked||!1,d=i.elements.namedItem("strip_gps")?.checked||!1,p=i.elements.namedItem("keep_copy")?.checked||!1,f=i.elements.namedItem("overwrite")?.checked||!1;(async()=>{try{const y=Array.from(a),w=c;let j,b;if(w==="custom"){const P=parseInt(i.elements.namedItem("custom_long")?.value||""),S=parseInt(i.elements.namedItem("custom_quality")?.value||"");j=isNaN(P)?void 0:P,b=isNaN(S)?void 0:S}const C=await jt(t,y,u,"copy",l,f,{stripGps:d,keepCopyrightOnly:p,preset:w,resizeLong:j,quality:b});r.setNote(`Exported ${C.copied}, skipped ${C.skipped}, errors ${C.errors}  ${C.dest}`)}catch(y){r.setNote(y instanceof Error?y.message:"Export failed")}})(),s()},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"dest-input",children:"Destination"}),e.jsx("input",{id:"dest-input",name:"dest",className:"w-full border rounded px-2 py-1",placeholder:"/absolute/path"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-sm font-medium mb-1",children:"Preset"}),e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"web",defaultChecked:!0})," Web"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"email"})," Email"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"print"})," Print"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"custom"})," Custom"]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Custom long edge"}),e.jsx("input",{type:"number",name:"custom_long",className:"border rounded px-2 py-1 w-28",placeholder:"1600"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Quality (1100)"}),e.jsx("input",{type:"number",name:"custom_quality",min:1,max:100,className:"border rounded px-2 py-1 w-28",placeholder:"85"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Privacy"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_all"})," Strip all EXIF/IPTC"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_gps"})," Strip GPS only"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"keep_copy"})," Keep copyright only"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Options"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"overwrite"})," Overwrite existing files"]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:s,"aria-label":"Cancel export",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Export selected photos",children:"Export"})]})]})]})})}),yc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),vc=({onClose:a,onTagSelected:t})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:s=>{s.key==="Escape"&&a()},children:e.jsx(yc,{onEscape:a,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Tag Selected"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Enter comma-separated tags"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault();const n=s.target.elements.namedItem("tags").value.trim();n&&(t(n),a())},children:[e.jsx("label",{htmlFor:"tags-input",className:"sr-only",children:"Tags"}),e.jsx("input",{id:"tags-input",name:"tags",className:"w-full border rounded px-2 py-1",placeholder:"family, beach, 2024"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:a,"aria-label":"Cancel tagging",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save tags",children:"Save"})]})]})]})})});function jc({onFolderSelect:a,currentPath:t}){const[s,r]=o.useState(t||""),[n,i]=o.useState(!1),[u,c]=o.useState(null),[l,d]=o.useState(""),p=o.useCallback(async b=>{if(b.trim()){i(!0),d("");try{const C=await fetch(`${he}/scan_count`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([b])});if(!C.ok)throw new Error("Failed to scan folder");const P=await C.json();P.items&&P.items.length>0&&c(P.items[0])}catch(C){d(C instanceof Error?C.message:"Failed to scan folder"),c(null)}finally{i(!1)}}},[]),f=o.useCallback(()=>{p(s)},[s,p]),y=o.useCallback(()=>{u&&u.exists&&u.files>0&&a(u.path)},[u,a]),w=b=>{if(b===0)return"0 Bytes";const C=1024,P=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(b)/Math.log(C));return parseFloat((b/Math.pow(C,S)).toFixed(2))+" "+P[S]},j=[{name:"Pictures",path:"~/Pictures"},{name:"Desktop",path:"~/Desktop"},{name:"Downloads",path:"~/Downloads"},{name:"Documents",path:"~/Documents"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Folder Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:b=>r(b.target.value),placeholder:"/path/to/your/photos or ~/Pictures",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:b=>b.key==="Enter"&&f()}),e.jsx("button",{onClick:f,disabled:n||!s.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Hs,{className:"w-4 h-4 animate-spin"}),"Scanning"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-4 h-4"}),"Scan"]})})]})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Ds,{className:"w-4 h-4"}),l]}),u&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Path:"}),e.jsx("span",{className:"text-sm text-gray-600 truncate",children:u.path})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx("span",{className:`text-sm ${u.exists?"text-green-600":"text-red-600"}`,children:u.exists?"Exists":"Not Found"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Photos Found:"}),e.jsx("span",{className:"text-sm text-gray-600",children:u.files})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Size:"}),e.jsx("span",{className:"text-sm text-gray-600",children:w(u.bytes)})]})]}),u.exists&&u.files>0&&e.jsxs("button",{onClick:y,className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:["Use This Folder (",u.files," photos)"]}),u.exists&&u.files===0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-sm text-yellow-800",children:"No photos found in this folder. Supported formats: JPG, PNG, GIF, TIF, WebP, HEIC, MP4, MOV, MKV, AVI, WebM"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Quick Select:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:j.map(b=>e.jsx("button",{onClick:()=>{r(b.path),p(b.path)},className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:b.name},b.path))})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Tip: You can also drag and drop a folder onto the app, or use the file picker in the main interface."})]})}const wc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),Nc=({dir:a,useOsTrash:t,useFast:s,fastKind:r,useCaps:n,useOcr:i,hasText:u,highContrast:c,onClose:l,settingsActions:d,uiActions:p,doIndex:f,prepareFast:y,buildOCR:w,buildMetadata:j})=>{const[b,C]=o.useState(a),P=m=>{C(m)},S=async m=>{if(m.preventDefault(),b){d.setDir(b),l();try{await tt(b),await f()}catch(h){console.error("Failed to add path or index:",h),p.setNote(h instanceof Error?h.message:"Failed to add path")}}};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:m=>{m.key==="Escape"&&l()},children:e.jsx(wc,{onEscape:l,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-4",children:"Set Photo Folder"}),e.jsx(jc,{onFolderSelect:P,currentPath:b}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("label",{htmlFor:"use-os-trash",className:"text-sm",children:"Use OS Trash (no Undo)"}),e.jsx("input",{id:"use-os-trash",type:"checkbox",checked:t,onChange:m=>d.setUseOsTrash(m.target.checked)})]}),e.jsxs("div",{className:"mt-4 border-t pt-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Preferences"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-fast",children:"Use Fast Index"}),e.jsx("input",{id:"pref-fast",type:"checkbox",checked:s,onChange:m=>d.setUseFast(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{htmlFor:"pref-fastkind",children:"Fast Kind"}),e.jsxs("select",{id:"pref-fastkind",className:"border rounded px-2 py-1",value:r,onChange:m=>d.setFastKind(m.target.value),children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"annoy",children:"Annoy"}),e.jsx("option",{value:"faiss",children:"FAISS"}),e.jsx("option",{value:"hnsw",children:"HNSW"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-caps",children:"Use Captions"}),e.jsx("input",{id:"pref-caps",type:"checkbox",checked:n,onChange:m=>d.setUseCaps(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-ocr",children:"Use OCR"}),e.jsx("input",{id:"pref-ocr",type:"checkbox",checked:i,onChange:m=>d.setUseOcr(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-hastext",children:"Default: Has Text"}),e.jsx("input",{id:"pref-hastext",type:"checkbox",checked:u,onChange:m=>d.setHasText(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-high-contrast",children:"High Contrast"}),e.jsx("input",{id:"pref-high-contrast",type:"checkbox",checked:c,onChange:m=>d.setHighContrast(m.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pref-vlm",className:"block mb-1",children:"VLM Model"}),e.jsx("input",{id:"pref-vlm",className:"w-full border rounded px-2 py-1",defaultValue:"",onChange:m=>{}})]})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:f,"aria-label":"Index files in the selected folder",children:"Index"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>y("annoy"),"aria-label":"Prepare fast index",children:"Fast"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:w,"aria-label":"Build OCR index",children:"OCR"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:j,"aria-label":"Build metadata index",children:"Metadata"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:l,"aria-label":"Close settings",children:"Close"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save settings",children:"Save"})]})]})]})]})})})},kc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),Sc=({selected:a,dir:t,engine:s,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(kc,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Similar + Text"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const d=l.target,p=d.elements.namedItem("text").value.trim(),f=parseFloat(d.elements.namedItem("weight").value);if(a.size===1)try{const y=Array.from(a)[0],{apiSearchLikePlus:w}=await pe(async()=>{const{apiSearchLikePlus:b}=await Promise.resolve().then(()=>ge);return{apiSearchLikePlus:b}},void 0,import.meta.url);c.setBusy("Searching");const j=await w(t,y,s,r,p||void 0,Number.isNaN(f)?.5:f);u.setResults(j.results||[]),i("results")}catch(y){c.setNote(y instanceof Error?y.message:"Search failed")}finally{c.setBusy("")}n()},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"likeplus-text",children:"Text (optional)"}),e.jsx("input",{id:"likeplus-text",name:"text",className:"w-full border rounded px-2 py-1",placeholder:"e.g. beach at sunset"}),e.jsx("label",{className:"block text-sm mt-3 mb-1",htmlFor:"mix-weight",children:"Weight (image vs text)"}),e.jsx("input",{id:"mix-weight",name:"weight",type:"range",min:"0",max:"1",step:"0.05",defaultValue:"0.5",className:"w-full"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel similar search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Search for similar photos with text",children:"Search"})]})]})]})})}),Cc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),Tc=({dir:a,searchText:t,query:s,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(Cc,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Save Search"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const p=l.target.elements.namedItem("name").value.trim();if(p){try{const{apiAddSaved:f,apiGetSaved:y}=await pe(async()=>{const{apiAddSaved:j,apiGetSaved:b}=await Promise.resolve().then(()=>ge);return{apiAddSaved:j,apiGetSaved:b}},void 0,import.meta.url);await f(a,p,t||s||"",r);const w=await y(a);u.setSaved(w.saved||[]),i("saved")}catch(f){c.setNote(f instanceof Error?f.message:"Save failed")}n()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"save-name",children:"Name"}),e.jsx("input",{id:"save-name",name:"name",className:"w-full border rounded px-2 py-1",placeholder:"e.g. Dogs on beach"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel saving search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save search",children:"Save"})]})]})]})})}),Ec=({onEscape:a,children:t})=>e.jsx("div",{children:t}),Pc=({selected:a,dir:t,collections:s,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(Ec,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Add to Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiSetCollection:p,apiGetCollections:f}=await pe(async()=>{const{apiSetCollection:w,apiGetCollections:j}=await Promise.resolve().then(()=>ge);return{apiSetCollection:w,apiGetCollections:j}},void 0,import.meta.url);await p(t,d,Array.from(a));const y=await f(t);i.setCollections(y.collections||{}),n({message:`Added ${a.size} to ${d}`})}catch(p){u.setNote(p instanceof Error?p.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name",children:"Collection"}),e.jsx("input",{id:"col-name",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Type or choose"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(s||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel adding to collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Add to collection",children:"Add"})]})]})]})})}),Ic=({onEscape:a,children:t})=>e.jsx("div",{children:t}),$c=({selected:a,dir:t,collections:s,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(Ic,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Remove from Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiGetCollections:p,apiSetCollection:f}=await pe(async()=>{const{apiGetCollections:C,apiSetCollection:P}=await Promise.resolve().then(()=>ge);return{apiGetCollections:C,apiSetCollection:P}},void 0,import.meta.url),w=(await p(t)).collections?.[d]||[],j=w.filter(C=>!a.has(C));await f(t,d,j);const b=await p(t);i.setCollections(b.collections||{}),n({message:`Removed ${w.length-j.length} from ${d}`})}catch(p){u.setNote(p instanceof Error?p.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name-remove",children:"Collection"}),e.jsx("input",{id:"col-name-remove",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Choose collection"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(s||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel removing from collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Remove from collection",children:"Remove"})]})]})]})})}),Mc=[{key:"D",shift:!0,description:"Toggle dark mode",action:()=>{try{const t=document.documentElement.classList.toggle("dark");localStorage.setItem("ps_theme",t?"dark":"light")}catch{}}},{key:"/",description:"Focus search",action:()=>{document.querySelector('input[placeholder*="Try"]')?.focus()}},{key:"a",description:"Open Advanced Search",action:()=>{const a=document.querySelector('[aria-label*="Open advanced search"]');a&&a.click()}},{key:"t",description:"Timeline: Jump to Today",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"today"}}))}},{key:"m",description:"Timeline: Jump to This Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"this-month"}}))}},{key:"l",description:"Timeline: Jump to Last Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"last-month"}}))}},{key:"o",description:"Timeline: Jump to Oldest",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"oldest"}}))}},{key:"Escape",description:"Close modal/Clear selection",action:()=>{const a=document.querySelector('[aria-label*="Close"]');a?.click(),a||document.querySelector('button:has-text("Clear Selection")')?.click()}},{key:"g",shift:!0,description:"Toggle grid view",action:()=>{document.querySelector('[aria-label*="Grid"]')?.click()}},{key:"l",shift:!0,description:"Toggle list view",action:()=>{document.querySelector('[aria-label*="List"]')?.click()}},{key:"a",ctrl:!0,description:"Select all",action:()=>{document.querySelector('[aria-label*="Select all"]')?.click()},enabled:!0},{key:"d",ctrl:!0,description:"Deselect all",action:()=>{document.querySelector('[aria-label*="Clear selection"]')?.click()},enabled:!0},{key:"Delete",description:"Delete selected",action:()=>{document.querySelector('button:has-text("Delete")')?.click()}},{key:"f",ctrl:!0,description:"Focus filter",action:()=>{document.querySelector('[placeholder*="Filter"]')?.focus()},enabled:!0},{key:"n",ctrl:!0,description:"New collection",action:()=>{document.querySelector('button:has-text("New Collection")')?.click()},enabled:!0},{key:"e",ctrl:!0,description:"Export selected",action:()=>{document.querySelector('button:has-text("Export")')?.click()},enabled:!0},{key:"s",ctrl:!0,description:"Save search",action:()=>{document.querySelector('button:has-text("Save Search")')?.click()},enabled:!0},{key:"ArrowLeft",description:"Previous photo",action:()=>{document.querySelector('[aria-label*="Previous"]')?.click()}},{key:"ArrowRight",description:"Next photo",action:()=>{document.querySelector('[aria-label*="Next"]')?.click()}},{key:" ",description:"Play/Pause slideshow",action:()=>{document.querySelector('[aria-label*="Play"]')?.click()}},{key:"i",description:"Toggle info panel",action:()=>{document.querySelector('[aria-label*="Info"]')?.click()}},{key:"?",shift:!0,description:"Show keyboard shortcuts",action:()=>{document.querySelector('[aria-label*="Help"]')?.click()}},{key:"h",description:"Go home",action:()=>{window.location.href="/"}},{key:"1",description:"Photos view",action:()=>{document.querySelector('[href*="/photos"]')?.click()}},{key:"2",description:"Albums view",action:()=>{document.querySelector('[href*="/albums"]')?.click()}},{key:"3",description:"People view",action:()=>{document.querySelector('[href*="/people"]')?.click()}}];function hn(){const a=Mc,t=s=>{const r=[];return s.ctrl&&r.push("Ctrl"),s.alt&&r.push("Alt"),s.shift&&r.push("Shift"),s.meta&&r.push("Cmd"),r.push(s.key===" "?"Space":s.key),r.join("+")};return a.map(s=>({keys:t(s),description:s.description}))}function _c({isOpen:a,onClose:t}){const s=hn();if(!a)return null;const r={Navigation:["/","1","2","3","Arrow","t","m","l","o"],Selection:["Ctrl+A","Ctrl+D","Space"],Actions:["Delete","Ctrl+E","Ctrl+S","Ctrl+N","a"],View:["Shift+G","Shift+L","i"],General:["Escape","Shift+?"]},n=i=>s.filter(u=>{const c=u.keys.toLowerCase();return i.some(l=>c.includes(l.toLowerCase()))});return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:i=>{i.key==="Escape"&&t()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close shortcuts",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(r).map(([i,u])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:i}),e.jsx("div",{className:"space-y-2",children:n(u).map((c,l)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded border border-gray-300 dark:border-gray-600",children:c.keys})]},l))})]},i))}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Pro Tips"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsxs("li",{children:[" Press ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"?"})," anytime to show this help"]}),e.jsx("li",{children:" Most shortcuts work globally except when typing in inputs"}),e.jsxs("li",{children:[" Use ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"Escape"})," to close modals or clear selection"]}),e.jsx("li",{children:" Navigate photos with arrow keys in lightbox view"})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Press any key to try it out"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})})]})})}function Fc({isOpen:a,onClose:t,initialSection:s="getting-started"}){const[r,n]=o.useState(s),[i,u]=o.useState(!1),c=hn();if(!a)return null;const l=[{id:"getting-started",title:"Getting Started",icon:e.jsx(pt,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Welcome to Photo Search!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Your AI-powered photo search and management tool. Here's how to get started:"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["Tip: Press ",e.jsx("span",{className:"font-mono",children:"?"})," anytime to open this help."]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-1",children:"Select Your Photo Directory"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"Choose the folder containing your photos. The app will index them for fast searching."})]})]})}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-1",children:"Try the Demo Library"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400",children:`Don't have photos ready? Click "Try Demo" to explore with sample photos and see how search works.`})]})]})}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-semibold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-300 mb-1",children:"Start Searching"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-400",children:'Use natural language to search: "beach sunset", "family photos", "mountains", or "red car".'})]})]})})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 dark:text-yellow-300 mb-2",children:" Pro Tip"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:`The more specific your search terms, the better results you'll get. Try combining concepts like "golden hour beach wedding" or "snowy mountain landscape".`})]})]})},{id:"features",title:"Features",icon:e.jsx(qs,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Powerful Features"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Discover what makes Photo Search special:"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Te,{className:"w-6 h-6 text-blue-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"AI-Powered Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search by visual content, not just filenames. Find photos using natural language descriptions."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Ye,{className:"w-6 h-6 text-green-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Face Recognition"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Automatically detect and group photos by people. Find all photos of specific individuals."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(ns,{className:"w-6 h-6 text-red-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Location Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search photos by location data. Find all photos taken in Paris, at the beach, or at home."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Jt,{className:"w-6 h-6 text-yellow-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Smart Collections"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Create dynamic collections based on search criteria. Automatically updated as you add new photos."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(vt,{className:"w-6 h-6 text-purple-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Filter by date, camera, lens, ISO, aperture, and more. Combine with AI search for precise results."})]})]})]})]})},{id:"shortcuts",title:"Keyboard Shortcuts",icon:e.jsx(ar,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"py-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Most Useful"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:c.slice(0,12).map((d,p)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-200",children:d.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600",children:d.keys})]},p))}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"View All Shortcuts"})})]})},{id:"troubleshooting",title:"Troubleshooting",icon:e.jsx(is,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Common Issues & Solutions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Having trouble? Here are solutions to common problems:"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-red-900 dark:text-red-300 mb-2",children:" No Search Results"}),e.jsxs("ul",{className:"text-sm text-red-700 dark:text-red-400 space-y-1",children:[e.jsx("li",{children:" Try more general search terms"}),e.jsx("li",{children:" Check if your photos are indexed (look for the indexing progress)"}),e.jsx("li",{children:" Try searching for colors, objects, or activities"}),e.jsx("li",{children:" Use the demo library to test search functionality"})]})]}),e.jsxs("div",{className:"border border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-300 mb-2",children:" Photos Not Loading"}),e.jsxs("ul",{className:"text-sm text-orange-700 dark:text-orange-400 space-y-1",children:[e.jsx("li",{children:" Ensure the photo directory is accessible"}),e.jsx("li",{children:" Check file permissions"}),e.jsx("li",{children:" Try re-selecting the directory"}),e.jsx("li",{children:" Restart the application if thumbnails don't appear"})]})]}),e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:" Slow Performance"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsx("li",{children:" Large photo libraries may take time to index initially"}),e.jsx("li",{children:' Use the "Fast" indexing option for quicker but less accurate results'}),e.jsx("li",{children:" Close other applications to free up memory"}),e.jsx("li",{children:" Consider using smaller batch sizes for indexing"})]})]}),e.jsxs("div",{className:"border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-2",children:" Face Recognition Issues"}),e.jsxs("ul",{className:"text-sm text-green-700 dark:text-green-400 space-y-1",children:[e.jsx("li",{children:" Face detection works best with clear, well-lit photos"}),e.jsx("li",{children:" Ensure faces are not obstructed or at extreme angles"}),e.jsx("li",{children:" Re-index your photos after making changes"}),e.jsx("li",{children:" Check the People view to see detected faces"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Still Need Help?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"If you're still experiencing issues, try:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2 space-y-1",children:[e.jsx("li",{children:" Restarting the application"}),e.jsx("li",{children:" Checking the browser console for error messages"}),e.jsx("li",{children:" Ensuring your browser supports modern web features"}),e.jsx("li",{children:" Clearing browser cache and cookies"})]})]})]})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:d=>{d.key==="Escape"&&t()},role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ki,{className:"w-6 h-6 text-blue-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Help Center"})]}),e.jsx("button",{type:"button",onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close help",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:e.jsx("div",{className:"flex gap-1",children:l.map(d=>e.jsxs("button",{type:"button",onClick:()=>n(d.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${r===d.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[d.icon,d.title]},d.id))})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:l.find(d=>d.id===r)?.content}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Need more help? Check out the demo library to explore features."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors text-sm font-medium",children:"Keyboard Shortcuts"}),e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})]})})]})}),e.jsx(_c,{isOpen:i,onClose:()=>u(!1)})]})}const Dc={facebook:{name:"Facebook",icon:e.jsx(Ti,{className:"w-5 h-5"}),maxSize:2048,aspectRatio:"1.91:1"},instagram:{name:"Instagram",icon:e.jsx(Ci,{className:"w-5 h-5"}),maxSize:1080,aspectRatio:"1:1"},twitter:{name:"Twitter",icon:e.jsx(Si,{className:"w-5 h-5"}),maxSize:1200,aspectRatio:"16:9"}},Xa={web:{name:"Web",description:"Optimized for websites",maxSize:1920,quality:85},email:{name:"Email",description:"Small size for email",maxSize:1024,quality:80},print:{name:"Print",description:"High quality for printing",maxSize:3e3,quality:95},instagram:{name:"Instagram",description:"Square format for Instagram",maxSize:1080,quality:90},twitter:{name:"Twitter",description:"Wide format for Twitter",maxSize:1200,quality:85},facebook:{name:"Facebook",description:"Wide format for Facebook",maxSize:2048,quality:90}},Oc=({selected:a,dir:t,onClose:s,uiActions:r})=>{const[n,i]=o.useState("link"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[p,f]=o.useState(!1),[y,w]=o.useState({expiryHours:24,viewOnly:!1}),[j,b]=o.useState("web"),[C,P]=o.useState(""),[S,m]=o.useState(""),[h,v]=o.useState(""),k=o.useRef(null),E=a.size,T=E>1,N=async()=>{if(!(!t||E===0)){c(!0);try{const M=Array.from(a),W=await Js(t,"local",M,y),se=`${window.location.origin}/share/${W.token}/view`;d(se),await navigator.clipboard.writeText(se),f(!0),r.setNote("Share link created and copied to clipboard!")}catch(M){r.setNote(M instanceof Error?M.message:"Share failed")}finally{c(!1)}}},O=async()=>{if(!(!t||E===0||!C)){c(!0);try{const M=Array.from(a),W=Xa[j],se=await jt(t,M,C,"copy",!1,!1,{preset:j==="instagram"||j==="twitter"||j==="facebook"?"web":j,resizeLong:W.maxSize,quality:W.quality});r.setNote(`Exported ${se.copied} photos to ${C}`),s()}catch(M){r.setNote(M instanceof Error?M.message:"Export failed")}finally{c(!1)}}},U=async()=>{l||await N()},Z=async()=>{const M=S.split(/[\n,;]+/).map(me=>me.trim()).filter(Boolean);if(M.length===0){r.setNote("Add at least one recipient");return}await U();const W=T?`Photos (${E})`:"Photo",se=`${h?h+`

`:""}${l}`,B=`mailto:${encodeURIComponent(M.join(","))}?subject=${encodeURIComponent(W)}&body=${encodeURIComponent(se)}`;try{window.location.href=B,s()}catch(me){r.setNote(me instanceof Error?me.message:"Could not open email client")}},F=M=>{if(!l)return;const W=`Check out ${T?`these ${E} photos`:"this photo"}!`,se={facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(l)}`,twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(W)}&url=${encodeURIComponent(l)}`,instagram:`instagram://library?AssetPath=${encodeURIComponent(l)}`};window.open(se[M],"_blank","width=600,height=400")},K=o.useCallback(()=>{!l||!k.current||(k.current.innerHTML=`<div style="font-family: monospace; font-size: 12px; line-height: 1; white-space: pre;">${_()}</div>`)},[l]),_=M=>`
    
         
       
     
     
          
     
     
       
           
     
    `.trim();return at.useEffect(()=>{l&&K()},[l,K]),e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center",children:e.jsx(rs,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Share ",T?`${E} Photos`:"Photo"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose how you'd like to share your photos"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{id:"link",icon:e.jsx(Fa,{className:"w-5 h-5"}),label:"Share Link",desc:"Create shareable link"},{id:"email",icon:e.jsx(Da,{className:"w-5 h-5"}),label:"Email",desc:"Send via email"},{id:"social",icon:e.jsx(Ye,{className:"w-5 h-5"}),label:"Social Media",desc:"Share on social platforms"},{id:"export",icon:e.jsx(_e,{className:"w-5 h-5"}),label:"Export",desc:"Download to folder"}].map(M=>e.jsx("button",{type:"button",onClick:()=>i(M.id),className:`p-4 rounded-xl border-2 transition-all ${n===M.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n===M.id?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:M.icon}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:M.label}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:M.desc})]})]})},M.id))})}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[n==="link"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Link Expires In"}),e.jsxs("select",{id:"expiry-select",value:y.expiryHours,onChange:M=>w(W=>({...W,expiryHours:parseInt(M.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[e.jsx("option",{value:1,children:"1 hour"}),e.jsx("option",{value:24,children:"24 hours"}),e.jsx("option",{value:168,children:"1 week"}),e.jsx("option",{value:720,children:"1 month"}),e.jsx("option",{value:8760,children:"1 year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password (Optional)"}),e.jsx("input",{id:"password-input",type:"password",value:y.password||"",onChange:M=>w(W=>({...W,password:M.target.value||void 0})),placeholder:"Leave empty for no password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"viewOnly",checked:y.viewOnly,onChange:M=>w(W=>({...W,viewOnly:M.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"viewOnly",className:"text-sm text-gray-700 dark:text-gray-300",children:"View-only (prevent downloads)"})]}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 dark:text-green-200",children:[e.jsx(gt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Share link created!"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"}),e.jsxs("button",{type:"button",onClick:async()=>{await navigator.clipboard.writeText(l),f(!0),setTimeout(()=>f(!1),2e3)},className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded flex items-center gap-1",children:[p?e.jsx(gt,{className:"w-4 h-4"}):e.jsx(It,{className:"w-4 h-4"}),p?"Copied!":"Copy"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Oa,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"QR Code"})]}),e.jsx("div",{ref:k,className:"flex justify-center",children:e.jsx("div",{className:"w-32 h-32 bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(Oa,{className:"w-16 h-16 text-gray-400"})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-2",children:"Scan to open on mobile"})]})]}):e.jsx("button",{type:"button",onClick:N,disabled:u,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Share Link..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fa,{className:"w-5 h-5"}),"Create Share Link"]})})]}),n==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Addresses"}),e.jsx("textarea",{id:"email-input",value:S,onChange:M=>m(M.target.value),placeholder:"Enter email addresses separated by commas",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message (Optional)"}),e.jsx("textarea",{id:"email-message",placeholder:"Add a personal message...",value:h,onChange:M=>v(M.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 h-20"})]}),e.jsxs("button",{type:"button",onClick:Z,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center justify-center gap-2",children:[e.jsx(Da,{className:"w-5 h-5"}),"Send Email"]})]}),n==="social"&&e.jsx("div",{className:"space-y-4",children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Share your photos on social media:"}),Object.entries(Dc).map(([M,W])=>e.jsxs("button",{type:"button",onClick:()=>F(M),className:"w-full p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:W.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium",children:W.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[W.aspectRatio,"  Max ",W.maxSize,"px"]})]}),e.jsx(Ls,{className:"w-5 h-5 text-gray-400"})]},M))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"First create a share link, then share on social media"}),e.jsx("button",{type:"button",onClick:()=>i("link"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Create Share Link First"})]})}),n==="export"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"export-destination",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Destination"}),e.jsx("input",{id:"export-destination",type:"text",value:C,onChange:M=>P(M.target.value),placeholder:"/absolute/path/to/export/folder",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Preset"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Xa).map(([M,W])=>e.jsxs("button",{type:"button",onClick:()=>b(M),className:`p-3 border rounded-lg text-left ${j===M?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:W.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:W.description}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["Max ",W.maxSize,"px  ",W.quality,"% quality"]})]},M))})]}),e.jsx("button",{type:"button",onClick:O,disabled:u||!C,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-5 h-5"}),"Export ",E," Photo",T?"s":""]})})]})]})]})})},Rc={blue:{primary:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#3b82f6"},green:{primary:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#22c55e"},purple:{primary:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#a855f7"},orange:{primary:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#f97316"},gray:{primary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#6b7280"}};function Lc({children:a}){const t=Ee(l=>l.themeMode),s=Ee(l=>l.colorScheme),r=Ee(l=>l.density),n=Ee(l=>l.customColors),i=ga(),u=o.useMemo(()=>t==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t,[t]),c=o.useMemo(()=>{const l=n?{primary:n.primary,secondary:n.secondary,accent:n.accent}:Rc[s],d={};return n?(d["--color-primary"]=n.primary,d["--color-primary-hover"]=n.primary,d["--color-primary-active"]=n.primary):Object.entries(l.primary).forEach(([p,f])=>{d[`--color-primary-${p}`]=f}),n?d["--color-secondary"]=n.secondary:Object.entries(l.secondary).forEach(([p,f])=>{d[`--color-secondary-${p}`]=f}),d["--color-accent"]=n?n.accent:l.accent,u==="dark"?(d["--color-background"]="#0f172a",d["--color-surface"]="#1e293b",d["--color-surface-hover"]="#334155",d["--color-border"]="#334155",d["--color-border-hover"]="#475569",d["--color-text-primary"]="#f8fafc",d["--color-text-secondary"]="#cbd5e1",d["--color-text-tertiary"]="#94a3b8"):(d["--color-background"]="#ffffff",d["--color-surface"]="#f8fafc",d["--color-surface-hover"]="#f1f5f9",d["--color-border"]="#e2e8f0",d["--color-border-hover"]="#cbd5e1",d["--color-text-primary"]="#0f172a",d["--color-text-secondary"]="#475569",d["--color-text-tertiary"]="#64748b"),i&&(d["--color-background"]="#000000",d["--color-surface"]="#000000",d["--color-surface-hover"]="#000000",d["--color-border"]="#ffffff",d["--color-border-hover"]="#ffffff",d["--color-text-primary"]="#ffffff",d["--color-text-secondary"]="#ffffff",d["--color-text-tertiary"]="#ffffff",d["--color-primary"]="#ffffff",d["--color-accent"]="#00ff00"),d},[u,s,n,i]);return o.useEffect(()=>{const l=document.documentElement;Object.entries(c).forEach(([d,p])=>{l.style.setProperty(d,p)}),l.classList.remove("light","dark"),l.classList.add(u),l.classList.remove("density-compact","density-normal","density-spacious"),l.classList.add(`density-${r}`),i?l.classList.add("high-contrast"):l.classList.remove("high-contrast")},[c,u,r,i]),o.useEffect(()=>{if(t!=="auto")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>{document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(l.matches?"dark":"light")};return l.addEventListener("change",d),()=>l.removeEventListener("change",d)},[t]),e.jsx(e.Fragment,{children:a})}const Ac=[{id:"blue",name:"Blue",color:"#3b82f6"},{id:"green",name:"Green",color:"#22c55e"},{id:"purple",name:"Purple",color:"#a855f7"},{id:"orange",name:"Orange",color:"#f97316"},{id:"gray",name:"Gray",color:"#6b7280"}],zc=[{id:"compact",name:"Compact",description:"Tighter spacing, smaller elements"},{id:"normal",name:"Normal",description:"Balanced spacing and sizing"},{id:"spacious",name:"Spacious",description:"More breathing room, larger elements"}];function Uc({isOpen:a,onClose:t}){const[s,r]=o.useState("appearance"),n=Ee(m=>m.themeMode),i=Ee(m=>m.colorScheme),u=Ee(m=>m.density),c=Ee(m=>m.customColors),l=Ee(m=>m.setThemeMode),d=Ee(m=>m.setColorScheme),p=Ee(m=>m.setDensity),f=Ee(m=>m.setCustomColors),y=Ee(m=>m.resetTheme),w=ga(),j=cs(m=>m.setHighContrast),[b,C]=o.useState(c||{primary:"#3b82f6",secondary:"#64748b",accent:"#3b82f6"});if(!a)return null;const P=(m,h)=>{const v={...b,[m]:h};C(v),f(v)},S=m=>{d(m),m!=="custom"&&f(void 0)};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-xl flex items-center justify-center",children:e.jsx(Pt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Theme Settings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Customize your app appearance"})]})]}),e.jsx("button",{type:"button",onClick:t,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center","aria-label":"Close theme settings",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[{id:"appearance",name:"Appearance",icon:vt},{id:"colors",name:"Colors",icon:Pt},{id:"accessibility",name:"Accessibility",icon:Ts}].map(m=>e.jsxs("button",{type:"button",onClick:()=>r(m.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${s===m.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(m.icon,{className:"w-4 h-4"}),m.name]},m.id))}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[s==="appearance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Theme Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{id:"light",name:"Light",icon:_s},{id:"dark",name:"Dark",icon:cr},{id:"auto",name:"Auto",icon:sr}].map(m=>e.jsxs("button",{type:"button",onClick:()=>l(m.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${n===m.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx(m.icon,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:m.name})]},m.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Density"}),e.jsx("div",{className:"space-y-3",children:zc.map(m=>e.jsx("button",{type:"button",onClick:()=>p(m.id),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${u===m.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:m.name}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:m.description})]}),u===m.id&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full"})]})},m.id))})]})]}),s==="colors"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Color Scheme"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[Ac.map(m=>e.jsxs("button",{type:"button",onClick:()=>S(m.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i===m.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-gray-300 dark:border-gray-600",style:{backgroundColor:m.color}}),e.jsx("span",{className:"text-sm font-medium",children:m.name})]},m.id)),e.jsxs("button",{type:"button",onClick:()=>S("custom"),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i==="custom"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-dashed border-gray-400 dark:border-gray-500 flex items-center justify-center",children:e.jsx(Pt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})}),e.jsx("span",{className:"text-sm font-medium",children:"Custom"})]})]})]}),i==="custom"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Custom Colors"}),e.jsx("div",{className:"space-y-4",children:[{key:"primary",label:"Primary"},{key:"secondary",label:"Secondary"},{key:"accent",label:"Accent"}].map(({key:m,label:h})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:`${m}-color`,className:"text-sm font-medium text-gray-700 dark:text-gray-300 min-w-16",children:h}),e.jsx("input",{id:`${m}-color`,type:"color",value:b[m],onChange:v=>P(m,v.target.value),className:"w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),e.jsx("input",{type:"text",value:b[m],onChange:v=>P(m,v.target.value),className:"flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"#000000"})]},m))})]})]}),s==="accessibility"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"High Contrast Mode"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ts,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"High Contrast"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Increases contrast for better accessibility"})]})]}),e.jsx("button",{type:"button",onClick:()=>j?.(!w),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${w?"bg-blue-600":"bg-gray-200 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${w?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Reset Theme"}),e.jsxs("button",{type:"button",onClick:()=>{y(),j?.(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx(Ei,{className:"w-4 h-4"}),"Reset to Defaults"]})]})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors",children:"Close"})})]})})}const Bc=a=>a.split("/").pop()||a;function Za({children:a,onEscape:t}){const s=at.useRef(null);return at.useEffect(()=>{const r=s.current;if(!r)return;const n=r.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'),i=Array.from(n).filter(c=>!c.hasAttribute("disabled"));i.length>0?(i.find(l=>l.getAttribute("tabindex")!=="-1")||i[0]).focus():(r.setAttribute("tabindex","-1"),r.focus());const u=c=>{if(c.key==="Escape"&&(c.stopPropagation(),c.preventDefault(),t&&t()),c.key==="Tab"){if(i.length===0)return;const l=i.indexOf(document.activeElement),d=c.shiftKey?-1:1;let p=l+d;p<0&&(p=i.length-1),p>=i.length&&(p=0),c.preventDefault(),i[p].focus()}};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[t]),e.jsx("div",{ref:s,children:a})}function qc(){const[a,t]=o.useState(!1);o.useEffect(()=>(t(!0),()=>t(!1)),[]);const s=No(),r=ko(),n=So(),i=Co(),u=Ao(),c=zo(),l=Oo(),d=Ro(),p=Uo(),f=Lo(),y=Fo(),w=Po(),j=Io(),b=$o(),C=Mo(),P=_o(),S=Ko(),m=Go(),h=To(),v=Eo(),k=Bo(),E=qo(),T=Ho(),N=Wo(),O=Vo(),U=Qo(),Z=U,F=Jo(),K=Xo(),_=[],M=Qr();Jr();const W=Yo(),se=Zo(),B=el(),me=tl();sl();const A=al(),ee=rl(),ie=nl(),V=il(),Y=ol(),R=Xr(),H=Zr(),$=ll(),G=cl(),[J,L]=o.useState("library"),z=Qs(),ce=fr(),[Q,re]=o.useState(""),[ue,Ne]=o.useState(new Set),[oe,X]=o.useState("medium"),[ye,rt]=o.useState("grid"),[Pe,ds]=o.useState("day"),[zt,Ut]=o.useState("all"),[nt,ze]=o.useState(!1),[Ue,us]=o.useState(""),[Be,hs]=o.useState(""),[Se,xe]=o.useState(null),[ya,mn]=o.useState(!1),[xn,qe]=o.useState(!1),[we,Qe]=o.useState(null),[be,Ve]=o.useState(null),[ms,pn]=o.useState([]),Bt=o.useRef(ms),[gn,va]=o.useState(!1),[fn,bn]=o.useState("home");o.useEffect(()=>{Bt.current=ms},[ms]);const yn=o.useCallback((x,g)=>x.length===g.length&&x.every((I,q)=>I.length===g[q].length&&I.every((D,te)=>D===g[q][te])),[]),ja=o.useRef(null),[wa,vn]=o.useState({cameras:[],places:[]}),[jn,wt]=o.useState(!1),[xs,Le]=o.useState([]),[Nt,Na]=o.useState(!1),[wn,ps]=o.useState(void 0),[kt,gs]=o.useState(void 0),[Nn,fs]=o.useState(!1),[kn,Sn]=o.useState(void 0),[Cn,bs]=o.useState(!1),[it,Tn]=o.useState(0),[ot,Ae]=o.useState(null),[En,ka]=o.useState(!1),[Pn,In]=o.useState(()=>{try{return!localStorage.getItem("ps_hint_help_seen")}catch{return!0}}),[ys,$n]=o.useState([]),qt=o.useRef(null),[St,vs]=o.useState(()=>{try{const x=localStorage.getItem("userActions");return x?JSON.parse(x):[]}catch{return[]}}),[Mn,_n]=o.useState(()=>{try{const x=localStorage.getItem("onboardingSteps");return x?JSON.parse(x):[]}catch{return[]}}),He=o.useCallback(x=>{const g={select_directory:[],index_photos:["select_directory"],first_search:["index_photos"],explore_features:["first_search"]};_n(I=>{if(I.includes(x)||!(g[x]||[]).every(te=>I.includes(te)))return I;const D=[...I,x];try{localStorage.setItem("onboardingSteps",JSON.stringify(D))}catch{}return D})},[]),[Fn,Sa]=o.useState(!1),[Dn,Ca]=o.useState(!1),js=o.useMemo(()=>{const x={},g=W||{};for(const I of Object.keys(g)){const D=(g[I]||[]).find(te=>/^rating:[1-5]$/.test(te));D&&(x[I]=parseInt(D.split(":")[1],10))}return x},[W]);o.useEffect(()=>{try{localStorage.getItem("ps_theme")==="dark"&&document.documentElement.classList.add("dark")}catch{}},[]);const ws=ga(),lt=Do();o.useEffect(()=>{const x=g=>{const I=document.activeElement;if(!(I&&(I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.isContentEditable))){if(g.key.toLowerCase()==="i"){g.preventDefault(),R.setShowInfoOverlay&&R.setShowInfoOverlay(!lt);return}if(g.key.toLowerCase()==="a"){g.preventDefault(),xe({kind:"advanced"});return}if(g.key==="?"){g.preventDefault(),qe(q=>!q);return}if(J==="results"&&ye==="timeline"){const q=D=>window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:D}}));if(g.key.toLowerCase()==="t"){g.preventDefault(),q("today");return}if(g.key.toLowerCase()==="m"){g.preventDefault(),q("this-month");return}if(g.key.toLowerCase()==="l"){g.preventDefault(),q("last-month");return}if(g.key.toLowerCase()==="o"){g.preventDefault(),q("oldest");return}}}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[lt,R,J,ye]),o.useEffect(()=>{const x=document.body;ws?x.classList.add("high-contrast"):x.classList.remove("high-contrast")},[ws]);const On=o.useMemo(()=>{const x=!!(w||j||b||C||P||y),g=!!(Ue&&Be),I=Array.isArray(ee)&&ee.length>0,q=!!(S&&S.trim()),D=it>0||f;return!!(N||x||g||I||q||D)},[w,j,b,C,P,y,Ue,Be,ee,S,it,f,N]);o.useEffect(()=>{const g=(z.pathname||"/library").split("/").filter(Boolean)[0]||"library",I=g==="search"?"results":g==="library"?"library":g==="people"?"people":g==="collections"?"collections":g==="settings"?"tasks":"library";J!==I&&L(I)},[z.pathname,J]),o.useEffect(()=>{const x=z.pathname||"",g=J==="results"?"/search":J==="library"?"/library":J==="people"?"/people":J==="collections"?"/collections":"/settings";x!==g&&ce({pathname:g,search:z.search},{replace:!1})},[J,ce,z.search]),o.useEffect(()=>{if(!a)return;const x=new URLSearchParams(z.search),g=x.get("q")||"";g&&g!==Q&&re(g);try{x.get("fav")==="1"&&H.setFavOnly(!0);const q=x.get("tags")||"";q&&H.setTagFilter(q);const D=x.get("date_from"),te=x.get("date_to");D&&us(D),te&&hs(te);const de=x.get("place");de&&R.setPlace(de),x.get("has_text")==="1"&&R.setHasText(!0);const ve=x.get("camera");ve&&R.setCamera(ve);const Ie=x.get("iso_min");Ie&&R.setIsoMin(parseFloat(Ie));const $e=x.get("iso_max");$e&&R.setIsoMax(parseFloat($e));const Wt=x.get("f_min");Wt&&R.setFMin(parseFloat(Wt));const Ce=x.get("f_max");Ce&&R.setFMax(parseFloat(Ce));const Kt=x.get("person"),Tt=x.get("persons");Tt?G.setPersons(Tt.split(",").map(Et=>Et.trim()).filter(Boolean)):Kt&&G.setPersons([Kt]);const Ze=x.get("rv");Ze&&R.setResultView&&R.setResultView(Ze);const Gt=x.get("tb");Gt&&R.setTimelineBucket&&R.setTimelineBucket(Gt)}catch{}},[z.search,a,Q,H,R,G]),o.useEffect(()=>{Q&&Q.trim()&&vs(x=>{if(!x.includes("searched")){const g=[...x,"searched"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return x})},[Q]),o.useEffect(()=>{s&&(vs(x=>{if(!x.includes("selected_directory")){const g=[...x,"selected_directory"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return x}),He("select_directory"))},[s,He]),o.useEffect(()=>{M&&M.length>0&&vs(x=>{if(!x.includes("indexed")){const g=[...x,"indexed"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return x})},[M]),o.useEffect(()=>{["collections","saved","smart","memories","trips","videos","people","map"].includes(J)&&He("explore_features")},[J,He]),o.useEffect(()=>{Sa(!!(St.length===0||J==="results"&&!St.includes("searched")||J==="library"&&s&&!St.includes("searched")))},[J,St,s]),o.useEffect(()=>{const g=!localStorage.getItem("onboardingComplete")&&s&&M&&M.length>0;Ca(g||!1)},[s,M]);const[nd,id]=o.useState(0),Rn=120,Ln=o.useMemo(()=>(M||[]).map(x=>({path:x})),[M]),Je=o.useCallback(async()=>{if(s)try{const x=await Xs(s);H.setFavorites(x.favorites||[])}catch{}},[s,H]),Vt=o.useCallback(async()=>{if(s)try{const x=await Zs(s);H.setSaved(x.saved||[])}catch{}},[s,H]),ct=o.useCallback(async()=>{if(s)try{const{apiGetPresets:x}=await pe(async()=>{const{apiGetPresets:I}=await Promise.resolve().then(()=>ge);return{apiGetPresets:I}},void 0,import.meta.url),g=await x(s);$n(g.presets||[])}catch{}},[s]),Fe=o.useCallback(async()=>{if(s)try{const x=await ia(s);H.setTagsMap(x.tags||{}),H.setAllTags(x.all||[])}catch{}},[s,H]),Ht=o.useCallback(async()=>{if(s)try{const x=await ta(s,r,v?i:void 0,h?n:void 0);G.setDiag(x)}catch{}},[s,r,v,i,h,n,G]),Ns=o.useCallback(async()=>{if(s)try{const x=await ua(s);G.setClusters(x.clusters||[])}catch{}},[s,G]),An=o.useCallback(async()=>{if(s)try{const x=await ea(s);G.setPoints(x.points||[])}catch{}},[s,G]),dt=o.useCallback(async(x=120,g=0,I=!1)=>{try{if(!s)return;const q=await At(s,r,x,g,{openaiKey:v?i:void 0,hfToken:h?n:void 0}),D=q.paths&&q.paths.length===x&&g+q.paths.length<q.total;I?q.paths&&q.paths.length>0&&H.appendLibrary(q.paths):H.setLibrary(q.paths||[]),H.setLibHasMore(D)}catch{}},[s,r,v,i,h,n,H]),Ta=o.useCallback(async()=>{try{if(!s)return;const x=await ca(s);vn({cameras:x.cameras||[],places:x.places||[]})}catch{}},[s]);o.useEffect(()=>{let x=!1;return(async()=>{if(!s){bs(!1);return}try{const{apiOcrStatus:I}=await pe(async()=>{const{apiOcrStatus:D}=await Promise.resolve().then(()=>ge);return{apiOcrStatus:D}},void 0,import.meta.url),q=await I(s);x||bs(!!q.ready)}catch{x||bs(!1)}})(),()=>{x=!0}},[s]);const ut=o.useCallback(async()=>{$.setNote("Indexing started in background. You can continue using the app."),Na(!0);const x=`index-${Date.now()}`,g={id:x,type:"index",title:"Indexing Photos",description:`Analyzing photos in ${s}`,status:"running",startTime:new Date,canCancel:!0,total:(M||[]).length||void 0};Le(q=>[...q,g]);let I;I=setInterval(async()=>{await dt(120,0)},3e3);try{const q=await Dt(s,r,32,h?n:void 0,v?i:void 0);I&&clearInterval(I),$.setNote(`Indexing complete! New: ${q.new}, Updated: ${q.updated}, Total: ${q.total}`),Le(D=>D.map(te=>te.id===x?{...te,status:"completed",endTime:new Date,progress:q.total}:te)),He("index_photos"),await dt(120,0)}catch(q){I&&clearInterval(I),$.setNote(q instanceof Error?q.message:"Index failed"),Le(D=>D.map(te=>te.id===x?{...te,status:"failed",endTime:new Date,error:q instanceof Error?q.message:"Index failed"}:te))}finally{Na(!1)}},[s,r,h,n,v,i,dt,$,He]),We=o.useCallback(async x=>{const g=(x??Q??"").trim();if(g){H.setQuery(g);try{const I=new URLSearchParams;I.set("q",g),N&&I.set("fav","1"),S?.trim()&&I.set("tags",S),Ue&&Be&&(I.set("date_from",Ue),I.set("date_to",Be)),y?.trim()&&I.set("place",y),f&&I.set("has_text","1"),w?.trim()&&I.set("camera",w),j&&I.set("iso_min",String(j)),b&&I.set("iso_max",String(b)),C&&I.set("f_min",String(C)),P&&I.set("f_max",String(P));const q=ee.filter(Boolean);q.length===1&&I.set("person",q[0]),q.length>1&&I.set("persons",q.join(",")),ce({pathname:"/search",search:`?${I.toString()}`},{replace:!1})}catch{}$.setBusy("Searching"),$.setNote("");try{const I=S.split(",").map(ve=>ve.trim()).filter(Boolean),q=ee.filter(Boolean);let D;const te=Ue?Math.floor(new Date(Ue).getTime()/1e3):void 0,de=Be?Math.floor(new Date(Be).getTime()/1e3):void 0;A?D=await na(s,g,r,O,{favoritesOnly:N,tags:I,dateFrom:te,dateTo:de,place:y||void 0,hasText:f,...q.length===1?{person:q[0]}:q.length>1?{persons:q}:{}}):D=await ls(s,g,r,O,{hfToken:h?n:void 0,openaiKey:v?i:void 0,favoritesOnly:N,tags:I,dateFrom:te,dateTo:de,...u?{useFast:!0,fastKind:c||void 0}:{},useCaptions:l,useOcr:d,camera:w||void 0,isoMin:j||void 0,isoMax:b||void 0,fMin:C||void 0,fMax:P||void 0,place:y||void 0,hasText:f||void 0,...q.length===1?{person:q[0]}:q.length>1?{persons:q}:{}});let fe=D.results||[];it>0&&(fe=fe.filter(ve=>(js[ve.path]||0)>=it)),H.setResults(fe),H.setSearchId(D.search_id||""),$.setNote(`Found ${D.results?.length||0} results.`),await Promise.all([Je(),Vt(),Fe(),Ht()]),L("results"),He("first_search")}catch(I){$.setNote(I instanceof Error?I.message:"Search failed")}finally{$.setBusy("")}}},[Q,H,ce,z.search,$,W,ee,Ue,Be,A,s,r,O,N,y,f,h,n,v,i,u,c,l,d,w,j,b,C,P,it,js,Je,Vt,Fe,Ht,He]),Ea=Li(We,300),zn=o.useCallback(async x=>{$.setBusy(`Preparing ${x.toUpperCase()}`);try{await sa(s,x,r,h?n:void 0,v?i:void 0),$.setNote(`${x.toUpperCase()} ready`)}catch(g){$.setNote(g instanceof Error?g.message:"Failed to build index")}finally{$.setBusy("")}},[s,r,h,n,v,i,$]),Un=o.useCallback(async()=>{$.setBusy("Extracting text (OCR)");try{const x=await aa(s,r,["en"],h?n:void 0,v?i:void 0);$.setNote(`OCR updated ${x.updated} images`),await Fe()}catch(x){$.setNote(x instanceof Error?x.message:"OCR failed")}finally{$.setBusy("")}},[s,r,h,n,v,i,Fe,$]),Bn=o.useCallback(async()=>{$.setBusy("Building metadata");try{const x=await la(s,r,h?n:void 0,v?i:void 0);$.setNote(`Metadata ready (${x.updated})`)}catch(x){$.setNote(x instanceof Error?x.message:"Metadata build failed")}finally{$.setBusy("")}},[s,r,h,n,v,i,$]);o.useEffect(()=>{if(!se||!s)return;let x,g="";const I=D=>{switch(D?.type){case"ocr_build":return`OCR updated ${D.updated}`;case"captions_build":return`Captions updated ${D.updated}`;case"fast_build":return`${String(D.kind).toUpperCase()} ${D.ok?"ready":"failed"}`;case"thumbs_build":return`Thumbs made ${D.made}`;case"trips_build":return`Trips ${D.trips}`;case"metadata_build":return`Metadata updated ${D.updated}`;case"export":return`Exported ${D.copied}, skipped ${D.skipped}`;default:return""}},q=async()=>{try{const{apiAnalytics:D}=await pe(async()=>{const{apiAnalytics:fe}=await Promise.resolve().then(()=>ge);return{apiAnalytics:fe}},void 0,import.meta.url),de=((await D(s,10)).events||[]).slice(-1)[0];if(de&&de.time!==g){g=de.time;const fe=I(de);fe&&$.setNote(fe)}}catch{}x=window.setTimeout(q,2e3)};return q(),()=>{x&&window.clearTimeout(x)}},[se,s,$]),o.useEffect(()=>{if(!Nt||!s){ps(void 0),gs(void 0),fs(!1);return}let x,g;const I=async()=>{try{const{apiIndexStatus:q}=await pe(async()=>{const{apiIndexStatus:Ze}=await Promise.resolve().then(()=>ge);return{apiIndexStatus:Ze}},void 0,import.meta.url),D=await q(s,r,h?n:void 0,v?i:void 0),te=Number(D.insert_done||0),de=Number(D.insert_total||0),fe=Number(D.updated_done||0),ve=Number(D.updated_total||0),Ie=te+fe,$e=Math.max(1,de+ve),Wt=Math.min(1,Math.max(0,Ie/$e));$e>1&&ps(Wt),fs(!!D.paused||D.state==="paused");const Ce=[];$e>1&&Ce.push(`processed ${Ie}/${$e}`),typeof D.indexed=="number"&&Ce.push(`indexed ${D.indexed}`),typeof D.target=="number"&&D.target>0&&Ce.push(`target ${D.target}`),typeof D.coverage=="number"&&Ce.push(`coverage ${Math.round(D.coverage*100)}%`),typeof D.drift=="number"&&D.drift>0&&Ce.push(`drift ${D.drift}`),D.state==="complete"&&(typeof D.new=="number"&&Ce.push(`new ${D.new}`),typeof D.updated=="number"&&Ce.push(`updated ${D.updated}`),D.last_index_time&&Ce.push(`at ${D.last_index_time}`)),typeof kt=="number"&&isFinite(kt)&&kt>0&&Ce.push(`eta ~${Math.max(1,Math.ceil(kt/60))}m`),Ce.length>0&&Sn(Ce.join("  ")),!g&&D.start&&(g=Date.parse(D.start));const Kt=Date.now(),Tt=g?Math.max(1,(Kt-g)/1e3):void 0;if(Tt&&Ie>5){const Ze=Ie/Tt,Gt=Math.max(0,$e-Ie),Et=Ze>0?Gt/Ze:void 0;Et&&isFinite(Et)&&gs(Et)}D.state==="complete"&&(ps(void 0),gs(void 0),fs(!1))}catch{}x=window.setTimeout(I,1e3)};return I(),()=>{x&&window.clearTimeout(x)}},[Nt,s,r,h,n,v,i]),o.useEffect(()=>{try{const x=new URLSearchParams(z.search);x.set("rv",ye),x.set("tb",Pe),ce({pathname:z.pathname,search:`?${x.toString()}`},{replace:!0})}catch{}},[ye,Pe]);const Ct=o.useCallback(x=>{Ne(g=>{const I=new Set(g);return I.has(x)?I.delete(x):I.add(x),I})},[]);o.useCallback(async x=>{if(!(!s||ue.size===0))try{const g=await jt(s,Array.from(ue),x,"copy",!1,!1);$.setNote(`Exported ${g.copied}, skipped ${g.skipped}, errors ${g.errors}  ${g.dest}`)}catch(g){$.setNote(g instanceof Error?g.message:"Export failed")}},[s,ue,$]);const Pa=o.useCallback(x=>{const g=(k||[]).findIndex(I=>I.path===x);g>=0&&Qe(g)},[k]),Xe=o.useCallback(x=>{Qe(g=>{if(g===null)return null;const I=g+x;return!k||I<0||I>=k.length?g:I})},[k]),qn=o.useCallback(async x=>{if(!s||ue.size===0)return;const g=x.split(",").map(I=>I.trim()).filter(Boolean);try{const{apiSetTags:I}=await pe(async()=>{const{apiSetTags:q}=await Promise.resolve().then(()=>ge);return{apiSetTags:q}},void 0,import.meta.url);await Promise.all(Array.from(ue).map(q=>I(s,q,g))),$.setNote(`Updated tags for ${ue.size} photos`),await Fe()}catch(I){$.setNote(I instanceof Error?I.message:"Tag update failed")}},[s,ue,Fe,$]);o.useCallback(async x=>{if(!(!s||ue.size===0))try{const{apiSetTags:g}=await pe(async()=>{const{apiSetTags:D}=await Promise.resolve().then(()=>ge);return{apiSetTags:D}},void 0,import.meta.url),I=/^rating:[1-5]$/,q=Array.from(ue);await Promise.all(q.map(async D=>{const te=(W?.[D]||[]).filter(fe=>!I.test(fe)),de=x===0?te:[...te,`rating:${x}`];await g(s,D,de)})),$.setNote(x===0?`Cleared rating for ${ue.size}`:`Set rating ${x} for ${ue.size}`),await Fe()}catch(g){$.setNote(g instanceof Error?g.message:"Rating update failed")}},[s,ue,W,Fe,$]),o.useEffect(()=>{if(!a)return;const x=E||"";re(g=>g===x?g:x)},[E,a]),o.useEffect(()=>{s&&(Je(),Vt(),Fe(),Ht(),Ns(),dt(Rn,0),Ta(),ct())},[s,Je,Vt,Fe,Ht,Ns,dt,Ta,ct]),o.useEffect(()=>{if(!a)return;const x=k?.length??0;Ve(g=>{const I=x>0?g===null?0:Math.min(g,x-1):null;return Object.is(g,I)?g:I})},[k?.length,a]),o.useEffect(()=>{function x(g){const I=g.target;if(I&&(I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.isContentEditable)||ya||Se||nt)return;if(g.key==="/"){g.preventDefault();return}if(g.key==="?"||g.shiftKey&&g.key==="/"){g.preventDefault(),mn(!0);return}if(!(J!=="results"||!((k?.length||0)>0))){if(g.key==="Escape"){Qe(null);return}if(we!==null){if((g.key==="ArrowLeft"||g.key==="k")&&(g.preventDefault(),Xe(-1)),(g.key==="ArrowRight"||g.key==="j")&&(g.preventDefault(),Xe(1)),g.key.toLowerCase()==="f"){g.preventDefault();const D=k?.[we]?.path;if(!D)return;$t(s,D,!T.includes(D)).then(Je).catch(()=>{})}return}if(g.key.toLowerCase()==="a"){g.preventDefault(),Ne(new Set((k??[]).map(D=>D.path)));return}if(g.key.toLowerCase()==="c"){g.preventDefault(),Ne(new Set);return}if(g.key.toLowerCase()==="f"&&be!==null){g.preventDefault();const D=k?.[be]?.path;if(!D)return;$t(s,D,!T.includes(D)).then(Je).catch(()=>{});return}if(g.key==="Enter"&&be!==null){g.preventDefault(),Qe(be);return}if(g.key===" "&&be!==null){g.preventDefault();const D=k?.[be]?.path;if(!D)return;Ct(D);return}if(g.key==="ArrowLeft"){g.preventDefault(),be!==null&&Ve(Math.max(0,be-1));return}if(g.key==="ArrowRight"){g.preventDefault(),be!==null&&Ve(Math.min((k?.length??1)-1,be+1));return}if(g.key==="ArrowUp"&&be!==null){g.preventDefault();const D=Bt.current;let te=D.findIndex(de=>de.includes(be));if(te>0){const de=D[te].indexOf(be),fe=D[te-1],ve=fe[Math.min(de,fe.length-1)];typeof ve=="number"&&Ve(ve)}return}if(g.key==="ArrowDown"&&be!==null){g.preventDefault();const D=Bt.current;let te=D.findIndex(de=>de.includes(be));if(te>=0&&te<D.length-1){const de=D[te].indexOf(be),fe=D[te+1],ve=fe[Math.min(de,fe.length-1)];typeof ve=="number"&&Ve(ve)}return}if(g.key==="Home"){g.preventDefault(),Ve(0);return}if(g.key==="End"){g.preventDefault(),Ve(k.length-1);return}if((g.key==="PageUp"||g.key==="PageDown")&&be!==null){g.preventDefault();const D=3,te=Bt.current,de=te.findIndex(fe=>fe.includes(be));if(de>=0){const fe=te[de].indexOf(be),ve=g.key==="PageUp"?Math.max(0,de-D):Math.min(te.length-1,de+D),Ie=te[ve],$e=Ie[Math.min(fe,Ie.length-1)];typeof $e=="number"&&Ve($e)}return}}}return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[J,k?.length,we,s,T,Xe,Ct,ya,Se,nt]),o.useEffect(()=>{if(be===null)return;const g=document.getElementById("modern-results-grid")?.querySelector(`[data-photo-idx="${be}"]`);g&&g.scrollIntoView({block:"nearest",inline:"nearest"})},[be]);const Vn=()=>s?M&&M.length===0?e.jsx("div",{className:"p-4",children:e.jsx(Ss,{type:"no-photos",onAction:()=>xe({kind:"folder"}),onOpenHelp:()=>qe(!0)})}):e.jsxs("div",{className:"p-4",children:[e.jsx(Ml,{dir:s,engine:r,library:M,onLoadLibrary:dt,selected:ue,onToggleSelect:Ct,onOpen:x=>{const g=[{path:x,score:0}];H.setResults(g),Qe(0),L("results")},tagsMap:W}),!Q&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-700 font-medium mb-2",children:"Try these searches"}),e.jsx(Ga,{onSearch:We})]})]}):e.jsxs("div",{className:"p-4",children:[e.jsx(Ss,{type:"no-directory",onAction:()=>xe({kind:"folder"}),onDemoAction:async()=>{R.setDir("/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data");try{await ut(),$.setNote("Demo library loaded! Try searching for 'beach sunset' or 'family photos'")}catch(g){console.error("Failed to setup demo:",g),$.setNote(g instanceof Error?g.message:"Failed to setup demo")}},onOpenHelp:()=>qe(!0),onStartTour:()=>qe(!0),sampleQueries:["beach sunset","birthday cake","mountain hike","red car"],onRunSample:x=>We(x)}),e.jsx(Kl,{onSelectDirectory:()=>xe({kind:"folder"}),onImport:()=>{},onHelp:()=>qe(!0)})]});return e.jsx(rc,{children:e.jsx(Lc,{children:(z.pathname||"").startsWith("/share/")?e.jsx(Ol,{}):(z.pathname||"").startsWith("/mobile-test")?e.jsx(Wl,{}):e.jsxs("div",{className:"flex h-screen bg-white dark:bg-gray-950 dark:text-gray-100",children:[e.jsx(ic,{}),me&&e.jsx(ql,{onStartDemo:async()=>{const x="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";R.setDir(x),$.setShowWelcome(!1);try{await tt(x),await ut()}catch(g){console.error("Failed to add demo path or index:",g),$.setNote(g instanceof Error?g.message:"Failed to setup demo")}},onSelectFolder:()=>{xe({kind:"folder"}),$.setShowWelcome(!1)},onClose:()=>$.setShowWelcome(!1)}),e.jsx(Hl,{open:!s&&jn,onClose:()=>{wt(!1),localStorage.setItem("hasSeenOnboarding","true")},onQuickStart:async x=>{try{const g=[];for(const I of x)try{const q=await fetch(`${he}/scan_count`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([I])});q.ok&&(await q.json()).items?.[0]?.exists&&g.push(I)}catch{}if(g.length===0){wt(!1),localStorage.setItem("hasSeenOnboarding","true");return}R.setDir(g[0]);for(const I of g){try{await tt(I)}catch{}(async()=>{try{await Dt(I,r,24,h?n:void 0,v?i:void 0)}catch{}})()}wt(!1),localStorage.setItem("hasSeenOnboarding","true")}catch(g){$.setNote(g instanceof Error?g.message:"Quick start failed")}},onCustom:()=>{xe({kind:"folder"}),wt(!1),localStorage.setItem("hasSeenOnboarding","true")},onDemo:async()=>{try{const x="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";R.setDir(x),await tt(x),await ut()}catch(x){$.setNote(x instanceof Error?x.message:"Demo setup failed")}wt(!1),localStorage.setItem("hasSeenOnboarding","true")},onTour:()=>{qe(!0)}}),e.jsx(ac,{selectedView:J,onViewChange:x=>L(x),library:M,favorites:T,collections:Object.keys(F||{}),clusters:ie,savedSearches:Z,smart:Object.keys(K||{}),trips:_,isOpen:gn,onClose:()=>va(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(hc,{searchText:Q,setSearchText:re,onSearch:We,clusters:ie,allTags:m,meta:wa,diag:Y,busy:!!se,gridSize:oe,setGridSize:X,selectedView:J,setSelectedView:x=>L(x),currentFilter:zt,setCurrentFilter:Ut,ratingMin:it,setRatingMin:Tn,setModal:x=>xe(x),setIsMobileMenuOpen:va,setShowFilters:ze,selected:ue,setSelected:Ne,dir:s,engine:r,topK:O,useOsTrash:p,showInfoOverlay:lt,onToggleInfoOverlay:()=>R.setShowInfoOverlay?R.setShowInfoOverlay(!lt):void 0,resultView:ye,onChangeResultView:x=>R.setResultView?.(x),timelineBucket:Pe,onChangeTimelineBucket:x=>R.setTimelineBucket?.(x),photoActions:H,uiActions:$,toastTimerRef:qt,setToast:Ae,isIndexing:Nt,onIndex:ut,activeJobs:xs.filter(x=>x.status==="running").length,onOpenJobs:()=>xe({kind:"jobs"}),progressPct:wn,etaSeconds:kt,paused:Nn,tooltip:kn,ocrReady:Cn,onPause:async()=>{try{const{apiIndexPause:x}=await pe(async()=>{const{apiIndexPause:g}=await Promise.resolve().then(()=>ge);return{apiIndexPause:g}},void 0,import.meta.url);await x(s)}catch{}},onResume:async()=>{try{const{apiIndexResume:x}=await pe(async()=>{const{apiIndexResume:g}=await Promise.resolve().then(()=>ge);return{apiIndexResume:g}},void 0,import.meta.url);await x(s)}catch{}},onOpenThemeModal:()=>ka(!0)}),Pn&&e.jsx("div",{className:"px-4 pt-2",children:e.jsxs("div",{className:"sticky top-0 z-20 bg-yellow-50 text-yellow-800 border border-yellow-200 rounded px-3 py-1 text-xs flex items-center justify-between",children:[e.jsxs("span",{children:["Press ",e.jsx("span",{className:"font-mono",children:"?"})," for help and shortcuts"]}),e.jsx("button",{type:"button",className:"text-yellow-800 hover:text-yellow-900","aria-label":"Dismiss help hint",onClick:()=>{In(!1);try{localStorage.setItem("ps_hint_help_seen","1")}catch{}},children:""})]})}),e.jsxs("div",{className:"flex-1 overflow-auto",ref:ja,children:[J==="results"&&e.jsx(Qa,{sectionName:"Search Results",children:e.jsxs("div",{className:"p-4",children:[k&&k.length>0&&(Q||"").trim()&&e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[k.length," results"]}),e.jsx("button",{type:"button",className:"chip",title:"Save this search as a Smart Collection",onClick:async()=>{const x=(prompt("Save current search as Smart (name):")||"").trim();if(x)try{const g=(S||"").split(",").map(de=>de.trim()).filter(Boolean),I={query:(Q||"").trim(),favoritesOnly:N,tags:g,useCaptions:l,useOcr:d,hasText:f,camera:w||void 0,isoMin:j||void 0,isoMax:b||void 0,fMin:C||void 0,fMax:P||void 0,place:y||void 0},q=(ee||[]).filter(Boolean);q.length===1?I.person=q[0]:q.length>1&&(I.persons=q);const{apiSetSmart:D,apiGetSmart:te}=await pe(async()=>{const{apiSetSmart:de,apiGetSmart:fe}=await Promise.resolve().then(()=>ge);return{apiSetSmart:de,apiGetSmart:fe}},void 0,import.meta.url);await D(s,x,I);try{const de=await te(s);H.setSmart(de.smart||{})}catch{}$.setNote(`Saved smart collection: ${x}`)}catch(g){$.setNote(g?.message||"Failed to save smart collection")}},children:"Save as Smart Collection"})]}),k&&k.length===0&&Q?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(Ss,{type:"no-results",searchQuery:Q,onAction:()=>{re(""),H.setQuery("")},onOpenFilters:()=>ze(!0),onOpenAdvanced:()=>xe({kind:"advanced"}),onClearSearch:()=>{N&&H.setFavOnly(!1),S&&H.setTagFilter(""),us(""),hs(""),R.setPlace(""),R.setCamera(""),R.setIsoMin(0),R.setIsoMax(0),R.setFMin(0),R.setFMax(0),R.setHasText(!1),G.setPersons([])},hasActiveFilters:On,sampleQueries:["golden hour","city skyline","family dinner","blue car"],onRunSample:x=>We(x),onOpenHelp:()=>qe(!0)}),e.jsx(Ga,{onSearch:We})]}):ye==="grid"?e.jsx(rn,{dir:s,engine:r,items:(k||[]).map(x=>({path:x.path,score:x.score})),selected:ue,onToggleSelect:Ct,onOpen:x=>Pa(x),scrollContainerRef:ja,focusIndex:be??void 0,onLayout:x=>pn(g=>yn(g,x)?g:x),ratingMap:js,showInfoOverlay:lt}):e.jsx(Ul,{dir:s,engine:r,items:(k||[]).map(x=>({path:x.path,score:x.score})),selected:ue,onToggleSelect:Ct,onOpen:x=>Pa(x),showInfoOverlay:lt,bucket:Pe})]})}),J==="library"&&e.jsx(Qa,{sectionName:"Library",children:e.jsx(Vn,{})}),J==="people"&&e.jsx("div",{className:"p-4",children:e.jsx(_l,{dir:s,engine:r,clusters:ie||[],persons:ee,setPersons:G.setPersons,busy:se,setBusy:$.setBusy,setNote:$.setNote,onLoadFaces:Ns,onOpenPhotos:x=>{H.setResults(x.map(g=>({path:g,score:0}))),L("results"),$.setNote(`Viewing ${x.length} photos from face cluster`)}})}),J==="map"&&e.jsx("div",{className:"p-4",children:e.jsx(Fl,{points:V||[],onLoadMap:An})}),J==="collections"&&e.jsx("div",{className:"p-4",children:e.jsx(Dl,{dir:s,engine:r,collections:F,onLoadCollections:async()=>{const{apiGetCollections:x}=await pe(async()=>{const{apiGetCollections:I}=await Promise.resolve().then(()=>ge);return{apiGetCollections:I}},void 0,import.meta.url),g=await x(s);H.setCollections(g.collections||{})},onOpen:x=>{const g=F?.[x]||[];H.setResults(g.map(I=>({path:I,score:0}))),L("results"),$.setNote(`${g.length} in ${x}`)},onDelete:async x=>{try{const{apiDeleteCollection:g,apiGetCollections:I}=await pe(async()=>{const{apiDeleteCollection:D,apiGetCollections:te}=await Promise.resolve().then(()=>ge);return{apiDeleteCollection:D,apiGetCollections:te}},void 0,import.meta.url);await g(s,x);const q=await I(s);H.setCollections(q.collections||{}),Ae({message:`Deleted collection ${x}`})}catch(g){$.setNote(g instanceof Error?g.message:"Delete failed")}}})}),J==="saved"&&e.jsxs("div",{className:"p-4",children:[e.jsx(Ll,{saved:U,onRun:(x,g,I)=>{re(g),I&&H.setTopK(I),We(g)},onDelete:async x=>{try{const{apiDeleteSaved:g,apiGetSaved:I}=await pe(async()=>{const{apiDeleteSaved:D,apiGetSaved:te}=await Promise.resolve().then(()=>ge);return{apiDeleteSaved:D,apiGetSaved:te}},void 0,import.meta.url);await g(s,x);const q=await I(s);H.setSaved(q.saved||[])}catch(g){$.setNote(g instanceof Error?g.message:"Delete failed")}}}),e.jsxs("div",{className:"mt-4 bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Presets"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:ct,children:"Refresh"}),e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:()=>{try{const x=JSON.stringify(ys||[],null,2),g=new Blob([x],{type:"application/json"}),I=URL.createObjectURL(g),q=document.createElement("a");q.href=I,q.download="photo-search-presets.json",document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(I)}catch{}},children:"Export"}),e.jsxs("label",{className:"px-2 py-1 rounded border cursor-pointer",children:["Import",e.jsx("input",{type:"file",accept:"application/json",className:"hidden",onChange:async x=>{const g=x.target.files?.[0];if(g)try{const I=await g.text(),q=JSON.parse(I);if(Array.isArray(q)){const{apiAddPreset:D}=await pe(async()=>{const{apiAddPreset:te}=await Promise.resolve().then(()=>ge);return{apiAddPreset:te}},void 0,import.meta.url);for(const te of q)te&&typeof te.name=="string"&&typeof te.query=="string"&&await D(s,te.name,te.query);await ct(),Ae({message:`Imported ${q.length} preset(s)`})}else $.setNote("Invalid JSON format")}catch{$.setNote("Import failed")}finally{x.currentTarget.value=""}}})]})]})]}),ys.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No presets yet. Use Advanced Search to create one."}):e.jsx("div",{className:"mt-2 divide-y",children:ys.map(x=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:x.name,children:x.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:x.query,children:x.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{re(x.query),Ea(x.query)},className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{type:"button",onClick:async()=>{try{const{apiDeletePreset:g}=await pe(async()=>{const{apiDeletePreset:I}=await Promise.resolve().then(()=>ge);return{apiDeletePreset:I}},void 0,import.meta.url);await g(s,x.name),await ct()}catch{}},className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},x.name))})]})]}),J==="memories"&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"font-semibold",children:"Recent Favorites"})}),T.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No favorites yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:T.slice(0,24).map(x=>e.jsx("img",{src:ke(s,r,x,196),alt:Bc(x),className:"w-full h-24 object-cover rounded"},x))})]}),e.jsx("div",{children:e.jsx(Ka,{dir:s,engine:r,setBusy:$.setBusy,setNote:$.setNote,setResults:H.setResults})})]}),J==="tasks"&&e.jsx("div",{className:"p-4",children:e.jsx(zl,{})}),J==="smart"&&e.jsx("div",{className:"p-4",children:e.jsx(Rl,{dir:s,engine:r,topK:O,smart:K,setSmart:H.setSmart,setResults:H.setResults,setSearchId:H.setSearchId,setNote:$.setNote,query:E,favOnly:N,tagFilter:S,useCaps:l,useOcr:d,hasText:f,camera:w,isoMin:String(j||""),isoMax:String(b||""),fMin:String(C||""),fMax:String(P||""),place:y,persons:ee})}),J==="trips"&&e.jsx("div",{className:"p-4",children:e.jsx(Ka,{dir:s,engine:r,setBusy:$.setBusy,setNote:$.setNote,setResults:H.setResults})}),J==="videos"&&e.jsx("div",{className:"p-4",children:e.jsx(pc,{currentDir:s,provider:r})})]}),e.jsx(mc,{items:Ln,note:B,diag:Y,engine:r}),e.jsx(sc,{show:nt,onClose:()=>ze(!1),onApply:()=>{ze(!1),We(Q)},favOnly:N,setFavOnly:H.setFavOnly,tagFilter:S,setTagFilter:H.setTagFilter,camera:w,setCamera:R.setCamera,isoMin:String(j||""),setIsoMin:x=>R.setIsoMin(parseFloat(x)||0),isoMax:String(b||""),setIsoMax:x=>R.setIsoMax(parseFloat(x)||0),dateFrom:Ue,setDateFrom:us,dateTo:Be,setDateTo:hs,fMin:String(C||""),setFMin:x=>R.setFMin(parseFloat(x)||0),fMax:String(P||""),setFMax:x=>R.setFMax(parseFloat(x)||0),place:y,setPlace:R.setPlace,useCaps:l,setUseCaps:R.setUseCaps,useOcr:d,setUseOcr:R.setUseOcr,hasText:f,setHasText:R.setHasText}),Se?.kind==="shareManage"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:x=>{x.key==="Escape"&&xe(null)},children:e.jsx(Za,{onEscape:()=>xe(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"Manage Shares"}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>xe(null),children:"Close"})]}),e.jsx(Xl,{dir:s})]})})}),Se?.kind==="export"&&e.jsx(bc,{selected:ue,dir:s,onClose:()=>xe(null),uiActions:$}),Se?.kind==="enhanced-share"&&e.jsx(Oc,{selected:ue,dir:s,onClose:()=>xe(null),uiActions:$}),Se?.kind==="share"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:x=>{x.key==="Escape"&&xe(null)},children:e.jsx(Za,{onEscape:()=>xe(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Share (v1)"}),e.jsxs("form",{onSubmit:async x=>{if(x.preventDefault(),!s)return;const g=Array.from(ue);if(g.length===0){alert("Select photos to share");return}const I=x.target,q=parseInt(I.elements.namedItem("expiry").value||"24",10),D=I.elements.namedItem("pw").value.trim(),te=I.elements.namedItem("viewonly").checked;try{const{apiCreateShare:de}=await pe(async()=>{const{apiCreateShare:ve}=await Promise.resolve().then(()=>ge);return{apiCreateShare:ve}},void 0,import.meta.url),fe=await de(s,r,g,{expiryHours:Number.isNaN(q)?24:q,password:D||void 0,viewOnly:te});await navigator.clipboard.writeText(window.location.origin+fe.url),$.setNote("Share link copied to clipboard")}catch(de){$.setNote(de instanceof Error?de.message:"Share failed")}xe(null)},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"expiry-input",children:"Expiry (hours)"}),e.jsx("input",{id:"expiry-input",name:"expiry",type:"number",min:1,defaultValue:24,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"pw-input",children:"Password (optional)"}),e.jsx("input",{id:"pw-input",name:"pw",type:"password",className:"w-full border rounded px-2 py-1",placeholder:""})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"viewonly",defaultChecked:!0})," ","View-only (disable downloads)"]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>xe(null),"aria-label":"Cancel sharing",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Create shareable link",children:"Create Link"})]})]})]})})}),Se?.kind==="tag"&&e.jsx(vc,{onClose:()=>xe(null),onTagSelected:qn}),Se?.kind==="folder"&&e.jsx(Nc,{dir:s,useOsTrash:p,useFast:u,fastKind:c,useCaps:l,useOcr:d,hasText:f,highContrast:ws,onClose:()=>xe(null),settingsActions:{...R,setHighContrast:()=>{}},uiActions:$,doIndex:ut,prepareFast:x=>zn(x),buildOCR:Un,buildMetadata:Bn}),Se?.kind==="likeplus"&&e.jsx(Sc,{selected:ue,dir:s,engine:r,topK:O,onClose:()=>xe(null),setSelectedView:x=>L(x),photoActions:H,uiActions:$}),Se?.kind==="save"&&e.jsx(Tc,{dir:s,searchText:Q,query:E,topK:O,onClose:()=>xe(null),setSelectedView:x=>L(x),photoActions:H,uiActions:$}),Se?.kind==="collect"&&e.jsx(Pc,{selected:ue,dir:s,collections:F,onClose:()=>xe(null),setToast:Ae,photoActions:H,uiActions:$}),Se?.kind==="removeCollect"&&e.jsx($c,{selected:ue,dir:s,collections:F,onClose:()=>xe(null),setToast:Ae,photoActions:H,uiActions:$}),we!==null&&k&&k[we]&&(Oe.isVideoFile(k[we].path)?e.jsx($l,{videoPath:k[we].path,videoUrl:`/api/media/${encodeURIComponent(k[we].path)}`,onPrevious:()=>Xe(-1),onNext:()=>Xe(1),onClose:()=>Qe(null)}):e.jsx(Il,{dir:s,engine:r,path:k[we].path,currentIndex:we,totalCount:k.length,onPrev:()=>Xe(-1),onNext:()=>Xe(1),onClose:()=>Qe(null),onReveal:async()=>{try{const{apiOpen:x}=await pe(async()=>{const{apiOpen:I}=await Promise.resolve().then(()=>ge);return{apiOpen:I}},void 0,import.meta.url),g=k&&we!==null?k[we]?.path:void 0;g&&await x(s,g)}catch{}},onFavorite:async()=>{try{const x=k&&we!==null?k[we]?.path:void 0;x&&(await $t(s,x,!T.includes(x)),await Je())}catch{}},onMoreLikeThis:async()=>{try{const{apiSearchLike:x}=await pe(async()=>{const{apiSearchLike:q}=await Promise.resolve().then(()=>ge);return{apiSearchLike:q}},void 0,import.meta.url),g=k&&we!==null?k[we]?.path:void 0;if(!g)return;$.setBusy("Searching similar");const I=await x(s,g,r,O);H.setResults(I.results||[]),L("results")}catch(x){$.setNote(x instanceof Error?x.message:"Search failed")}finally{$.setBusy("")}}})),e.jsx("button",{type:"button",onClick:()=>xe({kind:"jobs"}),className:"fixed bottom-4 right-4 bg-blue-600 text-white rounded-full shadow px-4 py-2",title:"Open Jobs","aria-label":"Open the jobs panel",children:"Jobs"}),Se?.kind==="jobs"&&e.jsx(Bl,{open:!0,onClose:()=>xe(null)}),Se?.kind==="advanced"&&e.jsx(gc,{open:!0,onClose:()=>xe(null),onApply:x=>{re(x),Ea(x),xe(null)},onSave:async(x,g)=>{try{const{apiAddPreset:I}=await pe(async()=>{const{apiAddPreset:q}=await Promise.resolve().then(()=>ge);return{apiAddPreset:q}},void 0,import.meta.url);await I(s,x,g),Ae({message:`Saved preset ${x}`}),await ct()}catch(I){$.setNote(I instanceof Error?I.message:"Save failed")}},allTags:m||[],cameras:wa?.cameras||[],people:(ie||[]).filter(x=>x.name).map(x=>String(x.name))}),e.jsx(Fc,{isOpen:xn,onClose:()=>qe(!1),initialSection:"getting-started"}),e.jsx(Uc,{isOpen:En,onClose:()=>ka(!1)}),!!se&&e.jsx("div",{className:"fixed inset-0 z-[1050] bg-black/40 flex items-center justify-center",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-sm",children:[e.jsx(ln,{size:"lg",message:se,className:"text-center"}),B&&e.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300 text-center",children:B})]})}),ot&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-[1070]",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"flex items-center gap-3 bg-gray-900 text-white px-4 py-2 rounded shadow",children:[e.jsx("span",{className:"text-sm",children:ot.message}),ot.actionLabel&&ot.onAction&&e.jsx("button",{type:"button",className:"text-sm underline",onClick:ot.onAction,children:ot.actionLabel}),e.jsx("button",{type:"button","aria-label":"Close notification",className:"ml-1",onClick:()=>{Ae(null),qt.current&&(window.clearTimeout(qt.current),qt.current=null)},children:""})]})}),e.jsx(Ql,{photoCount:M?.length||0,indexedCount:M?.length||0,searchProvider:r,isIndexing:Nt,isConnected:!0,currentDirectory:s,activeJobs:xs.filter(x=>x.status==="running").length}),e.jsx(Jl,{jobs:xs,onPause:x=>{Le(g=>g.map(I=>I.id===x?{...I,status:"paused"}:I))},onResume:x=>{Le(g=>g.map(I=>I.id===x?{...I,status:"running"}:I))},onCancel:x=>{Le(g=>g.map(I=>I.id===x?{...I,status:"cancelled"}:I))},onRetry:x=>{Le(g=>g.map(I=>I.id===x?{...I,status:"queued"}:I))},onClear:x=>{Le(g=>g.filter(I=>I.id!==x))},onClearAll:()=>{Le(x=>x.filter(g=>g.status==="running"||g.status==="queued"))}}),e.jsx(xc,{activeTab:fn,onTabChange:x=>{switch(bn(x),x){case"home":L("library");break;case"search":L("results");break;case"favorites":L("results"),H.setFavOnly(!0);break;case"settings":L("tasks");break}},onShowFilters:()=>ze(!0),onShowUpload:()=>xe({kind:"folder"}),onShowLibrary:()=>xe({kind:"folder"}),showSecondaryActions:!0})]}),e.jsx(Gl,{isVisible:Fn,onDismiss:()=>Sa(!1),context:J,userActions:St}),e.jsx(Yl,{isVisible:Dn,onComplete:()=>{Ca(!1);try{localStorage.setItem("onboardingComplete","true")}catch{}},completedSteps:Mn,inProgressStepId:Nt?"index_photos":void 0,onStepComplete:()=>{},onStepAction:x=>{switch(x){case"select_directory":{L("library"),xe({kind:"folder"});break}case"index_photos":{L("library"),s?ut():xe({kind:"folder"});break}case"first_search":{L("results"),Ae({message:"Try searching: beach sunset, birthday cake, mountain hike"});break}case"explore_features":{L("collections"),Ae({message:"Explore collections, favorites, and sharing"});break}}}}),e.jsx(un,{})]})})})}const Vc=({darkMode:a=!1,onDarkModeToggle:t})=>{const[s,r]=o.useState("library"),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState(new Set),[p,f]=o.useState(!1),[y,w]=o.useState(null),[j,b]=o.useState(null),[C,P]=o.useState(!1),[S,m]=o.useState(!1),[h,v]=o.useState(0),[k,E]=o.useState("medium"),[T,N]=o.useState(!1),O=o.useRef(null);o.useEffect(()=>{U()},[]),o.useEffect(()=>{j&&Z()},[j]);const U=async()=>{try{const A=await ra();console.log("Workspace loaded:",A)}catch(A){console.error("Failed to load workspace:",A)}},Z=async()=>{if(j){f(!0),w(null);try{console.log("Loading library from:",j);const A=await At(j);if(!A||!A.images)throw new Error("No images found in the selected folder");const ee=A.images.map((ie,V)=>({id:`photo-${V}`,path:ie,thumbnail:ke(ie),title:ie.split("/").pop()?.split(".")[0]||"Untitled",date:new Date().toLocaleDateString(),type:ie.split(".").pop()?.toLowerCase()}));c(ee),w(null),console.log(`Loaded ${ee.length} photos`)}catch(A){console.error("Failed to load library:",A),w(A.message||"Failed to load photos from the selected folder"),c([])}finally{f(!1)}}},F=async A=>{if(A.preventDefault(),!!n.trim()){f(!0);try{const ee=await ls(n,20);if(ee&&ee.results){const ie=ee.results.map((V,Y)=>({id:`search-${Y}`,path:V.image,thumbnail:ke(V.image),title:V.image.split("/").pop()?.split(".")[0],score:V.score}));c(ie)}}catch(ee){console.error("Search failed:",ee)}finally{f(!1)}}},K=async()=>{if(window.electronAPI)try{const A=await window.electronAPI.selectFolder();A&&await M(A)}catch(A){console.error("Failed to select folder:",A)}else O.current?.click()},_=async A=>{const ee=A.target.files;if(ee&&ee.length>0){const ie=ee[0].webkitRelativePath?.split("/")[0];if(ie){const V=`/Users/pranay/Desktop/${ie}`;await M(V)}}},M=async A=>{try{console.log("Adding path:",A),await tt(A),b(A),w(null)}catch(ee){console.error("Failed to add path:",ee),w("Failed to add the selected folder")}},W=A=>{const ee=new Set(l);ee.has(A.id)?ee.delete(A.id):ee.add(A.id),d(ee)},se=A=>{v(A),m(!0)},B=[{id:"library",label:"Library",icon:bt},{id:"memories",label:"Memories",icon:Ot},{id:"people",label:"People",icon:Ye},{id:"places",label:"Places",icon:dr},{id:"recent",label:"Recent",icon:ft}],me=s==="memories"?u.filter(A=>A.favorite):u;return e.jsxs("div",{className:`flex h-screen ${a?"dark":""}`,style:{background:"var(--bg-primary)"},children:[e.jsxs("div",{className:`sidebar ${T?"w-16":""}`,style:{width:T?"64px":"260px"},children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[!T&&e.jsx("h1",{className:"text-title",style:{fontSize:"1.25rem",fontWeight:600},children:"Photos"}),e.jsx("button",{onClick:()=>N(!T),className:"btn-ghost",style:{padding:"8px"},children:T?e.jsx(De,{size:18}):e.jsx(Es,{size:18})})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[!T&&e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"LIBRARY"}),B.map(A=>{const ee=A.icon;return e.jsxs("div",{onClick:()=>r(A.id),className:`nav-item ${s===A.id?"active":""}`,style:{justifyContent:T?"center":"flex-start",padding:T?"12px":"10px 16px"},children:[e.jsx(ee,{size:20}),!T&&e.jsx("span",{children:A.label})]},A.id)})]}),!T&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"ALBUMS"}),e.jsxs("div",{className:"nav-item",children:[e.jsx(Ra,{size:20}),e.jsx("span",{children:"All Albums"})]}),e.jsxs("div",{className:"nav-item",children:[e.jsx(Jt,{size:20}),e.jsx("span",{children:"Favorites"})]})]})]}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid var(--border-subtle)"},children:[e.jsx("button",{onClick:K,className:"btn btn-primary",style:{width:"100%",justifyContent:"center",fontSize:T?"0":"14px",padding:T?"12px":"10px 16px"},children:T?e.jsx(xt,{size:20}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{size:18}),e.jsx("span",{children:"Import Photos"})]})}),e.jsx("input",{ref:O,type:"file",webkitdirectory:"",directory:"",multiple:!0,onChange:_,style:{display:"none"}}),!T&&e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[e.jsx("button",{onClick:()=>P(!C),className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{onClick:t,className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:a?e.jsx(_s,{size:18}):e.jsx(cr,{size:18})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",style:{background:"var(--bg-primary)"},children:[e.jsx("header",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-subtle)",background:"var(--bg-primary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("form",{onSubmit:F,className:"search-bar",style:{maxWidth:"500px"},children:[e.jsx(Te,{size:18,style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)",color:"var(--text-tertiary)"}}),e.jsx("input",{type:"text",value:n,onChange:A=>i(A.target.value),placeholder:"Search photos...",className:"search-input"})]}),e.jsxs("div",{className:"flex items-center gap-12px",children:[l.size>0&&e.jsxs("div",{className:"flex items-center gap-8px",style:{marginRight:"16px"},children:[e.jsxs("span",{className:"text-caption",style:{color:"var(--text-secondary)"},children:[l.size," selected"]}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(rs,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(_e,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px",color:"var(--error)"},children:e.jsx(Ke,{size:16})})]}),e.jsx("div",{className:"flex items-center gap-4px",style:{padding:"4px",background:"var(--bg-tertiary)",borderRadius:"var(--radius-md)"},children:["small","medium","large"].map(A=>e.jsx("button",{onClick:()=>E(A),style:{padding:"6px 12px",background:k===A?"var(--bg-primary)":"transparent",border:"none",borderRadius:"var(--radius-sm)",color:k===A?"var(--text-primary)":"var(--text-secondary)",fontSize:"12px",fontWeight:500,cursor:"pointer",transition:"all var(--transition-fast)"},children:A.charAt(0).toUpperCase()+A.slice(1)},A))})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto",style:{padding:"24px"},children:[p&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse",style:{marginBottom:"16px"},children:e.jsx(Rt,{size:48,style:{color:"var(--text-tertiary)"}})}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)"},children:"Loading photos..."})]})}),y&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",style:{maxWidth:"400px"},children:[e.jsx(st,{size:48,style:{color:"var(--error)",marginBottom:"16px"}}),e.jsx("p",{className:"text-body",style:{color:"var(--error)",marginBottom:"24px"},children:y}),e.jsx("button",{onClick:K,className:"btn btn-primary",children:"Select Another Folder"})]})}),!p&&!y&&u.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ra,{size:64,style:{color:"var(--text-tertiary)",marginBottom:"24px"}}),e.jsx("h2",{className:"text-headline",style:{marginBottom:"12px",fontSize:"24px"},children:"No photos yet"}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)",marginBottom:"32px"},children:"Import your photos to get started"}),e.jsxs("button",{onClick:K,className:"btn btn-primary",style:{fontSize:"16px",padding:"12px 32px"},children:[e.jsx(xt,{size:20}),"Select Photo Folder"]})]})}),!p&&!y&&u.length>0&&e.jsx("div",{className:"photo-grid",style:{gridTemplateColumns:k==="small"?"repeat(auto-fill, minmax(150px, 1fr))":k==="large"?"repeat(auto-fill, minmax(300px, 1fr))":"repeat(auto-fill, minmax(200px, 1fr))",gap:k==="small"?"4px":"8px"},children:me.map((A,ee)=>e.jsxs("div",{className:"photo-item",onClick:()=>se(ee),style:{borderRadius:k==="small"?"4px":"8px",position:"relative"},children:[A.thumbnail?e.jsx("img",{src:A.thumbnail,alt:A.title,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{className:"skeleton",style:{width:"100%",height:"100%"}}),e.jsx("div",{onClick:ie=>{ie.stopPropagation(),W(A)},style:{position:"absolute",top:"8px",left:"8px",width:"24px",height:"24px",borderRadius:"50%",background:l.has(A.id)?"var(--accent-primary)":"rgba(255, 255, 255, 0.9)",border:l.has(A.id)?"none":"2px solid rgba(255, 255, 255, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",opacity:l.has(A.id)?1:0,transition:"opacity var(--transition-fast)"},className:"photo-select",children:l.has(A.id)&&e.jsx(gt,{size:14,style:{color:"white"}})})]},A.id))})]})]}),S&&u[h]&&e.jsxs("div",{onClick:()=>m(!1),style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"var(--z-modal)"},children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),m(!1)},style:{position:"absolute",top:"24px",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(je,{size:20})}),h>0&&e.jsx("button",{onClick:A=>{A.stopPropagation(),v(h-1)},style:{position:"absolute",left:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(Es,{size:20})}),h<u.length-1&&e.jsx("button",{onClick:A=>{A.stopPropagation(),v(h+1)},style:{position:"absolute",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(De,{size:20})}),e.jsx("img",{src:u[h].path,alt:u[h].title,style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain"},onClick:A=>A.stopPropagation()})]}),e.jsx("style",{jsx:!0,children:`
        .photo-item:hover .photo-select {
          opacity: 1 !important;
        }
      `})]})},Hc=()=>{const[a,t]=o.useState(()=>{const r=localStorage.getItem("darkMode");return r!==null?r==="true":window.matchMedia("(prefers-color-scheme: dark)").matches});o.useEffect(()=>{a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",a.toString())},[a]);const s=()=>{t(r=>!r)};return e.jsx(wl,{children:e.jsx(Vc,{darkMode:a,onDarkModeToggle:s})})};function Wc(){return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Test App"}),e.jsx("p",{children:"This is a minimal test to see if React is working."})]})}function Kc(){const[a,t]=o.useState([]),[s,r]=o.useState(null),[n,i]=o.useState("grid"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[p,f]=o.useState([]),[y,w]=o.useState(!1),j=Me();o.useEffect(()=>{b()},[]);const b=async()=>{w(!0);try{const h=await j.getCollections(),v=Object.entries(h.collections).map(([k,E])=>({name:k,paths:E,count:E.length,preview:E[0]}));t(v)}catch(h){console.error("Failed to load collections:",h)}finally{w(!1)}},C=async()=>{if(l.trim())try{await j.setCollection(l,p),await b(),c(!1),d(""),f([])}catch(h){console.error("Failed to create collection:",h)}},P=async h=>{if(confirm(`Delete collection "${h}"?`))try{await j.deleteCollection(h),await b(),s===h&&r(null)}catch(v){console.error("Failed to delete collection:",v)}},S=({collection:h})=>e.jsxs("div",{className:"collection-card",onClick:()=>r(h.name),children:[e.jsxs("div",{className:"collection-preview",children:[h.preview&&e.jsx("img",{src:j.getThumbnailUrl(h.preview),alt:h.name}),e.jsx("div",{className:"collection-overlay",children:e.jsx(bt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"collection-info",children:[e.jsx("h3",{children:h.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[h.count," items"]})]}),e.jsx("div",{className:"collection-actions",children:e.jsx("button",{onClick:v=>{v.stopPropagation(),P(h.name)},className:"btn-icon",children:e.jsx(Ke,{className:"w-4 h-4"})})})]}),m=({collection:h})=>e.jsxs("div",{className:"collection-list-item",onClick:()=>r(h.name),children:[e.jsx(De,{className:"w-4 h-4 text-gray-400"}),e.jsx(Ps,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:h.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[h.count," items"]})]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),P(h.name)},className:"btn-icon",children:e.jsx(Ke,{className:"w-4 h-4"})})]});return e.jsxs("div",{className:"collections-manager",children:[e.jsxs("div",{className:"manager-header",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Collections"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{onClick:()=>i("grid"),className:n==="grid"?"active":"",children:e.jsx(bt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i("list"),className:n==="list"?"active":"",children:e.jsx(lr,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary",children:[e.jsx(rr,{className:"w-4 h-4"}),"New Collection"]})]})]}),u&&e.jsxs("div",{className:"create-collection-panel",children:[e.jsx("input",{type:"text",placeholder:"Collection name...",value:l,onChange:h=>d(h.target.value),className:"input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"btn btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>{c(!1),d("")},className:"btn btn-secondary",children:"Cancel"})]})]}),y?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading collections..."})]}):e.jsx("div",{className:n==="grid"?"collections-grid":"collections-list",children:a.map(h=>n==="grid"?e.jsx(S,{collection:h},h.name):e.jsx(m,{collection:h},h.name))}),e.jsx("style",{jsx:!0,children:`
        .collections-manager {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .manager-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .view-toggle {
          display: flex;
          gap: 0.25rem;
          padding: 0.25rem;
          background: var(--bg-tertiary);
          border-radius: var(--radius-md);
        }

        .view-toggle button {
          padding: 0.5rem;
          background: transparent;
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .view-toggle button.active {
          background: var(--bg-primary);
          color: var(--accent-primary);
        }

        .create-collection-panel {
          background: var(--bg-secondary);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          margin-bottom: 2rem;
          display: flex;
          gap: 1rem;
          align-items: center;
        }

        .collections-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 1.5rem;
        }

        .collection-card {
          background: var(--bg-elevated);
          border-radius: var(--radius-lg);
          overflow: hidden;
          cursor: pointer;
          transition: all 0.3s;
        }

        .collection-card:hover {
          transform: translateY(-4px);
          box-shadow: var(--shadow-lg);
        }

        .collection-preview {
          position: relative;
          aspect-ratio: 1;
          background: var(--bg-tertiary);
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .collection-preview img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .collection-overlay {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.5);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-sm);
        }

        .collection-info {
          padding: 1rem;
        }

        .collection-info h3 {
          font-weight: 600;
          margin-bottom: 0.25rem;
        }

        .collection-actions {
          padding: 0 1rem 1rem;
          display: flex;
          gap: 0.5rem;
        }

        .collections-list {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .collection-list-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-elevated);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .collection-list-item:hover {
          background: var(--bg-tertiary);
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--error);
          color: white;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 300px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Gc(){const[a,t]=o.useState([]),[s,r]=o.useState(null),[n,i]=o.useState(null),[u,c]=o.useState(""),[l,d]=o.useState(!1),[p,f]=o.useState(!1),[y,w]=o.useState({totalFaces:0,namedPeople:0}),j=Me();o.useEffect(()=>{b()},[]);const b=async()=>{d(!0);try{const m=await j.getFaceClusters();t(m.clusters);const h=m.clusters.reduce((k,E)=>k+E.size,0),v=m.clusters.filter(k=>k.name).length;w({totalFaces:h,namedPeople:v})}catch(m){console.error("Failed to load face clusters:",m)}finally{d(!1)}},C=async()=>{f(!0);try{const m=await j.buildFaces();console.log(`Built faces: ${m.faces} faces in ${m.clusters} clusters`),await b()}catch(m){console.error("Failed to build face index:",m)}finally{f(!1)}},P=async m=>{if(u.trim())try{await j.nameFaceCluster(m,u),await b(),i(null),c("")}catch(h){console.error("Failed to name cluster:",h)}},S=({cluster:m})=>e.jsxs("div",{className:`face-cluster-card ${s===m.id?"selected":""}`,onClick:()=>r(m.id),children:[e.jsx("div",{className:"cluster-header",children:n===m.id?e.jsxs("div",{className:"name-editor",children:[e.jsx("input",{type:"text",value:u,onChange:h=>c(h.target.value),placeholder:"Enter name...",className:"name-input",autoFocus:!0,onClick:h=>h.stopPropagation()}),e.jsx("button",{onClick:h=>{h.stopPropagation(),P(m.id)},className:"btn-icon",children:e.jsx(gt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),i(null),c("")},className:"btn-icon",children:e.jsx(je,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"cluster-name",children:m.name||`Person ${m.id.slice(0,8)}`}),e.jsx("button",{onClick:h=>{h.stopPropagation(),i(m.id),c(m.name||"")},className:"btn-icon",children:e.jsx(Ii,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"cluster-stats",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[m.size," photos"]})}),e.jsx("div",{className:"face-examples",children:m.examples.slice(0,4).map(([h,v],k)=>e.jsx("div",{className:"face-thumbnail",children:e.jsx("img",{src:j.getFaceThumbnailUrl(h,v,96),alt:`Face ${k+1}`})},k))})]});return e.jsxs("div",{className:"face-detection",children:[e.jsxs("div",{className:"detection-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ye,{className:"w-6 h-6"}),"People"]}),e.jsxs("p",{className:"text-gray-500 mt-1",children:[y.totalFaces," faces detected  ",y.namedPeople," people identified"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:C,disabled:p,className:"btn btn-secondary",children:[e.jsx(Hs,{className:`w-4 h-4 ${p?"animate-spin":""}`}),p?"Building...":"Rebuild Index"]})})]}),l?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading faces..."})]}):a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Ye,{className:"w-16 h-16 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mt-4",children:"No faces detected yet"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Build the face index to detect and group people in your photos"}),e.jsxs("button",{onClick:C,disabled:p,className:"btn btn-primary mt-4",children:[e.jsx(Pi,{className:"w-4 h-4"}),"Build Face Index"]})]}):e.jsx("div",{className:"clusters-grid",children:a.map(m=>e.jsx(S,{cluster:m},m.id))}),e.jsx("style",{jsx:!0,children:`
        .face-detection {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .detection-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .clusters-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 1.5rem;
        }

        .face-cluster-card {
          background: var(--bg-elevated);
          border: 2px solid transparent;
          border-radius: var(--radius-lg);
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.3s;
        }

        .face-cluster-card:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .face-cluster-card.selected {
          border-color: var(--accent-primary);
          box-shadow: 0 0 0 3px var(--accent-light);
        }

        .cluster-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.5rem;
        }

        .cluster-name {
          font-size: 1.125rem;
          font-weight: 600;
        }

        .name-editor {
          display: flex;
          gap: 0.5rem;
          width: 100%;
        }

        .name-input {
          flex: 1;
          padding: 0.25rem 0.5rem;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-sm);
          background: var(--bg-primary);
          font-size: 1rem;
        }

        .cluster-stats {
          margin-bottom: 1rem;
        }

        .face-examples {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 0.5rem;
        }

        .face-thumbnail {
          aspect-ratio: 1;
          border-radius: var(--radius-md);
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .face-thumbnail img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          text-align: center;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .animate-spin {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Yc(){const[a,t]=o.useState("library"),[s,r]=o.useState(null),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState([]),[p,f]=o.useState([]),[y,w]=o.useState([]),[j,b]=o.useState("/Users/pranay/Desktop"),[C,P]=o.useState(null),[S,m]=o.useState(!1),[h,v]=o.useState({});o.useEffect(()=>{const F={dir:j,provider:"openai",openaiKey:localStorage.getItem("openai_api_key")||"",hfToken:localStorage.getItem("hf_token")||""};gl(F),k()},[j]);const k=async()=>{const F=Me();try{const K=await F.getWorkspace();w(K.folders),await E();const _=await F.getFavorites();f(_.favorites)}catch(K){console.error("Failed to load initial data:",K)}},E=async()=>{m(!0);try{const K=await Me().getLibrary(120,0);d(K.paths)}catch(F){console.error("Failed to load library:",F)}finally{m(!1)}},T=async()=>{if(n.trim()){m(!0);try{const K=await Me().search(n,24);c(K.results),t("search")}catch(F){console.error("Search failed:",F)}finally{m(!1)}}},N=async F=>{m(!0);const K=Me();try{let _;switch(F){case"search":_=await K.buildIndex(32),console.log(`Indexed ${_.total} images`);break;case"faces":_=await K.buildFaces(),console.log(`Found ${_.faces} faces in ${_.clusters} clusters`);break;case"ocr":_=await K.buildOCR(["en"]),console.log(`Extracted text from ${_.updated} images`);break;case"metadata":_=await K.buildMetadata(),console.log(`Extracted metadata from ${_.updated} images`);break;case"captions":_=await K.buildCaptions("Salesforce/blip-image-captioning-large"),console.log(`Generated captions for ${_.updated} images`);break;case"trips":_=await K.buildTrips(),console.log(`Found ${_.trips.length} trips`);break;case"fast-annoy":_=await K.buildFastIndex("annoy");break;case"fast-faiss":_=await K.buildFastIndex("faiss");break;case"fast-hnsw":_=await K.buildFastIndex("hnsw");break}await E()}catch(_){console.error(`Failed to build ${F} index:`,_)}finally{m(!1)}},O=async()=>{const F=prompt("Enter folder path:");if(F)try{const _=await Me().addToWorkspace(F);w(_.folders)}catch(K){console.error("Failed to add workspace folder:",K)}},U=async()=>{m(!0);try{const K=await Me().runDiagnostics();P(K),t("diagnostics")}catch(F){console.error("Failed to run diagnostics:",F)}finally{m(!1)}},Z=()=>{switch(a){case"collections":return e.jsx(Kc,{});case"people":return e.jsx(Gc,{});case"editor":return s?e.jsx(nn,{imagePath:s,onClose:()=>t("library"),onSave:F=>console.log("Saved:",F)}):null;case"search":return e.jsxs("div",{className:"search-results",children:[e.jsxs("h2",{children:['Search Results for "',n,'"']}),e.jsx("div",{className:"photo-grid",children:u.map((F,K)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(F.path),t("editor")},children:[e.jsx("img",{src:Me().getThumbnailUrl(F.path),alt:""}),e.jsx("div",{className:"photo-score",children:F.score.toFixed(2)})]},K))})]});case"library":return e.jsxs("div",{className:"library-view",children:[e.jsxs("div",{className:"library-header",children:[e.jsx("h2",{children:"Photo Library"}),e.jsxs("span",{className:"text-gray-500",children:[l.length," photos"]})]}),e.jsx("div",{className:"photo-grid",children:l.map((F,K)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(F),t("editor")},children:[e.jsx("img",{src:Me().getThumbnailUrl(F),alt:""}),p.includes(F)&&e.jsx("div",{className:"favorite-badge",children:e.jsx(Jt,{className:"w-4 h-4",fill:"currentColor"})})]},K))})]});case"diagnostics":return e.jsxs("div",{className:"diagnostics-view",children:[e.jsx("h2",{children:"System Diagnostics"}),C&&e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Storage"}),e.jsxs("p",{children:[C.free_gb.toFixed(2)," GB free"]}),e.jsxs("p",{children:["OS: ",C.os]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Indexes"}),C.engines.map(F=>e.jsxs("div",{children:[e.jsxs("p",{children:[F.key,": ",F.count," items"]}),F.fast&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Fast: Annoy=",F.fast.annoy?"":"","FAISS=",F.fast.faiss?"":"","HNSW=",F.fast.hnsw?"":""]})]},F.key))]})]})]});default:return null}};return e.jsxs("div",{className:"app-container",children:[e.jsxs("div",{className:"sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h1",{className:"text-xl font-bold",children:"PhotoVault Pro"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All 47 APIs Integrated"})]}),e.jsx("div",{className:"search-section",children:e.jsx("input",{type:"text",placeholder:"Search photos...",value:n,onChange:F=>i(F.target.value),onKeyPress:F=>F.key==="Enter"&&T(),className:"search-input"})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:`nav-item ${a==="library"?"active":""}`,onClick:()=>t("library"),children:[e.jsx($i,{className:"w-5 h-5"}),"Library"]}),e.jsxs("div",{className:`nav-item ${a==="collections"?"active":""}`,onClick:()=>t("collections"),children:[e.jsx(bt,{className:"w-5 h-5"}),"Collections"]}),e.jsxs("div",{className:`nav-item ${a==="people"?"active":""}`,onClick:()=>t("people"),children:[e.jsx(Ye,{className:"w-5 h-5"}),"People"]}),e.jsxs("div",{className:`nav-item ${a==="places"?"active":""}`,onClick:()=>t("places"),children:[e.jsx(ns,{className:"w-5 h-5"}),"Places"]}),e.jsxs("div",{className:`nav-item ${a==="favorites"?"active":""}`,onClick:()=>t("favorites"),children:[e.jsx(Jt,{className:"w-5 h-5"}),"Favorites"]}),e.jsxs("div",{className:`nav-item ${a==="trips"?"active":""}`,onClick:()=>t("trips"),children:[e.jsx(dr,{className:"w-5 h-5"}),"Trips"]})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsx("h3",{className:"section-title",children:"Build Indexes"}),e.jsxs("button",{onClick:()=>N("search"),className:"index-btn",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Search Index"]}),e.jsxs("button",{onClick:()=>N("faces"),className:"index-btn",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Face Detection"]}),e.jsxs("button",{onClick:()=>N("ocr"),className:"index-btn",children:[e.jsx(Mi,{className:"w-4 h-4"}),"OCR Text"]}),e.jsxs("button",{onClick:()=>N("metadata"),className:"index-btn",children:[e.jsx(_t,{className:"w-4 h-4"}),"Metadata"]}),e.jsxs("button",{onClick:()=>N("captions"),className:"index-btn",children:[e.jsx(_i,{className:"w-4 h-4"}),"AI Captions"]})]}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsxs("button",{onClick:U,className:"nav-item",children:[e.jsx(Bs,{className:"w-5 h-5"}),"Diagnostics"]}),e.jsxs("button",{onClick:O,className:"nav-item",children:[e.jsx(Ge,{className:"w-5 h-5"}),"Add Folder"]})]})]}),e.jsxs("main",{className:"main-content",children:[S&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),Z()]}),e.jsx("style",{jsx:!0,children:`
        .app-container {
          display: flex;
          height: 100vh;
          background: var(--bg-primary);
        }

        .main-content {
          flex: 1;
          overflow-y: auto;
          position: relative;
        }

        .search-section {
          padding: 1rem;
        }

        .sidebar-section {
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .section-title {
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.75rem;
          text-transform: uppercase;
          letter-spacing: 0.05em;
        }

        .index-btn {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          width: 100%;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-md);
          font-size: 0.875rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .index-btn:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .sidebar-footer {
          margin-top: auto;
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .library-view, .search-results, .diagnostics-view {
          padding: 2rem;
        }

        .library-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .library-header h2 {
          font-size: 2rem;
          font-weight: 700;
        }

        .photo-item {
          position: relative;
        }

        .photo-score {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: var(--radius-sm);
          font-size: 0.75rem;
        }

        .favorite-badge {
          position: absolute;
          top: 0.5rem;
          right: 0.5rem;
          background: var(--warning);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-full);
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 1.5rem;
        }

        .stat-card {
          background: var(--bg-elevated);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          border: 1px solid var(--border-subtle);
        }

        .stat-card h3 {
          font-size: 1.125rem;
          font-weight: 600;
          margin-bottom: 1rem;
        }

        .loading-overlay {
          position: absolute;
          inset: 0;
          background: rgba(255, 255, 255, 0.9);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 100;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}const Qc=o.createContext(null);function Jc({children:a}){const t=Zr(),[s,r]=o.useState(""),[n,i]=o.useState([]),[u,c]=o.useState({favOnly:!1}),l=o.useCallback(y=>{c(w=>({...w,...y}))},[]),d=o.useCallback(y=>{i(y);try{t?.setResults?.(y)}catch{}},[t]),p=o.useCallback(y=>{r(y);try{t?.setQuery?.(y)}catch{}},[t]),f=o.useMemo(()=>({state:{query:s,results:n,filters:u},actions:{setQuery:p,setResults:d,setFilters:l}}),[s,n,u,p,d,l]);return e.jsx(Qc.Provider,{value:f,children:a})}const Xc=o.createContext(null);function Zc({children:a}){const t=Qr()||[],s=!!Jr(),[r,n]=o.useState(!1),i=Xr(),u=o.useCallback(async d=>{const p=d?.dir||i?.state?.dir,f=d?.provider||i?.state?.engine||"local";if(p)try{n(!0),await Dt(p,f)}finally{n(!1)}},[i]),c=o.useCallback(async d=>{const p=d?.dir||i?.state?.dir,f=d?.provider||i?.state?.engine||"local";p&&await At(p,f,d?.limit??120,d?.offset??0)},[i]),l=o.useMemo(()=>({state:{paths:t,hasMore:s,isIndexing:r},actions:{index:u,load:c}}),[t,s,r,u,c]);return e.jsx(Xc.Provider,{value:l,children:a})}const ed=o.createContext(null);function td({children:a}){const[t,s]=o.useState("local"),[r,n]=o.useState(!1),[i,u]=o.useState("faiss"),[c,l]=o.useState(!1),[d,p]=o.useState(!1),[f,y]=o.useState(60),w=o.useMemo(()=>({state:{engine:t,useFast:r,fastKind:i,useCaptions:c,useOcr:d,topK:f},actions:{setEngine:s,setUseFast:n,setFastKind:u,setUseCaptions:l,setUseOcr:p,setTopK:y}}),[t,r,i,c,d,f]);return e.jsx(ed.Provider,{value:w,children:a})}function sd({children:a}){return e.jsx(co,{children:e.jsx(wo,{children:e.jsx(td,{children:e.jsx(oc,{children:e.jsx(Zc,{children:e.jsx(Jc,{children:a})})})})})})}const ad={};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(a=>{console.log("ServiceWorker registered:",a.scope),setInterval(()=>{a.update()},6e4),a.addEventListener("updatefound",()=>{const t=a.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&confirm("New version available! Refresh to update?")&&window.location.reload()})})}).catch(a=>{console.error("ServiceWorker registration failed:",a)})});window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),console.log("App can be installed")});function rd(){const t=new URLSearchParams(window.location.search).get("ui")??ad?.VITE_UI??"modern";return t==="test"?e.jsx(Wc,{}):t==="new"?e.jsx(Hc,{}):t==="modular"?e.jsx(Yc,{}):e.jsx(qc,{})}hr(document.getElementById("root")).render(e.jsx(sd,{children:rd()}));
