var vi=Object.defineProperty;var ji=(s,t,a)=>t in s?vi(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var de=(s,t,a)=>ji(s,typeof t!="symbol"?t+"":t,a);import{j as e,P as pt,H as Gt,S as gs,D as He,R as Js,A as wi,a as Ni,b as ki,c as Si,C as Ci,M as gr,d as fr,X as $e,e as fs,f as ns,g as Bt,h as Ct,i as bs,k as Wa,l as Ga,V as br,m as Ws,I as ys,n as Ti,o as Ei,p as yr,F as Gs,G as Pi,T as ot,q as Ka,r as is,W as Xs,s as os,t as Ii,u as Ge,v as vs,w as $i,x as Mi,L as Fi,y as vr,z as jr,U as mt,B as Ie,E as js,J as ws,K as Tt,N as Et,O as rs,Q as Zs,Y as Pt,Z as ea,_ as Ht,$ as wr,a0 as Di,a1 as Ri,a2 as Ns,a3 as ta,a4 as sa,a5 as gt,a6 as Xe,a7 as aa,a8 as Nr,a9 as Oi,aa as kr,ab as _i,ac as ra,ad as na,ae as Sr,af as Ya,ag as Li,ah as Ai,ai as zi,aj as Ui,ak as Cr,al as lt,am as Vt,an as Ks,ao as Bi,ap as Qa,aq as Ja,ar as Hi,as as Xa,at as Vi,au as qi,av as Wi,aw as Gi,ax as ia,ay as Tr,az as Ki,aA as oa,aB as we,aC as Za,aD as Er,aE as ls,aF as la,aG as Yi,aH as Qi,aI as Pr,aJ as Ji,aK as er,aL as Xi,aM as Zi,aN as eo}from"./ui-C892Pmwo.js";import{a as to,r as o,b as so,R as ft}from"./vendor-DfJzhmxv.js";import{c as Ir}from"./utils-0qZyvErh.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var $r,tr=to;$r=tr.createRoot,tr.hydrateRoot;const ao="modulepreload",ro=function(s,t){return new URL(s,t).href},sr={},ye=function(t,a,r){let n=Promise.resolve();if(a&&a.length>0){const u=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");n=Promise.allSettled(a.map(d=>{if(d=ro(d,r),d in sr)return;sr[d]=!0;const g=d.endsWith(".css"),y=g?'[rel="stylesheet"]':"";if(!!r)for(let v=u.length-1;v>=0;v--){const f=u[v];if(f.href===d&&(!g||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${y}`))return;const k=document.createElement("link");if(k.rel=g?"stylesheet":ao,g||(k.as="script"),k.crossOrigin="",k.href=d,l&&k.setAttribute("nonce",l),document.head.appendChild(k),g)return new Promise((v,f)=>{k.addEventListener("load",v),k.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(u){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=u,window.dispatchEvent(c),!c.defaultPrevented)throw u}return n.then(u=>{for(const c of u||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})};function no(s,t){const[a]=o.useState(()=>{let r=null;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{s(...n),r=null},t)}});return a}function io(s,t=300){const[a,r]=o.useState(s);return o.useEffect(()=>{if(s.length<=2){r(s);return}const n=setTimeout(()=>{r(s)},t);return()=>{clearTimeout(n)}},[s,t]),a}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qt(){return qt=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},qt.apply(this,arguments)}var ht;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(ht||(ht={}));const ar="popstate";function oo(s){s===void 0&&(s={});function t(n,i){let{pathname:u="/",search:c="",hash:l=""}=Kt(n.location.hash.substr(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),Ys("",{pathname:u,search:c,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function a(n,i){let u=n.document.querySelector("base"),c="";if(u&&u.getAttribute("href")){let l=n.location.href,d=l.indexOf("#");c=d===-1?l:l.slice(0,d)}return c+"#"+(typeof i=="string"?i:Mr(i))}function r(n,i){lo(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return uo(t,a,r,s)}function We(s,t){if(s===!1||s===null||typeof s>"u")throw new Error(t)}function lo(s,t){if(!s){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function co(){return Math.random().toString(36).substr(2,8)}function rr(s,t){return{usr:s.state,key:s.key,idx:t}}function Ys(s,t,a,r){return a===void 0&&(a=null),qt({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof t=="string"?Kt(t):t,{state:a,key:t&&t.key||r||co()})}function Mr(s){let{pathname:t="/",search:a="",hash:r=""}=s;return a&&a!=="?"&&(t+=a.charAt(0)==="?"?a:"?"+a),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Kt(s){let t={};if(s){let a=s.indexOf("#");a>=0&&(t.hash=s.substr(a),s=s.substr(0,a));let r=s.indexOf("?");r>=0&&(t.search=s.substr(r),s=s.substr(0,r)),s&&(t.pathname=s)}return t}function uo(s,t,a,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:i=!1}=r,u=n.history,c=ht.Pop,l=null,d=g();d==null&&(d=0,u.replaceState(qt({},u.state,{idx:d}),""));function g(){return(u.state||{idx:null}).idx}function y(){c=ht.Pop;let p=g(),w=p==null?null:p-d;d=p,l&&l({action:c,location:f.location,delta:w})}function j(p,w){c=ht.Push;let T=Ys(f.location,p,w);a&&a(T,p),d=g()+1;let h=rr(T,d),m=f.createHref(T);try{u.pushState(h,"",m)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;n.location.assign(m)}i&&l&&l({action:c,location:f.location,delta:1})}function k(p,w){c=ht.Replace;let T=Ys(f.location,p,w);a&&a(T,p),d=g();let h=rr(T,d),m=f.createHref(T);u.replaceState(h,"",m),i&&l&&l({action:c,location:f.location,delta:0})}function v(p){let w=n.location.origin!=="null"?n.location.origin:n.location.href,T=typeof p=="string"?p:Mr(p);return T=T.replace(/ $/,"%20"),We(w,"No window.location.(origin|href) available to create URL for href: "+T),new URL(T,w)}let f={get action(){return c},get location(){return s(n,u)},listen(p){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(ar,y),l=p,()=>{n.removeEventListener(ar,y),l=null}},createHref(p){return t(n,p)},createURL:v,encodeLocation(p){let w=v(p);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:j,replace:k,go(p){return u.go(p)}};return f}var nr;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(nr||(nr={}));function ho(s,t){if(t==="/")return s;if(!s.toLowerCase().startsWith(t.toLowerCase()))return null;let a=t.endsWith("/")?t.length-1:t.length,r=s.charAt(a);return r&&r!=="/"?null:s.slice(a)||"/"}function mo(s,t){t===void 0&&(t="/");let{pathname:a,search:r="",hash:n=""}=typeof s=="string"?Kt(s):s;return{pathname:a?a.startsWith("/")?a:xo(a,t):t,search:yo(r),hash:vo(n)}}function xo(s,t){let a=t.replace(/\/+$/,"").split("/");return s.split("/").forEach(n=>{n===".."?a.length>1&&a.pop():n!=="."&&a.push(n)}),a.length>1?a.join("/"):"/"}function Hs(s,t,a,r){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function po(s){return s.filter((t,a)=>a===0||t.route.path&&t.route.path.length>0)}function go(s,t){let a=po(s);return t?a.map((r,n)=>n===a.length-1?r.pathname:r.pathnameBase):a.map(r=>r.pathnameBase)}function fo(s,t,a,r){r===void 0&&(r=!1);let n;typeof s=="string"?n=Kt(s):(n=qt({},s),We(!n.pathname||!n.pathname.includes("?"),Hs("?","pathname","search",n)),We(!n.pathname||!n.pathname.includes("#"),Hs("#","pathname","hash",n)),We(!n.search||!n.search.includes("#"),Hs("#","search","hash",n)));let i=s===""||n.pathname==="",u=i?"/":n.pathname,c;if(u==null)c=a;else{let y=t.length-1;if(!r&&u.startsWith("..")){let j=u.split("/");for(;j[0]==="..";)j.shift(),y-=1;n.pathname=j.join("/")}c=y>=0?t[y]:"/"}let l=mo(n,c),d=u&&u!=="/"&&u.endsWith("/"),g=(i||u===".")&&a.endsWith("/");return!l.pathname.endsWith("/")&&(d||g)&&(l.pathname+="/"),l}const bo=s=>s.join("/").replace(/\/\/+/g,"/"),yo=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,vo=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s,Fr=["post","put","patch","delete"];new Set(Fr);const jo=["get",...Fr];new Set(jo);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cs(){return cs=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},cs.apply(this,arguments)}const Dr=o.createContext(null),ca=o.createContext(null),da=o.createContext(null),ua=o.createContext({outlet:null,matches:[],isDataRoute:!1});function ha(){return o.useContext(da)!=null}function ma(){return ha()||We(!1),o.useContext(da).location}function Rr(s){o.useContext(ca).static||o.useLayoutEffect(s)}function Or(){let{isDataRoute:s}=o.useContext(ua);return s?Co():wo()}function wo(){ha()||We(!1);let s=o.useContext(Dr),{basename:t,future:a,navigator:r}=o.useContext(ca),{matches:n}=o.useContext(ua),{pathname:i}=ma(),u=JSON.stringify(go(n,a.v7_relativeSplatPath)),c=o.useRef(!1);return Rr(()=>{c.current=!0}),o.useCallback(function(d,g){if(g===void 0&&(g={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let y=fo(d,JSON.parse(u),i,g.relative==="path");s==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:bo([t,y.pathname])),(g.replace?r.replace:r.push)(y,g.state,g)},[t,r,u,i,s])}var _r=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(_r||{}),Lr=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(Lr||{});function No(s){let t=o.useContext(Dr);return t||We(!1),t}function ko(s){let t=o.useContext(ua);return t||We(!1),t}function So(s){let t=ko(),a=t.matches[t.matches.length-1];return a.route.id||We(!1),a.route.id}function Co(){let{router:s}=No(_r.UseNavigateStable),t=So(Lr.UseNavigateStable),a=o.useRef(!1);return Rr(()=>{a.current=!0}),o.useCallback(function(n,i){i===void 0&&(i={}),a.current&&(typeof n=="number"?s.navigate(n):s.navigate(n,cs({fromRouteId:t},i)))},[s,t])}function To(s,t){s?.v7_startTransition,s?.v7_relativeSplatPath}function Eo(s){let{basename:t="/",children:a=null,location:r,navigationType:n=ht.Pop,navigator:i,static:u=!1,future:c}=s;ha()&&We(!1);let l=t.replace(/^\/*/,"/"),d=o.useMemo(()=>({basename:l,navigator:i,static:u,future:cs({v7_relativeSplatPath:!1},c)}),[l,c,i,u]);typeof r=="string"&&(r=Kt(r));let{pathname:g="/",search:y="",hash:j="",state:k=null,key:v="default"}=r,f=o.useMemo(()=>{let p=ho(g,l);return p==null?null:{location:{pathname:p,search:y,hash:j,state:k,key:v},navigationType:n}},[l,g,y,j,k,v,n]);return f==null?null:o.createElement(ca.Provider,{value:d},o.createElement(da.Provider,{children:a,value:f}))}new Promise(()=>{});/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Po="6";try{window.__reactRouterVersion=Po}catch{}const Io="startTransition",ir=so[Io];function $o(s){let{basename:t,children:a,future:r,window:n}=s,i=o.useRef();i.current==null&&(i.current=oo({window:n,v5Compat:!0}));let u=i.current,[c,l]=o.useState({action:u.action,location:u.location}),{v7_startTransition:d}=r||{},g=o.useCallback(y=>{d&&ir?ir(()=>l(y)):l(y)},[l,d]);return o.useLayoutEffect(()=>u.listen(g),[u,g]),o.useEffect(()=>To(r),[r]),o.createElement(Eo,{basename:t,children:a,location:c.location,navigationType:c.action,navigator:u,future:r})}var or;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(or||(or={}));var lr;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(lr||(lr={}));function ks(){return typeof window<"u"&&(window.electronAPI!==void 0||window.process?.type==="renderer"||navigator.userAgent.toLowerCase().includes("electron"))}const xe="http://localhost:8000";async function ue(s,t){const a=await fetch(`${xe}${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(await a.text());return a.json()}async function Wt(s,t,a=32,r,n){return ue("/index",{dir:s,provider:t,batch_size:a,hf_token:r,openai_key:n})}async function Mo(s,t,a,r){const n=new URLSearchParams({dir:s,provider:t});a&&n.set("hf_token",a),r&&n.set("openai_key",r);const i=await fetch(`${xe}/index/status?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function Fo(s){return ue("/index/pause",{dir:s})}async function Do(s){return ue("/index/resume",{dir:s})}async function Ss(s,t,a,r=24,n){if(!t?.trim())throw new Error("Search query cannot be empty");if(!s?.trim())throw new Error("Directory must be specified");if(r<1||r>1e3)throw new Error("Top K must be between 1 and 1000");try{const i=new URLSearchParams({dir:s,query:t,provider:a,top_k:String(r)});n?.hfToken&&i.set("hf_token",n.hfToken),n?.openaiKey&&i.set("openai_key",n.openaiKey),n?.favoritesOnly&&i.set("favorites_only","true"),n?.tags&&i.set("tags",n.tags.join(",")),n?.dateFrom!==void 0&&i.set("date_from",String(n.dateFrom)),n?.dateTo!==void 0&&i.set("date_to",String(n.dateTo)),n?.useFast&&i.set("use_fast","true"),n?.fastKind&&i.set("fast_kind",n.fastKind),n?.useCaptions&&i.set("use_captions","true"),n?.useOcr&&i.set("use_ocr","true"),n?.camera&&i.set("camera",n.camera),n?.isoMin!==void 0&&i.set("iso_min",String(n.isoMin)),n?.isoMax!==void 0&&i.set("iso_max",String(n.isoMax)),n?.fMin!==void 0&&i.set("f_min",String(n.fMin)),n?.fMax!==void 0&&i.set("f_max",String(n.fMax)),n?.flash&&i.set("flash",n.flash),n?.wb&&i.set("wb",n.wb),n?.metering&&i.set("metering",n.metering),n?.altMin!==void 0&&i.set("alt_min",String(n.altMin)),n?.altMax!==void 0&&i.set("alt_max",String(n.altMax)),n?.headingMin!==void 0&&i.set("heading_min",String(n.headingMin)),n?.headingMax!==void 0&&i.set("heading_max",String(n.headingMax)),n?.place&&i.set("place",n.place),n?.hasText&&i.set("has_text","true"),n?.person&&i.set("person",n.person),n?.persons&&i.set("persons",n.persons.join(",")),n?.sharpOnly&&i.set("sharp_only","true"),n?.excludeUnder&&i.set("exclude_underexp","true"),n?.excludeOver&&i.set("exclude_overexp","true");const u=await fetch(`${xe}/search?${i.toString()}`);if(!u.ok)throw new Error(await u.text());const c=await u.json();try{const{searchHistoryService:l}=await ye(async()=>{const{searchHistoryService:d}=await Promise.resolve().then(()=>wc);return{searchHistoryService:d}},void 0,import.meta.url);l.addToHistory({query:t.trim(),timestamp:Date.now(),resultCount:c.results?.length||0,filters:{tags:n?.tags,favOnly:n?.favoritesOnly,dateFrom:n?.dateFrom,dateTo:n?.dateTo,person:n?.person,place:n?.place}})}catch(l){console.warn("Failed to save search to history:",l)}return c}catch(i){if(i instanceof Error){if(i.message.includes("network"))throw new Error("Network error: Please check your connection");if(i.message.includes("timeout"))throw new Error("Search timeout: Try a simpler query or check your connection");if(i.message.includes("401"))throw new Error("Authentication error: Please check your API keys");if(i.message.includes("403"))throw new Error("Access denied: Please check your permissions");if(i.message.includes("500"))throw new Error("Server error: Please try again later")}throw i}}async function Ar(s,t,a,r=24,n,i=.5){return ue("/search_like_plus",{dir:s,path:t,provider:a,top_k:r,text:n,weight:i})}async function xa(s,t,a,r){return ue("/share",{dir:s,provider:t,paths:a,expiry_hours:r?.expiryHours??24,password:r?.password,view_only:r?.viewOnly??!0})}async function zr(s){const t=s?`${xe}/share?dir=${encodeURIComponent(s)}`:`${xe}/share`,a=await fetch(t);if(!a.ok)throw new Error(await a.text());return a.json()}async function Ur(s){return ue("/share/revoke",{token:s})}async function ds(s,t=200){const a=await fetch(`${xe}/analytics?dir=${encodeURIComponent(s)}&limit=${t}`);if(!a.ok)throw new Error(await a.text());return a.json()}async function Br(s,t,a,r,n){return ue("/captions/build",{dir:s,vlm_model:t,provider:a,hf_token:r,openai_key:n})}async function Hr(s,t,a,r,n){return ue("/feedback",{dir:s,search_id:t,query:a,positives:r,note:n})}async function pa(s){const t=await fetch(`${xe}/favorites?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function kt(s,t,a){return ue("/favorites",{dir:s,path:t,favorite:a})}async function ga(s){const t=await fetch(`${xe}/saved?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Vr(s,t,a,r){return ue("/saved",{dir:s,name:t,query:a,top_k:r})}async function qr(s,t){return ue("/saved/delete",{dir:s,name:t})}async function Ro(s){const t=await fetch(`${xe}/presets?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Oo(s,t,a){return ue("/presets",{dir:s,name:t,query:a})}async function _o(s,t){return ue("/presets/delete",{dir:s,name:t})}async function fa(s){const t=await fetch(`${xe}/map?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function ba(s,t,a,r){const n=new URLSearchParams({dir:s});t&&n.set("provider",t),r&&n.set("hf_token",r),a&&n.set("openai_key",a);const i=await fetch(`${xe}/diagnostics?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function Yt(s,t,a=120,r=0,n){const i=new URLSearchParams({dir:s,provider:t,limit:String(a),offset:String(r)});n?.hfToken&&i.set("hf_token",n.hfToken),n?.openaiKey&&i.set("openai_key",n.openaiKey);const u=await fetch(`${xe}/library?${i.toString()}`);if(!u.ok)throw new Error(await u.text());return u.json()}async function ya(s,t,a,r,n){return ue("/fast/build",{dir:s,kind:t,provider:a,hf_token:r,openai_key:n})}async function va(s,t,a,r,n){return ue("/ocr/build",{dir:s,provider:t,languages:a,hf_token:r,openai_key:n})}async function Wr(s,t=5){const a=await fetch(`${xe}/lookalikes?dir=${encodeURIComponent(s)}&max_distance=${t}`);if(!a.ok)throw new Error(await a.text());return a.json()}async function Gr(s,t){return ue("/lookalikes/resolve",{dir:s,group_paths:t})}async function ja(){const s=await fetch(`${xe}/workspace`);if(!s.ok)throw new Error(await s.text());return s.json()}async function xt(s){return ue("/workspace/add",{path:s})}async function Kr(s){return ue("/workspace/remove",{path:s})}async function It(s,t){const a=await fetch(`${xe}/metadata/detail?dir=${encodeURIComponent(s)}&path=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(await a.text());return a.json()}async function wa(s,t,a,r=24,n){return ue("/search_workspace",{dir:s,provider:a,query:t,top_k:r,favorites_only:n?.favoritesOnly,tags:n?.tags,date_from:n?.dateFrom,date_to:n?.dateTo,place:n?.place,has_text:n?.hasText,person:n?.person,persons:n?.persons})}async function Na(s){const t=await fetch(`${xe}/tags?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Yr(s,t,a){return ue("/tags",{dir:s,path:t,tags:a})}function Fe(s,t,a,r=256){if(ks())return`file://${a.startsWith("/")?a:`${s}/${a}`}`;const n=new URLSearchParams({dir:s,provider:t,path:a,size:String(r)});return`${xe}/thumb?${n.toString()}`}function ka(s,t,a,r,n=196){if(ks())return`file://${a.startsWith("/")?a:`${s}/${a}`}`;const i=new URLSearchParams({dir:s,provider:t,path:a,emb:String(r),size:String(n)});return`${xe}/thumb_face?${i.toString()}`}async function Qr(s,t){return ue("/open",{dir:s,path:t})}async function Jr(s,t,a){return ue("/edit/ops",{dir:s,path:t,rotate:a.rotate||0,flip:a.flip,crop:a.crop})}async function Xr(s,t,a=2,r="pil"){return ue("/edit/upscale",{dir:s,path:t,scale:a,engine:r})}async function $t(s,t,a,r="copy",n=!1,i=!1,u){return ue("/export",{dir:s,paths:t,dest:a,mode:r,strip_exif:n,overwrite:i,strip_gps:u?.stripGps,keep_copyright_only:u?.keepCopyrightOnly,preset:u?.preset,resize_long:u?.resizeLong,quality:u?.quality})}async function Sa(s,t,a,r){return ue("/metadata/build",{dir:s,provider:t,hf_token:a,openai_key:r})}async function Ca(s){const t=await fetch(`${xe}/metadata?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Zr(s,t,a,r=24){return ue("/search_like",{dir:s,path:t,provider:a,top_k:r})}async function en(s){const t=await fetch(`${xe}/collections?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function us(s,t,a){return ue("/collections",{dir:s,name:t,paths:a})}async function tn(s,t){return ue("/collections/delete",{dir:s,name:t})}async function sn(s){const t=await fetch(`${xe}/smart_collections?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function an(s,t,a){return ue("/smart_collections",{dir:s,name:t,rules:a})}async function rn(s,t){return ue("/smart_collections/delete",{dir:s,name:t})}async function nn(s,t,a,r=24){return ue("/smart_collections/resolve",{dir:s,name:t,provider:a,top_k:r})}async function on(s,t,a=160){return ue("/ocr/snippets",{dir:s,paths:t,limit:a})}async function Lo(s){const t=await fetch(`${xe}/ocr/status?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Ta(s,t){return ue("/faces/build",{dir:s,provider:t})}async function Ea(s){const t=await fetch(`${xe}/faces/clusters?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Pa(s,t,a){return ue("/faces/name",{dir:s,cluster_id:t,name:a})}async function ln(s,t){return ue("/trips/build",{dir:s,provider:t})}async function cn(s){const t=await fetch(`${xe}/trips?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function hs(){const s=await fetch(`${xe}/todo`);if(!s.ok)throw new Error(await s.text());return s.json()}async function Ia(s,t){return ue("/autotag",{dir:s,provider:t})}async function $a(s,t,a){const r=await fetch(`${xe}/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:s,paths:t,os_trash:!!a})});if(!r.ok)throw new Error(await r.text());return r.json()}async function Ma(s){const t=await fetch(`${xe}/undo_delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:s})});if(!t.ok)throw new Error(await t.text());return t.json()}async function dn(s){const t=await fetch(`${xe}/videos?dir=${encodeURIComponent(s)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function un(s,t){const a=await fetch(`${xe}/video/metadata?dir=${encodeURIComponent(s)}&path=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(await a.text());return a.json()}function hn(s,t,a=1,r=256){if(ks())return`file://${t.startsWith("/")?t:`${s}/${t}`}`;const n=new URLSearchParams({dir:s,path:t,frame_time:String(a),size:String(r)});return`${xe}/video/thumbnail?${n.toString()}`}async function mn(s,t="local"){return ue("/videos/index",{dir:s,provider:t})}async function Ao(s,t,a=!1){return ue("/batch/delete",{dir:s,paths:t,os_trash:a})}async function zo(s,t,a,r="add"){return ue("/batch/tag",{dir:s,paths:t,tags:a,operation:r})}async function xn(s,t){const a=await fetch(`${xe}/faces/photos?dir=${encodeURIComponent(s)}&cluster_id=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(await a.text());return a.json()}const ve=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:xe,apiAddPreset:Oo,apiAddSaved:Vr,apiAnalytics:ds,apiAutotag:Ia,apiBatchDelete:Ao,apiBatchTag:zo,apiBuildCaptions:Br,apiBuildFaces:Ta,apiBuildFast:ya,apiBuildMetadata:Sa,apiBuildOCR:va,apiCreateShare:xa,apiDelete:$a,apiDeleteCollection:tn,apiDeletePreset:_o,apiDeleteSaved:qr,apiDeleteSmart:rn,apiDiagnostics:ba,apiEditOps:Jr,apiExport:$t,apiFacesClusters:Ea,apiFacesName:Pa,apiFeedback:Hr,apiGetCollections:en,apiGetFacePhotos:xn,apiGetFavorites:pa,apiGetMetadata:Ca,apiGetPresets:Ro,apiGetSaved:ga,apiGetSmart:sn,apiGetTags:Na,apiGetVideoMetadata:un,apiIndex:Wt,apiIndexPause:Fo,apiIndexResume:Do,apiIndexStatus:Mo,apiIndexVideos:mn,apiLibrary:Yt,apiListShares:zr,apiListVideos:dn,apiLookalikes:Wr,apiMap:fa,apiMetadataDetail:It,apiOcrSnippets:on,apiOcrStatus:Lo,apiOpen:Qr,apiResolveLookalike:Gr,apiResolveSmart:nn,apiRevokeShare:Ur,apiSearch:Ss,apiSearchLike:Zr,apiSearchLikePlus:Ar,apiSearchWorkspace:wa,apiSetCollection:us,apiSetFavorite:kt,apiSetSmart:an,apiSetTags:Yr,apiTodo:hs,apiTripsBuild:ln,apiTripsList:cn,apiUndoDelete:Ma,apiUpscale:Xr,apiWorkspaceAdd:xt,apiWorkspaceList:ja,apiWorkspaceRemove:Kr,isElectron:ks,thumbFaceUrl:ka,thumbUrl:Fe,videoThumbnailUrl:hn},Symbol.toStringTag,{value:"Module"})),Uo={settings:{dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"faiss",useCaps:!1,vlmModel:"gpt-4o",useOcr:!1,hasText:!1,useOsTrash:!1,camera:"",isoMin:0,isoMax:25600,fMin:.7,fMax:32,place:"",showInfoOverlay:!1,resultView:"grid",timelineBucket:"day",includeVideos:!0},photo:{results:[],searchId:"",query:"",topK:24,fav:[],favOnly:!1,tags:{allTags:[],tagsMap:{},tagFilter:""},saved:[],collections:{},smart:{},library:[],libHasMore:!0},ui:{busy:"",note:"",viewMode:"grid",showWelcome:!1,showHelp:!1},workspace:{workspace:"",wsToggle:!1,persons:[],clusters:[],groups:[],points:[],diag:null}},pn=o.createContext(null),Bo=({children:s})=>{const[t,a]=o.useState(Uo),r=o.useCallback(c=>{a(l=>({...l,settings:{...l.settings,...c}}))},[]),n=o.useCallback(c=>{a(l=>({...l,photo:{...l.photo,...typeof c=="function"?c(l):c}}))},[]),i=o.useCallback(c=>{a(l=>({...l,ui:{...l.ui,...c}}))},[]),u=o.useCallback(c=>{a(l=>({...l,workspace:{...l.workspace,...c}}))},[]);return e.jsx(pn.Provider,{value:{state:t,setSettings:r,setPhoto:n,setUI:i,setWorkspace:u},children:s})},ce=()=>{const s=o.useContext(pn);if(!s)throw new Error("useSimpleStore must be used within SimpleStoreProvider");return s},Ho=()=>ce().state.settings.dir,Vo=()=>ce().state.settings.engine,qo=()=>ce().state.settings.hfToken,Wo=()=>ce().state.settings.openaiKey,Go=()=>ce().state.settings.engine.startsWith("hf"),Ko=()=>ce().state.settings.engine==="openai",Yo=()=>ce().state.settings.camera,Qo=()=>ce().state.settings.isoMin,Jo=()=>ce().state.settings.isoMax,Xo=()=>ce().state.settings.fMin,Zo=()=>ce().state.settings.fMax,el=()=>ce().state.settings.place,tl=()=>ce().state.settings.showInfoOverlay,sl=()=>ce().state.settings.useCaps,al=()=>ce().state.settings.useOcr,rl=()=>ce().state.settings.hasText,nl=()=>ce().state.settings.useFast,il=()=>ce().state.settings.fastKind,ol=()=>ce().state.settings.useOsTrash,ll=()=>ce().state.photo.results,cl=()=>ce().state.photo.query,dl=()=>ce().state.photo.topK,ul=()=>ce().state.photo.fav,hl=()=>ce().state.photo.favOnly,ml=()=>ce().state.photo.tags.tagFilter,xl=()=>ce().state.photo.tags.allTags,pl=()=>ce().state.photo.tags.tagsMap,gl=()=>ce().state.photo.saved,fl=()=>ce().state.photo.collections,bl=()=>ce().state.photo.smart,gn=()=>ce().state.photo.library,fn=()=>ce().state.photo.libHasMore,yl=()=>ce().state.ui.busy,vl=()=>ce().state.ui.note,jl=()=>ce().state.ui.showWelcome,wl=()=>ce().state.ui.showHelp,Nl=()=>ce().state.workspace.wsToggle,kl=()=>ce().state.workspace.persons,Sl=()=>ce().state.workspace.clusters,Cl=()=>ce().state.workspace.points,Tl=()=>ce().state.workspace.diag,bn=()=>{const{setSettings:s}=ce();return ft.useMemo(()=>({setDir:t=>s({dir:t}),setEngine:t=>s({engine:t}),setHfToken:t=>s({hfToken:t}),setOpenaiKey:t=>s({openaiKey:t}),setUseFast:t=>s({useFast:t}),setFastKind:t=>s({fastKind:t}),setUseCaps:t=>s({useCaps:t}),setVlmModel:t=>s({vlmModel:t}),setUseOcr:t=>s({useOcr:t}),setHasText:t=>s({hasText:t}),setUseOsTrash:t=>s({useOsTrash:t}),setCamera:t=>s({camera:t}),setIsoMin:t=>s({isoMin:t}),setIsoMax:t=>s({isoMax:t}),setFMin:t=>s({fMin:t}),setFMax:t=>s({fMax:t}),setPlace:t=>s({place:t}),setShowInfoOverlay:t=>s({showInfoOverlay:t}),setResultView:t=>s({resultView:t}),setTimelineBucket:t=>s({timelineBucket:t}),setIncludeVideos:t=>s({includeVideos:t})}),[s])},yn=()=>{const{setPhoto:s}=ce();return ft.useMemo(()=>({setResults:t=>s({results:t}),setSearchId:t=>s({searchId:t}),setQuery:t=>s({query:t}),setTopK:t=>s({topK:t}),setFavorites:t=>s({fav:t}),setFavOnly:t=>s({favOnly:t}),setAllTags:t=>s(a=>({tags:{...a.photo.tags,allTags:t}})),setTagsMap:t=>s(a=>({tags:{...a.photo.tags,tagsMap:t}})),setTagFilter:t=>s(a=>({tags:{...a.photo.tags,tagFilter:t}})),setSaved:t=>s({saved:t}),setCollections:t=>s({collections:t}),setSmart:t=>s({smart:t}),setLibrary:t=>s({library:t}),setLibHasMore:t=>s({libHasMore:t}),appendLibrary:t=>s(a=>({library:[...a.photo.library,...t]})),resetSearch:()=>s({results:[],searchId:"",query:""})}),[s])},El=()=>{const{setUI:s}=ce();return ft.useMemo(()=>({setBusy:t=>s({busy:t}),setNote:t=>s({note:t}),setViewMode:t=>s({viewMode:t}),setShowWelcome:t=>s({showWelcome:t}),setShowHelp:t=>s({showHelp:t})}),[s])},Pl=()=>{const{setWorkspace:s}=ce();return ft.useMemo(()=>({setWorkspace:t=>s({workspace:t}),setWsToggle:t=>s({wsToggle:t}),setPersons:t=>s({persons:t}),setClusters:t=>s({clusters:t}),setGroups:t=>s({groups:t}),setPoints:t=>s({points:t}),setDiag:t=>s({diag:t})}),[s])},Il=s=>(t,a,r)=>{const n=r.subscribe;return r.subscribe=(u,c,l)=>{let d=u;if(c){const g=l?.equalityFn||Object.is;let y=u(r.getState());d=j=>{const k=u(j);if(!g(y,k)){const v=y;c(y=k,v)}},l?.fireImmediately&&c(y,y)}return n(d)},s(t,a,r)},vn=Il;function $l(s,t){let a;try{a=s()}catch{return}return{getItem:n=>{var i;const u=l=>l===null?null:JSON.parse(l,void 0),c=(i=a.getItem(n))!=null?i:null;return c instanceof Promise?c.then(u):u(c)},setItem:(n,i)=>a.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>a.removeItem(n)}}const Qs=s=>t=>{try{const a=s(t);return a instanceof Promise?a:{then(r){return Qs(r)(a)},catch(r){return this}}}catch(a){return{then(r){return this},catch(r){return Qs(r)(a)}}}},Ml=(s,t)=>(a,r,n)=>{let i={storage:$l(()=>localStorage),partialize:f=>f,version:0,merge:(f,p)=>({...p,...f}),...t},u=!1;const c=new Set,l=new Set;let d=i.storage;if(!d)return s((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),a(...f)},r,n);const g=()=>{const f=i.partialize({...r()});return d.setItem(i.name,{state:f,version:i.version})},y=n.setState;n.setState=(f,p)=>(y(f,p),g());const j=s((...f)=>(a(...f),g()),r,n);n.getInitialState=()=>j;let k;const v=()=>{var f,p;if(!d)return;u=!1,c.forEach(T=>{var h;return T((h=r())!=null?h:j)});const w=((p=i.onRehydrateStorage)==null?void 0:p.call(i,(f=r())!=null?f:j))||void 0;return Qs(d.getItem.bind(d))(i.name).then(T=>{if(T)if(typeof T.version=="number"&&T.version!==i.version){if(i.migrate){const h=i.migrate(T.state,T.version);return h instanceof Promise?h.then(m=>[!0,m]):[!0,h]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,T.state];return[!1,void 0]}).then(T=>{var h;const[m,C]=T;if(k=i.merge(C,(h=r())!=null?h:j),a(k,!0),m)return g()}).then(()=>{w?.(k,void 0),k=r(),u=!0,l.forEach(T=>T(k))}).catch(T=>{w?.(void 0,T)})};return n.persist={setOptions:f=>{i={...i,...f},f.storage&&(d=f.storage)},clearStorage:()=>{d?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>v(),hasHydrated:()=>u,onHydrate:f=>(c.add(f),()=>{c.delete(f)}),onFinishHydration:f=>(l.add(f),()=>{l.delete(f)})},i.skipHydration||v(),k||j},jn=Ml,_e=Ir()(jn(vn((s,t)=>({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0,setThemeMode:a=>s({themeMode:a}),setColorScheme:a=>s({colorScheme:a}),setDensity:a=>s({density:a}),setCustomColors:a=>s({customColors:a}),resetTheme:()=>s({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0})})),{name:"photo-search-theme",partialize:s=>({themeMode:s.themeMode,colorScheme:s.colorScheme,density:s.density,customColors:s.customColors})})),Cs=Ir()(jn(vn((s,t)=>({dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"",useCaps:!1,vlmModel:"Qwen/Qwen2-VL-2B-Instruct",useOcr:!1,hasText:!1,useOsTrash:!1,showExplain:!1,showInfoOverlay:!1,highContrast:!1,camera:"",isoMin:"",isoMax:"",fMin:"",fMax:"",place:"",setDir:a=>s({dir:a}),setEngine:a=>s({engine:a}),setHfToken:a=>s({hfToken:a}),setOpenaiKey:a=>s({openaiKey:a}),setUseFast:a=>s({useFast:a}),setFastKind:a=>s({fastKind:a}),setUseCaps:a=>s({useCaps:a}),setVlmModel:a=>s({vlmModel:a}),setUseOcr:a=>s({useOcr:a}),setHasText:a=>s({hasText:a}),setUseOsTrash:a=>s({useOsTrash:a}),setShowExplain:a=>s({showExplain:a}),setShowInfoOverlay:a=>s({showInfoOverlay:a}),setHighContrast:a=>s({highContrast:a}),setCamera:a=>s({camera:a}),setIsoMin:a=>s({isoMin:a}),setIsoMax:a=>s({isoMax:a}),setFMin:a=>s({fMin:a}),setFMax:a=>s({fMax:a}),setPlace:a=>s({place:a})})),{name:"photo-search-settings",partialize:s=>({dir:s.dir,engine:s.engine,useFast:s.useFast,fastKind:s.fastKind,useCaps:s.useCaps,vlmModel:s.vlmModel,useOcr:s.useOcr,hasText:s.hasText,useOsTrash:s.useOsTrash,showExplain:s.showExplain,showInfoOverlay:s.showInfoOverlay,camera:s.camera,isoMin:s.isoMin,isoMax:s.isoMax,fMin:s.fMin,fMax:s.fMax,place:s.place})})),wn=()=>Cs(s=>s.dir),Fl=()=>Cs(s=>s.engine),Fa=()=>Cs(s=>s.highContrast);class qe{static isVideoFile(t){const a=t.toLowerCase().substring(t.lastIndexOf("."));return this.supportedFormats.includes(a)}static async extractMetadata(t){return new Promise((a,r)=>{const n=document.createElement("video");n.preload="metadata",n.onloadedmetadata=()=>{const i={duration:n.duration,width:n.videoWidth,height:n.videoHeight,codec:this.detectCodec(t),fps:30,bitrate:0,hasAudio:n.mozHasAudio||n.webkitAudioDecodedByteCount>0||n.audioTracks?.length>0||!0};n.remove(),a(i)},n.onerror=()=>{n.remove(),r(new Error("Failed to load video metadata"))},n.src=t})}static async generateThumbnail(t,a=2,r=320,n=240){return new Promise((i,u)=>{const c=document.createElement("video"),l=document.createElement("canvas"),d=l.getContext("2d");if(!d){u(new Error("Canvas context not available"));return}c.crossOrigin="anonymous",c.currentTime=a,c.onseeked=()=>{l.width=r,l.height=n;const g=c.videoWidth/c.videoHeight,y=r/n;let j=r,k=n,v=0,f=0;g>y?(k=r/g,f=(n-k)/2):(j=n*g,v=(r-j)/2),d.drawImage(c,v,f,j,k);const p=l.toDataURL("image/jpeg",.8);c.remove(),l.remove(),i(p)},c.onerror=()=>{c.remove(),l.remove(),u(new Error("Failed to generate thumbnail"))},c.src=t})}static async extractKeyframes(t,a=10,r=160,n=90){const u=(await this.extractMetadata(t)).duration/(a+1),c=[];for(let l=1;l<=a;l++)try{const d=u*l,g=await this.generateThumbnail(t,d,r,n);c.push(g)}catch(d){console.warn(`Failed to extract keyframe at ${u*l}s:`,d)}return c}static detectCodec(t){const a=t.toLowerCase().substring(t.lastIndexOf(".")+1);return{mp4:"H.264",mov:"H.264/ProRes",webm:"VP8/VP9",mkv:"H.264/H.265",avi:"Various",wmv:"WMV",flv:"FLV"}[a]||"Unknown"}static async getVideoInfo(t,a){if(this.videoCache.has(t))return this.videoCache.get(t);try{const r=await this.extractMetadata(a),n=await this.generateThumbnail(a),i={path:t,type:"video",format:t.substring(t.lastIndexOf(".")+1).toUpperCase(),metadata:r,thumbnailUrl:n,streamUrl:a};if(this.videoCache.set(t,i),this.videoCache.size>100){const u=this.videoCache.keys().next().value;this.videoCache.delete(u)}return i}catch(r){throw console.error("Failed to get video info:",r),r}}static clearCache(){this.videoCache.clear()}static formatDuration(t){const a=Math.floor(t/3600),r=Math.floor(t%3600/60),n=Math.floor(t%60);return a>0?`${a}:${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${r}:${n.toString().padStart(2,"0")}`}static getResolutionLabel(t,a){return a>=2160?"4K":a>=1440?"2K":a>=1080?"Full HD":a>=720?"HD":a>=480?"SD":"Low"}}de(qe,"supportedFormats",[".mp4",".mov",".avi",".webm",".mkv",".m4v",".mpg",".mpeg",".wmv",".flv"]),de(qe,"videoCache",new Map);class Dl{constructor(t={}){de(this,"intersectionObserver",null);de(this,"imageCache",new Map);de(this,"loadingQueue",new Set);de(this,"maxCacheSize",100*1024*1024);de(this,"currentCacheSize",0);de(this,"options");this.options={threshold:t.threshold??.1,rootMargin:t.rootMargin??"50px",quality:t.quality??"medium",enableProgressiveLoading:t.enableProgressiveLoading??!0},this.initIntersectionObserver()}initIntersectionObserver(){typeof window>"u"||!window.IntersectionObserver||(this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(a=>{if(a.isIntersecting){const r=a.target,n=r.dataset.src;n&&!r.src&&(this.loadImage(n,r),this.intersectionObserver?.unobserve(r))}})},{threshold:this.options.threshold,rootMargin:this.options.rootMargin}))}observeImage(t,a){if(!this.intersectionObserver){this.loadImage(a,t);return}t.dataset.src=a,this.options.enableProgressiveLoading&&(t.style.backgroundColor="#f3f4f6",t.style.backgroundImage="linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",t.style.backgroundSize="200% 100%",t.style.animation="shimmer 2s infinite linear"),this.intersectionObserver.observe(t)}async loadImage(t,a){if(this.loadingQueue.has(t))return;const r=this.imageCache.get(t);if(r){this.applyImageToElement(r.url,a),this.imageCache.delete(t),this.imageCache.set(t,r);return}this.loadingQueue.add(t);try{const n=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(!n.ok)throw new Error(`Failed to load image: ${n.status}`);const i=await n.blob(),u=URL.createObjectURL(i),c={blob:i,url:u,timestamp:Date.now(),size:i.size};this.addToCache(t,c),this.applyImageToElement(u,a)}catch(n){console.warn("Failed to load image:",t,n),a.style.backgroundColor="#fee2e2",a.alt="Failed to load"}finally{this.loadingQueue.delete(t)}}applyImageToElement(t,a){a.onload=()=>{a.style.backgroundColor="",a.style.backgroundImage="",a.style.animation=""},a.src=t}addToCache(t,a){for(this.currentCacheSize+=a.size;this.currentCacheSize>this.maxCacheSize&&this.imageCache.size>0;){const[r,n]=this.imageCache.entries().next().value;this.imageCache.delete(r),this.currentCacheSize-=n.size,URL.revokeObjectURL(n.url)}this.imageCache.set(t,a)}preloadImages(t,a="low"){a==="low"?window.requestIdleCallback?window.requestIdleCallback(()=>{this.preloadImageBatch(t)}):setTimeout(()=>this.preloadImageBatch(t),100):this.preloadImageBatch(t)}async preloadImageBatch(t){const a=t.filter(r=>!this.imageCache.has(r)&&!this.loadingQueue.has(r)).slice(0,10).map(r=>this.preloadSingleImage(r));await Promise.allSettled(a)}async preloadSingleImage(t){if(!(this.imageCache.has(t)||this.loadingQueue.has(t))){this.loadingQueue.add(t);try{const a=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(a.ok){const r=await a.blob(),n=URL.createObjectURL(r),i={blob:r,url:n,timestamp:Date.now(),size:r.size};this.addToCache(t,i)}}catch{}finally{this.loadingQueue.delete(t)}}}clearCache(){for(const t of this.imageCache.values())URL.revokeObjectURL(t.url);this.imageCache.clear(),this.currentCacheSize=0}getCacheStats(){return{size:this.imageCache.size,totalSize:this.currentCacheSize,maxSize:this.maxCacheSize,hitRate:this.imageCache.size>0?Array.from(this.imageCache.values()).filter(t=>Date.now()-t.timestamp<3e5).length/this.imageCache.size:0}}destroy(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.clearCache(),this.loadingQueue.clear()}}const Nn=new Dl;if(typeof document<"u"){const s=document.createElement("style");s.textContent=`
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
  `,document.head.appendChild(s)}const Da=o.memo(({src:s,alt:t,onLoad:a,onError:r,className:n="",enableProgressiveLoading:i=!0,quality:u="medium",...c})=>{const l=o.useRef(null),[d,g]=o.useState(!1),[y,j]=o.useState(!1);o.useEffect(()=>{const v=l.current;if(!v||!s)return;const f=()=>{g(!0),a?.()},p=()=>{j(!0),r?.()};return v.addEventListener("load",f),v.addEventListener("error",p),Nn.observeImage(v,s),()=>{v.removeEventListener("load",f),v.removeEventListener("error",p)}},[s,a,r]);const k=`
    ${n}
    ${i&&!d?"transition-opacity duration-300 opacity-0":""}
    ${d?"opacity-100":""}
    ${y?"bg-red-100":""}
  `.trim();return e.jsx("img",{ref:l,alt:t,className:k,...c,style:{...c.style,...i&&!d?{backgroundColor:"#f3f4f6",backgroundImage:"linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",backgroundSize:"200% 100%",animation:"shimmer 2s infinite linear"}:{}}})});Da.displayName="LazyImage";const kn=o.memo(({dir:s,engine:t,items:a,gap:r=8,targetRowHeight:n=196,scrollContainerRef:i,selected:u,onToggleSelect:c,onOpen:l,focusIndex:d=null,onLayout:g,ratingMap:y,showInfoOverlay:j})=>{const k=o.useRef(null),[v,f]=o.useState(0),[p,w]=o.useState({}),[T,h]=o.useState(null),[m,C]=o.useState({}),I=4/3,[E,S]=o.useState({});o.useEffect(()=>{const A=i.current;if(!A)return;const K=new ResizeObserver(()=>f(A.clientWidth));return K.observe(A),f(A.clientWidth),()=>K.disconnect()},[i]),o.useEffect(()=>{let A=!1;return a.slice(0,200).forEach(({path:Z})=>{if(p[Z])return;const ne=new Image;ne.onload=()=>{!A&&ne.naturalWidth&&ne.naturalHeight&&w(oe=>({...oe,[Z]:ne.naturalWidth/ne.naturalHeight}))},ne.src=Fe(s,t,Z,256)}),()=>{A=!0}},[a,s,t]);const N=o.useMemo(()=>{if(!v||a.length===0)return[];const A=[];let K=[],Z=0;const oe=Math.max(0,v-2*16);if(a.forEach((G,se)=>{const B=p[G.path]||I;if(K.push(G),Z+=B,Z*n+r*(K.length-1)>=oe){const pe=Math.max(120,Math.floor((oe-r*(K.length-1))/Z));A.push({items:K,height:pe}),K=[],Z=0}}),K.length>0){const G=Math.min(n,Math.floor((oe-r*(K.length-1))/Math.max(1,Z)));A.push({items:K,height:G})}return A},[a,p,v,r,n]),D=o.useMemo(()=>{const A=[];if(!a.length||N.length===0)return A;let K=0;for(const Z of N){const ne=[];for(let oe=0;oe<Z.items.length;oe++)ne.push(K++);A.push(ne)}return A},[N,a.length]);o.useEffect(()=>{g&&g(D)},[D,g]);const _=(A,K)=>{const Z=K.touches[0],ne=Date.now();m[A]?.longPressTimer&&clearTimeout(m[A].longPressTimer);const oe={startX:Z.clientX,startY:Z.clientY,startTime:ne,isLongPress:!1,longPressTimer:window.setTimeout(()=>{C(G=>({...G,[A]:{...G[A],isLongPress:!0}})),h(A)},500)};C(G=>({...G,[A]:oe}))},Q=(A,K)=>{const Z=K.touches[0],ne=m[A];if(!ne)return;const oe=Math.abs(Z.clientX-ne.startX),G=Math.abs(Z.clientY-ne.startY);(oe>10||G>10)&&ne.longPressTimer&&(clearTimeout(ne.longPressTimer),C(se=>({...se,[A]:{...se[A],longPressTimer:null}})))},M=(A,K)=>{const Z=m[A];if(!Z)return;Z.longPressTimer&&clearTimeout(Z.longPressTimer);const oe=Date.now()-Z.startTime;Z.isLongPress||(oe<200&&c(A),setTimeout(()=>{C(G=>{const se={...G};return delete se[A],se})},100))},H=(A,K)=>{switch(h(null),K){case"open":l(A);break;case"favorite":console.log("Favorite:",A);break;case"share":console.log("Share:",A);break;case"download":console.log("Download:",A);break}},[$,F]=o.useState(0),V=i.current?.clientHeight||0;o.useEffect(()=>{const A=i.current;if(!A)return;const K=()=>F(A.scrollTop);return A.addEventListener("scroll",K,{passive:!0}),F(A.scrollTop),()=>A.removeEventListener("scroll",K)},[i]);const{totalH:Y,offsets:O}=o.useMemo(()=>{let A=0;const K=[];for(const Z of N)K.push(A),A+=Z.height+r;return{totalH:A,offsets:K}},[N,r]),J=600,L=o.useMemo(()=>{const A=Math.max(0,$-J);let K=0;for(;K<O.length&&O[K]+N[K].height<A;)K++;return K},[O,N,$]),X=o.useMemo(()=>{const A=$+V+J;let K=L;for(;K<O.length&&O[K]<A;)K++;return Math.min(K+5,N.length)},[O,N,$,V,L]);o.useEffect(()=>{const A=N.slice(X,X+3).flatMap(K=>K.items.map(Z=>Fe(s,t,Z.path,256)));A.length>0&&Nn.preloadImages(A,"low")},[X,N,s,t]),o.useEffect(()=>{if(!j)return;const A=[];N.slice(L,X).forEach((oe,G)=>{oe.items.forEach(se=>{A.push(se.path)})});const K=A.filter(oe=>!E[oe]);if(K.length===0)return;const Z=K.slice(0,16);let ne=!1;return Promise.all(Z.map(async oe=>{try{const G=await It(s,oe);!ne&&G&&G.meta&&S(se=>se[oe]?se:{...se,[oe]:G.meta})}catch{}})),()=>{ne=!0}},[j,N,L,X,s,E]),o.useEffect(()=>{if(!j)return;const A=a.slice(0,48).map(Z=>Z.path).filter(Z=>!E[Z]);if(A.length===0)return;let K=!1;return Promise.all(A.slice(0,24).map(async Z=>{try{const ne=await It(s,Z);!K&&ne&&ne.meta&&S(oe=>oe[Z]?oe:{...oe,[Z]:ne.meta})}catch{}})),()=>{K=!0}},[j,a,s]);const le=d!==null?`photo-${d}`:void 0;return e.jsx("div",{id:"modern-results-grid",ref:k,className:"relative",style:{height:Y},role:"grid","aria-multiselectable":"true","aria-activedescendant":le,tabIndex:0,children:N.slice(L,X).map((A,K)=>{const Z=L+K,ne=O[Z],oe=Math.max(0,v-2*16),G=A.items.reduce((B,U)=>B+(p[U.path]||I),0),se=Math.max(120,Math.floor((oe-r*(A.items.length-1))/Math.max(.01,G)));return e.jsx("div",{className:"absolute left-0 right-0",style:{top:ne},children:e.jsx("div",{className:"flex",style:{gap:r},children:A.items.map((B,U)=>{const pe=D[Z]?.[U],te=p[B.path]||I,me=Math.floor(se*te),W=u.has(B.path),ge=d!==null&&pe===d,Ce=B.path.split("/").pop()||B.path;return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden transition-all duration-200 hover:shadow ${W?"ring-2 ring-blue-500":""} ${ge?"outline outline-2 outline-indigo-500":""} ${m[B.path]?"scale-95":""}`,style:{width:me,height:se},onClick:()=>c(B.path),onDoubleClick:()=>l(B.path),onTouchStart:ee=>_(B.path,ee),onTouchMove:ee=>Q(B.path,ee),onTouchEnd:ee=>M(B.path),title:B.path,"data-photo-idx":pe,id:`photo-${pe}`,role:"gridcell","aria-selected":W,tabIndex:ge?0:-1,children:[e.jsx(Da,{src:Fe(s,t,B.path,256),alt:B.path,className:"w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",enableProgressiveLoading:!0}),qe.isVideoFile(B.path)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(pt,{className:"w-6 h-6 text-white ml-1"})})}),j&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:Ce,children:Ce}),e.jsx("div",{className:"flex items-center gap-1",children:(()=>{const ee=E[B.path],re=[];return ee&&(ee.camera&&re.push(String(ee.camera)),typeof ee.fnumber=="number"&&re.push(`f/${ee.fnumber}`),typeof ee.iso=="number"&&re.push(`ISO ${ee.iso}`)),typeof B.score=="number"&&re.push(B.score.toFixed(2)),re.slice(0,3).map((ie,q)=>e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:ie},q))})()})]}),y&&typeof y[B.path]=="number"&&y[B.path]>0&&e.jsxs("div",{className:"absolute bottom-1 left-1 px-1 py-0.5 rounded bg-black/50 text-yellow-300 text-[10px] flex items-center gap-0.5",children:[e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M12 .587l3.668 7.431 8.2 1.193-5.934 5.787 1.401 8.168L12 18.896l-7.335 3.87 1.401-8.168L.132 9.211l8.2-1.193z"})}),e.jsx("span",{children:y[B.path]})]}),W&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),T===B.path&&e.jsxs("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center gap-3",onClick:()=>h(null),children:[e.jsx("div",{className:"text-white text-sm font-medium mb-2",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),H(B.path,"open")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),H(B.path,"open"))},className:"w-12 h-12 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Open",children:e.jsx(pt,{className:"w-5 h-5 ml-0.5"})}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),H(B.path,"favorite")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),H(B.path,"favorite"))},className:"w-12 h-12 bg-pink-500 hover:bg-pink-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Favorite",children:e.jsx(Gt,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),H(B.path,"share")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),H(B.path,"share"))},className:"w-12 h-12 bg-green-500 hover:bg-green-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Share",children:e.jsx(gs,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),H(B.path,"download")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),H(B.path,"download"))},className:"w-12 h-12 bg-purple-500 hover:bg-purple-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Download",children:e.jsx(He,{className:"w-5 h-5"})})]}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),h(null)},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),h(null))},className:"mt-4 text-white/70 hover:text-white text-xs",children:"Tap anywhere to close"})]})]},B.path)})})},Z)})})});kn.displayName="JustifiedResults";class Rl{constructor(t){de(this,"config");this.config=t}async search(t,a=24){return Ss(this.config.dir,t,this.config.provider,a)}async searchWorkspace(t,a=24){return wa(this.config.dir,t,this.config.provider,a)}async searchSimilar(t,a=24){return Zr(this.config.dir,t,this.config.provider,a)}async searchSimilarPlus(t,a,r=.5,n=24){return Ar(this.config.dir,t,this.config.provider,n,a,r)}async buildIndex(t=32){return Wt(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async buildFastIndex(t){return ya(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async buildCaptions(t){return Br(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getCollections(){return en(this.config.dir)}async setCollection(t,a){return us(this.config.dir,t,a)}async deleteCollection(t){return tn(this.config.dir,t)}async getSmartCollections(){return sn(this.config.dir)}async setSmartCollection(t,a){return an(this.config.dir,t,a)}async deleteSmartCollection(t){return rn(this.config.dir,t)}async resolveSmartCollection(t,a=24){return nn(this.config.dir,t,this.config.provider,a)}async buildTrips(){return ln(this.config.dir,this.config.provider)}async getTrips(){return cn(this.config.dir)}async buildFaces(){return Ta(this.config.dir,this.config.provider)}async getFaceClusters(){return Ea(this.config.dir)}async nameFaceCluster(t,a){return Pa(this.config.dir,t,a)}async buildOCR(t){return va(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async getOCRSnippets(t,a=160){return on(this.config.dir,t,a)}async getMetadata(){return Ca(this.config.dir)}async getMetadataDetail(t){return It(this.config.dir,t)}async buildMetadata(){return Sa(this.config.dir,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getTags(){return Na(this.config.dir)}async setTags(t,a){return Yr(this.config.dir,t,a)}async getMapData(){return fa(this.config.dir)}async getFavorites(){return pa(this.config.dir)}async setFavorite(t,a){return kt(this.config.dir,t,a)}async getSavedSearches(){return ga(this.config.dir)}async addSavedSearch(t,a,r){return Vr(this.config.dir,t,a,r)}async deleteSavedSearch(t){return qr(this.config.dir,t)}async editImage(t,a){return Jr(this.config.dir,t,a)}async upscaleImage(t,a=2,r="pil"){return Xr(this.config.dir,t,a,r)}async exportImages(t,a,r="copy",n=!1,i=!1){return $t(this.config.dir,t,a,r,n,i)}async openExternal(t){return Qr(this.config.dir,t)}async getLibrary(t=120,a=0){return Yt(this.config.dir,this.config.provider,t,a,{hfToken:this.config.hfToken,openaiKey:this.config.openaiKey})}async getWorkspace(){return ja()}async addToWorkspace(t){return xt(t)}async removeFromWorkspace(t){return Kr(t)}async deleteImages(t,a=!0){return $a(this.config.dir,t,a)}async undoDelete(){return Ma(this.config.dir)}async findLookalikes(t=5){return Wr(this.config.dir,t)}async resolveLookalikes(t){return Gr(this.config.dir,t)}async runDiagnostics(){return ba(this.config.dir,this.config.provider,this.config.openaiKey,this.config.hfToken)}async submitFeedback(t,a,r,n){return Hr(this.config.dir,t,a,r,n)}async getTodos(){return hs()}getThumbnailUrl(t){return Fe(this.config.dir,this.config.provider,t)}getFaceThumbnailUrl(t,a,r=196){return ka(this.config.dir,this.config.provider,t,a,r)}async autoTag(){return Ia(this.config.dir,this.config.provider)}}let ms=null;function Ol(s){return ms=new Rl(s),ms}function Be(){if(!ms)throw new Error("PhotoVault API not initialized. Call initializeAPI first.");return ms}function Sn({imagePath:s,onClose:t,onSave:a}){const[r,n]=o.useState(s),[i,u]=o.useState(s),[c,l]=o.useState(0),[d,g]=o.useState(!1),[y,j]=o.useState(!1),[k,v]=o.useState(!1),[f,p]=o.useState({x:0,y:0,w:100,h:100}),[w,T]=o.useState(2),[h,m]=o.useState("pil"),[C,I]=o.useState(!1),[E,S]=o.useState([s]),[N,D]=o.useState(0),[_,Q]=o.useState(!1),[M,H]=o.useState({brightness:100,contrast:100,saturation:100}),$=Be(),F=o.useRef(null),V=o.useRef(null),Y=async G=>{I(!0);try{const se={rotate:G},B=await $.editImage(r,se);le(B.out_path),n(B.out_path),l(0)}catch(se){console.error("Failed to rotate image:",se)}finally{I(!1)}},O=async G=>{I(!0);try{const se={flip:G},B=await $.editImage(r,se);le(B.out_path),n(B.out_path),G==="h"?g(!1):j(!1)}catch(se){console.error("Failed to flip image:",se)}finally{I(!1)}},J=async()=>{if(F.current){I(!0);try{const G=F.current,B={crop:{x:Math.round(f.x/100*G.naturalWidth),y:Math.round(f.y/100*G.naturalHeight),w:Math.round(f.w/100*G.naturalWidth),h:Math.round(f.h/100*G.naturalHeight)}},U=await $.editImage(r,B);le(U.out_path),n(U.out_path),v(!1)}catch(G){console.error("Failed to crop image:",G)}finally{I(!1)}}},L=async()=>{I(!0);try{const G=await $.upscaleImage(r,w,h);le(G.out_path),n(G.out_path)}catch(G){console.error("Failed to upscale image:",G)}finally{I(!1)}},X=async()=>{if(!(M.brightness===100&&M.contrast===100&&M.saturation===100)){I(!0);try{alert("Adjustments would be applied here. In a full implementation, this would process the image with the selected adjustments.")}catch(G){console.error("Failed to apply adjustments:",G)}finally{I(!1)}}},le=G=>{const se=E.slice(0,N+1);se.push(G),S(se),D(se.length-1)},A=()=>{N>0&&(D(N-1),n(E[N-1]))},K=()=>{N<E.length-1&&(D(N+1),n(E[N+1]))},Z=()=>{n(i),S([i]),D(0),H({brightness:100,contrast:100,saturation:100})},ne=()=>{a&&a(r),t&&t()},oe=async()=>{try{const G=prompt("Enter export destination folder:");if(!G)return;const se=await $.exportImages([r],G,"copy",!1,!1);alert(`Exported to: ${se.dest}`)}catch(G){console.error("Failed to export image:",G)}};return e.jsxs("div",{className:"image-editor",children:[e.jsxs("div",{className:"editor-toolbar",children:[e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:()=>Y(90),disabled:C,className:"toolbar-btn",title:"Rotate 90",children:e.jsx(Js,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>O("h"),disabled:C,className:"toolbar-btn",title:"Flip Horizontal",children:[e.jsx(wi,{className:"w-4 h-4"}),e.jsx(Ni,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>O("v"),disabled:C,className:"toolbar-btn",title:"Flip Vertical",children:[e.jsx(ki,{className:"w-4 h-4"}),e.jsx(Si,{className:"w-4 h-4"})]}),e.jsx("button",{onClick:()=>v(!k),disabled:C,className:`toolbar-btn ${k?"active":""}`,title:"Crop",children:e.jsx(Ci,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"toolbar-group",children:e.jsx("button",{onClick:()=>Q(!_),className:"toolbar-btn",title:"Before/After Toggle",children:e.jsx("span",{children:"Before/After"})})}),e.jsxs("div",{className:"toolbar-group",children:[e.jsxs("select",{value:w,onChange:G=>T(Number(G.target.value)),className:"toolbar-select",children:[e.jsx("option",{value:2,children:"2x"}),e.jsx("option",{value:4,children:"4x"})]}),e.jsxs("select",{value:h,onChange:G=>m(G.target.value),className:"toolbar-select",children:[e.jsx("option",{value:"pil",children:"PIL"}),e.jsx("option",{value:"realesrgan",children:"RealESRGAN"})]}),e.jsx("button",{onClick:L,disabled:C,className:"toolbar-btn",title:"Upscale",children:e.jsx(gr,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:A,disabled:N===0||C,className:"toolbar-btn",children:"Undo"}),e.jsx("button",{onClick:K,disabled:N===E.length-1||C,className:"toolbar-btn",children:"Redo"})]}),e.jsxs("div",{className:"toolbar-group ml-auto",children:[e.jsx("button",{onClick:Z,className:"toolbar-btn",title:"Revert to Original",children:"Revert"}),e.jsxs("button",{onClick:oe,className:"toolbar-btn",children:[e.jsx(He,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:ne,className:"btn btn-primary",children:[e.jsx(fr,{className:"w-4 h-4"}),"Save"]}),t&&e.jsx("button",{onClick:t,className:"toolbar-btn",children:e.jsx($e,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"adjustment-panel",children:[e.jsxs("div",{className:"adjustment-control",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsx("label",{children:"Brightness"}),e.jsx("input",{type:"range",min:"0",max:"200",value:M.brightness,onChange:G=>H({...M,brightness:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[M.brightness,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("label",{children:"Contrast"}),e.jsx("input",{type:"range",min:"0",max:"200",value:M.contrast,onChange:G=>H({...M,contrast:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[M.contrast,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(Bt,{className:"w-4 h-4"}),e.jsx("label",{children:"Saturation"}),e.jsx("input",{type:"range",min:"0",max:"200",value:M.saturation,onChange:G=>H({...M,saturation:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[M.saturation,"%"]})]}),e.jsx("button",{onClick:X,disabled:C,className:"btn btn-secondary",children:"Apply Adjustments"})]}),e.jsxs("div",{className:"editor-canvas",children:[C&&e.jsxs("div",{className:"processing-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),e.jsxs("div",{className:"image-container",children:[_?e.jsxs("div",{className:"before-after-container",children:[e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"Before"}),e.jsx("img",{src:$.getThumbnailUrl(i),alt:"Original"})]}),e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"After"}),e.jsx("img",{src:$.getThumbnailUrl(r),alt:"Edited"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{ref:F,src:$.getThumbnailUrl(r),alt:"Editing",style:{transform:`rotate(${c}deg) ${d?"scaleX(-1)":""} ${y?"scaleY(-1)":""}`,filter:`brightness(${M.brightness}%) contrast(${M.contrast}%) saturate(${M.saturation}%)`}}),e.jsx("canvas",{ref:V,style:{display:"none"}})]}),k&&e.jsx("div",{className:"crop-overlay",style:{left:`${f.x}%`,top:`${f.y}%`,width:`${f.w}%`,height:`${f.h}%`},children:e.jsxs("div",{className:"crop-controls",children:[e.jsxs("button",{onClick:J,className:"btn btn-primary btn-sm",children:[e.jsx(Ct,{className:"w-3 h-3"}),"Apply"]}),e.jsxs("button",{onClick:()=>v(!1),className:"btn btn-secondary btn-sm",children:[e.jsx($e,{className:"w-3 h-3"}),"Cancel"]})]})})]})]}),e.jsx("style",{jsx:!0,children:`
        .image-editor {
          display: flex;
          flex-direction: column;
          height: 100vh;
          background: var(--bg-primary);
        }

        .editor-toolbar {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .toolbar-group {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .toolbar-group.ml-auto {
          margin-left: auto;
        }

        .toolbar-btn {
          display: flex;
          align-items: center;
          gap: 0.25rem;
          padding: 0.5rem 0.75rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .toolbar-btn:hover:not(:disabled) {
          background: var(--bg-tertiary);
          border-color: var(--accent-primary);
        }

        .toolbar-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .toolbar-btn.active {
          background: var(--accent-primary);
          color: white;
        }

        .toolbar-select {
          padding: 0.5rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
        }

        .adjustment-panel {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 0.5rem 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .adjustment-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .adjustment-control label {
          font-size: 0.875rem;
          white-space: nowrap;
        }

        .adjustment-slider {
          width: 100px;
        }

        .editor-canvas {
          flex: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .processing-overlay {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 10;
          color: white;
        }

        .image-container {
          position: relative;
          max-width: 90%;
          max-height: 90%;
        }

        .before-after-container {
          display: flex;
          gap: 2rem;
          max-width: 100%;
          max-height: 100%;
        }

        .before-after-panel {
          flex: 1;
          text-align: center;
        }

        .before-after-panel h3 {
          margin-bottom: 0.5rem;
          color: white;
        }

        .before-after-panel img {
          max-width: 100%;
          max-height: 80vh;
          object-fit: contain;
        }

        .image-container img {
          max-width: 100%;
          max-height: 100%;
          transition: transform 0.3s;
        }

        .crop-overlay {
          position: absolute;
          border: 2px solid var(--accent-primary);
          background: rgba(0, 122, 255, 0.1);
          cursor: move;
        }

        .crop-controls {
          position: absolute;
          bottom: -40px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 0.5rem;
          white-space: nowrap;
        }

        .btn-sm {
          padding: 0.25rem 0.5rem;
          font-size: 0.875rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .editor-toolbar {
            flex-direction: column;
            align-items: stretch;
          }
          
          .toolbar-group {
            flex-wrap: wrap;
            justify-content: center;
          }
          
          .adjustment-panel {
            flex-direction: column;
            align-items: stretch;
          }
          
          .adjustment-control {
            justify-content: space-between;
          }
        }
      `})]})}class St{static async verifyFaces(t,a,r){const n=[];for(const i of a){let u={clusterId:"",confidence:0};for(const[c,l]of r){const d=this.calculateFaceSimilarity(i.embedding,l.centroid);d>u.confidence&&(u={clusterId:c,confidence:d})}u.confidence>this.faceThreshold&&n.push({clusterId:u.clusterId,confidence:u.confidence,suggested:!0,faceBox:i.box})}return n}static async detectPets(t){const a=[],r=[{type:"dog",breed:"Golden Retriever",confidence:.92},{type:"cat",breed:"Siamese",confidence:.88}];for(const n of r)n.confidence>this.petThreshold&&a.push({...n,box:{x:100,y:100,width:200,height:200}});return a}static async analyzeScene(t){const a={wedding:["bride","groom","ceremony","cake","dress"],birthday:["cake","candles","balloons","party","celebration"],hiking:["mountain","trail","backpack","forest","outdoors"],beach:["ocean","sand","waves","sunset","swimming"],sports:["ball","field","court","team","game"],concert:["stage","crowd","lights","music","performance"],graduation:["cap","gown","diploma","ceremony","academic"]},r={primary:"outdoor",categories:["nature","landscape"],activities:[],events:[],objects:[{name:"mountain",confidence:.95},{name:"trees",confidence:.89},{name:"sky",confidence:.92}],confidence:.88};for(const[n,i]of Object.entries(a))i.filter(c=>r.objects.some(l=>l.name.includes(c))).length>=2&&r.events.push(n);return r.objects.some(n=>n.name.includes("sport"))&&r.activities.push("sports"),r.objects.some(n=>n.name.includes("mountain")||n.name.includes("trail"))&&r.activities.push("hiking"),r}static async assessQuality(t,a){const r={overall:0,sharpness:0,exposure:0,composition:0,colorBalance:0,noise:0,issues:[]};return a?(r.sharpness=this.calculateSharpness(a),r.exposure=this.calculateExposure(a),r.composition=this.calculateComposition(a),r.colorBalance=this.calculateColorBalance(a),r.noise=this.calculateNoise(a)):(r.sharpness=Math.random()*100,r.exposure=Math.random()*100,r.composition=Math.random()*100,r.colorBalance=Math.random()*100,r.noise=100-Math.random()*30),r.overall=r.sharpness*this.qualityWeights.sharpness+r.exposure*this.qualityWeights.exposure+r.composition*this.qualityWeights.composition+r.colorBalance*this.qualityWeights.colorBalance+r.noise*this.qualityWeights.noise,r.sharpness<40&&r.issues.push("Blurry"),r.exposure<30&&r.issues.push("Underexposed"),r.exposure>85&&r.issues.push("Overexposed"),r.composition<40&&r.issues.push("Poor composition"),r.noise<70&&r.issues.push("Noisy"),r}static async generateAutoTags(t){const a=[];t.scene&&(a.push({tag:t.scene.primary,confidence:t.scene.confidence}),t.scene.categories.forEach(n=>a.push({tag:n,confidence:t.scene.confidence*.9})),t.scene.activities.forEach(n=>a.push({tag:n,confidence:.85})),t.scene.events.forEach(n=>a.push({tag:n,confidence:.9}))),t.quality&&(t.quality.overall>80&&a.push({tag:"high-quality",confidence:.95}),t.quality.sharpness>85&&a.push({tag:"sharp",confidence:.9}),t.quality.issues.forEach(n=>a.push({tag:n.toLowerCase(),confidence:.8}))),t.pets&&t.pets.length>0&&t.pets.forEach(n=>{a.push({tag:n.type,confidence:n.confidence}),n.breed&&a.push({tag:n.breed,confidence:n.confidence*.8})});const r=new Map;return a.forEach(n=>{const i=r.get(n.tag);(!i||n.confidence>i)&&r.set(n.tag,n.confidence)}),Array.from(r.entries()).map(([n,i])=>({tag:n,confidence:i})).sort((n,i)=>i.confidence-n.confidence)}static calculateFaceSimilarity(t,a){let r=0,n=0,i=0;for(let u=0;u<t.length;u++)r+=t[u]*a[u],n+=t[u]*t[u],i+=a[u]*a[u];return r/(Math.sqrt(n)*Math.sqrt(i))}static calculateSharpness(t){const{data:a,width:r,height:n}=t;let i=0,u=0,c=0;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const g=(l*r+d)*4,j=-((a[g]+a[g+1]+a[g+2])/3)+(a[((l-1)*r+d)*4]+a[((l+1)*r+d)*4]+a[(l*r+(d-1))*4]+a[(l*r+(d+1))*4])/4;u+=j,c++}u/=c;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const g=(l*r+d)*4,j=-((a[g]+a[g+1]+a[g+2])/3)+(a[((l-1)*r+d)*4]+a[((l+1)*r+d)*4]+a[(l*r+(d-1))*4]+a[(l*r+(d+1))*4])/4;i+=Math.pow(j-u,2)}return i/=c,Math.min(100,Math.sqrt(i)*10)}static calculateExposure(t){const{data:a}=t,r=new Array(256).fill(0);for(let l=0;l<a.length;l+=4){const d=(a[l]+a[l+1]+a[l+2])/3;r[Math.floor(d)]++}const n=a.length/4,i=r.slice(0,20).reduce((l,d)=>l+d,0)/n,u=r.slice(235,256).reduce((l,d)=>l+d,0)/n;let c=100;return c-=i*200,c-=u*200,Math.max(0,Math.min(100,c))}static calculateComposition(t){const{width:a,height:r}=t;return 70+Math.random()*30}static calculateColorBalance(t){const{data:a}=t;let r=0,n=0,i=0;const u=a.length/4;for(let k=0;k<a.length;k+=4)r+=a[k],n+=a[k+1],i+=a[k+2];const c=r/u,l=n/u,d=i/u,g=Math.max(c,l,d),y=Math.min(c,l,d);return(1-(g-y)/g)*100}static calculateNoise(t){const{data:a,width:r,height:n}=t;let i=0,u=0;for(let c=1;c<n-1;c+=10)for(let l=1;l<r-1;l+=10){const d=(c*r+l)*4,g=(a[d]+a[d+1]+a[d+2])/3;let y=0;for(let j=-1;j<=1;j++)for(let k=-1;k<=1;k++){const v=((c+j)*r+(l+k))*4,f=(a[v]+a[v+1]+a[v+2])/3;y+=Math.pow(f-g,2)}i+=Math.sqrt(y/9),u++}return i/=u,Math.max(0,100-i)}}de(St,"faceThreshold",.85),de(St,"petThreshold",.7),de(St,"sceneThreshold",.6),de(St,"qualityWeights",{sharpness:.3,exposure:.25,composition:.25,colorBalance:.15,noise:.05});function _l({imagePath:s,detectedFaces:t=[],knownPeople:a,onVerify:r,onCreateNew:n}){const[i,u]=o.useState([]),[c,l]=o.useState(0),[d,g]=o.useState(""),[y,j]=o.useState(!1),[k,v]=o.useState(!1);o.useEffect(()=>{async function w(){if(t.length){v(!0);try{const T=await St.verifyFaces(s,t,a);u(T)}catch(T){console.error("Face verification failed:",T)}finally{v(!1)}}}w()},[s,t,a]);const f=(w,T)=>{r(w,T),u(h=>h.map(m=>m.clusterId===w?{...m,verified:T}:m))},p=()=>{d.trim()&&(n(d),g(""),j(!1))};return t.length?k?e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Analyzing faces..."})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Face Recognition"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," face",t.length!==1?"s":""," detected"]})]}),t.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:t.map((w,T)=>e.jsx("button",{onClick:()=>l(T),className:`relative w-16 h-16 rounded overflow-hidden border-2 transition-colors ${c===T?"border-blue-500":"border-gray-300"}`,children:e.jsx("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium",children:T+1})})},T))}),i[c]&&e.jsxs("div",{className:"space-y-3",children:[i[c].suggested?e.jsx("div",{className:"p-3 bg-blue-50 rounded",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Suggested: ",a.get(i[c].clusterId)?.name||"Unknown"]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Confidence: ",(i[c].confidence*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(i[c].clusterId,!0),className:`px-3 py-1 text-xs rounded ${i[c].verified===!0?"bg-green-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:" Correct"}),e.jsx("button",{onClick:()=>f(i[c].clusterId,!1),className:`px-3 py-1 text-xs rounded ${i[c].verified===!1?"bg-red-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:" Wrong"})]})]})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-600",children:"No match found"})}),y?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:w=>g(w.target.value),onKeyPress:w=>w.key==="Enter"&&p(),placeholder:"Enter person's name",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:border-blue-500",autoFocus:!0}),e.jsx("button",{onClick:p,className:"px-3 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Add"}),e.jsx("button",{onClick:()=>{j(!1),g("")},className:"px-3 py-2 text-sm bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"})]}):e.jsx("button",{onClick:()=>j(!0),className:"w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50",children:"+ Tag as new person"})]})]}):e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No faces detected in this photo"})})}function Ll({imagePath:s,show:t,imageData:a}){const[r,n]=o.useState(null),[i,u]=o.useState(!1);if(o.useEffect(()=>{if(!t)return;async function g(){u(!0);try{const y=await St.assessQuality(s,a);n(y)}catch(y){console.error("Quality assessment failed:",y)}finally{u(!1)}}g()},[s,t,a]),!t)return null;const c=g=>g>=80?"text-green-600":g>=60?"text-yellow-600":g>=40?"text-orange-600":"text-red-600",l=g=>g>=80?"Excellent":g>=60?"Good":g>=40?"Fair":"Poor",d=(g,y)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:y}),e.jsx("span",{className:c(g),children:g.toFixed(0)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all ${g>=80?"bg-green-500":g>=60?"bg-yellow-500":g>=40?"bg-orange-500":"bg-red-500"}`,style:{width:`${g}%`}})})]});return i?e.jsx("div",{className:"absolute top-2 left-2 bg-white/90 backdrop-blur rounded-lg p-3 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Analyzing quality..."})]})}):r?e.jsxs("div",{className:"absolute top-2 left-2 bg-white/95 backdrop-blur rounded-lg p-3 shadow-lg max-w-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:"Quality Score"}),e.jsx("p",{className:`text-2xl font-bold ${c(r.overall)}`,children:r.overall.toFixed(0)})]}),e.jsx("div",{className:`text-sm ${c(r.overall)}`,children:l(r.overall)})]}),e.jsxs("div",{className:"space-y-2",children:[d(r.sharpness,"Sharpness"),d(r.exposure,"Exposure"),d(r.composition,"Composition"),d(r.colorBalance,"Color Balance"),d(r.noise,"Noise Level")]}),r.issues.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Issues Detected:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.issues.map((g,y)=>e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded",children:g},y))})]})]}):null}const Al={minSwipeDistance:50,maxSwipeTime:300,minPinchDistance:10,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!0,pullToRefreshThreshold:80};class zl{constructor(t={}){de(this,"config");de(this,"touchStartPoints",[]);de(this,"gestureState",{isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0});de(this,"touchStartTime",0);de(this,"lastTouchEndTime",0);de(this,"doubleTapTimer",null);de(this,"pullStartY",0);de(this,"isPulling",!1);de(this,"onSwipeCallback");de(this,"onPinchCallback");de(this,"onPanCallback");de(this,"onDoubleTapCallback");de(this,"onPullToRefreshCallback");this.config={...Al,...t}}onSwipe(t){return this.onSwipeCallback=t,this}onPinch(t){return this.onPinchCallback=t,this}onPan(t){return this.onPanCallback=t,this}onDoubleTap(t){return this.onDoubleTapCallback=t,this}onPullToRefresh(t){return this.onPullToRefreshCallback=t,this}handleTouchStart(t){this.touchStartTime=Date.now(),this.touchStartPoints=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));const a=Date.now();this.doubleTapTimer&&a-this.lastTouchEndTime<300?(this.handleDoubleTap(this.touchStartPoints[0].x,this.touchStartPoints[0].y),this.clearDoubleTapTimer()):this.startDoubleTapTimer(),this.gestureState.lastScale=this.gestureState.scale,this.gestureState.lastTranslateX=this.gestureState.translateX,this.gestureState.lastTranslateY=this.gestureState.translateY,this.config.enablePullToRefresh&&this.isAtTopOfPage()&&(this.pullStartY=this.touchStartPoints[0].y,this.isPulling=!0)}handleTouchMove(t){t.preventDefault();const a=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));a.length===1?this.handleSingleTouchMove(a[0]):a.length===2&&this.handlePinchMove(a)}handleTouchEnd(t){const a=Date.now()-this.touchStartTime;this.lastTouchEndTime=Date.now(),this.gestureState.isSwiping&&a<this.config.maxSwipeTime&&this.handleSwipe(t.changedTouches[0]),this.gestureState.isPinching=!1,this.gestureState.isPanning=!1,this.gestureState.isSwiping=!1,this.isPulling=!1}handleSingleTouchMove(t){const a=this.touchStartPoints[0];if(!a)return;const r=t.x-a.x,n=t.y-a.y,i=Math.sqrt(r*r+n*n);if(this.isPulling&&this.config.enablePullToRefresh&&t.y-this.pullStartY>this.config.pullToRefreshThreshold){this.triggerPullToRefresh(),this.isPulling=!1;return}if(this.gestureState.scale>1){this.gestureState.isPanning=!0,this.gestureState.translateX=this.gestureState.lastTranslateX+r,this.gestureState.translateY=this.gestureState.lastTranslateY+n,this.onPanCallback&&this.onPanCallback(r,n);return}i>this.config.minSwipeDistance&&!this.gestureState.isPanning&&(this.gestureState.isSwiping=!0)}handlePinchMove(t){if(t.length!==2)return;const a=this.touchStartPoints.find(u=>u.id===t[0].id),r=this.touchStartPoints.find(u=>u.id===t[1].id);if(!a||!r)return;const n=this.getDistance(a,r),i=this.getDistance(t[0],t[1]);if(Math.abs(i-n)>this.config.minPinchDistance){this.gestureState.isPinching=!0;const u=i/n*this.gestureState.lastScale,c=Math.max(this.config.minScale,Math.min(this.config.maxScale,u)),l=(t[0].x+t[1].x)/2,d=(t[0].y+t[1].y)/2;this.gestureState.scale=c,this.onPinchCallback&&this.onPinchCallback(c,l,d)}}handleSwipe(t){const a=this.touchStartPoints[0];if(!a)return;const r=t.clientX-a.x,n=t.clientY-a.y,i=Math.abs(r),u=Math.abs(n);if(i>u&&i>this.config.minSwipeDistance){const c={left:r<0,right:r>0,up:!1,down:!1};this.onSwipeCallback&&this.onSwipeCallback(c)}}handleDoubleTap(t,a){this.onDoubleTapCallback&&this.onDoubleTapCallback(t,a)}triggerPullToRefresh(){this.onPullToRefreshCallback&&this.onPullToRefreshCallback()}getDistance(t,a){const r=a.x-t.x,n=a.y-t.y;return Math.sqrt(r*r+n*n)}isAtTopOfPage(){return window.scrollY<=10}startDoubleTapTimer(){this.clearDoubleTapTimer(),this.doubleTapTimer=window.setTimeout(()=>{this.doubleTapTimer=null},300)}clearDoubleTapTimer(){this.doubleTapTimer&&(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null)}reset(){this.gestureState={isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0},this.touchStartPoints=[],this.isPulling=!1}getScale(){return this.gestureState.scale}getTranslation(){return{x:this.gestureState.translateX,y:this.gestureState.translateY}}isGestureActive(){return this.gestureState.isPinching||this.gestureState.isPanning||this.gestureState.isSwiping}}function Ul(s,t){const a=React.useRef();return React.useEffect(()=>{if(!s.current)return;a.current=new zl(t);const r=s.current,n=c=>{a.current?.handleTouchStart(c)},i=c=>{a.current?.handleTouchMove(c)},u=c=>{a.current?.handleTouchEnd(c)};return r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("touchmove",i,{passive:!1}),r.addEventListener("touchend",u,{passive:!1}),()=>{r.removeEventListener("touchstart",n),r.removeEventListener("touchmove",i),r.removeEventListener("touchend",u)}},[s,t]),a.current}function Bl({dir:s,engine:t,path:a,onPrev:r,onNext:n,onClose:i,onReveal:u,onFavorite:c,onMoreLikeThis:l}){if(!a)return null;const d=o.useRef(null),g=o.useRef(null),[y,j]=o.useState(1),[k,v]=o.useState(0),[f,p]=o.useState(0),[w,T]=o.useState(!1),h=o.useRef({x:0,y:0,tx:0,ty:0}),[m,C]=o.useState(!1),[I,E]=o.useState(!1),[S,N]=o.useState(null),[D,_]=o.useState(!1),[Q,M]=o.useState(a),[H,$]=o.useState(!1),[F,V]=o.useState(!1),[Y,O]=o.useState(null),[J,L]=o.useState(!1),X=Ul(d,{minSwipeDistance:50,maxSwipeTime:300,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!1});o.useEffect(()=>{X&&X.onSwipe(W=>{W.left?n():W.right&&r()}).onPinch((W,ge,Ce)=>{le(W-y,ge,Ce)}).onDoubleTap((W,ge)=>{y===1?le(1,W,ge):G()})},[X,r,n,y]);function le(W,ge,Ce){const ee=y,re=Math.min(5,Math.max(1,+(ee+W).toFixed(2)));if(re===ee)return;const ie=g.current;if(ie&&ge!==void 0&&Ce!==void 0){const q=ie.getBoundingClientRect(),De=ge-q.left,fe=Ce-q.top,ke=re/ee;v(k+(De-De*ke)),p(f+(fe-fe*ke))}j(re)}function A(W){W.preventDefault();const ge=W.deltaY<0?.1:-.1;le(ge,W.clientX,W.clientY)}function K(W){y!==1&&(T(!0),h.current={x:W.clientX,y:W.clientY,tx:k,ty:f})}function Z(W){if(!w)return;const ge=W.clientX-h.current.x,Ce=W.clientY-h.current.y;v(h.current.tx+ge),p(h.current.ty+Ce)}function ne(){T(!1)}function oe(){T(!1)}function G(){j(1),v(0),p(0)}function se(){le(.2)}function B(){le(-.2)}function U(W){y===1?le(1,W.clientX,W.clientY):G()}function pe(W){if(W.touches.length===1){const ge=W.touches[0];O({x:ge.clientX,y:ge.clientY}),L(!1)}}function te(W){if(!Y||W.touches.length!==1)return;const ge=W.touches[0],Ce=ge.clientX-Y.x,ee=ge.clientY-Y.y,re=Math.abs(Ce),ie=Math.abs(ee);re>ie&&re>30&&L(!0)}function me(W){if(!Y||!J){O(null),L(!1);return}const Ce=W.changedTouches[0].clientX-Y.x;Math.abs(Ce)>50&&(Ce>0?r():n()),O(null),L(!1)}return o.useEffect(()=>{d.current?.focus()},[a]),o.useEffect(()=>{let W=!1;async function ge(){if(!(!m||!a))try{E(!0);const Ce=await It(s,a);W||N(Ce.meta||{})}catch{W||N(null)}finally{W||E(!1)}}return ge(),()=>{W=!0}},[m,s,a]),e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center",onClick:i,onKeyDown:W=>{W.key==="Escape"&&(W.stopPropagation(),i())},children:e.jsxs("div",{className:"relative max-w-6xl w-full p-4",onClick:W=>W.stopPropagation(),ref:d,role:"dialog","aria-modal":"true","aria-label":a,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 text-white",children:[e.jsx("div",{className:"truncate text-sm",children:a}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"bg-white/20 rounded px-2 py-1",children:""}),e.jsx("button",{type:"button",onClick:n,className:"bg-white/20 rounded px-2 py-1",children:""}),e.jsx("button",{type:"button",onClick:()=>C(W=>!W),className:`rounded px-2 py-1 ${m?"bg-blue-600 text-white":"bg-white/20"}`,children:"Info"}),e.jsx("button",{type:"button",onClick:()=>$(W=>!W),className:`rounded px-2 py-1 ${H?"bg-green-600 text-white":"bg-white/20"}`,children:"Quality"}),e.jsx("button",{type:"button",onClick:()=>V(W=>!W),className:`rounded px-2 py-1 ${F?"bg-purple-600 text-white":"bg-white/20"}`,children:"Faces"}),e.jsx("button",{type:"button",onClick:i,className:"bg-white text-black rounded px-2 py-1",children:"Close"})]})]}),e.jsxs("div",{className:"relative bg-black/40 rounded overflow-hidden",onWheel:A,onMouseDown:K,onMouseMove:Z,onMouseUp:ne,onMouseLeave:oe,onDoubleClick:U,onTouchStart:pe,onTouchMove:te,onTouchEnd:me,style:{cursor:y>1&&w?"grabbing":y>1?"grab":"default"},children:[e.jsx("img",{ref:g,src:Fe(s,t,a,1024),className:"w-full h-auto select-none",style:{transform:`translate(${k}px, ${f}px) scale(${y})`,transformOrigin:"0 0"},alt:a,draggable:!1}),e.jsx(Ll,{imagePath:a,show:H})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/10 rounded p-1",children:[e.jsx("button",{type:"button",onClick:B,className:"px-2 py-1 bg-white/20 text-white rounded",children:""}),e.jsxs("div",{className:"text-white text-sm w-12 text-center",children:[Math.round(y*100),"%"]}),e.jsx("button",{type:"button",onClick:se,className:"px-2 py-1 bg-white/20 text-white rounded",children:"+"}),e.jsx("button",{type:"button",onClick:G,className:"px-2 py-1 bg-white/20 text-white rounded",children:"Reset"})]}),e.jsx("button",{type:"button",onClick:u,className:"px-3 py-1 bg-gray-200 rounded",children:"Reveal in Finder/Explorer"}),e.jsx("button",{type:"button",onClick:()=>_(!0),className:"px-3 py-1 bg-green-600 text-white rounded",children:" Edit"}),e.jsx("button",{type:"button",onClick:c,className:"px-3 py-1 bg-pink-600 text-white rounded",children:" Favorite"}),l&&e.jsx("button",{type:"button",onClick:l,className:"px-3 py-1 bg-blue-600 text-white rounded",children:"More like this"})]}),m&&e.jsx("div",{className:"mt-3 bg-white text-gray-900 rounded p-3 max-h-72 overflow-auto",children:I?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading EXIF"}):S?e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[S.camera&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Camera"}),e.jsx("div",{className:"font-medium",children:S.camera})]}),S.lens&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Lens"}),e.jsx("div",{className:"font-medium",children:S.lens})]}),S.iso&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"ISO"}),e.jsx("div",{className:"font-medium",children:S.iso})]}),S.fnumber&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Aperture"}),e.jsxs("div",{className:"font-medium",children:["f/",S.fnumber]})]}),S.shutter&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Shutter"}),e.jsx("div",{className:"font-medium",children:S.shutter})]}),S.datetime&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Date"}),e.jsx("div",{className:"font-medium",children:new Date(S.datetime*1e3).toLocaleString()})]}),S.place&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-500",children:"Place"}),e.jsx("div",{className:"font-medium",children:S.place})]}),Array.isArray(S.tags)&&S.tags.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-500",children:"Tags"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:S.tags.map(W=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 rounded text-xs",children:W},W))})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"No metadata."})}),F&&e.jsx("div",{className:"mt-3 bg-white text-gray-900 rounded p-3",children:e.jsx(_l,{imagePath:a,detectedFaces:S?.faces||[],knownPeople:new Map,onVerify:(W,ge)=>{console.log("Face verified:",W,ge)},onCreateNew:W=>{console.log("New person created:",W)}})}),D&&e.jsx(Sn,{imagePath:a,onSave:W=>{M(W),_(!1)},onClose:()=>_(!1)})]})})}function Hl({videoPath:s,videoUrl:t,onClose:a,onNext:r,onPrevious:n}){const i=o.useRef(null),u=o.useRef(null),[c,l]=o.useState(null),[d,g]=o.useState(!1),[y,j]=o.useState(!1),[k,v]=o.useState(0),[f,p]=o.useState(0),[w,T]=o.useState(1),[h,m]=o.useState(!0),[C,I]=o.useState(!0),[E,S]=o.useState(0),[N,D]=o.useState(!1),[_,Q]=o.useState([]),[M,H]=o.useState(null),[$,F]=o.useState(!1),V=o.useRef();o.useEffect(()=>(Y(),()=>{V.current&&clearTimeout(V.current)}),[s,t]);const Y=async()=>{I(!0);try{const te=await qe.getVideoInfo(s,t);l(te),qe.extractKeyframes(t,10,120,68).then(me=>Q(me)).catch(console.error)}catch(te){console.error("Failed to load video info:",te)}finally{I(!1)}},O=()=>{i.current&&(d?i.current.pause():i.current.play(),g(!d))},J=()=>{i.current&&(i.current.muted=!y,j(!y))},L=te=>{const me=parseFloat(te.target.value);T(me),i.current&&(i.current.volume=me,j(me===0))},X=te=>{if(i.current&&u.current){const me=u.current.getBoundingClientRect(),ge=(te.clientX-me.left)/me.width*f;i.current.currentTime=ge,v(ge)}},le=()=>{if(i.current&&(v(i.current.currentTime),i.current.buffered.length>0)){const te=i.current.buffered.end(i.current.buffered.length-1);S(te/f*100)}},A=()=>{i.current&&p(i.current.duration)},K=te=>{i.current&&(i.current.currentTime+=te)},Z=()=>{i.current&&(document.fullscreenElement?document.exitFullscreen():i.current.requestFullscreen())},ne=()=>{m(!0),V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{d&&m(!1)},3e3)},oe=te=>{switch(te.key){case" ":te.preventDefault(),O();break;case"ArrowLeft":K(-10);break;case"ArrowRight":K(10);break;case"ArrowUp":T(Math.min(1,w+.1));break;case"ArrowDown":T(Math.max(0,w-.1));break;case"m":J();break;case"f":Z();break;case"Escape":a();break}},G=te=>{if(te.touches.length===1){const me=te.touches[0];H({x:me.clientX,y:me.clientY}),F(!1)}},se=te=>{if(!M||te.touches.length!==1)return;const me=te.touches[0],W=me.clientX-M.x,ge=me.clientY-M.y,Ce=Math.abs(W),ee=Math.abs(ge);Ce>ee&&Ce>30&&F(!0)},B=te=>{if(!M||!$){H(null),F(!1);return}const W=te.changedTouches[0].clientX-M.x;Math.abs(W)>50&&(W>0?n&&n():r&&r()),H(null),F(!1)},U=te=>qe.formatDuration(te),pe=f>0?k/f*100:0;return e.jsxs("div",{className:"video-lightbox",onMouseMove:ne,onKeyDown:oe,onTouchStart:G,onTouchMove:se,onTouchEnd:B,tabIndex:0,children:[e.jsx("div",{className:"video-container",children:C?e.jsxs("div",{className:"loading-spinner",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading video..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:i,src:t,onTimeUpdate:le,onLoadedMetadata:A,onEnded:()=>g(!1),onClick:O,className:"video-player"}),e.jsxs("div",{className:`video-controls ${h?"visible":"hidden"}`,children:[e.jsxs("div",{className:"timeline-container",children:[e.jsxs("div",{ref:u,className:"progress-bar",onClick:X,children:[e.jsx("div",{className:"buffered-bar",style:{width:`${E}%`}}),e.jsx("div",{className:"progress-fill",style:{width:`${pe}%`}}),e.jsx("div",{className:"progress-handle",style:{left:`${pe}%`}}),_.length>0&&e.jsx("div",{className:"keyframes",children:_.map((te,me)=>e.jsx("img",{src:te,className:"keyframe",style:{left:`${(me+1)*(100/(_.length+1))}%`},alt:""},me))})]}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:U(k)}),e.jsx("span",{className:"separator",children:"/"}),e.jsx("span",{children:U(f)})]})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsxs("div",{className:"controls-left",children:[e.jsx("button",{onClick:O,className:"control-btn",children:d?e.jsx(bs,{}):e.jsx(pt,{})}),e.jsx("button",{onClick:()=>K(-10),className:"control-btn",children:e.jsx(Wa,{})}),e.jsx("button",{onClick:()=>K(10),className:"control-btn",children:e.jsx(Ga,{})}),e.jsxs("div",{className:"volume-control",children:[e.jsx("button",{onClick:J,className:"control-btn",children:y||w===0?e.jsx(br,{}):e.jsx(Ws,{})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w,onChange:L,className:"volume-slider"})]})]}),e.jsxs("div",{className:"controls-right",children:[e.jsx("button",{onClick:()=>D(!N),className:"control-btn",children:e.jsx(ys,{})}),e.jsx("button",{onClick:Z,className:"control-btn",children:e.jsx(gr,{})}),e.jsx("a",{href:t,download:s.split("/").pop(),className:"control-btn",children:e.jsx(He,{})})]})]})]}),N&&c&&e.jsxs("div",{className:"video-info-overlay",children:[e.jsx("h3",{children:s.split("/").pop()}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{children:["Format: ",c.format]}),e.jsxs("div",{children:["Resolution: ",c.metadata.width,"",c.metadata.height]}),e.jsxs("div",{children:["Duration: ",U(c.metadata.duration)]}),e.jsxs("div",{children:["Codec: ",c.metadata.codec]}),e.jsxs("div",{children:["Quality: ",qe.getResolutionLabel(c.metadata.width,c.metadata.height)]}),e.jsxs("div",{children:["Audio: ",c.metadata.hasAudio?"Yes":"No"]})]})]})]})}),n&&e.jsx("button",{onClick:n,className:"nav-btn nav-prev",children:e.jsx(Wa,{})}),r&&e.jsx("button",{onClick:r,className:"nav-btn nav-next",children:e.jsx(Ga,{})}),e.jsx("button",{onClick:a,className:"close-btn",children:""}),e.jsx("style",{jsx:!0,children:`
        .video-lightbox {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.95);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
        }

        .video-container {
          position: relative;
          width: 90%;
          max-width: 1200px;
          height: 80vh;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .video-player {
          width: 100%;
          height: 100%;
          object-fit: contain;
          cursor: pointer;
        }

        .video-controls {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
          padding: 2rem 1rem 1rem;
          transition: opacity 0.3s;
        }

        .video-controls.hidden {
          opacity: 0;
          pointer-events: none;
        }

        .timeline-container {
          margin-bottom: 1rem;
        }

        .progress-bar {
          position: relative;
          height: 6px;
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
          cursor: pointer;
          margin-bottom: 0.5rem;
        }

        .progress-bar:hover {
          height: 10px;
        }

        .buffered-bar {
          position: absolute;
          height: 100%;
          background: rgba(255, 255, 255, 0.3);
          border-radius: 3px;
        }

        .progress-fill {
          position: absolute;
          height: 100%;
          background: var(--accent-primary);
          border-radius: 3px;
        }

        .progress-handle {
          position: absolute;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 14px;
          height: 14px;
          background: white;
          border-radius: 50%;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .keyframes {
          position: absolute;
          top: -80px;
          left: 0;
          right: 0;
          height: 68px;
          opacity: 0;
          transition: opacity 0.2s;
          pointer-events: none;
        }

        .progress-bar:hover .keyframes {
          opacity: 1;
        }

        .keyframe {
          position: absolute;
          height: 68px;
          width: 120px;
          object-fit: cover;
          border: 2px solid white;
          border-radius: 4px;
          transform: translateX(-50%);
        }

        .time-display {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: white;
          font-size: 0.875rem;
        }

        .control-buttons {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .controls-left, .controls-right {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .control-btn {
          background: none;
          border: none;
          color: white;
          cursor: pointer;
          padding: 0.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: opacity 0.2s;
        }

        .control-btn:hover {
          opacity: 0.7;
        }

        .control-btn svg {
          width: 20px;
          height: 20px;
        }

        .volume-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .volume-slider {
          width: 80px;
          opacity: 0;
          transition: opacity 0.2s;
        }

        .volume-control:hover .volume-slider {
          opacity: 1;
        }

        .video-info-overlay {
          position: absolute;
          top: 2rem;
          left: 2rem;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 1.5rem;
          border-radius: 8px;
          max-width: 400px;
        }

        .video-info-overlay h3 {
          margin-bottom: 1rem;
          font-size: 1.125rem;
        }

        .info-grid {
          display: grid;
          gap: 0.5rem;
          font-size: 0.875rem;
        }

        .nav-btn {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(0, 0, 0, 0.5);
          border: none;
          color: white;
          padding: 1rem;
          cursor: pointer;
          transition: background 0.2s;
        }

        .nav-btn:hover {
          background: rgba(0, 0, 0, 0.8);
        }

        .nav-prev {
          left: 1rem;
        }

        .nav-next {
          right: 1rem;
        }

        .close-btn {
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: none;
          border: none;
          color: white;
          font-size: 2rem;
          cursor: pointer;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .loading-spinner {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 1rem;
          color: white;
        }

        .spinner {
          width: 48px;
          height: 48px;
          border: 3px solid rgba(255, 255, 255, 0.2);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Vl({dir:s,engine:t,library:a,onLoadLibrary:r,selected:n=new Set,onToggleSelect:i,onOpen:u,tagsMap:c={}}){const[l,d]=o.useState("name"),[g,y]=o.useState("asc"),[j,k]=o.useState(!1),v=o.useCallback(m=>{const C=m.split("/").pop()||m,I=C.split(".").pop()?.toLowerCase()||"",S=(c[m]||[]).find(D=>D.startsWith("rating:")),N=S?parseInt(S.split(":")[1]):0;return{name:C,ext:I,rating:N,isVideo:qe.isVideoFile(m)}},[c]),f=o.useMemo(()=>a.length?[...a].sort((m,C)=>{const I=v(m),E=v(C);let S=0;switch(l){case"name":S=I.name.localeCompare(E.name);break;case"rating":S=E.rating-I.rating;break;case"date":S=m.localeCompare(C);break;case"size":S=I.name.localeCompare(E.name);break;case"camera":S=I.name.localeCompare(E.name);break;default:S=0}return g==="desc"?-S:S}):[],[a,l,g,v]),p=o.useMemo(()=>{const m=a.length,C=a.filter(N=>qe.isVideoFile(N)).length,I=m-C,E=n.size,S={1:0,2:0,3:0,4:0,5:0};return a.forEach(N=>{const _=(c[N]||[]).find(Q=>Q.startsWith("rating:"));if(_){const Q=parseInt(_.split(":")[1]);Q>=1&&Q<=5&&S[Q]++}}),{total:m,photos:I,videos:C,selected:E,ratings:S}},[a,n,c]),w=m=>{l===m?y(C=>C==="asc"?"desc":"asc"):(d(m),y("asc"))},T=()=>{i&&a.forEach(m=>{n.has(m)||i(m)})},h=()=>{i&&Array.from(n).forEach(m=>{i(m)})};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"font-semibold",children:"Library"}),e.jsx("button",{onClick:()=>k(!j),className:`p-1 rounded ${j?"bg-blue-100 text-blue-600":"text-gray-500 hover:bg-gray-100"}`,title:"Toggle statistics",children:e.jsx(Ti,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ei,{className:"w-3 h-3 text-gray-400"}),e.jsxs("select",{value:l,onChange:m=>w(m.target.value),className:"text-xs border rounded px-1 py-0.5",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"rating",children:"Rating"}),e.jsx("option",{value:"size",children:"Size"}),e.jsx("option",{value:"camera",children:"Camera"})]}),e.jsx("button",{onClick:()=>y(m=>m==="asc"?"desc":"asc"),className:"text-xs text-gray-500 hover:text-gray-700",title:`Sort ${g==="asc"?"descending":"ascending"}`,children:g==="asc"?"":""})]}),i&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("button",{onClick:T,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"All"}),e.jsx("button",{onClick:h,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"None"})]}),e.jsx("button",{onClick:()=>r(120,0),className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Reload"})]})]}),j&&a.length>0&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 rounded text-xs",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Total: ",p.total]}),e.jsxs("div",{className:"text-gray-600",children:["Photos: ",p.photos]}),e.jsxs("div",{className:"text-gray-600",children:["Videos: ",p.videos]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Selected: ",p.selected]}),e.jsx("div",{className:"text-gray-600",children:p.selected>0&&`${(p.selected/p.total*100).toFixed(1)}%`})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Ratings:"}),e.jsx("div",{className:"flex gap-1",children:Object.entries(p.ratings).map(([m,C])=>e.jsxs("span",{className:"text-gray-600",title:`${m} stars: ${C} photos`,children:[m,":",C]},m))})]})]})}),n.size>0&&e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[n.size," item",n.size!==1?"s":""," selected"]}),a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No items yet. Build the index, then click Reload."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:f.map((m,C)=>{const I=n.has(m),E=v(m);return e.jsxs("div",{className:`relative group cursor-pointer rounded overflow-hidden ${I?"ring-2 ring-blue-500":""}`,onClick:()=>u?u(m):void 0,children:[i&&e.jsx("button",{onClick:S=>{S.stopPropagation(),i(m)},className:`absolute top-1 left-1 z-10 w-5 h-5 rounded border-2 flex items-center justify-center
                      ${I?"bg-blue-600 border-blue-600":"bg-white/80 border-gray-300 opacity-0 group-hover:opacity-100"} transition-opacity`,children:I&&e.jsx(Ct,{className:"w-3 h-3 text-white"})}),e.jsx("img",{src:Fe(s,t,m,196),alt:E.name,title:`${E.name}${E.rating>0?` - ${"".repeat(E.rating)}`:""}`,className:"w-full h-24 object-cover"}),E.isVideo&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-8 h-8 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(pt,{className:"w-4 h-4 text-white ml-0.5"})})}),E.rating>0&&e.jsx("div",{className:"absolute top-1 right-1 bg-black/60 text-white text-xs px-1 rounded",children:"".repeat(E.rating)}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"p-1 text-white text-xs truncate",children:E.name})})]},m)})})]})}function ql({dir:s,engine:t,clusters:a,persons:r,setPersons:n,busy:i,setBusy:u,setNote:c,onLoadFaces:l,onOpenPhotos:d}){const[g,y]=o.useState(null),[j,k]=o.useState([]),[v,f]=o.useState(!1),p=async w=>{try{u("Loading photos...");const T=await xn(s,w);k(T.photos),y(w),f(!0),u(""),c(`Found ${T.photos.length} photos in cluster`)}catch(T){u(""),c(T.message)}};return v&&g?e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Photos in Cluster"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(!1),className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Back"}),e.jsxs("button",{onClick:()=>d?.(j),className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:["View All (",j.length,")"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:j.map((w,T)=>e.jsx("img",{src:Fe(s,t,w,196),alt:`Photo ${T+1}`,className:"w-full h-24 object-cover rounded cursor-pointer hover:ring-2 hover:ring-blue-500",onClick:()=>d?.([w])},T))})]}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"People"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{try{u("Scanning faces");const w=await Ta(s,t);u(""),c(`Faces: ${w.faces}, clusters: ${w.clusters}`),await l()}catch(w){u(""),c(w.message)}},className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build/Update"}),e.jsx("button",{onClick:l,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No face clusters yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-sm",children:a.map(w=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:w.name||`Cluster ${w.id}`,children:w.name||`Cluster ${w.id}`}),e.jsx("div",{className:"text-xs text-gray-600",children:w.size})]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-1",children:w.examples.map(([T,h],m)=>e.jsx("img",{src:ka(s,t,T,h,196),className:"w-full h-16 object-cover rounded"},m))}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{const T=w.name||"";if(!T)return;const h=r.includes(T)?r.filter(m=>m!==T):[...r,T];n(h)},disabled:!w.name,className:`px-2 py-1 rounded text-xs ${w.name&&r.includes(w.name)?"bg-blue-700 text-white":w.name?"bg-blue-600 text-white":"bg-gray-200"}`,children:w.name&&r.includes(w.name)?"Remove":"Add"}),e.jsx("button",{onClick:async()=>{const T=prompt("Name this person as",w.name||"")||"";if(T.trim())try{await Pa(s,String(w.id),T.trim()),await l()}catch{}},className:"px-2 py-1 rounded bg-gray-200 text-xs",children:"Name"})]}),e.jsxs("button",{onClick:()=>p(w.id),className:"px-2 py-1 rounded bg-green-600 text-white text-xs w-full",children:["View Photos (",w.size,")"]})]})]},w.id))}),r.length>0&&e.jsxs("div",{className:"mt-2 text-sm flex items-center gap-2 flex-wrap",children:[r.map(w=>e.jsxs("span",{className:"px-2 py-1 bg-blue-600 text-white rounded flex items-center gap-2",children:[w," ",e.jsx("button",{onClick:()=>n(r.filter(T=>T!==w)),className:"bg-white/20 rounded px-1",children:""})]},w)),e.jsx("button",{onClick:()=>n([]),className:"px-2 py-1 bg-gray-200 rounded",children:"Clear"})]})]})}function Wl({points:s,onLoadMap:t}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Map (GPS)"}),e.jsx("button",{onClick:t,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Load"})]}),s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No GPS points found."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 text-xs",children:s.map((a,r)=>e.jsxs("div",{className:"border rounded p-2",children:[a.lat.toFixed(5),", ",a.lon.toFixed(5)]},r))})]})}function Gl({dir:s,engine:t,collections:a,onLoadCollections:r,onOpen:n,onDelete:i,onShare:u,onExport:c,selectedPhotos:l=[],onCollectionUpdate:d}){const[g,y]=o.useState(null),[j,k]=o.useState(null),[v,f]=o.useState(!1),[p,w]=o.useState(""),[T,h]=o.useState(!1),[m,C]=o.useState(null),I=o.useRef(0),E=o.useCallback(async()=>{if(!(!p.trim()||T)){h(!0);try{if(await us(s,p.trim(),l),w(""),f(!1),r(),d){const $={...a,[p.trim()]:l};d($)}}catch($){console.error("Failed to create collection:",$),alert($ instanceof Error?$.message:"Failed to create collection")}finally{h(!1)}}},[p,l,s,r,a,d]),S=o.useCallback(($,F)=>{const V={type:"collection",data:F,name:F};y(V),$.dataTransfer.effectAllowed="move",$.dataTransfer.setData("text/plain",JSON.stringify(V))},[]),N=o.useCallback(($,F)=>{$.preventDefault(),$.dataTransfer.dropEffect="copy",k(F)},[]),D=o.useCallback(($,F)=>{$.preventDefault(),I.current++,k(F)},[]),_=o.useCallback($=>{I.current--,I.current===0&&k(null)},[]),Q=o.useCallback(async($,F)=>{$.preventDefault(),I.current=0,k(null);try{const V=$.dataTransfer.getData("text/plain");let Y;if(V)Y=JSON.parse(V);else{if(!g)return;Y=g}if(Y.type==="photo"){const O=Array.isArray(Y.data)?Y.data:[Y.data],J=a[F]||[],L=Array.from(new Set([...J,...O]));if(await us(s,F,L),r(),d){const X={...a,[F]:L};d(X)}}}catch(V){console.error("Failed to update collection:",V),alert("Failed to update collection")}finally{y(null)}},[a,s,r,d,g]),M=o.useCallback(async $=>{if(u)u($,a[$]||[]);else try{const F=a[$]||[];if(F.length===0){alert("Collection is empty");return}const V=await xa(s,t,F,{expiryHours:24,viewOnly:!0});await navigator.clipboard.writeText(window.location.origin+V.url),alert("Share link copied to clipboard!")}catch(F){console.error("Failed to share collection:",F),alert(F instanceof Error?F.message:"Failed to share collection")}},[u,a,s,t]),H=o.useCallback(async $=>{if(c)c($,a[$]||[]);else{const F=prompt(`Export collection "${$}" to folder:`,$);if(!F)return;try{const V=a[$]||[];if(V.length===0){alert("Collection is empty");return}await $t(s,V,F,"copy",!1,!1),alert(`Exported ${V.length} photos to ${F}`)}catch(V){console.error("Failed to export collection:",V),alert(V instanceof Error?V.message:"Failed to export collection")}}},[c,a,s]);return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-semibold",children:"Collections"}),l.length>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[l.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.length>0&&e.jsxs("button",{onClick:()=>f(!0),className:"bg-green-600 text-white rounded px-3 py-1 text-sm hover:bg-green-700 flex items-center gap-1",children:[e.jsx(yr,{className:"w-3 h-3"}),"New"]}),e.jsx("button",{onClick:r,className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Refresh"})]})]}),v&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4 text-blue-600"}),e.jsx("input",{type:"text",placeholder:"Collection name",value:p,onChange:$=>w($.target.value),className:"flex-1 border rounded px-2 py-1 text-sm",onKeyDown:$=>{$.key==="Enter"&&E(),$.key==="Escape"&&f(!1)},autoFocus:!0}),e.jsx("button",{onClick:E,disabled:!p.trim()||T,className:"bg-blue-600 text-white px-3 py-1 text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:T?"Creating...":"Create"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700 px-2 py-1 text-sm",children:"Cancel"})]}),l.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["Will add ",l.length," selected photo",l.length!==1?"s":""]})]}),Object.keys(a||{}).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Gs,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"No collections yet"}),l.length>0?e.jsxs("button",{onClick:()=>f(!0),className:"text-sm text-blue-600 hover:text-blue-800",children:["Create your first collection with ",l.length," selected photo",l.length!==1?"s":""]}):e.jsx("div",{className:"text-xs text-gray-500",children:"Select photos and create collections to organize them"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:Object.keys(a).map($=>{const F=j===$,V=a[$]||[];return e.jsxs("div",{draggable:!0,onDragStart:Y=>S(Y,$),onDragOver:Y=>N(Y,$),onDragEnter:Y=>D(Y,$),onDragLeave:_,onDrop:Y=>Q(Y,$),className:`border rounded-lg p-3 transition-all cursor-move ${F?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"} ${m===$?"ring-2 ring-blue-200":""}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(Pi,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:$,children:$}),e.jsxs("div",{className:"text-xs text-gray-600",children:[V.length," item",V.length!==1?"s":"",F&&e.jsx("span",{className:"ml-2 text-blue-600 font-medium",children:"Drop here to add"})]})]})]}),e.jsxs("div",{className:"flex gap-1 mb-3 overflow-hidden",children:[V.slice(0,4).map((Y,O)=>e.jsx("img",{src:Fe(s,t,Y,96),alt:Y.split("/").pop()||Y,className:`object-cover rounded ${V.length===1?"w-full h-20":V.length===2?"w-1/2 h-16":"w-1/4 h-12"}`},Y)),V.length>4&&e.jsxs("div",{className:"w-1/4 h-12 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:["+",V.length-4]}),V.length===0&&e.jsx("div",{className:"w-full h-16 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:"Empty collection"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>n($),className:"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 text-xs",children:"Open"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>M($),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-blue-600",title:"Share collection",disabled:V.length===0,children:e.jsx(gs,{className:"w-3 h-3"})}),e.jsx("button",{type:"button",onClick:()=>H($),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-green-600",title:"Export collection",disabled:V.length===0,children:e.jsx(He,{className:"w-3 h-3"})}),i&&e.jsx("button",{type:"button",onClick:()=>i($),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-red-600",title:"Delete collection",children:e.jsx(ot,{className:"w-3 h-3"})})]})]})]},$)})}),l.length>0&&Object.keys(a||{}).length>0&&e.jsx("div",{className:"mt-3 text-xs text-center text-gray-500 border-t pt-2",children:" Drag photos onto collections to add them, or create a new collection above"})]})}function Kl(){const s=ma(),t=Or(),a=o.useMemo(()=>s.pathname.split("/").filter(Boolean)[1]||"",[s.pathname]),[r,n]=o.useState(null),[i,u]=o.useState(""),[c,l]=o.useState(""),[d,g]=o.useState(!1);async function y(){g(!0),l("");try{const k=new URLSearchParams({token:a});i.trim()&&k.set("password",i.trim());const f=await(await fetch(`${xe}/share/detail?${k.toString()}`)).json();n(f),f.ok||(f.error==="expired"?l("This link has expired"):f.error==="password_required"?l("Password required or incorrect"):l("Unable to open share"))}catch(k){l(k instanceof Error?k.message:"Failed to load share")}finally{g(!1)}}if(o.useEffect(()=>{a&&y()},[a]),!a)return e.jsx("div",{className:"h-screen bg-gray-950 text-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl mb-2",children:"Invalid share link"}),e.jsx("button",{className:"px-3 py-1 rounded bg-gray-800 border border-gray-700",onClick:()=>t("/"),children:"Back"})]})});const j=r?.ok&&r?.paths&&r?.dir;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-gray-100",children:[e.jsxs("header",{className:"px-4 py-3 border-b border-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:"Shared Photos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r?.expires&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Expires ",new Date(r.expires).toLocaleString()]}),e.jsx("button",{className:"px-2 py-1 rounded bg-gray-800 border border-gray-700 text-sm",onClick:()=>t("/"),children:"Back"})]})]}),e.jsxs("main",{className:"p-4",children:[(!r||!r.ok&&r.error==="password_required")&&e.jsxs("div",{className:"max-w-md mx-auto",children:[c&&e.jsx("div",{className:"mb-2 text-red-400 text-sm",children:c}),e.jsx("label",{className:"block text-sm mb-1",children:"Password"}),e.jsx("input",{className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded",value:i,onChange:k=>u(k.target.value),placeholder:"Enter password (if required)",type:"password"}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:y,disabled:d,children:d?"Opening":"Open"})})]}),r&&!r.ok&&r.error==="expired"&&e.jsx("div",{className:"text-center text-gray-300",children:"This link has expired."}),j&&e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))"},children:r.paths.map(k=>e.jsx("div",{className:"border border-gray-800 rounded overflow-hidden bg-gray-900",children:e.jsx("img",{src:Fe(r.dir,r.provider||"local",k,256),alt:"photo",className:"w-full h-[140px] object-cover"})},k))})]})]})}function Yl({dir:s,engine:t,topK:a,smart:r,setSmart:n,setResults:i,setSearchId:u,setNote:c,query:l,favOnly:d,tagFilter:g,useCaps:y,useOcr:j,hasText:k,camera:v,isoMin:f,isoMax:p,fMin:w,fMax:T,place:h,persons:m}){const C=async()=>{const N=(prompt("Save current search as Smart (name):")||"").trim();if(N)try{const D=g.split(",").map(F=>F.trim()).filter(Boolean),_={query:l,favoritesOnly:d,tags:D,useCaptions:y,useOcr:j,hasText:k,camera:v||void 0,isoMin:f?parseInt(f,10):void 0,isoMax:p?parseInt(p,10):void 0,fMin:w?parseFloat(w):void 0,fMax:T?parseFloat(T):void 0,place:h||void 0},Q=m.filter(Boolean);Q.length===1?_.person=Q[0]:Q.length>1&&(_.persons=Q);const{apiSetSmart:M,apiGetSmart:H}=await ye(async()=>{const{apiSetSmart:F,apiGetSmart:V}=await Promise.resolve().then(()=>ve);return{apiSetSmart:F,apiGetSmart:V}},void 0,import.meta.url);await M(s,N,_);const $=await H(s);n($.smart||{}),c("Saved smart collection")}catch(D){c(D.message||"Failed to save smart")}},I=async()=>{try{const{apiGetSmart:N}=await ye(async()=>{const{apiGetSmart:_}=await Promise.resolve().then(()=>ve);return{apiGetSmart:_}},void 0,import.meta.url),D=await N(s);n(D.smart||{})}catch(N){c(N.message||"Failed to load smart")}},E=async N=>{try{const{apiResolveSmart:D}=await ye(async()=>{const{apiResolveSmart:Q}=await Promise.resolve().then(()=>ve);return{apiResolveSmart:Q}},void 0,import.meta.url),_=await D(s,N,t,a);i(_.results||[]),u(_.search_id||""),c(`Opened smart: ${N}`)}catch(D){c(D.message)}},S=async N=>{if(confirm(`Delete smart collection "${N}"?`))try{const{apiDeleteSmart:D,apiGetSmart:_}=await ye(async()=>{const{apiDeleteSmart:M,apiGetSmart:H}=await Promise.resolve().then(()=>ve);return{apiDeleteSmart:M,apiGetSmart:H}},void 0,import.meta.url);await D(s,N);const Q=await _(s);n(Q.smart||{})}catch(D){c(D.message)}};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Smart Collections"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:I,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"}),e.jsx("button",{onClick:C,className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:"Save current as Smart"})]})]}),Object.keys(r||{}).length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No smart collections yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.keys(r).map(N=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:N,children:N}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E(N),className:"px-2 py-1 bg-blue-600 text-white rounded",children:"Open"}),e.jsx("button",{onClick:()=>S(N),className:"px-2 py-1 bg-red-600 text-white rounded",children:"Delete"})]})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 truncate",children:JSON.stringify(r[N])})]},N))})]})}function cr({dir:s,engine:t,setBusy:a,setNote:r,setResults:n}){const i=async()=>{try{const{apiTripsBuild:l}=await ye(async()=>{const{apiTripsBuild:g}=await Promise.resolve().then(()=>ve);return{apiTripsBuild:g}},void 0,import.meta.url);a("Grouping trips");const d=await l(s,t);a(""),window._trips=d.trips||[],r(`Trips: ${d.trips?.length||0}`)}catch(l){a(""),r(l.message)}},u=async()=>{try{const{apiTripsList:l}=await ye(async()=>{const{apiTripsList:g}=await Promise.resolve().then(()=>ve);return{apiTripsList:g}},void 0,import.meta.url),d=await l(s);window._trips=d.trips||[],r(`Loaded ${d.trips.length} trips`)}catch(l){r(l.message)}},c=l=>{n((l.paths||[]).map(d=>({path:d,score:1}))),r("Opened trip")};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Trips"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:i,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build"}),e.jsx("button",{onClick:u,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:window._trips?.slice(0,6)?.map((l,d)=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:l.place||"",children:l.place||"Trip"}),e.jsx("div",{children:l.count})]}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-1",children:(l.paths||[]).slice(0,3).map((g,y)=>e.jsx("img",{src:Fe(s,t,g,196),className:"w-full h-16 object-cover rounded"},y))}),e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx("button",{onClick:()=>c(l),className:"bg-blue-600 text-white rounded px-3 py-1",children:"Open"})})]},l.id||d))})]})}function Ql({saved:s,onRun:t,onDelete:a}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"font-semibold",children:"Saved Searches"})}),!s||s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No saved searches yet."}):e.jsx("div",{className:"mt-2 divide-y",children:s.map(r=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:r.name,children:r.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:r.query,children:r.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:()=>t(r.name,r.query,r.top_k),className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{onClick:()=>a(r.name),className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},r.name))})]})}function Jl(s){const t=s.split(/\r?\n/),a=[];let r=[];function n(){r.length&&(a.push(e.jsx("ul",{className:"list-disc ml-6 space-y-1",children:r.map((i,u)=>e.jsx("li",{children:i},u))},`ul-${a.length}`)),r=[])}return t.forEach((i,u)=>{const c=i.match(/^(#+)\s+(.*)$/);if(c){n();const d=c[1].length,g=c[2],y=d===1?"h1":d===2?"h2":"h3";a.push(e.jsx(y,{className:"font-semibold mt-4",children:g},`h-${u}`));return}const l=i.match(/^[-*]\s+(.*)$/);if(l){const d=l[1],g=d.match(/^\[( |x|X)\]\s+(.*)$/);if(g){const y=g[1].toLowerCase()==="x",j=g[2];r.push(e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",disabled:!0,checked:y}),e.jsx("span",{children:j})]}))}else r.push(e.jsx("span",{children:d}));return}if(i.trim()===""){n(),a.push(e.jsx("div",{className:"h-2"},`sp-${u}`));return}n(),a.push(e.jsx("p",{children:i},`p-${u}`))}),n(),a}function Xl(){const s=wn(),t=Fl(),[a,r]=o.useState(""),[n,i]=o.useState(!0),[u,c]=o.useState(""),[l,d]=o.useState([]),[g,y]=o.useState(!1),[j,k]=o.useState(null),[v,f]=o.useState(!1),p=async()=>{try{i(!0);const m=await hs();r(m.text||"")}catch(m){c(String(m))}finally{i(!1)}},w=async()=>{if(!s){d([]);return}try{f(!0);const m=await ds(s,200);d(m.events||[])}catch{}finally{f(!1)}},T=m=>{try{const C=new Date(m).getTime(),I=Date.now(),E=Math.max(0,I-C),S=Math.floor(E/1e3);if(S<60)return`${S}s ago`;const N=Math.floor(S/60);if(N<60)return`${N}m ago`;const D=Math.floor(N/60);return D<24?`${D}h ago`:`${Math.floor(D/24)}d ago`}catch{return m}};o.useEffect(()=>{let m=!1;return hs().then(C=>{m||(r(C.text||""),i(!1))}).catch(C=>{m||(c(String(C)),i(!1))}),()=>{m=!0}},[]),o.useEffect(()=>{let m=!1;if(!s){d([]);return}ds(s,200).then(I=>{m||d(I.events||[])}).catch(()=>{});const C=window.setInterval(()=>{m||w()},3e4);return()=>{m=!0,window.clearInterval(C)}},[s]);const h=async()=>{if(s)try{y(!0),k(null);const m=await Ia(s,t),C=typeof m.updated=="number"?m.updated:0;if(C>0)k(`Updated tags for ${C} photo${C===1?"":"s"}`);else if(m.tags){const I=Object.keys(m.tags||{}).length;k(`Generated tags for ${I} photo${I===1?"":"s"}`)}else k("No changes")}catch(m){k(`Error: ${m.message}`)}finally{y(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Project Tasks (TODO.md)"}),e.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:p,disabled:n,title:"Refresh TODO.md",children:"Refresh"})]}),n?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading"}):u?e.jsx("div",{className:"text-sm text-red-600",children:u}):e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:Jl(a)}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Auto-tag Photos"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 border rounded p-3 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Generate smart tags for your photos using AI analysis. This will analyze photo content and automatically assign relevant tags."}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:h,disabled:g||!s,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Generating Tags...":"Generate Auto Tags"})}),j&&e.jsx("div",{className:`p-2 rounded text-sm ${j.startsWith("Error:")?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"}`,children:j})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Recent Events"}),e.jsx("button",{className:"text-sm px-2 py-1 border rounded disabled:opacity-50",onClick:w,disabled:v||!s,title:"Refresh events",children:v?"Refreshing":"Refresh"})]}),e.jsx("div",{className:"border rounded divide-y",children:l.length===0?e.jsx("div",{className:"p-2 text-sm text-gray-600",children:"No recent events."}):l.map((m,C)=>e.jsxs("div",{className:"p-2 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:m.type}),e.jsx("span",{children:m.query?`"${m.query}"`:m.token?`share:${m.token.slice(0,6)}`:""})]}),e.jsx("div",{className:"text-gray-500",title:new Date(m.time).toLocaleString(),children:T(m.time)})]},C))})]})]})}function Zl({dir:s,engine:t,items:a,selected:r,onToggleSelect:n,onOpen:i,showInfoOverlay:u,bucket:c="day"}){const[l,d]=o.useState({}),[g,y]=o.useState(new Set);o.useEffect(()=>{const m=a.slice(0,200).map(E=>E.path).filter(E=>!l[E]&&!g.has(E)).slice(0,32);if(m.length===0)return;const C=new Set(g);m.forEach(E=>C.add(E)),y(C);let I=!1;return Promise.all(m.map(async E=>{try{const S=await It(s,E);!I&&S&&S.meta&&d(N=>({...N,[E]:{mtime:S.meta.mtime,camera:S.meta.camera,fnumber:S.meta.fnumber,iso:S.meta.iso}}))}catch{}})).finally(()=>{I||y(E=>{const S=new Set(E);return m.forEach(N=>S.delete(N)),S})}),()=>{I=!0}},[a,s,l,g]);const j=o.useMemo(()=>{const m=_=>!_||!isFinite(_)?"Unknown":new Date(_*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),C=_=>!_||!isFinite(_)?"Unknown":new Date(_*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}),I=_=>{if(!_||!isFinite(_))return"Unknown";const Q=new Date(_*1e3),M=new Date(Date.UTC(Q.getFullYear(),Q.getMonth(),Q.getDate())),H=M.getUTCDay()||7;M.setUTCDate(M.getUTCDate()+4-H);const $=new Date(Date.UTC(M.getUTCFullYear(),0,1)),F=Math.ceil(((M.getTime()-$.getTime())/864e5+1)/7);return`${M.getUTCFullYear()}  W${String(F).padStart(2,"0")}`},E=_=>c==="month"?C(_):c==="week"?I(_):m(_),S=a.map(_=>({it:_,ts:l[_.path]?.mtime}));S.sort((_,Q)=>(Q.ts||0)-(_.ts||0));const N={};for(const{it:_,ts:Q}of S){const M=E(Q);N[M]||(N[M]=[]),N[M].push(_)}const D=Object.keys(N);return D.sort((_,Q)=>_==="Unknown"?1:Q==="Unknown"?-1:0),D.map(_=>({key:_,items:N[_]}))},[a,l,c]),k=o.useMemo(()=>{const m=new Set;if(c==="week")for(const C of j){const I=C.items[0]?.path,E=I?l[I]?.mtime:void 0;if(E&&isFinite(E)){const S=new Date(E*1e3);m.add(S.toLocaleDateString(void 0,{year:"numeric",month:"short"}))}}else for(const C of j){const I=C.key.split(" ");I.length>=2&&m.add(`${I[0]} ${I[1]}`)}return Array.from(m)},[j,c,l]),v=o.useMemo(()=>{const m={};if(c==="week")for(const C of j){const I=C.items[0]?.path,E=I?l[I]?.mtime:void 0;if(E&&isFinite(E)){const N=new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});m[N]=(m[N]||0)+C.items.length}}else for(const C of j){const I=C.key.split(" ").slice(0,2).join(" ");m[I]=(m[I]||0)+C.items.length}return m},[j,c,l]),f=o.useMemo(()=>Object.values(v).reduce((m,C)=>Math.max(m,C||0),0)||1,[v]),p=o.useRef({}),w=o.useRef(null),[T,h]=o.useState(null);return o.useEffect(()=>{const m=w.current;if(!m)return;const C=new IntersectionObserver(I=>{for(const E of I)if(E.isIntersecting){const S=E.target.dataset.month||null;S&&h(S)}},{root:m,threshold:.1});return Object.values(p.current).forEach(I=>I&&C.observe(I)),()=>C.disconnect()},[j]),o.useEffect(()=>{const m=C=>{try{const I=C?.detail?.kind;if(!I)return;const E=Date.now()/1e3;if(I==="today"){const S=c==="month"?new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const D=new Date(E*1e3),_=new Date(Date.UTC(D.getFullYear(),D.getMonth(),D.getDate())),Q=_.getUTCDay()||7;_.setUTCDate(_.getUTCDate()+4-Q);const M=new Date(Date.UTC(_.getUTCFullYear(),0,1)),H=Math.ceil(((_.getTime()-M.getTime())/864e5+1)/7);return`${_.getUTCFullYear()}  W${String(H).padStart(2,"0")}`})():new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"});p.current[S]?.scrollIntoView({behavior:"smooth",block:"start"})}else if(I==="this-month"){const S=new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(p.current).find(D=>D?.dataset.month&&D.dataset.month.startsWith(S))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(I==="last-month"){const S=new Date,D=new Date(S.getFullYear(),S.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(p.current).find(Q=>Q?.dataset.month&&Q.dataset.month.startsWith(D))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(I==="oldest"){const S=Object.keys(p.current);S.length>0&&p.current[S[S.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})}}catch{}};return window.addEventListener("timeline-jump",m),()=>window.removeEventListener("timeline-jump",m)},[c]),e.jsxs("div",{ref:w,className:"space-y-8 relative",style:{scrollSnapType:"y proximity"},children:[e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-4 z-10 bg-blue-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=Date.now()/1e3,C=c==="month"?new Date(m*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const E=new Date(m*1e3),S=new Date(Date.UTC(E.getFullYear(),E.getMonth(),E.getDate())),N=S.getUTCDay()||7;S.setUTCDate(S.getUTCDate()+4-N);const D=new Date(Date.UTC(S.getUTCFullYear(),0,1)),_=Math.ceil(((S.getTime()-D.getTime())/864e5+1)/7);return`${S.getUTCFullYear()}  W${String(_).padStart(2,"0")}`})():new Date(m*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),I=p.current[C];I&&I.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to today",children:"Today"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-14 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=Date.now()/1e3,C=new Date(m*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(p.current).find(E=>E?.dataset.month&&E.dataset.month.startsWith(C))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to this month",children:"This Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-20 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=new Date,I=new Date(m.getFullYear(),m.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(p.current).find(S=>S?.dataset.month&&S.dataset.month.startsWith(I))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to last month",children:"Last Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-24 z-10 bg-gray-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=Object.keys(p.current);m.length>0&&p.current[m[m.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to oldest",children:"Oldest"}),k.length>1&&e.jsx("div",{className:"hidden md:flex flex-col gap-1 fixed right-4 top-1/2 -translate-y-1/2 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur p-2 rounded shadow max-h-[60vh] overflow-auto",children:k.map(m=>e.jsxs("button",{type:"button",className:`text-xs px-2 py-0.5 rounded flex items-center gap-1 ${T===m?"bg-blue-600 text-white":"text-blue-700 hover:bg-blue-100"}`,onClick:()=>{Object.values(p.current).find(I=>I?.dataset.month===m)?.scrollIntoView({behavior:"smooth",block:"start"})},children:[e.jsx("span",{children:m}),e.jsxs("span",{className:"opacity-70",children:["(",v[m]||0,")"]}),e.jsx("span",{className:"inline-block h-1 bg-current opacity-50",style:{width:`${Math.max(6,Math.round((v[m]||0)/f*60))}px`}})]},m))}),j.map(m=>e.jsxs("section",{"aria-label":m.key,ref:C=>{C&&(p.current[m.key]=C)},"data-month":m.key.split(" ").slice(0,2).join(" "),style:{scrollSnapAlign:"start"},children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur px-2 py-1 border-b text-sm font-medium",children:[m.key,"  ",m.items.length]}),e.jsx("div",{className:"mt-3 grid gap-2 grid-cols-[repeat(auto-fill,minmax(160px,1fr))]",children:m.items.map(C=>{const I=r.has(C.path),E=C.path.split("/").pop()||C.path,S=l[C.path];return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden border ${I?"ring-2 ring-blue-500":"border-transparent"}`,onClick:()=>n(C.path),onDoubleClick:()=>i(C.path),title:C.path,children:[e.jsx(Da,{src:Fe(s,t,C.path,256),alt:C.path,className:"w-full h-[160px] object-cover",enableProgressiveLoading:!0}),u&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:E,children:E}),e.jsxs("div",{className:"flex items-center gap-1",children:[S?.camera&&e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:S.camera}),typeof S?.fnumber=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["f/",S.fnumber]}),typeof S?.iso=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["ISO ",S.iso]})]})]})]},C.path)})})]},m.key))]})}function ec({open:s,onClose:t}){const a=wn(),[r,n]=o.useState([]),[i,u]=o.useState(!1);return o.useEffect(()=>{let c;async function l(){if(a){u(!0);try{const d=await ds(a,200);n(d.events||[])}catch{}u(!1),c=setTimeout(l,3500)}}return s&&l(),()=>{c&&clearTimeout(c)}},[a,s]),s?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:t}),e.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-full sm:w-[420px] bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-800 p-3 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Jobs"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:t,children:"Close"})]}),i&&e.jsx("div",{className:"text-sm text-gray-600",children:"Loading"}),e.jsxs("div",{className:"space-y-2",children:[r.map((c,l)=>e.jsxs("div",{className:"p-2 border rounded text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:c.type}),c.type==="export"&&e.jsxs("span",{children:[c.copied," copied, ",c.skipped," skipped",c.errors?`, ${c.errors} errors`:""]}),c.type==="backup_run"&&e.jsxs("span",{children:[c.copied," backed up, ",c.skipped," skipped"]}),c.type==="backup_restore"&&e.jsxs("span",{children:[c.restored," restored"]}),c.type==="captions_build"&&e.jsxs("span",{children:[c.updated," captions"]}),c.type==="ocr_build"&&e.jsxs("span",{children:[c.updated," OCR"]}),c.type==="fast_build"&&e.jsxs("span",{children:[c.kind," index ",c.ok?"ok":"failed"]}),c.type==="trips_build"&&e.jsxs("span",{children:[c.trips," trips"]}),c.type==="thumbs_build"&&e.jsxs("span",{children:[c.made," thumbs"]}),c.type==="metadata_build"&&e.jsxs("span",{children:[c.updated," metadata"]}),c.type==="share_created"&&e.jsxs("span",{children:["link  ",c.count," items"]}),c.type==="share_open"&&e.jsx("span",{children:"link opened"}),c.type==="search"&&e.jsxs("span",{children:["",c.query,""]})]}),e.jsx("div",{className:"text-gray-500",children:new Date(c.time).toLocaleString()})]},l)),r.length===0&&!i&&e.jsx("div",{className:"text-sm text-gray-600",children:"No recent jobs."})]})]})]}):null}function tc({onStartDemo:s,onSelectFolder:t,onClose:a}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",onClick:r=>r.stopPropagation(),children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto flex items-center justify-center mb-6",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-12 h-12 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Find any photo instantly"}),e.jsx("p",{className:"text-gray-600 mb-8 max-w-xl mx-auto",children:`Just describe what you're looking for - like "that beach sunset" or "my daughter's birthday" - and we'll find it. No more endless scrolling!`}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Search naturally"}),e.jsx("p",{className:"text-gray-600 text-sm",children:`Type what you remember - "kids at the park" or "that amazing sunset" - we'll find it.`})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Find people instantly"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"We recognize faces so you can find all photos of someone special in seconds."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx("button",{onClick:s,className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:"See it in action"}),e.jsx("button",{onClick:t,className:"px-8 py-4 bg-white border-2 border-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-50 transition-all shadow-md",children:"Use my photos"})]}),e.jsx("button",{onClick:a,className:"mt-6 text-gray-500 hover:text-gray-700 transition-colors",children:"Maybe later"})]})})})})}function sc(){try{const s=navigator.userAgent,t=s.includes("Windows")||s.includes("Win64"),a=s.includes("Macintosh")||s.includes("Mac OS");return t?["~/Pictures","~/Desktop","~/Downloads","~/OneDrive/Pictures"]:a?["~/Pictures","~/Desktop","~/Downloads","~/Documents/Screenshots"]:["~/Pictures","~/Downloads","~/Desktop"]}catch{return["~/Pictures","~/Downloads"]}}function ac({open:s,onClose:t,onQuickStart:a,onCustom:r,onDemo:n,onTour:i}){const[u,c]=o.useState([]),[l,d]=o.useState(!1),[g,y]=o.useState(sc()),j=ce(),k=j.state.settings.includeVideos,v=j.setSettings,[f,p]=o.useState(k),w=o.useMemo(()=>u.reduce((E,S)=>E+(S.files||0),0),[u]),[T,h]=o.useState(!1),[m,C]=o.useState("");o.useEffect(()=>{if(!s)return;let E=!1;return(async()=>{d(!0);try{const N=await fetch(`${xe}/scan_count?include_videos=${f?"1":"0"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!N.ok)throw new Error(await N.text());const D=await N.json();E||c(D.items||[])}catch{E||c([])}finally{E||d(!1)}})(),()=>{E=!0}},[s,g,f]);const I=E=>{if(!E)return"0 B";const S=["B","KB","MB","GB","TB"];let N=0,D=E;for(;D>=1024&&N<S.length-1;)D/=1024,N++;return`${D.toFixed(D<10?1:0)} ${S[N]}`};return s?e.jsxs("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center",children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1101] bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl p-5",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Welcome  lets find your photos"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Get started fast (no cloud, localonly)."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:" Quick Start (Recommended)"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Index common locations (local only)"}),e.jsx("ul",{className:"text-xs text-gray-700 mb-2",children:u.map(E=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:E.path}),e.jsx("span",{children:E.exists?`${E.files}  ${I(E.bytes)} (Found)`:"Not found"})]},E.path))}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 mb-2",children:[e.jsx("input",{id:"incl-videos",type:"checkbox",checked:f,onChange:E=>{p(E.target.checked);try{v({includeVideos:E.target.checked})}catch{}}}),e.jsx("label",{htmlFor:"incl-videos",children:"Include videos (may take longer)"})]}),e.jsx("button",{className:"px-3 py-1 rounded bg-blue-600 text-white text-sm disabled:opacity-50",disabled:l||T,onClick:async()=>{h(!0),C("Starting indexing");try{a(g);const E=u.find(N=>N.exists)?.path||g[0],S=Date.now()+7e3;for(;Date.now()<S;){try{const N=await fetch(`${xe}/analytics?dir=${encodeURIComponent(E)}&limit=5`);if(N.ok){const _=((await N.json()).events||[]).find(Q=>Q.type==="index");if(_){C(`Indexed ${_.new}+${_.updated} (total ${_.total})`);break}}}catch{}await new Promise(N=>setTimeout(N,1e3))}}finally{setTimeout(()=>{h(!1),t()},1e3)}},children:l?"Calculating":T?m||"Starting":`Start indexing (${w} files  ${I(u.reduce((E,S)=>E+(S.bytes||0),0))})`}),!T&&!l&&e.jsx("div",{className:"mt-2 text-[11px] text-gray-600",children:"Runs in the background; you can start searching."})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:" Custom Setup"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Choose specific folders to index"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:r,children:"Select Folders"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:" Demo Mode"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Try with sample photos first"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:n,children:"Try Demo"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:" Guided Tour"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Learn the basics in under a minute"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:()=>i&&i(),children:"Start Tour"})]})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-600",children:"This runs locally; nothing leaves your device."}),e.jsx("div",{className:"text-xs text-gray-600",children:"You can add or remove folders anytime."}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:t,children:"Skip"})})]})]}):null}function rc(){const[s,t]=o.useState(navigator.onLine),[a,r]=o.useState(!1),[n,i]=o.useState(!1),[u,c]=o.useState(!1),[l,d]=o.useState(!1);o.useEffect(()=>{const v=()=>t(!0),f=()=>t(!1);window.addEventListener("online",v),window.addEventListener("offline",f);const p=!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);return r(p),c("ontouchstart"in window),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(()=>{d(!0)}),window.matchMedia("(display-mode: standalone)").matches&&i(!0),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",f)}},[]);const g=[{name:"Touch Gestures",icon:Ka,status:u,description:"Pinch-to-zoom, swipe navigation"},{name:"Camera Access",icon:is,status:a,description:"Native photo capture"},{name:"Offline Support",icon:s?Xs:os,status:l,description:"Works without internet"},{name:"PWA Installation",icon:Ii,status:n,description:"Install as app"}],y=async()=>{try{if("caches"in window){const v=await caches.open("test-cache");await v.put("/test",new Response("Hello from cache!"));const p=await(await v.match("/test"))?.text();alert(`Cache test: ${p||"Failed"}`)}else alert("Cache API not supported")}catch(v){alert(`Cache test failed: ${v}`)}},j=async()=>{try{const v=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});alert("Camera access successful!"),v.getTracks().forEach(f=>f.stop())}catch(v){alert(`Camera test failed: ${v}`)}},k=()=>{alert("Touch the screen to test gestures! Try pinching, swiping, or long-pressing.")};return e.jsx("div",{className:"p-4 max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Mobile PWA Features Test"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Test the mobile PWA features that were just implemented. This page helps verify that all the mobile enhancements are working correctly."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:g.map((v,f)=>{const p=v.icon;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(p,{className:`w-6 h-6 mr-2 ${v.status?"text-green-500":"text-gray-400"}`}),e.jsx("h3",{className:"font-semibold",children:v.name}),e.jsx("span",{className:`ml-auto px-2 py-1 text-xs rounded ${v.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:v.status?"Available":"Not Available"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:v.description})]},f)})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Interactive Tests"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:!l,children:[e.jsx(He,{className:"w-4 h-4 inline mr-2"}),"Test Cache API"]}),e.jsxs("button",{onClick:j,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",disabled:!a,children:[e.jsx(is,{className:"w-4 h-4 inline mr-2"}),"Test Camera Access"]}),e.jsxs("button",{onClick:k,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",disabled:!u,children:[e.jsx(Ka,{className:"w-4 h-4 inline mr-2"}),"Test Touch Gestures"]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Current Status"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Online Status:"," ",e.jsx("span",{className:s?"text-green-600":"text-red-600",children:s?"Online":"Offline"})]}),e.jsxs("div",{children:["Service Worker:"," ",e.jsx("span",{className:l?"text-green-600":"text-red-600",children:l?"Ready":"Not Ready"})]}),e.jsxs("div",{children:["Display Mode:"," ",e.jsx("span",{className:"text-blue-600",children:n?"Standalone (Installed)":"Browser"})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2",children:"Instructions"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:" Test this page on a mobile device for best results"}),e.jsx("li",{children:" Try installing the app to test PWA features"}),e.jsx("li",{children:" Go offline to test cached functionality"}),e.jsx("li",{children:" Use touch gestures on photos to test interactions"})]})]})]})})}function dr({onSearch:s}){const t=["photos from last summer","my kids playing","that trip to Paris","birthday celebrations","sunset at the beach","our dog running","Christmas morning","backyard BBQ","first day of school","weekend adventures","family dinner","vacation memories","funny moments","beautiful landscapes","selfies with friends"];return e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Try searching for:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.map(a=>e.jsx("button",{type:"button",onClick:()=>s(a),className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-600 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 text-left",children:a},a))}),e.jsx("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:" Just describe what you're looking for in your own words"})]})}function nc({onSelectDirectory:s,onImport:t,onHelp:a}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-6",children:[e.jsxs("button",{type:"button",onClick:s,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(Ge,{className:"w-8 h-8 text-blue-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Select Directory"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose a folder with your photos"})]}),e.jsxs("button",{type:"button",onClick:t,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(He,{className:"w-8 h-8 text-green-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Import Photos"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Import from camera or device"})]}),e.jsxs("button",{type:"button",onClick:a,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(vs,{className:"w-8 h-8 text-purple-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Get Help"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View tutorials and documentation"})]})]})}function Vs({type:s,searchQuery:t,onAction:a,onDemoAction:r,onClearSearch:n,onOpenFilters:i,onOpenAdvanced:u,onOpenHelp:c,onStartTour:l,onOpenJobs:d,sampleQueries:g,onRunSample:y,hasActiveFilters:j,indexingProgress:k=0,estimatedTime:v}){const[f,p]=o.useState(!1),w=["beach sunset","birthday cake","mountain hike","red car"],T=Array.isArray(g)&&g.length>0?g:w,m=(()=>{switch(s){case"no-directory":return{icon:e.jsx(Ge,{className:"w-16 h-16 text-gray-400"}),title:"Welcome to Photo Search",description:"Get started by selecting a folder containing your photos. We'll analyze them to make them searchable.",actionLabel:"Select Photo Folder",action:a,demoActionLabel:"Try Demo Photos",demoAction:r,tips:["Choose a folder with JPEG, PNG, or other common photo formats","We'll scan and analyze your photos using AI for natural language search","Your photos stay on your device - we only create searchable indexes","You can always add more folders later from the settings"]};case"no-photos":return{icon:e.jsx(js,{className:"w-16 h-16 text-gray-400"}),title:"No Photos Found",description:"This folder doesn't contain any photos yet. Add some photos or select a different folder.",actionLabel:"Select Different Folder",action:a,tips:["Make sure your photos are in common formats like JPEG, PNG, or TIFF","Check that the folder contains actual photo files, not just subfolders","If you just added photos, try refreshing the library","You can also import photos from other locations"]};case"no-results":return{icon:e.jsx(Ie,{className:"w-16 h-16 text-gray-400"}),title:`No results for "${t}"`,description:"Try adjusting your search terms or filters. Here are some suggestions:",suggestions:["Use simpler words or phrases","Try searching for colors, objects, or locations","Check your spelling","Remove filters if any are applied","Try searching for people or events"],actionLabel:"Clear Search",action:a};case"indexing":return{icon:e.jsx(mt,{className:"w-16 h-16 text-blue-500 animate-pulse"}),title:"Indexing Your Photos",description:`Analyzing your photos to make them searchable. ${k}% complete.`,progress:k,estimatedTime:v,tips:["This process analyzes each photo using AI to understand its content","You'll be able to search by objects, scenes, colors, and more","The process typically takes about 30 seconds per 100 photos","You can continue using other features while indexing runs"]};default:return{icon:e.jsx(vs,{className:"w-16 h-16 text-gray-400"}),title:"Something went wrong",description:"We're having trouble loading this content.",actionLabel:"Try Again",action:a}}})();return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8 text-center",role:s==="indexing"?"status":void 0,"aria-live":s==="indexing"?"polite":void 0,children:[e.jsx("div",{className:"mb-6",children:m.icon}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-3",children:m.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md leading-relaxed",children:m.description}),m.progress!==void 0&&e.jsxs("div",{className:"w-full max-w-md mb-6",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${m.progress}%`}})}),m.estimatedTime&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Estimated time remaining: ",m.estimatedTime]})]}),m.suggestions&&e.jsxs("div",{className:"mb-6 text-left max-w-md",children:[e.jsx("ul",{className:"space-y-2",children:m.suggestions.map((C,I)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:""}),C]},`suggestion-${C.substring(0,10)}-${I}`))}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[i&&e.jsxs("button",{type:"button",onClick:i,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx($i,{className:"w-4 h-4"})," Filters"]}),u&&e.jsxs("button",{type:"button",onClick:u,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx(Mi,{className:"w-4 h-4"})," Advanced"]}),j&&n&&e.jsx("button",{type:"button",onClick:n,className:"px-3 py-1.5 rounded border text-sm",children:"Clear filters"})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:T.map(C=>e.jsx("button",{type:"button",onClick:()=>y&&y(C),className:"px-2 py-1.5 rounded bg-gray-100 dark:bg-gray-800 text-xs",children:C},C))})]}),e.jsxs("div",{className:"flex gap-3 mb-6 flex-wrap justify-center",children:[m.action&&e.jsx("button",{type:"button",onClick:m.action,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:m.actionLabel}),m.demoAction&&e.jsx("button",{type:"button",onClick:m.demoAction,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:m.demoActionLabel}),s==="no-directory"&&l&&e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Start Tour"}),s==="indexing"&&d&&e.jsx("button",{type:"button",onClick:d,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"View Progress"}),c&&e.jsxs("button",{type:"button",onClick:c,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[e.jsx(Fi,{className:"w-4 h-4"})," Help"]})]}),m.tips&&e.jsxs("div",{className:"max-w-md",children:[e.jsxs("button",{type:"button",onClick:()=>p(!f),className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:[f?e.jsx(vr,{className:"w-4 h-4"}):e.jsx(jr,{className:"w-4 h-4"}),f?"Hide tips":"Show tips"]}),f&&e.jsx("div",{className:"mt-4 text-left",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-3",children:" Tips"}),e.jsx("ul",{className:"space-y-2",children:m.tips.map((C,I)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:""}),C]},`tip-${C.substring(0,10)}-${I}`))})]})})]})]})}function ic({isVisible:s,onDismiss:t,context:a,userActions:r}){const[n,i]=o.useState(0),[u,c]=o.useState(!1),d={search:[{title:"Natural Language Search",content:"Try searching for 'sunset at beach' or 'family birthday party' - our AI understands what you're looking for naturally.",trigger:!r.includes("searched")},{title:"Search by Colors & Objects",content:"Search for colors like 'red car' or objects like 'mountains' - our AI can find visual elements in your photos.",trigger:r.includes("searched")&&!r.includes("filtered")},{title:"Advanced Filters",content:"Use the filter panel to narrow by date, camera, location, or rating for more precise results.",trigger:r.includes("searched")&&r.length>3}],library:[{title:"Getting Started",content:"Select a folder with your photos to begin. We'll analyze them to make them searchable.",trigger:!r.includes("selected_directory")},{title:"Indexing Process",content:"After selecting photos, we'll index them using AI. This takes about 30 seconds per 100 photos.",trigger:r.includes("selected_directory")&&!r.includes("indexed")},{title:"Browse Your Photos",content:"Once indexed, you can browse all your photos here. Use the search bar above to find specific ones.",trigger:r.includes("indexed")}],results:[{title:"Photo Actions",content:"Select photos to share, favorite, tag, or organize them into collections.",trigger:!r.includes("selected_photo")},{title:"Quick Actions",content:"Use keyboard shortcuts: Space to select, Enter to view full size, F to favorite.",trigger:r.includes("selected_photo")&&!r.includes("used_keyboard")},{title:"Save Searches",content:"Save your favorite searches to quickly access them later from the Saved Searches section.",trigger:r.includes("searched")&&r.length>5}],collections:[{title:"Organize Your Photos",content:"Create collections to group related photos together, like 'Vacation 2024' or 'Family Events'.",trigger:!r.includes("created_collection")},{title:"Smart Collections",content:"Set up smart collections that automatically include photos based on your criteria.",trigger:r.includes("created_collection")}],settings:[{title:"Customize Your Experience",content:"Configure AI models, indexing preferences, and interface settings to match your needs.",trigger:!r.includes("changed_setting")},{title:"Performance Tuning",content:"Adjust indexing speed and search accuracy based on your hardware and preferences.",trigger:r.includes("changed_setting")}]}[a]?.filter(j=>j.trigger)||[];if(o.useEffect(()=>{if(d.length>0&&!u){const y=setInterval(()=>{i(j=>(j+1)%d.length)},8e3);return()=>clearInterval(y)}},[d.length,u]),!s||d.length===0)return null;const g=d[n];return e.jsx("div",{className:"fixed bottom-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Tip"})]}),e.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Dismiss tip",children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:g.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed",children:g.content})]}),d.length>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:d.map((y,j)=>e.jsx("button",{type:"button",onClick:()=>i(j),className:`w-2 h-2 rounded-full transition-colors ${j===n?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`,"aria-label":`Go to tip ${j+1}`},`tip-${y.title}-${j}`))}),e.jsxs("button",{type:"button",onClick:()=>i((n+1)%d.length),className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:["Next",e.jsx(Tt,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:()=>{c(!0),t()},className:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Don't show tips like this"})})]})})}function oc({isVisible:s,onComplete:t,completedSteps:a,onStepComplete:r,onStepAction:n,inProgressStepId:i}){const[u,c]=o.useState(!1),l=[{id:"select_directory",title:"Select Photo Directory",description:"Choose a folder containing your photos",action:"Get Started"},{id:"index_photos",title:"Index Your Photos",description:"Let AI analyze your photos for search",action:"Start Indexing"},{id:"first_search",title:"Try Your First Search",description:'Search for something like "beach sunset"',action:"Search Now"},{id:"explore_features",title:"Explore Features",description:"Try collections, favorites, and sharing",action:"Explore"}],d=a.length,g=l.length,y=d===g;return o.useEffect(()=>{if(y){const j=setTimeout(t,2e3);return()=>clearTimeout(j)}},[y,t]),s?e.jsx("div",{className:"fixed top-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>c(!u),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${y?"bg-green-100 dark:bg-green-900/20":"bg-blue-100 dark:bg-blue-900/20"}`,children:y?e.jsx(Et,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(vs,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Getting Started"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d," of ",g," steps complete"]})]})]}),e.jsx(Tt,{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${d/g*100}%`}})})}),u&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-h-80 overflow-y-auto",children:l.map((j,k)=>{const v=a.includes(j.id),f=a.length===k;return e.jsx("div",{className:`px-4 py-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0 ${v?"bg-green-50 dark:bg-green-900/10":f?"bg-blue-50 dark:bg-blue-900/10":"bg-gray-50 dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 ${v?"bg-green-100 dark:bg-green-900/20":"bg-gray-200 dark:bg-gray-600"}`,children:v?e.jsx(Et,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:k+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-medium text-sm ${v?"text-green-800 dark:text-green-200":"text-gray-900 dark:text-white"}`,children:j.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:j.description}),!v&&f&&(i===j.id?e.jsx("span",{className:"mt-2 inline-flex items-center px-3 py-1 bg-gray-500 text-white text-xs rounded",children:"In progress"}):e.jsx("button",{type:"button",onClick:()=>n?n(j.id):r(j.id),className:"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",children:j.action}))]})]})},j.id)})})})]})}):null}function lc({photoCount:s=0,indexedCount:t=0,searchProvider:a="local",isIndexing:r=!1,isConnected:n=!0,currentDirectory:i="",lastSync:u,activeJobs:c=0}){const[l,d]=o.useState(0),[g,y]=o.useState(0);o.useEffect(()=>{const v=setInterval(()=>{d(Math.random()*30+(r?40:10)),y(Math.random()*20+30)},2e3);return()=>clearInterval(v)},[r]);const j=v=>{if(!v)return"No directory selected";const f=v.split("/");return f.length>3?`.../${f.slice(-2).join("/")}`:v},k=v=>{if(!v)return"Never";const p=new Date().getTime()-v.getTime(),w=Math.floor(p/6e4);if(w<1)return"Just now";if(w<60)return`${w}m ago`;const T=Math.floor(w/60);return T<24?`${T}h ago`:`${Math.floor(T/24)}d ago`};return e.jsx("div",{className:"status-bar",children:e.jsxs("div",{className:"status-content",children:[e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(rs,{className:"status-icon"}),e.jsx("span",{className:"status-text",children:j(i)})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(js,{className:"status-icon"}),e.jsxs("span",{children:[s.toLocaleString()," photos"]})]}),r?e.jsxs("div",{className:"status-item",children:[e.jsx("div",{className:"status-spinner"}),e.jsxs("span",{className:"status-text processing",children:["Indexing... ",t,"/",s]})]}):e.jsxs("div",{className:"status-item",children:[e.jsx(Et,{className:"status-icon"}),e.jsxs("span",{className:"status-text success",children:[t.toLocaleString()," indexed"]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Ie,{className:"status-icon"}),e.jsx("span",{className:"capitalize",children:a})]}),c>0&&e.jsxs("div",{className:"status-item",children:[e.jsx(Zs,{className:"status-icon"}),e.jsxs("span",{className:"status-text warning",children:[c," active job",c!==1?"s":""]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(Pt,{className:"status-icon"}),e.jsxs("span",{children:["Synced ",k(u)]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(ea,{className:"status-icon"}),e.jsxs("span",{children:[l.toFixed(0),"%"]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(Ht,{className:"status-icon"}),e.jsxs("span",{children:[g.toFixed(0),"%"]})]}),e.jsx("div",{className:"status-item",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"status-icon"}),e.jsx("span",{className:"status-text success",children:"Connected"})]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"status-icon"}),e.jsx("span",{className:"status-text error",children:"Offline"})]})})]})]})})}function cc({jobs:s,onPause:t,onResume:a,onCancel:r,onRetry:n,onClear:i,onClearAll:u}){const[c,l]=o.useState(!1),[d,g]=o.useState(new Set),y=s.filter(h=>h.status==="running"||h.status==="paused"),j=s.filter(h=>h.status==="completed"||h.status==="failed"||h.status==="cancelled"),k=h=>{const m=new Set(d);m.has(h)?m.delete(h):m.add(h),g(m)},v=h=>({index:e.jsx(Ht,{className:"w-4 h-4"}),search:e.jsx(Ie,{className:"w-4 h-4"}),edit:e.jsx(js,{className:"w-4 h-4"}),export:e.jsx(He,{className:"w-4 h-4"}),import:e.jsx(mt,{className:"w-4 h-4"}),backup:e.jsx(Ht,{className:"w-4 h-4"}),analyze:e.jsx(ea,{className:"w-4 h-4"}),restore:e.jsx(Js,{className:"w-4 h-4"})})[h],f=h=>({queued:"text-gray-500",running:"text-blue-500",paused:"text-yellow-500",completed:"text-green-500",failed:"text-red-500",cancelled:"text-gray-400"})[h],p=h=>{switch(h){case"queued":return e.jsx(Pt,{className:"w-4 h-4"});case"running":return e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"});case"paused":return e.jsx(bs,{className:"w-4 h-4"});case"completed":return e.jsx(Et,{className:"w-4 h-4"});case"failed":return e.jsx(Di,{className:"w-4 h-4"});case"cancelled":return e.jsx(wr,{className:"w-4 h-4"})}},w=(h,m)=>{if(!h)return"";const I=(m||new Date).getTime()-h.getTime(),E=Math.floor(I/1e3),S=Math.floor(E/60),N=Math.floor(S/60);return N>0?`${N}h ${S%60}m`:S>0?`${S}m ${E%60}s`:`${E}s`},T=h=>{const m=Math.floor(h/60),C=Math.floor(m/60);return C>0?`${C} hour${C>1?"s":""}`:m>0?`${m} minute${m>1?"s":""}`:`${h} second${h>1?"s":""}`};return s.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:e.jsxs("button",{onClick:()=>l(!c),className:"bg-white dark:bg-gray-800 rounded-full shadow-lg p-3 flex items-center gap-2 hover:shadow-xl transition-shadow",children:[e.jsx(Zs,{className:"w-5 h-5 text-blue-500"}),y.length>0&&e.jsx("span",{className:"bg-blue-500 text-white text-xs rounded-full px-2 py-0.5",children:y.length})]})}),c&&e.jsxs("div",{className:"fixed bottom-20 right-4 w-96 max-h-[600px] bg-white dark:bg-gray-800 rounded-lg shadow-2xl z-40 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold",children:"What's happening"}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.length>0&&e.jsx("button",{onClick:u,className:"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Clear All"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx($e,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[y.length>0&&e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Working on"}),e.jsx("div",{className:"space-y-2",children:y.map(h=>e.jsx(ur,{job:h,isExpanded:d.has(h.id),onToggleExpanded:()=>k(h.id),onPause:t,onResume:a,onCancel:r,getJobIcon:v,getStatusIcon:p,getStatusColor:f,formatDuration:w,formatTimeRemaining:T},h.id))})]}),j.length>0&&e.jsxs("div",{className:"p-3 border-t dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Recently finished"}),e.jsx("div",{className:"space-y-2",children:j.map(h=>e.jsx(ur,{job:h,isExpanded:d.has(h.id),onToggleExpanded:()=>k(h.id),onRetry:n,onClear:i,getJobIcon:v,getStatusIcon:p,getStatusColor:f,formatDuration:w,formatTimeRemaining:T},h.id))})]})]})]})]})}function ur({job:s,isExpanded:t,onToggleExpanded:a,onPause:r,onResume:n,onCancel:i,onRetry:u,onClear:c,getJobIcon:l,getStatusIcon:d,getStatusColor:g,formatDuration:y,formatTimeRemaining:j}){const k=s.total?(s.progress||0)/s.total*100:0;return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("div",{className:"mt-0.5",children:l(s.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:s.title}),e.jsxs("div",{className:`flex items-center gap-1 ${g(s.status)}`,children:[d(s.status),e.jsx("span",{className:"text-xs capitalize",children:s.status})]})]}),s.status==="running"&&s.total&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:[s.progress||0," of ",s.total,s.type==="backup"?" photos saved":s.type==="index"?" photos found":s.type==="export"?" photos exported":" items"]}),e.jsxs("span",{children:[k.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all",style:{width:`${k}%`}})}),(s.estimatedTimeRemaining||s.speed)&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mt-1",children:[s.estimatedTimeRemaining&&e.jsxs("span",{children:["About ",j(s.estimatedTimeRemaining)," left"]}),s.speed&&e.jsx("span",{children:s.speed})]}),s.currentItem&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:[s.type==="backup"?"Saving: ":s.type==="index"?"Looking at: ":"Processing: ",s.currentItem]})]}),s.startTime&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.status==="completed"?"Finished in ":s.status==="failed"?"Failed after ":s.status==="running"?"Running for ":"",y(s.startTime,s.endTime),s.status==="completed"&&e.jsxs("span",{className:"ml-2",children:[s.successCount&&e.jsxs("span",{className:"text-green-500",children:[" ",s.successCount]}),s.warningCount&&e.jsxs("span",{className:"text-yellow-500 ml-1",children:[" ",s.warningCount]}),s.errorCount&&e.jsxs("span",{className:"text-red-500 ml-1",children:[" ",s.errorCount]})]})]}),t&&(s.error||s.description)&&e.jsx("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300",children:s.error?e.jsx("div",{className:"text-red-500",children:s.error}):e.jsx("div",{children:s.description})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[s.status==="running"&&s.canPause&&e.jsx("button",{onClick:()=>r?.(s.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(bs,{className:"w-3 h-3"})}),s.status==="paused"&&e.jsx("button",{onClick:()=>n?.(s.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(pt,{className:"w-3 h-3"})}),(s.status==="running"||s.status==="paused")&&s.canCancel&&e.jsx("button",{onClick:()=>i?.(s.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded text-red-500",children:e.jsx($e,{className:"w-3 h-3"})}),s.status==="failed"&&s.canRetry&&e.jsx("button",{onClick:()=>u?.(s.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Js,{className:"w-3 h-3"})}),(s.status==="completed"||s.status==="failed"||s.status==="cancelled")&&e.jsx("button",{onClick:()=>c?.(s.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(ot,{className:"w-3 h-3"})}),(s.error||s.description)&&e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:t?e.jsx(vr,{className:"w-3 h-3"}):e.jsx(jr,{className:"w-3 h-3"})})]})]})})}function dc({dir:s}){const[t,a]=o.useState([]),[r,n]=o.useState(!1),[i,u]=o.useState("");async function c(){n(!0),u("");try{const l=await zr(s||void 0);a(l.shares||[])}catch(l){u(l instanceof Error?l.message:"Failed to load shares")}finally{n(!1)}}return o.useEffect(()=>{c()},[s]),e.jsxs("div",{children:[i&&e.jsx("div",{className:"text-red-700 text-sm mb-2",children:i}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," link",t.length!==1?"s":""]}),e.jsx("button",{onClick:c,className:"px-2 py-1 border rounded text-sm",children:"Refresh"})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 pr-2",children:"Token"}),e.jsx("th",{className:"py-1 pr-2",children:"Created"}),e.jsx("th",{className:"py-1 pr-2",children:"Expires"}),e.jsx("th",{className:"py-1 pr-2",children:"Count"}),e.jsx("th",{className:"py-1 pr-2",children:"Access"}),e.jsx("th",{className:"py-1 pr-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[t.map(l=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 pr-2 font-mono text-xs",children:l.token}),e.jsx("td",{className:"py-1 pr-2",children:new Date(l.created).toLocaleString()}),e.jsxs("td",{className:"py-1 pr-2",children:[l.expires?new Date(l.expires).toLocaleString():"",l.expired?e.jsx("span",{className:"ml-1 text-red-700",children:"(expired)"}):null,!l.expired&&l.expires&&(()=>{const d=new Date(l.expires).getTime()-Date.now();return d>0&&d<24*3600*1e3?e.jsx("span",{className:"ml-1 text-amber-700",children:"(expires soon)"}):null})()]}),e.jsx("td",{className:"py-1 pr-2",children:l.count}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:l.view_only?"View-only":"Downloadable"}),l.has_password?e.jsx("span",{className:"text-xs bg-gray-200 rounded px-1",children:"Protected"}):null]})}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;window.open(d,"_blank")},children:"Open"}),e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;await navigator.clipboard.writeText(d),alert("Copied link to clipboard")},children:"Copy Link"}),e.jsx("button",{className:"px-2 py-0.5 border rounded text-red-700",onClick:async()=>{if(confirm("Revoke this share link?"))try{await Ur(l.token),await c()}catch{}},children:"Revoke"})]})})]},l.token)),t.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"No share links yet."})}),r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"Loading"})})]})]})})]})}function uc({cameras:s=[],popularISOs:t=[100,200,400,800,1600,3200],popularApertures:a=[1.4,1.8,2.8,4,5.6,8],yearRange:r,camera:n,setCamera:i,isoMin:u,setIsoMin:c,isoMax:l,setIsoMax:d,fMin:g,setFMin:y,fMax:j,setFMax:k,dateFrom:v,setDateFrom:f,dateTo:p,setDateTo:w,onApplyFilters:T,onClearFilters:h,compact:m=!1}){const[C,I]=o.useState("camera"),E=n||u||l||g||j||v||p,S=[{id:"camera",label:"Camera",icon:is,content:e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>i(""),className:`px-2 py-1 text-xs rounded border ${n?"bg-white border-gray-300 hover:bg-gray-50":"bg-blue-600 text-white border-blue-600"}`,children:"Any Camera"}),s.slice(0,m?4:8).map(N=>e.jsx("button",{type:"button",onClick:()=>i(n===N?"":N),className:`px-2 py-1 text-xs rounded border truncate max-w-32 ${n===N?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,title:N,children:N.length>20?N.substring(0,20)+"...":N},N))]})})},{id:"aperture",label:"Aperture",icon:Ri,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select f-stop range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{y(""),k("")},className:`px-2 py-1 text-xs rounded border ${!g&&!j?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),a.map(N=>e.jsxs("button",{type:"button",onClick:()=>{const D=N.toString();g===D&&j===D?(y(""),k("")):(y(D),k(D))},className:`px-2 py-1 text-xs rounded border ${g===N.toString()&&j===N.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:["f/",N]},N))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:g,onChange:N=>y(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"1.4"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:j,onChange:N=>k(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"8.0"})]})]})]})},{id:"iso",label:"ISO",icon:Ns,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select ISO range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{c(""),d("")},className:`px-2 py-1 text-xs rounded border ${!u&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),e.jsx("button",{type:"button",onClick:()=>{c(""),d("800")},className:`px-2 py-1 text-xs rounded border ${!u&&l==="800"?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Low (800)"}),e.jsx("button",{type:"button",onClick:()=>{c("800"),d("")},className:`px-2 py-1 text-xs rounded border ${u==="800"&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"High (800)"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(N=>e.jsx("button",{type:"button",onClick:()=>{const D=N.toString();u===D&&l===D?(c(""),d("")):(c(D),d(D))},className:`px-2 py-1 text-xs rounded border ${u===N.toString()&&l===N.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:N},N))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:u,onChange:N=>c(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:l,onChange:N=>d(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"3200"})]})]})]})},{id:"date",label:"Date",icon:ta,content:e.jsxs("div",{className:"space-y-2",children:[r&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>{f(""),w("")},className:`px-2 py-1 text-xs rounded border ${!v&&!p?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any Year"}),Array.from({length:Math.min(6,r[0]-r[1]+1)},(N,D)=>r[0]-D).map(N=>e.jsx("button",{type:"button",onClick:()=>{const D=`${N}-01-01`,_=`${N}-12-31`;v===D&&p===_?(f(""),w("")):(f(D),w(_))},className:`px-2 py-1 text-xs rounded border ${v===`${N}-01-01`&&p===`${N}-12-31`?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:N},N))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From"}),e.jsx("input",{type:"date",value:v,onChange:N=>f(N.target.value),className:"w-full text-xs border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To"}),e.jsx("input",{type:"date",value:p,onChange:N=>w(N.target.value),className:"w-full text-xs border rounded px-2 py-1"})]})]})]})}];return m?e.jsxs("div",{className:"bg-white border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Quick Filters"}),E&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:T,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700",children:"Apply"}),E&&e.jsx("button",{type:"button",onClick:h,className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",children:"Clear"})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:S.map(N=>{const D=N.icon;return e.jsxs("div",{className:"flex-shrink-0 min-w-48",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(D,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:N.label})]}),e.jsx("div",{className:"text-xs",children:N.content})]},N.id)})})]}):e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Quick Filters"}),E&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[[n,u,l,g,j,v,p].filter(Boolean).length," active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:T,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"Apply"}),E&&e.jsx("button",{type:"button",onClick:h,className:"text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300",children:"Clear All"})]})]}),e.jsx("div",{className:"flex border-b",children:S.map(N=>{const D=N.icon;return e.jsxs("button",{type:"button",onClick:()=>I(N.id),className:`flex-1 flex items-center justify-center gap-2 p-3 text-sm border-r last:border-r-0 ${C===N.id?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(D,{className:"w-4 h-4"}),N.label]},N.id)})}),e.jsx("div",{className:"p-4",children:S.find(N=>N.id===C)?.content})]})}function hc(s,t){const a=Date.now();return{id:`preset_${a}_${Math.random().toString(36).substr(2,9)}`,name:s,createdAt:a,updatedAt:a,filters:t}}function mc(s,t){const{filters:a}=s;a.favOnly!==void 0&&t.setFavOnly(a.favOnly),a.tagFilter!==void 0&&t.setTagFilter(a.tagFilter),a.place!==void 0&&t.setPlace(a.place),a.camera!==void 0&&t.setCamera(a.camera),a.isoMin!==void 0&&t.setIsoMin(a.isoMin),a.isoMax!==void 0&&t.setIsoMax(a.isoMax),a.fMin!==void 0&&t.setFMin(a.fMin),a.fMax!==void 0&&t.setFMax(a.fMax),a.dateFrom!==void 0&&t.setDateFrom(a.dateFrom),a.dateTo!==void 0&&t.setDateTo(a.dateTo),a.useCaps!==void 0&&t.setUseCaps(a.useCaps),a.useOcr!==void 0&&t.setUseOcr(a.useOcr),a.hasText!==void 0&&t.setHasText(a.hasText),a.ratingMin!==void 0&&t.setRatingMin(a.ratingMin)}function xc({show:s,onClose:t,onApply:a,favOnly:r,setFavOnly:n,tagFilter:i,setTagFilter:u,camera:c,setCamera:l,isoMin:d,setIsoMin:g,isoMax:y,setIsoMax:j,dateFrom:k,setDateFrom:v,dateTo:f,setDateTo:p,fMin:w,setFMin:T,fMax:h,setFMax:m,place:C,setPlace:I,useCaps:E,setUseCaps:S,useOcr:N,setUseOcr:D,hasText:_,setHasText:Q,ratingMin:M,setRatingMin:H,availableCameras:$,yearRange:F,filterPresets:V,onSavePreset:Y,onLoadPreset:O,onDeletePreset:J}){const[L,X]=o.useState(!1),[le,A]=o.useState(""),[K,Z]=o.useState(!1);if(!s)return null;const ne=()=>({favOnly:r,tagFilter:i,place:C,camera:c,isoMin:d,isoMax:y,fMin:w,fMax:h,dateFrom:k,dateTo:f,useCaps:E,useOcr:N,hasText:_,ratingMin:M}),oe=()=>{n(!1),u(""),I(""),l(""),g(""),j(""),T(""),m(""),v(""),p(""),S(!1),D(!1),Q(!1),H(0)},G=()=>{if(!le.trim())return;const B=hc(le.trim(),ne());Y(B),A(""),Z(!1)},se=B=>{mc(B,{setFavOnly:n,setTagFilter:u,setPlace:I,setCamera:l,setIsoMin:g,setIsoMax:j,setFMin:T,setFMax:m,setDateFrom:v,setDateTo:p,setUseCaps:S,setUseOcr:D,setHasText:Q,setRatingMin:H}),X(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40 flex",children:e.jsxs("div",{className:"ml-auto w-full max-w-md bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(sa,{className:"w-5 h-5"}),"Filters"]}),e.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-gray-100",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsx("button",{type:"button",className:`flex-1 py-3 text-sm font-medium ${L?"text-gray-500":"border-b-2 border-blue-500 text-blue-600"}`,onClick:()=>X(!1),children:"Filters"}),e.jsx("button",{type:"button",className:`flex-1 py-3 text-sm font-medium ${L?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>X(!0),children:"Presets"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:L?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-medium",children:"Saved Filter Presets"}),e.jsxs("button",{type:"button",onClick:()=>Z(!0),className:"flex items-center gap-1 text-sm bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx(fr,{className:"w-4 h-4"}),"Save Current"]})]}),K&&e.jsxs("div",{className:"border rounded p-3 bg-blue-50",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Save Current Filters"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:le,onChange:B=>A(B.target.value),placeholder:"Preset name",className:"flex-1 border rounded px-2 py-1 text-sm",autoFocus:!0}),e.jsx("button",{type:"button",onClick:G,disabled:!le.trim(),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm disabled:opacity-50",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>{Z(!1),A("")},className:"px-3 py-1 border rounded text-sm",children:"Cancel"})]})]}),V.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ge,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"No saved presets yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Save your filter combinations for quick access"})]}):e.jsx("div",{className:"space-y-2",children:V.map(B=>e.jsx("div",{className:"border rounded p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium truncate",title:B.name,children:B.name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Object.keys(B.filters).length," filters"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>se(B),className:"p-1 rounded hover:bg-gray-200",title:"Apply preset",children:e.jsx(Ns,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>J(B.id),className:"p-1 rounded hover:bg-red-100 text-red-600",title:"Delete preset",children:e.jsx(ot,{className:"w-4 h-4"})})]})]})},B.id))})]}):e.jsxs(e.Fragment,{children:[e.jsx(uc,{cameras:$,yearRange:F,camera:c,setCamera:l,isoMin:d,setIsoMin:g,isoMax:y,setIsoMax:j,fMin:w,setFMin:T,fMax:h,setFMax:m,dateFrom:k,setDateFrom:v,dateTo:f,setDateTo:p,onApplyFilters:a,onClearFilters:oe,compact:!0}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Basic Filters"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"flt-fav",children:"Favorites only"}),e.jsx("input",{id:"flt-fav",type:"checkbox",checked:r,onChange:B=>n(B.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-tags",children:"Tags (comma-separated)"}),e.jsx("input",{id:"flt-tags",className:"w-full border rounded px-2 py-1",value:i,onChange:B=>u(B.target.value),placeholder:"portrait, landscape, vacation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-place",children:"Location/Place"}),e.jsx("input",{id:"flt-place",className:"w-full border rounded px-2 py-1",value:C,onChange:B=>I(B.target.value),placeholder:"New York, Beach, Mountains"})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Search Features"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-caps",children:[e.jsx("span",{children:"Use AI captions"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search in generated image descriptions"})]}),e.jsx("input",{id:"flt-caps",type:"checkbox",checked:E,onChange:B=>S(B.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-ocr",children:[e.jsx("span",{children:"Use OCR"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search for text within images"})]}),e.jsx("input",{id:"flt-ocr",type:"checkbox",checked:N,onChange:B=>D(B.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-hastext",children:[e.jsx("span",{children:"Has text"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Only images containing readable text"})]}),e.jsx("input",{id:"flt-hastext",type:"checkbox",checked:_,onChange:B=>Q(B.target.checked)})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Minimum rating:"}),[0,1,2,3,4,5].map(B=>e.jsx("button",{type:"button",className:`px-2 py-1 rounded text-sm ${M===B?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,onClick:()=>H(B),children:B===0?"Any":"".repeat(B)},B))]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Date Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-from-manual",children:"Date From"}),e.jsx("input",{id:"flt-date-from-manual",type:"date",className:"w-full border rounded px-2 py-1",value:k,onChange:B=>v(B.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-to-manual",children:"Date To"}),e.jsx("input",{id:"flt-date-to-manual",type:"date",className:"w-full border rounded px-2 py-1",value:f,onChange:B=>p(B.target.value)})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t bg-gray-50",children:[e.jsx("button",{type:"button",onClick:oe,className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear All Filters"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded border border-gray-300 hover:bg-gray-50",onClick:t,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",onClick:a,children:"Apply Filters"})]})]})]})})}function pc({selectedView:s,onViewChange:t,library:a=[],favorites:r=[],collections:n=[],clusters:i=[],savedSearches:u=[],smart:c=[],trips:l=[],isOpen:d=!1,onClose:g}){const y=[{id:"library",label:"All Photos",icon:gt,count:a?.length||0},{id:"results",label:"Search Results",icon:Ie},{id:"favorites",label:"Favorites",icon:Gt,count:r?.length||0}],j=[{id:"people",label:"People",icon:Xe,count:i?.length||0},{id:"map",label:"Places",icon:aa},{id:"calendar",label:"Calendar",icon:ta},{id:"collections",label:"Collections",icon:Nr,count:n?.length||0},{id:"trips",label:"Trips",icon:Oi,count:l?.length||0}],k=[{id:"smart",label:"Smart Collections",icon:kr,count:c?.length||0},{id:"saved",label:"Saved Searches",icon:Ie,count:u?.length||0},{id:"tasks",label:"Tasks",icon:_i}],v=f=>e.jsxs("button",{type:"button",onClick:()=>t(f.id),className:`nav-item ${s===f.id?"active":""}`,children:[e.jsxs("div",{className:"nav-item-content",children:[e.jsx(f.icon,{className:"nav-item-icon"}),e.jsx("span",{className:"nav-item-label",children:f.label})]}),f.count!==void 0&&e.jsx("span",{className:"nav-item-count",children:f.count})]},f.id);return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:g}),e.jsxs("div",{className:`sidebar-container ${d?"open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"sidebar-title",children:"PhotoVault"}),e.jsx("p",{className:"sidebar-subtitle",children:"AI-Powered Photo Management"})]}),e.jsx("button",{type:"button",onClick:g,className:"sidebar-close",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Library"}),e.jsx("div",{className:"nav-items",children:y.map(v)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Organize"}),e.jsx("div",{className:"nav-items",children:j.map(v)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Smart Features"}),e.jsx("div",{className:"nav-items",children:k.map(v)})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsx("button",{type:"button",className:"sidebar-settings-button",onClick:()=>window.location.href="/settings",children:"Settings"})})]})]})}class gc extends o.Component{constructor(a){super(a);de(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});de(this,"handleReload",()=>{window.location.reload()});de(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("ErrorBoundary caught an error:",a,r),this.setState(n=>({errorInfo:r,errorCount:n.errorCount+1})),this.props.onError&&this.props.onError(a,r),typeof window<"u"&&window.logErrorToService&&window.logErrorToService({error:a.toString(),errorInfo:r.componentStack,timestamp:new Date().toISOString()})}render(){return this.state.hasError?this.props.fallback?e.jsx(e.Fragment,{children:this.props.fallback}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx(ra,{className:"w-6 h-6 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 mb-2",children:"Oops! Something unexpected happened"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Don't worry - your photos are safe. Let's get you back on track."}),!1,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:this.handleReset,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(na,{className:"w-4 h-4"}),"Try again"]}),e.jsx("button",{onClick:this.handleReload,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Reload page"}),e.jsxs("button",{onClick:this.handleGoHome,className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Sr,{className:"w-4 h-4"}),"Go to home"]})]}),this.state.errorCount>2&&e.jsx("p",{className:"mt-4 text-xs text-center text-gray-500",children:"Having trouble? A quick refresh usually helps."})]})}):this.props.children}}class hr extends o.Component{constructor(a){super(a);de(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error(`Error in ${this.props.sectionName||"section"}:`,a),this.setState({errorInfo:r})}render(){return this.state.hasError?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ra,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-red-900",children:["Couldn't load ",this.props.sectionName||"this section"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:this.state.error?.message||"Something went wrong, but we can fix it"}),e.jsx("button",{onClick:this.handleReset,className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"Try again"})]})]})}):this.props.children}}class fc{constructor(){de(this,"QUEUE_KEY","offline_action_queue");de(this,"MAX_RETRIES",3);de(this,"isOnline");de(this,"syncInProgress",!1);de(this,"listeners",new Set);this.isOnline=navigator.onLine,this.setupEventListeners(),this.checkConnection()}setupEventListeners(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),setInterval(()=>this.checkConnection(),3e4)}async checkConnection(){try{const t=await fetch("/api/ping",{method:"HEAD",cache:"no-cache"});this.setOnlineStatus(t.ok)}catch{this.setOnlineStatus(!1)}}setOnlineStatus(t){this.isOnline!==t&&(this.isOnline=t,this.notifyListeners(t),t&&this.syncQueue())}handleOnline(){console.log("[Offline Service] Connection restored"),this.setOnlineStatus(!0)}handleOffline(){console.log("[Offline Service] Connection lost"),this.setOnlineStatus(!1)}notifyListeners(t){this.listeners.forEach(a=>a(t))}onStatusChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}getStatus(){return this.isOnline}async queueAction(t){const a={...t,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),retries:0},r=this.getQueue();return r.push(a),this.saveQueue(r),this.isOnline&&this.syncQueue(),a.id}getQueue(){try{const t=localStorage.getItem(this.QUEUE_KEY);return t?JSON.parse(t):[]}catch{return[]}}saveQueue(t){try{localStorage.setItem(this.QUEUE_KEY,JSON.stringify(t))}catch(a){console.error("[Offline Service] Failed to save queue:",a)}}async syncQueue(){if(!this.isOnline||this.syncInProgress)return;this.syncInProgress=!0;const t=this.getQueue(),a=[];for(const r of t)try{await this.processAction(r),console.log(`[Offline Service] Synced action: ${r.id}`)}catch(n){console.error(`[Offline Service] Failed to sync action: ${r.id}`,n),r.retries++,r.retries<this.MAX_RETRIES?a.push(r):console.error(`[Offline Service] Max retries reached for action: ${r.id}`)}this.saveQueue(a),this.syncInProgress=!1,a.length>0&&setTimeout(()=>this.syncQueue(),6e4)}async processAction(t){const{apiSearch:a,apiSetCollection:r,apiBatchTag:n,apiBatchDelete:i}=await ye(async()=>{const{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}=await Promise.resolve().then(()=>ve);return{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}},void 0,import.meta.url);switch(t.type){case"search":await a(t.payload.dir,t.payload.query,t.payload.topK);break;case"collection":await r(t.payload.dir,t.payload.name,t.payload.paths);break;case"tag":await n(t.payload.dir,t.payload.paths,t.payload.tags,t.payload.operation);break;case"delete":await i(t.payload.dir,t.payload.paths,t.payload.useOsTrash);break;default:throw new Error(`Unknown action type: ${t.type}`)}}async precacheImages(t){if("caches"in window)try{await(await caches.open("photovault-images")).addAll(t)}catch(a){console.error("[Offline Service] Failed to precache images:",a)}}async getCachedImage(t){if(!("caches"in window))return null;try{return await(await caches.open("photovault-images")).match(t)}catch{return null}}async registerBackgroundSync(t){if(!(!("serviceWorker"in navigator)||!("sync"in ServiceWorkerRegistration.prototype)))try{await(await navigator.serviceWorker.ready).sync.register(t),console.log(`[Offline Service] Background sync registered: ${t}`)}catch(a){console.error("[Offline Service] Failed to register background sync:",a)}}async clearOfflineData(){if(localStorage.removeItem(this.QUEUE_KEY),"caches"in window){const t=await caches.keys();await Promise.all(t.filter(a=>a.startsWith("photovault-")).map(a=>caches.delete(a)))}console.log("[Offline Service] Offline data cleared")}}const qs=new fc;function bc(){const[s,t]=o.useState(!0),[a,r]=o.useState(!1),[n,i]=o.useState(!1);return o.useEffect(()=>(t(qs.getStatus()),qs.onStatusChange(c=>{t(c),r(!0),c&&(i(!0),qs.syncQueue().then(()=>{i(!1)})),setTimeout(()=>r(!1),3e3)})),[]),s&&!a&&!n?null:e.jsxs(e.Fragment,{children:[!s&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg shadow-lg",children:[e.jsx(os,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Offline Mode"})]}),a&&e.jsx("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg transition-all duration-300 ${s?"bg-green-500 text-white":"bg-orange-500 text-white"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Back Online"}),n&&e.jsx("div",{className:"text-sm opacity-90",children:"Syncing changes..."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"You're Offline"}),e.jsx("div",{className:"text-sm opacity-90",children:"Changes will sync when reconnected"})]})]})}),n&&s&&!a&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Syncing offline changes..."})]})]})}function Cn({size:s="md",message:t,className:a="",inline:r=!1}){const n={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"};return r?e.jsxs("span",{className:`inline-flex items-center gap-2 ${a}`,children:[e.jsx(Ya,{className:`${n[s]} animate-spin text-blue-600`}),t&&e.jsx("span",{className:"text-sm text-gray-600",children:t})]}):e.jsxs("div",{className:`flex flex-col items-center justify-center ${a}`,children:[e.jsx(Ya,{className:`${n[s]} animate-spin text-blue-600`}),t&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t})]})}const Tn=o.createContext(null);function yc({children:s}){const[t,a]=o.useState(!0),[r,n]=o.useState(()=>localStorage.getItem("ps_theme")||"light"),[i,u]=o.useState({help:!1,onboarding:!1});o.useEffect(()=>{localStorage.setItem("ps_theme",r),r==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[r]);const c=o.useMemo(()=>({state:{sidebarOpen:t,theme:r,modals:i},actions:{toggleSidebar:()=>a(l=>!l),setTheme:n,openModal:l=>u(d=>({...d,[l]:!0})),closeModal:l=>u(d=>({...d,[l]:!1}))}}),[t,r,i]);return e.jsx(Tn.Provider,{value:c,children:s})}function vc(){const s=o.useContext(Tn);if(!s)throw new Error("useUIContext must be used within UIProvider");return s}class jc{constructor(){de(this,"STORAGE_KEY","photo_search_history");de(this,"MAX_HISTORY_ENTRIES",100);de(this,"MAX_SUGGESTIONS",20)}getHistory(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return[];const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch{return[]}}addToHistory(t){try{const r=this.getHistory().filter(i=>i.query.toLowerCase()!==t.query.toLowerCase());r.unshift(t);const n=r.slice(0,this.MAX_HISTORY_ENTRIES);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(a){console.warn("Failed to save search history:",a)}}getSuggestions(t){const a=t.toLowerCase().trim();if(!a)return this.getRecentSuggestions();const r=this.getHistory(),n=[];return r.forEach(u=>{u.query.toLowerCase().includes(a)&&n.push({query:u.query,type:"history",score:this.calculateHistoryScore(u,a),metadata:{lastUsed:u.timestamp,useCount:this.getUseCount(u.query)}})}),this.generateSimilarQueries(a,r).forEach(u=>{n.push({query:u,type:"similar",score:this.calculateSimilarityScore(a,u)})}),n.sort((u,c)=>c.score-u.score).slice(0,this.MAX_SUGGESTIONS)}getRecentSuggestions(){return this.getHistory().slice(0,10).map(a=>({query:a.query,type:"history",score:this.calculateRecencyScore(a),metadata:{lastUsed:a.timestamp,useCount:this.getUseCount(a.query)}}))}calculateHistoryScore(t,a){const r=this.calculateRecencyScore(t),n=this.getUseCount(t.query)/10,i=this.calculateMatchScore(t.query,a);return r*.3+n*.3+i*.4}calculateRecencyScore(t){const r=Date.now()-t.timestamp,n=30*24*60*60*1e3;return Math.max(0,1-r/n)}calculateMatchScore(t,a){const r=t.toLowerCase(),n=a.toLowerCase();if(r===n)return 1;if(r.startsWith(n))return .9;if(r.includes(n))return .7;const i=r.split(/\s+/),u=n.split(/\s+/);return i.filter(l=>u.includes(l)).length/Math.max(i.length,u.length)}calculateSimilarityScore(t,a){return this.calculateMatchScore(a,t)*.6}getUseCount(t){return this.getHistory().filter(r=>r.query.toLowerCase()===t.toLowerCase()).length}generateSimilarQueries(t,a){const r=t.split(/\s+/),n=[];return a.forEach(i=>{const u=i.query.toLowerCase().split(/\s+/);r.filter(l=>u.some(d=>d.includes(l.toLowerCase()))).length>0&&i.query.toLowerCase()!==t.toLowerCase()&&n.push(i.query)}),Array.from(new Set(n)).slice(0,5)}clearHistory(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(t){console.warn("Failed to clear search history:",t)}}getPopularSearches(t=10){const a=this.getHistory(),r=new Map;return a.forEach(n=>{const i=n.query.toLowerCase();r.set(i,(r.get(i)||0)+1)}),Array.from(r.entries()).sort((n,i)=>i[1]-n[1]).slice(0,t).map(([n])=>n)}}const xs=new jc,wc=Object.freeze(Object.defineProperty({__proto__:null,searchHistoryService:xs},Symbol.toStringTag,{value:"Module"})),Nc=({onSearch:s,onClose:t})=>{const[a,r]=o.useState([]),[n,i]=o.useState(!1);o.useEffect(()=>{u()},[]);const u=()=>{const y=xs.getHistory();r(y)},c=y=>{s(y),t()},l=()=>{xs.clearHistory(),r([]),i(!1)},d=y=>{const k=Date.now()-y,v=Math.floor(k/(1e3*60)),f=Math.floor(k/(1e3*60*60)),p=Math.floor(k/(1e3*60*60*24));return v<1?"Just now":v<60?`${v}m ago`:f<24?`${f}h ago`:p<7?`${p}d ago`:new Date(y).toLocaleDateString()},g=y=>new Date(y).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"search-history-panel",children:[e.jsxs("div",{className:"search-history-header",children:[e.jsxs("div",{className:"search-history-title",children:[e.jsx(Pt,{className:"w-5 h-5"}),e.jsx("span",{children:"Search History"})]}),e.jsxs("div",{className:"search-history-actions",children:[e.jsx("button",{onClick:()=>i(!0),className:"clear-history-btn",title:"Clear search history",children:e.jsx(ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:t,className:"close-btn",title:"Close",children:e.jsx($e,{className:"w-4 h-4"})})]})]}),n&&e.jsx("div",{className:"clear-confirm-overlay",children:e.jsxs("div",{className:"clear-confirm-dialog",children:[e.jsx("p",{children:"Are you sure you want to clear your search history?"}),e.jsxs("div",{className:"clear-confirm-actions",children:[e.jsx("button",{onClick:()=>i(!1),className:"cancel-btn",children:"Cancel"}),e.jsx("button",{onClick:l,className:"confirm-btn",children:"Clear History"})]})]})}),e.jsx("div",{className:"search-history-content",children:a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Pt,{className:"w-12 h-12 text-gray-300"}),e.jsx("p",{children:"No search history yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your recent searches will appear here"})]}):e.jsx("div",{className:"search-history-list",children:a.map((y,j)=>e.jsx("div",{className:"search-history-item",children:e.jsxs("button",{onClick:()=>c(y.query),className:"search-history-button",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"search-query-container",children:[e.jsx("span",{className:"search-query",children:y.query}),e.jsxs("div",{className:"search-meta",children:[e.jsxs("span",{className:"result-count",children:[y.resultCount," results"]}),e.jsx("span",{className:"search-time",title:g(y.timestamp),children:d(y.timestamp)})]})]})]})},j))})}),e.jsx("style",{jsx:!0,children:`
        .search-history-panel {
          position: fixed;
          top: 0;
          right: 0;
          bottom: 0;
          width: 100%;
          max-width: 400px;
          background: white;
          border-left: 1px solid #e5e7eb;
          display: flex;
          flex-direction: column;
          z-index: 1000;
          box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .search-history-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
          background: #f9fafb;
        }

        .search-history-title {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: 600;
          font-size: 1.125rem;
        }

        .search-history-actions {
          display: flex;
          gap: 0.5rem;
        }

        .clear-history-btn,
        .close-btn {
          padding: 0.5rem;
          border-radius: 0.375rem;
          background: transparent;
          border: none;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s;
        }

        .clear-history-btn:hover {
          background: #fee2e2;
          color: #ef4444;
        }

        .close-btn:hover {
          background: #f3f4f6;
          color: #374151;
        }

        .search-history-content {
          flex: 1;
          overflow-y: auto;
        }

        .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          padding: 2rem;
          text-align: center;
          color: #6b7280;
        }

        .empty-state p {
          margin: 1rem 0 0.5rem;
        }

        .search-history-list {
          padding: 0.5rem;
        }

        .search-history-item {
          margin-bottom: 0.25rem;
        }

        .search-history-button {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          width: 100%;
          padding: 0.75rem;
          border-radius: 0.5rem;
          border: none;
          background: transparent;
          text-align: left;
          cursor: pointer;
          transition: background-color 0.2s;
        }

        .search-history-button:hover {
          background: #f3f4f6;
        }

        .search-query-container {
          flex: 1;
          min-width: 0;
        }

        .search-query {
          display: block;
          font-size: 0.875rem;
          font-weight: 500;
          color: #1f2937;
          margin-bottom: 0.25rem;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .search-meta {
          display: flex;
          gap: 0.75rem;
          font-size: 0.75rem;
          color: #6b7280;
        }

        .result-count::after {
          content: "";
          margin-left: 0.75rem;
        }

        .clear-confirm-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1001;
        }

        .clear-confirm-dialog {
          background: white;
          border-radius: 0.5rem;
          padding: 1.5rem;
          max-width: 300px;
          width: 90%;
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .clear-confirm-dialog p {
          margin-bottom: 1.5rem;
          text-align: center;
          font-size: 0.875rem;
          color: #374151;
        }

        .clear-confirm-actions {
          display: flex;
          gap: 0.75rem;
          justify-content: center;
        }

        .cancel-btn,
        .confirm-btn {
          padding: 0.5rem 1rem;
          border-radius: 0.375rem;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .cancel-btn {
          background: #f3f4f6;
          color: #374151;
        }

        .cancel-btn:hover {
          background: #e5e7eb;
        }

        .confirm-btn {
          background: #ef4444;
          color: white;
        }

        .confirm-btn:hover {
          background: #dc2626;
        }

        @media (max-width: 640px) {
          .search-history-panel {
            max-width: 100%;
          }
        }
      `})]})},En=o.memo(({searchText:s,setSearchText:t,onSearch:a,clusters:r=[],allTags:n=[],meta:i={}})=>{const[u,c]=o.useState(!1),[l,d]=o.useState([]),[g,y]=o.useState(!1),j=o.useRef(null),k=io(s,150);o.useEffect(()=>{if(u){const h=xs.getSuggestions(k);d(h)}},[k,u]);const v=h=>{a(h),c(!1)},f=h=>{const C=Date.now()-h,I=Math.floor(C/(1e3*60)),E=Math.floor(C/(1e3*60*60)),S=Math.floor(C/(1e3*60*60*24));return I<60?`${I}m ago`:E<24?`${E}h ago`:`${S}d ago`},w=u?(()=>{const h=s.toLowerCase(),m=[];l.length>0&&l.forEach(S=>{(!h||S.query.toLowerCase().includes(h))&&m.push({cat:S.type==="history"?"Recent":"Similar",label:S.query,icon:S.type==="history"?Pt:Ai,subtitle:S.metadata?.lastUsed?`${S.metadata.useCount||1} times, ${f(S.metadata.lastUsed)}`:void 0,type:"history"})});const C=(r||[]).map(S=>S.name).filter(Boolean);for(const S of C)(!h||S.toLowerCase().includes(h))&&m.push({cat:"People",label:S,type:"metadata"});for(const S of n||[])(!h||S.toLowerCase().includes(h))&&m.push({cat:"Tag",label:S,type:"metadata"});for(const S of i.cameras||[])(!h||S.toLowerCase().includes(h))&&m.push({cat:"Camera",label:S,type:"metadata"});for(const S of i.places||[])(!h||String(S).toLowerCase().includes(h))&&m.push({cat:"Place",label:String(S),type:"metadata"});const I=m.filter(S=>S.type==="history").slice(0,8),E=m.filter(S=>S.type==="metadata").slice(0,12);return[...I,...E].slice(0,20)})():[],T=(()=>{const h=[],m=(s||"").trim();if(!m)return h;try{let C=0;for(const S of m)if(S==="("?C++:S===")"&&C--,C<0){h.push("Unbalanced parentheses");break}C>0&&h.push("Unbalanced parentheses");const I=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),E=m.split(/\s+/);for(const S of E){const N=S.indexOf(":");if(N>0){const D=S.slice(0,N).toLowerCase();I.has(D)||h.push(`Unknown field: ${D}`)}}}catch{}return Array.from(new Set(h))})();return e.jsxs("div",{className:"search-bar-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(Ie,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"What are you looking for? Try 'kids at the park' or 'last summer'",value:s,onChange:h=>{t(h.target.value),c(!0)},onKeyDown:h=>{h.key==="Enter"&&v(s)},onFocus:()=>c(!0),onBlur:()=>setTimeout(()=>c(!1),120),ref:j,className:"search-input"}),e.jsx("button",{type:"button",onClick:()=>y(!0),className:"history-button",title:"View search history",children:e.jsx(Li,{className:"history-icon"})}),T.length>0&&e.jsx("div",{className:"ml-2 text-red-600 text-xs",title:T.join(`
`),"aria-label":"Query warnings",children:"!"})]}),T.length>0&&e.jsx("div",{className:"text-[11px] text-red-600 mt-1 px-1",children:T.slice(0,2).map((h,m)=>e.jsx("div",{children:h},m))}),u&&e.jsx("div",{className:"suggestions-dropdown",children:w.length===0?e.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No suggestions"}):w.map(h=>e.jsxs("button",{type:"button",className:"suggestion-item",onMouseDown:m=>{m.preventDefault();let C=h.label;h.cat==="People"?C=`person:"${h.label}"`:h.cat==="Camera"?C=`camera:"${h.label}"`:h.cat==="Place"?C=`place:"${h.label}"`:h.cat==="Tag"&&(C=`tag:${h.label}`);const I=(s||"").trim(),E=I?`${I} ${C}`:C;t(E),c(!1),setTimeout(()=>v(E),0)},children:[e.jsxs("div",{className:"suggestion-content",children:[h.icon&&e.jsx(h.icon,{className:"suggestion-icon"}),e.jsxs("div",{className:"suggestion-text",children:[e.jsxs("div",{className:"suggestion-main",children:[e.jsxs("span",{className:"suggestion-category",children:[h.cat,":"]}),e.jsx("span",{className:"suggestion-label",children:h.label})]}),h.subtitle&&e.jsx("div",{className:"suggestion-subtitle",children:h.subtitle})]})]}),e.jsx("span",{className:"suggestion-hint",children:""})]},`${h.cat}:${h.label}`))}),g&&e.jsx(Nc,{onSearch:h=>{t(h),v(h)},onClose:()=>y(!1)})]})});En.displayName="SearchBar";const mr={};function kc({searchText:s,setSearchText:t,onSearch:a,clusters:r,allTags:n,meta:i,busy:u,gridSize:c,setGridSize:l,selectedView:d,setSelectedView:g,currentFilter:y,setCurrentFilter:j,ratingMin:k,setRatingMin:v,setModal:f,setIsMobileMenuOpen:p,setShowFilters:w,selected:T,setSelected:h,dir:m,engine:C,topK:I,useOsTrash:E,showInfoOverlay:S,onToggleInfoOverlay:N,resultView:D,onChangeResultView:_,timelineBucket:Q,onChangeTimelineBucket:M,diag:H,isIndexing:$,onIndex:F,activeJobs:V,onOpenJobs:Y,progressPct:O,etaSeconds:J,paused:L,onPause:X,onResume:le,tooltip:A,ocrReady:K,photoActions:Z,uiActions:ne,toastTimerRef:oe,setToast:G,onOpenThemeModal:se}){const{state:B}=vc();return e.jsxs("div",{className:"top-bar top-bar-mobile",children:[u&&e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill"})}),e.jsxs("div",{className:"top-bar-content",children:[e.jsxs("div",{className:"top-bar-left",children:[e.jsx("button",{type:"button",className:"mobile-menu-button",onClick:()=>p(!0),"aria-label":"Open menu",children:e.jsx(zi,{className:"w-5 h-5"})}),e.jsx(En,{searchText:s,setSearchText:t,onSearch:a,clusters:r,allTags:n,meta:i}),e.jsxs("div",{className:"quick-filters hidden md:flex items-center gap-2 ml-2",children:[(i?.cameras||[]).slice(0,3).map(U=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const pe=`camera:"${U}"`,te=(s||"").trim(),me=te?`${te} ${pe}`:pe;t(me),a(me)},title:`Filter camera: ${U}`,children:String(U)},`cam-${U}`)),(n||[]).slice(0,6).map(U=>e.jsxs("button",{type:"button",className:"chip",onClick:()=>{const pe=`tag:${U}`,te=(s||"").trim(),me=te?`${te} ${pe}`:pe;t(me),a(me)},title:`Filter tag: ${U}`,children:["#",U]},`tag-${U}`)),(r||[]).filter(U=>U.name).slice(0,6).map(U=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const te=`person:"${String(U.name)}"`,me=(s||"").trim(),W=me?`${me} ${te}`:te;t(W),a(W)},title:`Filter person: ${String(U.name)}`,children:String(U.name)},`person-${U.name}`)),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const U="has_text:true",pe=(s||"").trim(),te=pe?`${pe} ${U}`:U;t(te),a(te)},title:"Filter photos that contain text",children:"Text"}),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const U="(filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi) AND duration:>30",pe=(s||"").trim(),te=pe?`${pe} ${U}`:U;t(te),a(te)},title:"Find videos longer than 30 seconds",children:"Videos > 30s"})]}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>w(U=>!U),"aria-label":"Show filters",children:[e.jsx(sa,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Filters"})]}),/(camera:|tag:|person:|has_text:|iso:|fnumber:|width:|height:|place:)/i.test(s||"")&&e.jsx("button",{type:"button",className:"chip",onClick:()=>{const U=(s||"").replace(/\b(camera|tag|person|has_text|iso|fnumber|width|height|place):[^\s]+/gi,"").replace(/\s{2,}/g," ").trim();t(U),a(U)},title:"Clear filter tokens from query","aria-label":"Clear filter tokens",children:"Clear filters"}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>f({kind:"save"}),title:"Save this search for later","aria-label":"Save current search",children:[e.jsx(Ui,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Remember"})]})]}),e.jsxs("div",{className:"top-bar-right",children:[H&&(H.engines?.length||0)>=1&&e.jsxs("div",{className:"indexed-chip relative",children:[e.jsx("span",{className:"indexed-label",children:"Indexed"}),e.jsx("span",{className:"indexed-count",children:H.engines?.[0]?.count||0}),e.jsx("button",{type:"button",className:"indexed-action",onClick:()=>F&&F(),disabled:!!$,"aria-label":$?"Indexing photos (indeterminate)":H.engines?.[0]?.count?"Reindex your library":"Start indexing your library",title:$?"Indexing runs in the background. You can keep working.":H.engines?.[0]?.count?"Reindex photos":"Start indexing",children:$?"Indexing":H.engines?.[0]?.count?"Reindex":"Index"}),$&&e.jsx("div",{className:"indexed-progress","aria-hidden":!0,children:e.jsx("div",{className:"indexed-progress-bar",style:typeof O=="number"&&O>=0&&O<=1?{width:`${Math.max(4,Math.round(O*100))}%`}:void 0})}),$&&typeof J=="number"&&isFinite(J)&&J>0&&e.jsxs("span",{className:"ml-2 text-[11px] text-gray-600",title:"Estimated time remaining",children:["~",Math.max(1,Math.ceil(J/60)),"m"]}),$&&e.jsx("button",{type:"button",className:"ml-2 chip",onClick:()=>L?le?.():X?.(),"aria-label":L?"Resume indexing":"Pause indexing",title:L?"Resume indexing":"Pause indexing",children:L?"Resume":"Pause"}),A&&e.jsx("div",{className:"tooltip-card",role:"tooltip","aria-hidden":!0,children:(A.split("  ")||[]).map((U,pe)=>e.jsx("div",{className:"tooltip-line",children:U},pe))})]}),K&&e.jsx("span",{className:"chip",title:"OCR ready: search text inside images",children:"OCR"}),typeof V=="number"&&V>0&&e.jsxs("button",{type:"button",className:"chip",onClick:()=>Y&&Y(),title:"View running tasks","aria-label":`Open Jobs (${V})`,children:["Jobs (",V,")"]}),e.jsx("div",{className:"grid-size-control",children:["small","medium","large"].map(U=>e.jsx("button",{type:"button",onClick:()=>l(U),className:`grid-size-button ${c===U?"active":""}`,"aria-label":`Set grid size to ${U}`,children:U.charAt(0).toUpperCase()+U.slice(1)},U))}),e.jsxs("div",{className:"view-mode-control",children:[e.jsx("button",{type:"button",onClick:()=>g("results"),className:`view-mode-button ${d==="results"?"active":""}`,"aria-label":"Grid view",children:e.jsx(gt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>g("library"),className:`view-mode-button ${d==="library"?"active":""}`,"aria-label":"List view",children:e.jsx(Cr,{className:"w-4 h-4"})})]}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Settings & Indexing",onClick:()=>f({kind:"folder"}),"aria-label":"Open settings and indexing options",children:e.jsx(lt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Open theme settings","aria-label":"Open theme settings",onClick:()=>se?.(),children:e.jsx(Bt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"filter-chips",children:["All","Today","This Week","This Month","Favorites","People","Screenshots"].map(U=>e.jsx("button",{type:"button",onClick:()=>{j(U.toLowerCase()),U==="Favorites"&&(Z.setFavOnly(!0),a(s))},className:`chip ${y===U.toLowerCase()?"active":""}`,"aria-label":`Filter by ${U}`,children:U},U))}),e.jsxs("div",{className:"rating-filter",children:[e.jsx("span",{children:"Min rating:"}),[0,1,2,3,4,5].map(U=>e.jsx("button",{type:"button",className:`rating-button ${k===U?"active":""}`,onClick:()=>v(U),"aria-label":`Filter by minimum rating of ${U}`,children:U===0?"Any":`${"".repeat(U)}`},U))]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"View:"}),e.jsx("button",{type:"button",className:`view-button ${D==="grid"?"active":""}`,onClick:()=>_("grid"),"aria-pressed":D==="grid",children:"Grid"}),e.jsx("button",{type:"button",className:`view-button ${D==="timeline"?"active":""}`,onClick:()=>_("timeline"),"aria-pressed":D==="timeline",children:"Timeline"})]}),e.jsxs("div",{className:"text-[11px] text-gray-600 mt-1",children:["Boolean: AND, OR, NOT, ( )  Fields:"," ",e.jsx("span",{className:"font-mono",children:"camera:"})," ",e.jsx("span",{className:"font-mono",children:"place:"})," ",e.jsx("span",{className:"font-mono",children:"tag:"})," ",e.jsx("span",{className:"font-mono",children:"rating:"})," ",e.jsx("span",{className:"font-mono",children:"person:"})," ",e.jsx("span",{className:"font-mono",children:"has_text:"})," ",e.jsx("span",{className:"font-mono",children:"filetype:"}),"  Numeric:"," ",e.jsx("span",{className:"font-mono",children:"iso:"})," ",e.jsx("span",{className:"font-mono",children:"fnumber:"})," ",e.jsx("span",{className:"font-mono",children:"width:"})," ",e.jsx("span",{className:"font-mono",children:"height:"})," ",e.jsx("span",{className:"font-mono",children:"mtime:"})," ",e.jsx("span",{className:"font-mono",children:"brightness:"})," ",e.jsx("span",{className:"font-mono",children:"sharpness:"})," ",e.jsx("span",{className:"font-mono",children:"exposure:"})," ",e.jsx("span",{className:"font-mono",children:"focal:"})," ",e.jsx("span",{className:"font-mono",children:"duration:"})," (supports >=, <=, >, <, =)"]}),e.jsx("div",{className:"preset-filters hidden md:flex flex-wrap gap-2 mt-1",children:[{label:"High ISO",expr:"iso:>=1600"},{label:"Shallow DoF",expr:"fnumber:<2.8"},{label:"Text in Image",expr:"has_text:true"},{label:"Large",expr:"width:>=3000 height:>=2000"},{label:"Recent (30d)",expr:`mtime:>=${Math.floor(Date.now()/1e3-30*24*3600)}`},{label:"Underexposed",expr:"brightness:<50"},{label:"Sharp Only",expr:"sharpness:>=60"},{label:"Video > 30s",expr:"filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi AND duration:>30"}].map(U=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const pe=U.expr,te=(s||"").trim(),me=te?`${te} ${pe}`:pe;t(me),a(me)},title:U.expr,children:U.label},U.label))}),D==="timeline"&&e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"Bucket:"}),["day","week","month"].map(U=>e.jsx("button",{type:"button",className:`view-button ${Q===U?"active":""}`,onClick:()=>M&&M(U),"aria-pressed":Q===U,children:U[0].toUpperCase()+U.slice(1)},U))]}),T.size>0&&e.jsxs("div",{className:"selected-actions",children:[e.jsxs("span",{className:"selected-count",children:[T.size," photo",T.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"export"}),"aria-label":"Export selected photos",children:[e.jsx(He,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"enhanced-share"}),"aria-label":"Share selected photos",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Share"]}),mr?.VITE_FF_SHARING_V1==="1"&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"share"}),"aria-label":"Share selected photos",children:[e.jsx(Ie,{className:"w-4 h-4"})," Share"]}),mr?.VITE_FF_SHARING_V1==="1"&&e.jsx("button",{type:"button",className:"action-button",onClick:()=>f({kind:"shareManage"}),"aria-label":"Manage shared links",children:"Manage Shares"}),e.jsxs("button",{type:"button",className:`action-button ${S?"active":""}`,onClick:N,"aria-pressed":S,"aria-label":"Toggle info overlay on grid items",children:[e.jsx(ys,{className:"w-4 h-4"})," Info"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>f({kind:"advanced"}),"aria-label":"Open advanced search",children:"Advanced"}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"tag"}),"aria-label":"Tag selected photos",children:[e.jsx(Nr,{className:"w-4 h-4"}),"Tag"]}),T.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:async()=>{const U=Array.from(T)[0],{apiSearchLike:pe}=await ye(async()=>{const{apiSearchLike:te}=await Promise.resolve().then(()=>ve);return{apiSearchLike:te}},void 0,import.meta.url);ne.setBusy("Searching similar");try{const te=await pe(m,U,C,I);Z.setResults(te.results||[]),g("results")}catch(te){ne.setNote(te instanceof Error?te.message:"Search failed")}finally{ne.setBusy("")}},"aria-label":"Find similar photos to the selected photo",children:[e.jsx(Ie,{className:"w-4 h-4"})," Similar"]}),T.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"likeplus"}),"aria-label":"Find similar photos with additional text query",children:[e.jsx(Ie,{className:"w-4 h-4"})," Similar + Text"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"collect"}),"aria-label":"Add selected photos to a collection",children:[e.jsx(Ge,{className:"w-4 h-4"})," Add to Collection"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"removeCollect"}),"aria-label":"Remove selected photos from a collection",children:[e.jsx(Ge,{className:"w-4 h-4 rotate-180"})," Remove from Collection"]}),e.jsxs("button",{type:"button",className:"action-button danger",onClick:async()=>{if(T.size!==0&&confirm(`Move ${T.size} item(s) to Trash?`))try{ne.setBusy("Deleting");const U=await $a(m,Array.from(T),E);ne.setNote(`Moved ${U.moved} to ${E?"OS Trash":"Trash"}`),h(new Set),E?G({message:`Moved ${U.moved} to OS Trash`}):(oe.current&&window.clearTimeout(oe.current),G({message:`Moved ${U.moved} to Trash`,actionLabel:"Undo",onAction:async()=>{try{const pe=await Ma(m);ne.setNote(`Restored ${pe.restored}`)}catch{}G(null),oe.current&&(window.clearTimeout(oe.current),oe.current=null)}}),oe.current=window.setTimeout(()=>{G(null),oe.current=null},1e4))}catch(U){ne.setNote(U instanceof Error?U.message:"Delete failed")}finally{ne.setBusy("")}},"aria-label":"Delete selected photos",children:[e.jsx(ot,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function Sc({items:s,note:t,diag:a,engine:r}){const n=s.length,i=(a?.engines||[]).find(c=>c.key===r),u=i?.fast&&(i.fast.annoy||i.fast.faiss||i.fast.hnsw);return e.jsx("div",{className:"stats-bar",children:e.jsxs("div",{className:"stats-content",children:[e.jsxs("div",{className:"stats-left",children:[e.jsxs("span",{children:[n," photos"]}),t?e.jsx("span",{className:"text-gray-800",children:t}):null]}),e.jsxs("div",{className:"stats-right",children:[e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${i?.count?"ready":"empty"}`}),e.jsxs("span",{children:["AI Index ",i?.count?"Ready":"Empty"]})]}),e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${u?"fast-ready":"empty"}`}),e.jsxs("span",{children:["Fast Index ",u?"Ready":""]})]})]})]})})}function Cc({activeTab:s,onTabChange:t,onShowFilters:a,onShowUpload:r,onShowLibrary:n,showSecondaryActions:i=!0}){const u=[{id:"home",icon:Sr,label:"Home"},{id:"search",icon:Ie,label:"Search"},{id:"favorites",icon:Gt,label:"Favorites"},{id:"settings",icon:lt,label:"Settings"}];return e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 md:hidden",children:[i&&e.jsxs("div",{className:"flex items-center justify-around py-2 px-4 border-b border-gray-100",children:[e.jsxs("button",{type:"button",onClick:a,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-blue-600 transition-colors","aria-label":"Show filters",children:[e.jsx(sa,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Filters"})]}),e.jsxs("button",{type:"button",onClick:r,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-green-600 transition-colors","aria-label":"Upload",children:[e.jsx(mt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Upload"})]}),e.jsxs("button",{type:"button",onClick:n,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-purple-600 transition-colors","aria-label":"Library",children:[e.jsx(Ge,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Library"})]})]}),e.jsx("div",{className:"flex items-center justify-around py-2 px-4",children:u.map(({id:c,icon:l,label:d})=>e.jsxs("button",{type:"button",onClick:()=>t(c),className:`flex flex-col items-center gap-1 p-2 min-w-[64px] transition-colors ${s===c?"text-blue-600":"text-gray-600 hover:text-gray-900"}`,"aria-label":d,"aria-current":s===c,children:[e.jsx(l,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs font-medium",children:d}),s===c&&e.jsx("div",{className:"w-1 h-1 bg-blue-600 rounded-full mt-1"})]},c))})]})}function Tc({currentDir:s,provider:t}){const[a,r]=o.useState([]),[n,i]=o.useState(!1),[u,c]=o.useState(!1),[l,d]=o.useState(null),[g,y]=o.useState(null),[j,k]=o.useState(null);o.useEffect(()=>{s&&v()},[s]);const v=async()=>{try{i(!0),k(null);const h=await dn(s);r(h.videos)}catch(h){k(h instanceof Error?h.message:"Failed to load videos")}finally{i(!1)}},f=async()=>{try{c(!0),k(null);const h=await mn(s,t);alert(`Indexed ${h.indexed} out of ${h.total} videos`),await v()}catch(h){k(h instanceof Error?h.message:"Failed to index videos")}finally{c(!1)}},p=async h=>{d(h);try{const m=await un(s,h.path);y(m.metadata)}catch(m){console.error("Failed to load video metadata:",m),y(null)}},w=h=>{const m=["Bytes","KB","MB","GB","TB"];if(h===0)return"0 Bytes";const C=Math.floor(Math.log(h)/Math.log(1024));return Math.round(h/Math.pow(1024,C)*100)/100+" "+m[C]},T=h=>{const m=Math.floor(h/60),C=Math.floor(h%60);return`${m}:${C.toString().padStart(2,"0")}`};return n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(Cn,{})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Video Manager"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:v,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"Refresh"}),e.jsx("button",{onClick:f,disabled:u||a.length===0,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:u?"Indexing...":"Index Videos"})]})]}),j&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:j}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Videos (",a.length,")"]}),a.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No videos found in this directory"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.map((h,m)=>e.jsxs("div",{onClick:()=>p(h),className:`p-3 border rounded cursor-pointer transition-colors ${l?.path===h.path?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium truncate",title:h.path,children:h.path.split("/").pop()||h.path}),e.jsxs("div",{className:"text-sm text-gray-500",children:[w(h.size),"  ",new Date(h.mtime*1e3).toLocaleDateString()]})]},m))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Video Details"}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video bg-gray-100 rounded overflow-hidden",children:e.jsx("img",{src:hn(s,l.path),alt:"Video thumbnail",className:"w-full h-full object-cover",onError:h=>{h.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjNjM2MzYzIi8+Cjwvc3ZnPgo="}})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded space-y-2",children:[e.jsx("div",{className:"font-medium",children:"File Information"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Path:"})," ",l.path]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",w(l.size)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Modified:"})," ",new Date(l.mtime*1e3).toLocaleString()]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium mt-4",children:"Video Metadata"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Dimensions:"})," ",g.width,"  ",g.height]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Rate:"})," ",g.fps?.toFixed(2)," fps"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",T(g.duration)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Count:"})," ",g.frame_count?.toLocaleString()]})]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Select a video to view details"})]})]})]})}const Pn=o.memo(()=>{const[s,t]=o.useState(null),[a,r]=o.useState(!1);return o.useEffect(()=>{},[]),o.useEffect(()=>{const n=i=>{i.ctrlKey&&i.shiftKey&&i.key==="P"&&r(u=>!u)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[]),null});Pn.displayName="PerformanceMonitor";function Ec({open:s,onClose:t,onApply:a,onSave:r,allTags:n,cameras:i,people:u}){const[c,l]=o.useState(""),[d,g]=o.useState(""),[y,j]=o.useState(""),[k,v]=o.useState(""),[f,p]=o.useState(""),[w,T]=o.useState("any"),[h,m]=o.useState(""),[C,I]=o.useState(""),[E,S]=o.useState(""),[N,D]=o.useState(""),[_,Q]=o.useState(""),[M,H]=o.useState(""),[$,F]=o.useState(""),V=o.useMemo(()=>{const O=[];return c.trim()&&O.push(c.trim()),d.trim()&&O.push(`camera:"${d.trim()}"`),y.trim()&&O.push(`place:"${y.trim()}"`),k.trim()&&O.push(`tag:${k.trim()}`),f.trim()&&O.push(`person:"${f.trim()}"`),w==="true"&&O.push("has_text:true"),w==="false"&&O.push("has_text:false"),h.trim()&&O.push(`iso:>=${h.trim()}`),C.trim()&&O.push(`fnumber:<${C.trim()}`),E.trim()&&O.push(`width:>=${E.trim()}`),N.trim()&&O.push(`height:>=${N.trim()}`),_.trim()&&O.push(`filetype:${_.trim().toLowerCase()}`),M.trim()&&O.push(`duration:>${M.trim()}`),O.join(" AND ")},[c,d,y,k,f,w,h,C,E,N,_,M]),Y=o.useMemo(()=>{const O=[],J=V||"";let L=0;for(const X of J)if(X==="("?L++:X===")"&&L--,L<0){O.push("Unbalanced parentheses");break}L>0&&O.push("Unbalanced parentheses");try{const X=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),le=J.split(/\s+/);for(const A of le){const K=A.indexOf(":");if(K>0){const Z=A.slice(0,K).toLowerCase();X.has(Z)||O.push(`Unknown field: ${Z}`)}}}catch{}return Array.from(new Set(O))},[V]);return s?e.jsxs("div",{className:"fixed inset-0 z-[1080] flex items-center justify-center",onKeyDown:O=>{O.key==="Escape"&&t()},children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1081] bg-white dark:bg-gray-900 rounded-lg shadow p-4 w-full max-w-2xl",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Advanced Search"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Base Text"}),e.jsx("input",{className:"input",value:c,onChange:O=>l(O.target.value),placeholder:'e.g., "golden hour" OR beach'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Camera"}),e.jsx("input",{list:"cam-list",className:"input",value:d,onChange:O=>g(O.target.value),placeholder:"Canon, Sony..."}),e.jsx("datalist",{id:"cam-list",children:i.map(O=>e.jsx("option",{value:O},O))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Place"}),e.jsx("input",{className:"input",value:y,onChange:O=>j(O.target.value),placeholder:"City, location..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Tag"}),e.jsx("input",{list:"tag-list",className:"input",value:k,onChange:O=>v(O.target.value),placeholder:"Any tag"}),e.jsx("datalist",{id:"tag-list",children:n.map(O=>e.jsx("option",{value:O},O))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Person"}),e.jsx("input",{list:"person-list",className:"input",value:f,onChange:O=>p(O.target.value),placeholder:"Person name"}),e.jsx("datalist",{id:"person-list",children:u.map(O=>e.jsx("option",{value:O},O))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Has Text"}),e.jsxs("select",{className:"input",value:w,onChange:O=>T(O.target.value),children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"ISO "}),e.jsx("input",{className:"input",value:h,onChange:O=>m(O.target.value),placeholder:"e.g., 1600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"f-number <"}),e.jsx("input",{className:"input",value:C,onChange:O=>I(O.target.value),placeholder:"e.g., 2.8"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Width "}),e.jsx("input",{className:"input",value:E,onChange:O=>S(O.target.value),placeholder:"e.g., 3000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Height "}),e.jsx("input",{className:"input",value:N,onChange:O=>D(O.target.value),placeholder:"e.g., 2000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Filetype"}),e.jsx("input",{className:"input",value:_,onChange:O=>Q(O.target.value),placeholder:"jpg, png, mp4, ..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Duration > (s)"}),e.jsx("input",{className:"input",value:M,onChange:O=>H(O.target.value),placeholder:"e.g., 30"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Preview"}),e.jsx("div",{className:"text-sm font-mono bg-gray-100 dark:bg-gray-800 rounded p-2 break-words",style:{minHeight:"2.2rem"},children:V||""}),Y.length>0&&e.jsx("ul",{className:"mt-2 text-xs text-red-600 list-disc pl-5",children:Y.map((O,J)=>e.jsx("li",{children:O},J))})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",placeholder:"Preset name",value:$,onChange:O=>F(O.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{$.trim()&&(r($.trim(),V),F(""))},children:"Save Preset"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"Close"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a(V),children:"Apply"})]})]})]})]}):null}const Pc=({onEscape:s,children:t})=>e.jsx("div",{children:t}),Ic=({selected:s,dir:t,onClose:a,uiActions:r})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:n=>{n.key==="Escape"&&a()},children:e.jsx(Pc,{onEscape:a,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Export Selected"}),e.jsxs("form",{onSubmit:n=>{n.preventDefault();const i=n.target,u=i.elements.namedItem("dest").value.trim();if(!u)return;const c=i.elements.namedItem("preset")?.value||"web",l=i.elements.namedItem("strip_all")?.checked||!1,d=i.elements.namedItem("strip_gps")?.checked||!1,g=i.elements.namedItem("keep_copy")?.checked||!1,y=i.elements.namedItem("overwrite")?.checked||!1;(async()=>{try{const j=Array.from(s),k=c;let v,f;if(k==="custom"){const w=parseInt(i.elements.namedItem("custom_long")?.value||""),T=parseInt(i.elements.namedItem("custom_quality")?.value||"");v=isNaN(w)?void 0:w,f=isNaN(T)?void 0:T}const p=await $t(t,j,u,"copy",l,y,{stripGps:d,keepCopyrightOnly:g,preset:k,resizeLong:v,quality:f});r.setNote(`Exported ${p.copied}, skipped ${p.skipped}, errors ${p.errors}  ${p.dest}`)}catch(j){r.setNote(j instanceof Error?j.message:"Export failed")}})(),a()},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"dest-input",children:"Destination"}),e.jsx("input",{id:"dest-input",name:"dest",className:"w-full border rounded px-2 py-1",placeholder:"/absolute/path"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-sm font-medium mb-1",children:"Preset"}),e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"web",defaultChecked:!0})," Web"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"email"})," Email"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"print"})," Print"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"custom"})," Custom"]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Custom long edge"}),e.jsx("input",{type:"number",name:"custom_long",className:"border rounded px-2 py-1 w-28",placeholder:"1600"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Quality (1100)"}),e.jsx("input",{type:"number",name:"custom_quality",min:1,max:100,className:"border rounded px-2 py-1 w-28",placeholder:"85"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Privacy"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_all"})," Strip all EXIF/IPTC"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_gps"})," Strip GPS only"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"keep_copy"})," Keep copyright only"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Options"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"overwrite"})," Overwrite existing files"]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:a,"aria-label":"Cancel export",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Export selected photos",children:"Export"})]})]})]})})}),$c=({onEscape:s,children:t})=>e.jsx("div",{children:t}),Mc=({onClose:s,onTagSelected:t})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:a=>{a.key==="Escape"&&s()},children:e.jsx($c,{onEscape:s,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Tag Selected"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Enter comma-separated tags"}),e.jsxs("form",{onSubmit:a=>{a.preventDefault();const n=a.target.elements.namedItem("tags").value.trim();n&&(t(n),s())},children:[e.jsx("label",{htmlFor:"tags-input",className:"sr-only",children:"Tags"}),e.jsx("input",{id:"tags-input",name:"tags",className:"w-full border rounded px-2 py-1",placeholder:"family, beach, 2024"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:s,"aria-label":"Cancel tagging",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save tags",children:"Save"})]})]})]})})});function Fc({onFolderSelect:s,currentPath:t}){const[a,r]=o.useState(t||""),[n,i]=o.useState(!1),[u,c]=o.useState(null),[l,d]=o.useState(""),g=o.useCallback(async f=>{if(f.trim()){i(!0),d("");try{const p=await fetch(`${xe}/scan_count`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([f])});if(!p.ok)throw new Error("Failed to scan folder");const w=await p.json();w.items&&w.items.length>0&&c(w.items[0])}catch(p){d(p instanceof Error?p.message:"Failed to scan folder"),c(null)}finally{i(!1)}}},[]),y=o.useCallback(()=>{g(a)},[a,g]),j=o.useCallback(()=>{u&&u.exists&&u.files>0&&s(u.path)},[u,s]),k=f=>{if(f===0)return"0 Bytes";const p=1024,w=["Bytes","KB","MB","GB"],T=Math.floor(Math.log(f)/Math.log(p));return parseFloat((f/Math.pow(p,T)).toFixed(2))+" "+w[T]},v=[{name:"Pictures",path:"~/Pictures"},{name:"Desktop",path:"~/Desktop"},{name:"Downloads",path:"~/Downloads"},{name:"Documents",path:"~/Documents"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Folder Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:f=>r(f.target.value),placeholder:"/path/to/your/photos or ~/Pictures",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:f=>f.key==="Enter"&&y()}),e.jsx("button",{onClick:y,disabled:n||!a.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(na,{className:"w-4 h-4 animate-spin"}),"Scanning"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-4 h-4"}),"Scan"]})})]})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(wr,{className:"w-4 h-4"}),l]}),u&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Path:"}),e.jsx("span",{className:"text-sm text-gray-600 truncate",children:u.path})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx("span",{className:`text-sm ${u.exists?"text-green-600":"text-red-600"}`,children:u.exists?"Exists":"Not Found"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Photos Found:"}),e.jsx("span",{className:"text-sm text-gray-600",children:u.files})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Size:"}),e.jsx("span",{className:"text-sm text-gray-600",children:k(u.bytes)})]})]}),u.exists&&u.files>0&&e.jsxs("button",{onClick:j,className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:["Use This Folder (",u.files," photos)"]}),u.exists&&u.files===0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-sm text-yellow-800",children:"No photos found in this folder. Supported formats: JPG, PNG, GIF, TIF, WebP, HEIC, MP4, MOV, MKV, AVI, WebM"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Quick Select:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.map(f=>e.jsx("button",{onClick:()=>{r(f.path),g(f.path)},className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:f.name},f.path))})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Tip: You can also drag and drop a folder onto the app, or use the file picker in the main interface."})]})}const Dc=({onEscape:s,children:t})=>e.jsx("div",{children:t}),Rc=({dir:s,useOsTrash:t,useFast:a,fastKind:r,useCaps:n,useOcr:i,hasText:u,highContrast:c,onClose:l,settingsActions:d,uiActions:g,doIndex:y,prepareFast:j,buildOCR:k,buildMetadata:v})=>{const[f,p]=o.useState(s),w=h=>{p(h)},T=async h=>{if(h.preventDefault(),f){d.setDir(f),l();try{await xt(f),await y()}catch(m){console.error("Failed to add path or index:",m),g.setNote(m instanceof Error?m.message:"Failed to add path")}}};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:h=>{h.key==="Escape"&&l()},children:e.jsx(Dc,{onEscape:l,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-4",children:"Set Photo Folder"}),e.jsx(Fc,{onFolderSelect:w,currentPath:f}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("label",{htmlFor:"use-os-trash",className:"text-sm",children:"Use OS Trash (no Undo)"}),e.jsx("input",{id:"use-os-trash",type:"checkbox",checked:t,onChange:h=>d.setUseOsTrash(h.target.checked)})]}),e.jsxs("div",{className:"mt-4 border-t pt-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Preferences"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-fast",children:"Use Fast Index"}),e.jsx("input",{id:"pref-fast",type:"checkbox",checked:a,onChange:h=>d.setUseFast(h.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{htmlFor:"pref-fastkind",children:"Fast Kind"}),e.jsxs("select",{id:"pref-fastkind",className:"border rounded px-2 py-1",value:r,onChange:h=>d.setFastKind(h.target.value),children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"annoy",children:"Annoy"}),e.jsx("option",{value:"faiss",children:"FAISS"}),e.jsx("option",{value:"hnsw",children:"HNSW"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-caps",children:"Use Captions"}),e.jsx("input",{id:"pref-caps",type:"checkbox",checked:n,onChange:h=>d.setUseCaps(h.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-ocr",children:"Use OCR"}),e.jsx("input",{id:"pref-ocr",type:"checkbox",checked:i,onChange:h=>d.setUseOcr(h.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-hastext",children:"Default: Has Text"}),e.jsx("input",{id:"pref-hastext",type:"checkbox",checked:u,onChange:h=>d.setHasText(h.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-high-contrast",children:"High Contrast"}),e.jsx("input",{id:"pref-high-contrast",type:"checkbox",checked:c,onChange:h=>d.setHighContrast(h.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pref-vlm",className:"block mb-1",children:"VLM Model"}),e.jsx("input",{id:"pref-vlm",className:"w-full border rounded px-2 py-1",defaultValue:"",onChange:h=>{}})]})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:y,"aria-label":"Index files in the selected folder",children:"Index"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>j("annoy"),"aria-label":"Prepare fast index",children:"Fast"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:k,"aria-label":"Build OCR index",children:"OCR"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:v,"aria-label":"Build metadata index",children:"Metadata"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:l,"aria-label":"Close settings",children:"Close"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save settings",children:"Save"})]})]})]})]})})})},Oc=({onEscape:s,children:t})=>e.jsx("div",{children:t}),_c=({selected:s,dir:t,engine:a,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(Oc,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Similar + Text"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const d=l.target,g=d.elements.namedItem("text").value.trim(),y=parseFloat(d.elements.namedItem("weight").value);if(s.size===1)try{const j=Array.from(s)[0],{apiSearchLikePlus:k}=await ye(async()=>{const{apiSearchLikePlus:f}=await Promise.resolve().then(()=>ve);return{apiSearchLikePlus:f}},void 0,import.meta.url);c.setBusy("Searching");const v=await k(t,j,a,r,g||void 0,Number.isNaN(y)?.5:y);u.setResults(v.results||[]),i("results")}catch(j){c.setNote(j instanceof Error?j.message:"Search failed")}finally{c.setBusy("")}n()},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"likeplus-text",children:"Text (optional)"}),e.jsx("input",{id:"likeplus-text",name:"text",className:"w-full border rounded px-2 py-1",placeholder:"e.g. beach at sunset"}),e.jsx("label",{className:"block text-sm mt-3 mb-1",htmlFor:"mix-weight",children:"Weight (image vs text)"}),e.jsx("input",{id:"mix-weight",name:"weight",type:"range",min:"0",max:"1",step:"0.05",defaultValue:"0.5",className:"w-full"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel similar search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Search for similar photos with text",children:"Search"})]})]})]})})}),Lc=({onEscape:s,children:t})=>e.jsx("div",{children:t}),Ac=({dir:s,searchText:t,query:a,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(Lc,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Save Search"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const g=l.target.elements.namedItem("name").value.trim();if(g){try{const{apiAddSaved:y,apiGetSaved:j}=await ye(async()=>{const{apiAddSaved:v,apiGetSaved:f}=await Promise.resolve().then(()=>ve);return{apiAddSaved:v,apiGetSaved:f}},void 0,import.meta.url);await y(s,g,t||a||"",r);const k=await j(s);u.setSaved(k.saved||[]),i("saved")}catch(y){c.setNote(y instanceof Error?y.message:"Save failed")}n()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"save-name",children:"Name"}),e.jsx("input",{id:"save-name",name:"name",className:"w-full border rounded px-2 py-1",placeholder:"e.g. Dogs on beach"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel saving search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save search",children:"Save"})]})]})]})})}),zc=({onEscape:s,children:t})=>e.jsx("div",{children:t}),Uc=({selected:s,dir:t,collections:a,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(zc,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Add to Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiSetCollection:g,apiGetCollections:y}=await ye(async()=>{const{apiSetCollection:k,apiGetCollections:v}=await Promise.resolve().then(()=>ve);return{apiSetCollection:k,apiGetCollections:v}},void 0,import.meta.url);await g(t,d,Array.from(s));const j=await y(t);i.setCollections(j.collections||{}),n({message:`Added ${s.size} to ${d}`})}catch(g){u.setNote(g instanceof Error?g.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name",children:"Collection"}),e.jsx("input",{id:"col-name",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Type or choose"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(a||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel adding to collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Add to collection",children:"Add"})]})]})]})})}),Bc=({onEscape:s,children:t})=>e.jsx("div",{children:t}),Hc=({selected:s,dir:t,collections:a,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(Bc,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Remove from Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiGetCollections:g,apiSetCollection:y}=await ye(async()=>{const{apiGetCollections:p,apiSetCollection:w}=await Promise.resolve().then(()=>ve);return{apiGetCollections:p,apiSetCollection:w}},void 0,import.meta.url),k=(await g(t)).collections?.[d]||[],v=k.filter(p=>!s.has(p));await y(t,d,v);const f=await g(t);i.setCollections(f.collections||{}),n({message:`Removed ${k.length-v.length} from ${d}`})}catch(g){u.setNote(g instanceof Error?g.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name-remove",children:"Collection"}),e.jsx("input",{id:"col-name-remove",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Choose collection"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(a||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel removing from collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Remove from collection",children:"Remove"})]})]})]})})}),Vc=[{key:"D",shift:!0,description:"Toggle dark mode",action:()=>{try{const t=document.documentElement.classList.toggle("dark");localStorage.setItem("ps_theme",t?"dark":"light")}catch{}}},{key:"/",description:"Focus search",action:()=>{document.querySelector('input[placeholder*="Try"]')?.focus()}},{key:"a",description:"Open Advanced Search",action:()=>{const s=document.querySelector('[aria-label*="Open advanced search"]');s&&s.click()}},{key:"t",description:"Timeline: Jump to Today",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"today"}}))}},{key:"m",description:"Timeline: Jump to This Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"this-month"}}))}},{key:"l",description:"Timeline: Jump to Last Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"last-month"}}))}},{key:"o",description:"Timeline: Jump to Oldest",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"oldest"}}))}},{key:"Escape",description:"Close modal/Clear selection",action:()=>{const s=document.querySelector('[aria-label*="Close"]');s?.click(),s||document.querySelector('button:has-text("Clear Selection")')?.click()}},{key:"g",shift:!0,description:"Toggle grid view",action:()=>{document.querySelector('[aria-label*="Grid"]')?.click()}},{key:"l",shift:!0,description:"Toggle list view",action:()=>{document.querySelector('[aria-label*="List"]')?.click()}},{key:"a",ctrl:!0,description:"Select all",action:()=>{document.querySelector('[aria-label*="Select all"]')?.click()},enabled:!0},{key:"d",ctrl:!0,description:"Deselect all",action:()=>{document.querySelector('[aria-label*="Clear selection"]')?.click()},enabled:!0},{key:"Delete",description:"Delete selected",action:()=>{document.querySelector('button:has-text("Delete")')?.click()}},{key:"f",ctrl:!0,description:"Focus filter",action:()=>{document.querySelector('[placeholder*="Filter"]')?.focus()},enabled:!0},{key:"n",ctrl:!0,description:"New collection",action:()=>{document.querySelector('button:has-text("New Collection")')?.click()},enabled:!0},{key:"e",ctrl:!0,description:"Export selected",action:()=>{document.querySelector('button:has-text("Export")')?.click()},enabled:!0},{key:"s",ctrl:!0,description:"Save search",action:()=>{document.querySelector('button:has-text("Save Search")')?.click()},enabled:!0},{key:"ArrowLeft",description:"Previous photo",action:()=>{document.querySelector('[aria-label*="Previous"]')?.click()}},{key:"ArrowRight",description:"Next photo",action:()=>{document.querySelector('[aria-label*="Next"]')?.click()}},{key:" ",description:"Play/Pause slideshow",action:()=>{document.querySelector('[aria-label*="Play"]')?.click()}},{key:"i",description:"Toggle info panel",action:()=>{document.querySelector('[aria-label*="Info"]')?.click()}},{key:"?",shift:!0,description:"Show keyboard shortcuts",action:()=>{document.querySelector('[aria-label*="Help"]')?.click()}},{key:"h",description:"Go home",action:()=>{window.location.href="/"}},{key:"1",description:"Photos view",action:()=>{document.querySelector('[href*="/photos"]')?.click()}},{key:"2",description:"Albums view",action:()=>{document.querySelector('[href*="/albums"]')?.click()}},{key:"3",description:"People view",action:()=>{document.querySelector('[href*="/people"]')?.click()}}];function In(){const s=Vc,t=a=>{const r=[];return a.ctrl&&r.push("Ctrl"),a.alt&&r.push("Alt"),a.shift&&r.push("Shift"),a.meta&&r.push("Cmd"),r.push(a.key===" "?"Space":a.key),r.join("+")};return s.map(a=>({keys:t(a),description:a.description}))}function qc({isOpen:s,onClose:t}){const a=In();if(!s)return null;const r={Navigation:["/","1","2","3","Arrow","t","m","l","o"],Selection:["Ctrl+A","Ctrl+D","Space"],Actions:["Delete","Ctrl+E","Ctrl+S","Ctrl+N","a"],View:["Shift+G","Shift+L","i"],General:["Escape","Shift+?"]},n=i=>a.filter(u=>{const c=u.keys.toLowerCase();return i.some(l=>c.includes(l.toLowerCase()))});return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:i=>{i.key==="Escape"&&t()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close shortcuts",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(r).map(([i,u])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:i}),e.jsx("div",{className:"space-y-2",children:n(u).map((c,l)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded border border-gray-300 dark:border-gray-600",children:c.keys})]},l))})]},i))}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Pro Tips"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsxs("li",{children:[" Press ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"?"})," anytime to show this help"]}),e.jsx("li",{children:" Most shortcuts work globally except when typing in inputs"}),e.jsxs("li",{children:[" Use ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"Escape"})," to close modals or clear selection"]}),e.jsx("li",{children:" Navigate photos with arrow keys in lightbox view"})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Press any key to try it out"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})})]})})}function Wc({isOpen:s,onClose:t,initialSection:a="getting-started"}){const[r,n]=o.useState(a),[i,u]=o.useState(!1),c=In();if(!s)return null;const l=[{id:"getting-started",title:"Getting Started",icon:e.jsx(pt,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Welcome to Photo Search!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Your AI-powered photo search and management tool. Here's how to get started:"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["Tip: Press ",e.jsx("span",{className:"font-mono",children:"?"})," anytime to open this help."]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-1",children:"Select Your Photo Directory"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"Choose the folder containing your photos. The app will index them for fast searching."})]})]})}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-1",children:"Try the Demo Library"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400",children:`Don't have photos ready? Click "Try Demo" to explore with sample photos and see how search works.`})]})]})}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-semibold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-300 mb-1",children:"Start Searching"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-400",children:'Use natural language to search: "beach sunset", "family photos", "mountains", or "red car".'})]})]})})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 dark:text-yellow-300 mb-2",children:" Pro Tip"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:`The more specific your search terms, the better results you'll get. Try combining concepts like "golden hour beach wedding" or "snowy mountain landscape".`})]})]})},{id:"features",title:"Features",icon:e.jsx(Ns,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Powerful Features"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Discover what makes Photo Search special:"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Ie,{className:"w-6 h-6 text-blue-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"AI-Powered Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search by visual content, not just filenames. Find photos using natural language descriptions."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Xe,{className:"w-6 h-6 text-green-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Face Recognition"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Automatically detect and group photos by people. Find all photos of specific individuals."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(aa,{className:"w-6 h-6 text-red-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Location Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search photos by location data. Find all photos taken in Paris, at the beach, or at home."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Vt,{className:"w-6 h-6 text-yellow-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Smart Collections"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Create dynamic collections based on search criteria. Automatically updated as you add new photos."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(lt,{className:"w-6 h-6 text-purple-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Filter by date, camera, lens, ISO, aperture, and more. Combine with AI search for precise results."})]})]})]})]})},{id:"shortcuts",title:"Keyboard Shortcuts",icon:e.jsx(Ks,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"py-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Most Useful"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:c.slice(0,12).map((d,g)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-200",children:d.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600",children:d.keys})]},g))}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"View All Shortcuts"})})]})},{id:"troubleshooting",title:"Troubleshooting",icon:e.jsx(vs,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Common Issues & Solutions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Having trouble? Here are solutions to common problems:"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-red-900 dark:text-red-300 mb-2",children:" No Search Results"}),e.jsxs("ul",{className:"text-sm text-red-700 dark:text-red-400 space-y-1",children:[e.jsx("li",{children:" Try more general search terms"}),e.jsx("li",{children:" Check if your photos are indexed (look for the indexing progress)"}),e.jsx("li",{children:" Try searching for colors, objects, or activities"}),e.jsx("li",{children:" Use the demo library to test search functionality"})]})]}),e.jsxs("div",{className:"border border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-300 mb-2",children:" Photos Not Loading"}),e.jsxs("ul",{className:"text-sm text-orange-700 dark:text-orange-400 space-y-1",children:[e.jsx("li",{children:" Ensure the photo directory is accessible"}),e.jsx("li",{children:" Check file permissions"}),e.jsx("li",{children:" Try re-selecting the directory"}),e.jsx("li",{children:" Restart the application if thumbnails don't appear"})]})]}),e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:" Slow Performance"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsx("li",{children:" Large photo libraries may take time to index initially"}),e.jsx("li",{children:' Use the "Fast" indexing option for quicker but less accurate results'}),e.jsx("li",{children:" Close other applications to free up memory"}),e.jsx("li",{children:" Consider using smaller batch sizes for indexing"})]})]}),e.jsxs("div",{className:"border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-2",children:" Face Recognition Issues"}),e.jsxs("ul",{className:"text-sm text-green-700 dark:text-green-400 space-y-1",children:[e.jsx("li",{children:" Face detection works best with clear, well-lit photos"}),e.jsx("li",{children:" Ensure faces are not obstructed or at extreme angles"}),e.jsx("li",{children:" Re-index your photos after making changes"}),e.jsx("li",{children:" Check the People view to see detected faces"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Still Need Help?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"If you're still experiencing issues, try:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2 space-y-1",children:[e.jsx("li",{children:" Restarting the application"}),e.jsx("li",{children:" Checking the browser console for error messages"}),e.jsx("li",{children:" Ensuring your browser supports modern web features"}),e.jsx("li",{children:" Clearing browser cache and cookies"})]})]})]})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:d=>{d.key==="Escape"&&t()},role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bi,{className:"w-6 h-6 text-blue-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Help Center"})]}),e.jsx("button",{type:"button",onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close help",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:e.jsx("div",{className:"flex gap-1",children:l.map(d=>e.jsxs("button",{type:"button",onClick:()=>n(d.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${r===d.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[d.icon,d.title]},d.id))})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:l.find(d=>d.id===r)?.content}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Need more help? Check out the demo library to explore features."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors text-sm font-medium",children:"Keyboard Shortcuts"}),e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})]})})]})}),e.jsx(qc,{isOpen:i,onClose:()=>u(!1)})]})}const Gc={facebook:{name:"Facebook",icon:e.jsx(Gi,{className:"w-5 h-5"}),maxSize:2048,aspectRatio:"1.91:1"},instagram:{name:"Instagram",icon:e.jsx(Wi,{className:"w-5 h-5"}),maxSize:1080,aspectRatio:"1:1"},twitter:{name:"Twitter",icon:e.jsx(qi,{className:"w-5 h-5"}),maxSize:1200,aspectRatio:"16:9"}},xr={web:{name:"Web",description:"Optimized for websites",maxSize:1920,quality:85},email:{name:"Email",description:"Small size for email",maxSize:1024,quality:80},print:{name:"Print",description:"High quality for printing",maxSize:3e3,quality:95},instagram:{name:"Instagram",description:"Square format for Instagram",maxSize:1080,quality:90},twitter:{name:"Twitter",description:"Wide format for Twitter",maxSize:1200,quality:85},facebook:{name:"Facebook",description:"Wide format for Facebook",maxSize:2048,quality:90}},Kc=({selected:s,dir:t,onClose:a,uiActions:r})=>{const[n,i]=o.useState("link"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[g,y]=o.useState(!1),[j,k]=o.useState({expiryHours:24,viewOnly:!1}),[v,f]=o.useState("web"),[p,w]=o.useState(""),[T,h]=o.useState(""),[m,C]=o.useState(""),I=o.useRef(null),E=s.size,S=E>1,N=async()=>{if(!(!t||E===0)){c(!0);try{const F=Array.from(s),V=await xa(t,"local",F,j),Y=`${window.location.origin}/share/${V.token}/view`;d(Y),await navigator.clipboard.writeText(Y),y(!0),r.setNote("Share link created and copied to clipboard!")}catch(F){r.setNote(F instanceof Error?F.message:"Share failed")}finally{c(!1)}}},D=async()=>{if(!(!t||E===0||!p)){c(!0);try{const F=Array.from(s),V=xr[v],Y=await $t(t,F,p,"copy",!1,!1,{preset:v==="instagram"||v==="twitter"||v==="facebook"?"web":v,resizeLong:V.maxSize,quality:V.quality});r.setNote(`Exported ${Y.copied} photos to ${p}`),a()}catch(F){r.setNote(F instanceof Error?F.message:"Export failed")}finally{c(!1)}}},_=async()=>{l||await N()},Q=async()=>{const F=T.split(/[\n,;]+/).map(J=>J.trim()).filter(Boolean);if(F.length===0){r.setNote("Add at least one recipient");return}await _();const V=S?`Photos (${E})`:"Photo",Y=`${m?m+`

`:""}${l}`,O=`mailto:${encodeURIComponent(F.join(","))}?subject=${encodeURIComponent(V)}&body=${encodeURIComponent(Y)}`;try{window.location.href=O,a()}catch(J){r.setNote(J instanceof Error?J.message:"Could not open email client")}},M=F=>{if(!l)return;const V=`Check out ${S?`these ${E} photos`:"this photo"}!`,Y={facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(l)}`,twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(V)}&url=${encodeURIComponent(l)}`,instagram:`instagram://library?AssetPath=${encodeURIComponent(l)}`};window.open(Y[F],"_blank","width=600,height=400")},H=o.useCallback(()=>{!l||!I.current||(I.current.innerHTML=`<div style="font-family: monospace; font-size: 12px; line-height: 1; white-space: pre;">${$()}</div>`)},[l]),$=F=>`
    
         
       
     
     
          
     
     
       
           
     
    `.trim();return ft.useEffect(()=>{l&&H()},[l,H]),e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center",children:e.jsx(gs,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Share ",S?`${E} Photos`:"Photo"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose how you'd like to share your photos"})]})]}),e.jsx("button",{type:"button",onClick:a,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{id:"link",icon:e.jsx(Qa,{className:"w-5 h-5"}),label:"Share Link",desc:"Create shareable link"},{id:"email",icon:e.jsx(Ja,{className:"w-5 h-5"}),label:"Email",desc:"Send via email"},{id:"social",icon:e.jsx(Xe,{className:"w-5 h-5"}),label:"Social Media",desc:"Share on social platforms"},{id:"export",icon:e.jsx(He,{className:"w-5 h-5"}),label:"Export",desc:"Download to folder"}].map(F=>e.jsx("button",{type:"button",onClick:()=>i(F.id),className:`p-4 rounded-xl border-2 transition-all ${n===F.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n===F.id?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:F.icon}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:F.label}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:F.desc})]})]})},F.id))})}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[n==="link"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Link Expires In"}),e.jsxs("select",{id:"expiry-select",value:j.expiryHours,onChange:F=>k(V=>({...V,expiryHours:parseInt(F.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[e.jsx("option",{value:1,children:"1 hour"}),e.jsx("option",{value:24,children:"24 hours"}),e.jsx("option",{value:168,children:"1 week"}),e.jsx("option",{value:720,children:"1 month"}),e.jsx("option",{value:8760,children:"1 year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password (Optional)"}),e.jsx("input",{id:"password-input",type:"password",value:j.password||"",onChange:F=>k(V=>({...V,password:F.target.value||void 0})),placeholder:"Leave empty for no password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"viewOnly",checked:j.viewOnly,onChange:F=>k(V=>({...V,viewOnly:F.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"viewOnly",className:"text-sm text-gray-700 dark:text-gray-300",children:"View-only (prevent downloads)"})]}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 dark:text-green-200",children:[e.jsx(Ct,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Share link created!"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"}),e.jsxs("button",{type:"button",onClick:async()=>{await navigator.clipboard.writeText(l),y(!0),setTimeout(()=>y(!1),2e3)},className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded flex items-center gap-1",children:[g?e.jsx(Ct,{className:"w-4 h-4"}):e.jsx(Hi,{className:"w-4 h-4"}),g?"Copied!":"Copy"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Xa,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"QR Code"})]}),e.jsx("div",{ref:I,className:"flex justify-center",children:e.jsx("div",{className:"w-32 h-32 bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(Xa,{className:"w-16 h-16 text-gray-400"})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-2",children:"Scan to open on mobile"})]})]}):e.jsx("button",{type:"button",onClick:N,disabled:u,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Share Link..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Qa,{className:"w-5 h-5"}),"Create Share Link"]})})]}),n==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Addresses"}),e.jsx("textarea",{id:"email-input",value:T,onChange:F=>h(F.target.value),placeholder:"Enter email addresses separated by commas",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message (Optional)"}),e.jsx("textarea",{id:"email-message",placeholder:"Add a personal message...",value:m,onChange:F=>C(F.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 h-20"})]}),e.jsxs("button",{type:"button",onClick:Q,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center justify-center gap-2",children:[e.jsx(Ja,{className:"w-5 h-5"}),"Send Email"]})]}),n==="social"&&e.jsx("div",{className:"space-y-4",children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Share your photos on social media:"}),Object.entries(Gc).map(([F,V])=>e.jsxs("button",{type:"button",onClick:()=>M(F),className:"w-full p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:V.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium",children:V.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[V.aspectRatio,"  Max ",V.maxSize,"px"]})]}),e.jsx(Vi,{className:"w-5 h-5 text-gray-400"})]},F))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"First create a share link, then share on social media"}),e.jsx("button",{type:"button",onClick:()=>i("link"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Create Share Link First"})]})}),n==="export"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"export-destination",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Destination"}),e.jsx("input",{id:"export-destination",type:"text",value:p,onChange:F=>w(F.target.value),placeholder:"/absolute/path/to/export/folder",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Preset"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(xr).map(([F,V])=>e.jsxs("button",{type:"button",onClick:()=>f(F),className:`p-3 border rounded-lg text-left ${v===F?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:V.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:V.description}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["Max ",V.maxSize,"px  ",V.quality,"% quality"]})]},F))})]}),e.jsx("button",{type:"button",onClick:D,disabled:u||!p,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-5 h-5"}),"Export ",E," Photo",S?"s":""]})})]})]})]})})},Yc={blue:{primary:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#3b82f6"},green:{primary:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#22c55e"},purple:{primary:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#a855f7"},orange:{primary:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#f97316"},gray:{primary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#6b7280"}};function Qc({children:s}){const t=_e(l=>l.themeMode),a=_e(l=>l.colorScheme),r=_e(l=>l.density),n=_e(l=>l.customColors),i=Fa(),u=o.useMemo(()=>t==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t,[t]),c=o.useMemo(()=>{const l=n?{primary:n.primary,secondary:n.secondary,accent:n.accent}:Yc[a],d={};return n?(d["--color-primary"]=n.primary,d["--color-primary-hover"]=n.primary,d["--color-primary-active"]=n.primary):Object.entries(l.primary).forEach(([g,y])=>{d[`--color-primary-${g}`]=y}),n?d["--color-secondary"]=n.secondary:Object.entries(l.secondary).forEach(([g,y])=>{d[`--color-secondary-${g}`]=y}),d["--color-accent"]=n?n.accent:l.accent,u==="dark"?(d["--color-background"]="#0f172a",d["--color-surface"]="#1e293b",d["--color-surface-hover"]="#334155",d["--color-border"]="#334155",d["--color-border-hover"]="#475569",d["--color-text-primary"]="#f8fafc",d["--color-text-secondary"]="#cbd5e1",d["--color-text-tertiary"]="#94a3b8"):(d["--color-background"]="#ffffff",d["--color-surface"]="#f8fafc",d["--color-surface-hover"]="#f1f5f9",d["--color-border"]="#e2e8f0",d["--color-border-hover"]="#cbd5e1",d["--color-text-primary"]="#0f172a",d["--color-text-secondary"]="#475569",d["--color-text-tertiary"]="#64748b"),i&&(d["--color-background"]="#000000",d["--color-surface"]="#000000",d["--color-surface-hover"]="#000000",d["--color-border"]="#ffffff",d["--color-border-hover"]="#ffffff",d["--color-text-primary"]="#ffffff",d["--color-text-secondary"]="#ffffff",d["--color-text-tertiary"]="#ffffff",d["--color-primary"]="#ffffff",d["--color-accent"]="#00ff00"),d},[u,a,n,i]);return o.useEffect(()=>{const l=document.documentElement;Object.entries(c).forEach(([d,g])=>{l.style.setProperty(d,g)}),l.classList.remove("light","dark"),l.classList.add(u),l.classList.remove("density-compact","density-normal","density-spacious"),l.classList.add(`density-${r}`),i?l.classList.add("high-contrast"):l.classList.remove("high-contrast")},[c,u,r,i]),o.useEffect(()=>{if(t!=="auto")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>{document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(l.matches?"dark":"light")};return l.addEventListener("change",d),()=>l.removeEventListener("change",d)},[t]),e.jsx(e.Fragment,{children:s})}const Jc=[{id:"blue",name:"Blue",color:"#3b82f6"},{id:"green",name:"Green",color:"#22c55e"},{id:"purple",name:"Purple",color:"#a855f7"},{id:"orange",name:"Orange",color:"#f97316"},{id:"gray",name:"Gray",color:"#6b7280"}],Xc=[{id:"compact",name:"Compact",description:"Tighter spacing, smaller elements"},{id:"normal",name:"Normal",description:"Balanced spacing and sizing"},{id:"spacious",name:"Spacious",description:"More breathing room, larger elements"}];function Zc({isOpen:s,onClose:t}){const[a,r]=o.useState("appearance"),n=_e(h=>h.themeMode),i=_e(h=>h.colorScheme),u=_e(h=>h.density),c=_e(h=>h.customColors),l=_e(h=>h.setThemeMode),d=_e(h=>h.setColorScheme),g=_e(h=>h.setDensity),y=_e(h=>h.setCustomColors),j=_e(h=>h.resetTheme),k=Fa(),v=Cs(h=>h.setHighContrast),[f,p]=o.useState(c||{primary:"#3b82f6",secondary:"#64748b",accent:"#3b82f6"});if(!s)return null;const w=(h,m)=>{const C={...f,[h]:m};p(C),y(C)},T=h=>{d(h),h!=="custom"&&y(void 0)};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-xl flex items-center justify-center",children:e.jsx(Bt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Theme Settings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Customize your app appearance"})]})]}),e.jsx("button",{type:"button",onClick:t,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center","aria-label":"Close theme settings",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[{id:"appearance",name:"Appearance",icon:lt},{id:"colors",name:"Colors",icon:Bt},{id:"accessibility",name:"Accessibility",icon:ns}].map(h=>e.jsxs("button",{type:"button",onClick:()=>r(h.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${a===h.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(h.icon,{className:"w-4 h-4"}),h.name]},h.id))}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[a==="appearance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Theme Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{id:"light",name:"Light",icon:fs},{id:"dark",name:"Dark",icon:ia},{id:"auto",name:"Auto",icon:Tr}].map(h=>e.jsxs("button",{type:"button",onClick:()=>l(h.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${n===h.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx(h.icon,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:h.name})]},h.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Density"}),e.jsx("div",{className:"space-y-3",children:Xc.map(h=>e.jsx("button",{type:"button",onClick:()=>g(h.id),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${u===h.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:h.name}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:h.description})]}),u===h.id&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full"})]})},h.id))})]})]}),a==="colors"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Color Scheme"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[Jc.map(h=>e.jsxs("button",{type:"button",onClick:()=>T(h.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i===h.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-gray-300 dark:border-gray-600",style:{backgroundColor:h.color}}),e.jsx("span",{className:"text-sm font-medium",children:h.name})]},h.id)),e.jsxs("button",{type:"button",onClick:()=>T("custom"),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i==="custom"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-dashed border-gray-400 dark:border-gray-500 flex items-center justify-center",children:e.jsx(Bt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})}),e.jsx("span",{className:"text-sm font-medium",children:"Custom"})]})]})]}),i==="custom"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Custom Colors"}),e.jsx("div",{className:"space-y-4",children:[{key:"primary",label:"Primary"},{key:"secondary",label:"Secondary"},{key:"accent",label:"Accent"}].map(({key:h,label:m})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:`${h}-color`,className:"text-sm font-medium text-gray-700 dark:text-gray-300 min-w-16",children:m}),e.jsx("input",{id:`${h}-color`,type:"color",value:f[h],onChange:C=>w(h,C.target.value),className:"w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),e.jsx("input",{type:"text",value:f[h],onChange:C=>w(h,C.target.value),className:"flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"#000000"})]},h))})]})]}),a==="accessibility"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"High Contrast Mode"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ns,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"High Contrast"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Increases contrast for better accessibility"})]})]}),e.jsx("button",{type:"button",onClick:()=>v?.(!k),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${k?"bg-blue-600":"bg-gray-200 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${k?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Reset Theme"}),e.jsxs("button",{type:"button",onClick:()=>{j(),v?.(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx(Ki,{className:"w-4 h-4"}),"Reset to Defaults"]})]})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors",children:"Close"})})]})})}function $n(s){var t,a,r="";if(typeof s=="string"||typeof s=="number")r+=s;else if(typeof s=="object")if(Array.isArray(s)){var n=s.length;for(t=0;t<n;t++)s[t]&&(a=$n(s[t]))&&(r&&(r+=" "),r+=a)}else for(a in s)s[a]&&(r&&(r+=" "),r+=a);return r}function Te(){for(var s,t,a=0,r="",n=arguments.length;a<n;a++)(s=arguments[a])&&(t=$n(s))&&(r&&(r+=" "),r+=t);return r}const ps={highContrast:!1,largeText:!1,reducedMotion:!1,screenReader:!1,keyboardNavigation:!0,focusIndicators:!0,colorBlindFriendly:!1,fontSize:"medium",theme:"auto"};function ed({isOpen:s,onClose:t,onSettingsChange:a}){const[r,n]=o.useState(ps),[i,u]=o.useState("general");o.useEffect(()=>{const v=localStorage.getItem("accessibility-settings");if(v)try{const f=JSON.parse(v);n({...ps,...f})}catch(f){console.warn("Failed to parse accessibility settings:",f)}},[]);const c=(v,f)=>{const p={...r,[v]:f};n(p),localStorage.setItem("accessibility-settings",JSON.stringify(p)),a?.(p),l(p)},l=v=>{const f=document.documentElement;v.highContrast?f.setAttribute("data-high-contrast","true"):f.removeAttribute("data-high-contrast"),f.setAttribute("data-font-size",v.fontSize),v.reducedMotion?f.setAttribute("data-reduced-motion","true"):f.removeAttribute("data-reduced-motion"),v.focusIndicators?f.setAttribute("data-focus-visible","true"):f.removeAttribute("data-focus-visible"),v.colorBlindFriendly?f.setAttribute("data-color-blind","true"):f.removeAttribute("data-color-blind"),f.setAttribute("data-theme",v.theme)};o.useEffect(()=>{const v=f=>{if(s){if(f.key==="Escape"){t();return}f.key==="Tab"&&f.preventDefault()}};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[s,t]);const d=[{id:"general",label:"General",icon:Tr},{id:"vision",label:"Vision",icon:Za},{id:"motor",label:"Motor",icon:Ks},{id:"cognitive",label:"Cognitive",icon:Ws}],g=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"General Settings"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Theme"}),e.jsxs("select",{value:r.theme,onChange:v=>c("theme",v.target.value),className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"dark",children:"Dark"})]})]})}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Font Size"}),e.jsxs("select",{value:r.fontSize,onChange:v=>c("fontSize",v.target.value),className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"}),e.jsx("option",{value:"xlarge",children:"Extra Large"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(br,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Reduced Motion"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Minimize animations and transitions"})]})]}),e.jsx("button",{onClick:()=>c("reducedMotion",!r.reducedMotion),className:Te("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",r.reducedMotion?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"),"aria-pressed":r.reducedMotion,children:e.jsx("span",{className:Te("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",r.reducedMotion?"translate-x-6":"translate-x-1")})})]})]})}),y=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Vision & Display"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ns,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"High Contrast"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Increase contrast for better visibility"})]})]}),e.jsx("button",{onClick:()=>c("highContrast",!r.highContrast),className:Te("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",r.highContrast?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"),"aria-pressed":r.highContrast,children:e.jsx("span",{className:Te("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",r.highContrast?"translate-x-6":"translate-x-1")})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Er,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Large Text"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Increase text size throughout the app"})]})]}),e.jsx("button",{onClick:()=>c("largeText",!r.largeText),className:Te("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",r.largeText?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"),"aria-pressed":r.largeText,children:e.jsx("span",{className:Te("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",r.largeText?"translate-x-6":"translate-x-1")})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Za,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Color Blind Friendly"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Use patterns and shapes instead of colors"})]})]}),e.jsx("button",{onClick:()=>c("colorBlindFriendly",!r.colorBlindFriendly),className:Te("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",r.colorBlindFriendly?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"),"aria-pressed":r.colorBlindFriendly,children:e.jsx("span",{className:Te("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",r.colorBlindFriendly?"translate-x-6":"translate-x-1")})})]})]})}),j=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Motor & Dexterity"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ks,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Keyboard Navigation"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Navigate using keyboard shortcuts"})]})]}),e.jsx("button",{onClick:()=>c("keyboardNavigation",!r.keyboardNavigation),className:Te("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",r.keyboardNavigation?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"),"aria-pressed":r.keyboardNavigation,children:e.jsx("span",{className:Te("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",r.keyboardNavigation?"translate-x-6":"translate-x-1")})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-gray-500 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Focus Indicators"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Show visible focus outlines"})]})]}),e.jsx("button",{onClick:()=>c("focusIndicators",!r.focusIndicators),className:Te("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",r.focusIndicators?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"),"aria-pressed":r.focusIndicators,children:e.jsx("span",{className:Te("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",r.focusIndicators?"translate-x-6":"translate-x-1")})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Keyboard Shortcuts"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Open search"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded",children:"Ctrl+K"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Focus sidebar"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded",children:"Ctrl+B"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Select all"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded",children:"Ctrl+A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delete selected"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded",children:"Delete"})]})]})]})]}),k=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Cognitive Support"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ws,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Screen Reader Support"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Optimize for screen readers"})]})]}),e.jsx("button",{onClick:()=>c("screenReader",!r.screenReader),className:Te("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",r.screenReader?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"),"aria-pressed":r.screenReader,children:e.jsx("span",{className:Te("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",r.screenReader?"translate-x-6":"translate-x-1")})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Accessibility Tips"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(ys,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Use high contrast mode if text is hard to read"})]}),e.jsxs("div",{className:"flex gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx(Et,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-green-800 dark:text-green-200",children:"Enable keyboard navigation for faster browsing"})]}),e.jsxs("div",{className:"flex gap-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[e.jsx(ra,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Reduced motion helps with vestibular disorders"})]})]})]})]});return e.jsx(oa,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(we.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:t,"aria-hidden":"true"}),e.jsxs(we.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl max-h-[90vh] bg-white dark:bg-gray-800 rounded-2xl shadow-2xl z-50 overflow-hidden",role:"dialog","aria-modal":"true","aria-labelledby":"accessibility-title",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{id:"accessibility-title",className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Accessibility Settings"}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Close accessibility panel",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:d.map(v=>{const f=v.icon;return e.jsxs("button",{onClick:()=>u(v.id),className:Te("flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2",i===v.id?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),"aria-pressed":i===v.id,children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:v.label})]},v.id)})}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[i==="general"&&g(),i==="vision"&&y(),i==="motor"&&j(),i==="cognitive"&&k()]}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Settings are saved automatically"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Done"})]})]})]})})}function td(){const[s,t]=o.useState(ps);return o.useEffect(()=>{const r=localStorage.getItem("accessibility-settings");if(r)try{const n=JSON.parse(r);t({...ps,...n})}catch(n){console.warn("Failed to parse accessibility settings:",n)}},[]),{settings:s,updateSettings:r=>{const n={...s,...r};t(n),localStorage.setItem("accessibility-settings",JSON.stringify(n));const i=document.documentElement;Object.entries(n).forEach(([u,c])=>{typeof c=="boolean"?c?i.setAttribute(`data-${u}`,"true"):i.removeAttribute(`data-${u}`):i.setAttribute(`data-${u}`,String(c))})}}}const Je=[{id:"welcome",title:"Welcome to Photo Search!",description:"Let's take a quick tour to help you get started with your photo library.",content:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(Vt,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-900 dark:text-blue-100",children:"AI-Powered Search"}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Find photos using natural language"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx(Ns,{className:"w-6 h-6 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-900 dark:text-green-100",children:"Smart Organization"}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Auto-categorize and tag your photos"})]})]})]}),position:"center",showNext:!0,canSkip:!0},{id:"search-bar",title:"Smart Search Bar",description:"Use natural language to find your photos instantly.",content:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Try searching for things like:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:'"beach sunset with palm trees"'})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:'"family photos from last summer"'})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:'"red car in city"'})]})]})]}),target:'[data-tour="search-bar"]',position:"bottom",showNext:!0,showPrev:!0,canSkip:!0},{id:"sidebar",title:"Navigation Sidebar",description:"Access different sections of your photo library.",content:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(Ge,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Browse"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(lt,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Organize"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Use the sidebar to navigate between different views and manage your photos."})]}),target:'[data-tour="sidebar"]',position:"right",showNext:!0,showPrev:!0,canSkip:!0},{id:"upload",title:"Add Your Photos",description:"Import photos from your computer or cloud storage.",content:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx(mt,{className:"w-6 h-6 text-purple-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-purple-900 dark:text-purple-100",children:"Import Photos"}),e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300",children:"Drag & drop or browse your files"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Supported formats: JPG, PNG, GIF, WebP, HEIC, and more."})]}),target:'[data-tour="upload-button"]',position:"top",showNext:!0,showPrev:!0,canSkip:!0},{id:"shortcuts",title:"Keyboard Shortcuts",description:"Speed up your workflow with keyboard shortcuts.",content:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{children:"Open search"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs",children:"Ctrl+K"})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{children:"Select all"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs",children:"Ctrl+A"})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{children:"Delete selected"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs",children:"Del"})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{children:"Focus sidebar"}),e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs",children:"Ctrl+B"})]})]})}),position:"center",showNext:!0,showPrev:!0,canSkip:!0},{id:"complete",title:"You're All Set!",description:"Start exploring your photo library with AI-powered search.",content:e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Et,{className:"w-16 h-16 text-green-500 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You can always access this tour again from the help menu, or get contextual hints as you use the app."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500 dark:text-gray-500",children:[e.jsx(ws,{className:"w-4 h-4"}),e.jsx("span",{children:'Pro tip: Try searching for "sunset" to see AI in action!'})]})]}),position:"center",showNext:!1,showPrev:!0,canSkip:!1}];function sd({isActive:s,onComplete:t,onSkip:a,currentStep:r=0,userActions:n=[]}){const[i,u]=o.useState(r),[c,l]=o.useState(!1),[d,g]=o.useState(new Set),y=o.useRef(),j=Je[i];o.useEffect(()=>{if(!(!s||c||!j?.autoAdvance))return y.current=setTimeout(()=>{i<Je.length-1&&u(i+1)},j.autoAdvance*1e3),()=>{y.current&&clearTimeout(y.current)}},[i,s,c,j]),o.useEffect(()=>{if(!j?.target)return;const T=document.querySelector(j.target);if(T)return T.scrollIntoView({behavior:"smooth",block:"center"}),T.setAttribute("data-tour-highlight","true"),()=>{T.removeAttribute("data-tour-highlight")}},[j]);const k=()=>{i<Je.length-1?(g(T=>new Set([...T,i])),u(i+1)):f()},v=()=>{i>0&&u(i-1)},f=()=>{g(T=>new Set([...T,i])),t()},p=()=>{a()},w=()=>{l(!c)};return s?e.jsx(oa,{children:e.jsxs(we.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),j?.target&&e.jsx("div",{className:"absolute inset-0",children:e.jsx("div",{className:"absolute inset-0 bg-black/20",style:{clipPath:`polygon(0 0, 100% 0, 100% 100%, 0 100%, 0 0, ${ad(j.target)})`}})}),e.jsx(we.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:Te("absolute pointer-events-auto max-w-md",Mn(j?.position,j?.target)),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(ws,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:j?.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:j?.description})]})]}),e.jsx("button",{onClick:p,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Skip tour",children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-4",children:j?.content}),e.jsxs("div",{className:"px-4 pb-2",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${(i+1)/Je.length*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsxs("span",{children:[i+1," of ",Je.length]}),e.jsxs("span",{children:[Math.round((i+1)/Je.length*100),"% complete"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[j?.showPrev&&i>0&&e.jsxs("button",{onClick:v,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(ls,{className:"w-4 h-4"}),"Previous"]}),j?.autoAdvance&&e.jsx("button",{onClick:w,className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":c?"Resume auto-advance":"Pause auto-advance",children:c?e.jsx(pt,{className:"w-4 h-4"}):e.jsx(bs,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j?.canSkip&&i<Je.length-1&&e.jsx("button",{onClick:p,className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"Skip Tour"}),j?.showNext&&e.jsxs("button",{onClick:k,className:"flex items-center gap-1 px-4 py-1.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium",children:[i===Je.length-1?"Get Started":"Next",i<Je.length-1&&e.jsx(Tt,{className:"w-4 h-4"})]})]})]})]})},i)]})}):null}function ad(s){const t=document.querySelector(s);if(!t)return"";const a=t.getBoundingClientRect(),r=8;return`
    ${a.left-r}px ${a.top-r}px,
    ${a.right+r}px ${a.top-r}px,
    ${a.right+r}px ${a.bottom+r}px,
    ${a.left-r}px ${a.bottom+r}px
  `}function Mn(s,t){if(!t||s==="center")return"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2";const a=document.querySelector(t);if(!a)return"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2";const r=a.getBoundingClientRect(),n=r.left+r.width/2,i=r.top+r.height/2;switch(s){case"top":return`left-[${n}px] top-[${r.top-20}px] -translate-x-1/2`;case"bottom":return`left-[${n}px] top-[${r.bottom+20}px] -translate-x-1/2`;case"left":return`left-[${r.left-20}px] top-[${i}px] -translate-y-1/2`;case"right":return`left-[${r.right+20}px] top-[${i}px] -translate-y-1/2`;default:return"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"}}function rd({message:s,action:t,position:a,target:r,onDismiss:n,autoHide:i}){const[u,c]=o.useState(!0);return o.useEffect(()=>{if(i){const l=setTimeout(()=>{c(!1),n?.()},i*1e3);return()=>clearTimeout(l)}},[i,n]),u?e.jsx(we.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:Te("absolute z-40 pointer-events-auto",Mn(a,r)),children:e.jsx("div",{className:"bg-blue-500 text-white px-4 py-3 rounded-lg shadow-lg max-w-xs",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ws,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s}),t&&e.jsx("p",{className:"text-xs opacity-90 mt-1",children:t})]}),n&&e.jsx("button",{onClick:()=>{c(!1),n()},className:"flex-shrink-0 p-1 hover:bg-blue-600 rounded transition-colors","aria-label":"Dismiss hint",children:e.jsx($e,{className:"w-3 h-3"})})]})})}):null}function nd(){const[s,t]=o.useState(!1),[a,r]=o.useState(new Set),[n,i]=o.useState(0);return o.useEffect(()=>{const d=localStorage.getItem("onboarding-completed"),g=localStorage.getItem("dismissed-hints");if(d==="true"&&t(!0),g)try{r(new Set(JSON.parse(g)))}catch(y){console.warn("Failed to parse dismissed hints:",y)}},[]),{hasCompletedTour:s,currentTourStep:n,setCurrentTourStep:i,completeTour:()=>{t(!0),localStorage.setItem("onboarding-completed","true")},dismissHint:d=>{const g=new Set([...a,d]);r(g),localStorage.setItem("dismissed-hints",JSON.stringify([...g]))},shouldShowHint:d=>!a.has(d)}}const Fn=o.createContext(null);function id({children:s}){const[t,a]=o.useState([]),{settings:r}=td(),n=d=>{r.reducedMotion&&d.priority!=="high"||d.condition&&!d.condition()||(a(g=>g.filter(y=>y.id!==d.id)),a(g=>[...g,d]),d.autoHide&&setTimeout(()=>{i(d.id)},d.autoHide*1e3))},i=d=>{a(g=>g.filter(y=>y.id!==d))},u=()=>{a([])},l=t.sort((d,g)=>{const y={high:3,medium:2,low:1};return y[g.priority]-y[d.priority]})[0];return e.jsxs(Fn.Provider,{value:{showHint:n,dismissHint:i,clearAllHints:u,activeHints:t},children:[s,l&&e.jsx(rd,{message:l.message,action:l.action,position:l.position,target:l.target,onDismiss:()=>i(l.id),autoHide:l.autoHide})]})}function od(){const s=o.useContext(Fn);if(!s)throw new Error("useHints must be used within a HintProvider");return s}const it={FIRST_SEARCH:{id:"first-search",message:'Try searching for "beach" or "mountains" to see AI-powered search in action!',action:"Click here or press Ctrl+K to search",position:"bottom",target:'[data-tour="search-bar"]',priority:"high",autoHide:10},EMPTY_LIBRARY:{id:"empty-library",message:"Your photo library is empty. Let's add some photos to get started!",action:"Click the upload button above",position:"center",priority:"high",condition:()=>{const s=localStorage.getItem("photo-library-state");if(!s)return!0;try{const t=JSON.parse(s);return!t.photos||t.photos.length===0}catch{return!0}}},ADVANCED_SEARCH:{id:"advanced-search",message:'Try advanced search queries like "sunset with people" or "red car in city"',position:"bottom",target:'[data-tour="search-bar"]',priority:"low",trigger:"search-success",autoHide:8},BULK_SELECT:{id:"bulk-select",message:"Select multiple photos by holding Ctrl and clicking",action:"Or press Ctrl+A to select all",position:"top",priority:"low",trigger:"photo-selected",autoHide:6},ORGANIZE_FOLDERS:{id:"organize-folders",message:"Create folders to organize your photos by events, dates, or themes",position:"right",target:'[data-tour="sidebar"]',priority:"medium",trigger:"photos-uploaded",autoHide:12},KEYBOARD_SHORTCUTS:{id:"keyboard-shortcuts",message:"Use keyboard shortcuts for faster navigation",action:"Press Ctrl+K for search, Ctrl+B for sidebar",position:"center",priority:"low",trigger:"multiple-actions",autoHide:10},EXPORT_PHOTOS:{id:"export-photos",message:"Export selected photos in different formats and sizes",position:"left",priority:"low",trigger:"photos-selected",autoHide:8},SHARE_PHOTOS:{id:"share-photos",message:"Share photos directly from the app with customizable links",position:"left",priority:"low",trigger:"photos-selected",autoHide:8}};function Dn(){const{showHint:s}=od();return{triggerHint:(a,r)=>{switch(a){case"app-loaded":setTimeout(()=>{s(it.FIRST_SEARCH)},2e3);break;case"library-empty":s(it.EMPTY_LIBRARY);break;case"photos-uploaded":s(it.ORGANIZE_FOLDERS);break;case"search-success":setTimeout(()=>{s(it.ADVANCED_SEARCH)},3e3);break;case"photo-selected":s(it.BULK_SELECT);break;case"multiple-photos-selected":s(it.EXPORT_PHOTOS),setTimeout(()=>{s(it.SHARE_PHOTOS)},2e3);break;case"keyboard-shortcut-used":s(it.KEYBOARD_SHORTCUTS);break}}}}function ld({children:s}){const{triggerHint:t}=Dn();return o.useEffect(()=>{t("app-loaded");const a=()=>t("photos-uploaded"),r=()=>t("search-success"),n=()=>t("photo-selected"),i=()=>t("multiple-photos-selected"),u=()=>t("keyboard-shortcut-used");return document.addEventListener("photo-uploaded",a),document.addEventListener("search-success",r),document.addEventListener("photo-selected",n),document.addEventListener("multiple-photos-selected",i),document.addEventListener("keyboard-shortcut-used",u),()=>{document.removeEventListener("photo-uploaded",a),document.removeEventListener("search-success",r),document.removeEventListener("photo-selected",n),document.removeEventListener("multiple-photos-selected",i),document.removeEventListener("keyboard-shortcut-used",u)}},[t]),e.jsx(e.Fragment,{children:s})}function cd({onRefresh:s,children:t,threshold:a=80}){const[r,n]=o.useState(!1),[i,u]=o.useState(0),c=o.useRef(null),l=y=>{c.current?.scrollTop===0&&(c.current.dataset.pullStart=y.touches[0].clientY.toString())},d=y=>{if(!c.current?.dataset.pullStart||r)return;const j=parseFloat(c.current.dataset.pullStart),k=y.touches[0].clientY,v=Math.max(0,k-j);v>0&&(u(v),y.preventDefault())},g=()=>{i>=a&&!r?(n(!0),s(),setTimeout(()=>{n(!1),u(0)},1e3)):u(0),c.current&&delete c.current.dataset.pullStart};return e.jsxs("div",{ref:c,className:"relative overflow-y-auto h-full",onTouchStart:l,onTouchMove:d,onTouchEnd:g,children:[e.jsxs(we.div,{className:"absolute top-0 left-0 right-0 flex justify-center items-center py-4 bg-white dark:bg-gray-800 z-10",style:{transform:`translateY(${Math.min(i-60,0)}px)`,opacity:i>20?1:0},children:[e.jsx(we.div,{animate:{rotate:i>=a?180:0},className:"w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full"}),e.jsx("span",{className:"ml-3 text-sm text-gray-600 dark:text-gray-400",children:i>=a?"Release to refresh":"Pull to refresh"})]}),e.jsx(we.div,{style:{transform:`translateY(${Math.max(0,i-60)}px)`},children:t})]})}function dd({children:s,onSwipeLeft:t,onSwipeRight:a,onSwipeUp:r,onSwipeDown:n,enableSwipeGestures:i=!0,enablePullToRefresh:u=!1,onPullToRefresh:c}){const l=o.useRef(null),[d,g]=o.useState(null),y=v=>{i&&g({x:v.touches[0].clientX,y:v.touches[0].clientY})},j=v=>{if(!i||!d)return;const f={x:v.changedTouches[0].clientX,y:v.changedTouches[0].clientY},p=f.x-d.x,w=f.y-d.y,T=50;Math.abs(p)>Math.abs(w)?Math.abs(p)>T&&(p>0?a?.():t?.()):Math.abs(w)>T&&(w>0?n?.():r?.()),g(null)},k=u&&c?e.jsx(cd,{onRefresh:c,children:s}):s;return e.jsx("div",{ref:l,className:"min-h-screen",onTouchStart:y,onTouchEnd:j,children:k})}function ud(){const[s,t]=o.useState(!1),[a,r]=o.useState(!1),[n,i]=o.useState("desktop");return o.useEffect(()=>{const u=()=>{const c=window.innerWidth,l=c<768,d=c>=768&&c<1024;t(l),r(d),i(l?"mobile":d?"tablet":"desktop")};return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),{isMobile:s,isTablet:a,screenSize:n}}function hd(){return{trigger:(t="light")=>{if("vibrate"in navigator){const a={light:[10],medium:[20],heavy:[30]};navigator.vibrate(a[t])}}}}const md=({selectedView:s,onViewChange:t,stats:a={totalPhotos:0,collections:0,people:0,favorites:0},aiStatus:r={indexReady:!0,fastIndexType:"FAISS",freeSpace:45.2},darkMode:n=!1,onDarkModeToggle:i,onSettingsClick:u,onSelectLibrary:c})=>{const[l,d]=o.useState(!1),[g,y]=o.useState(!1);o.useEffect(()=>{const h=()=>{y(window.innerWidth<1024),window.innerWidth<768&&d(!0)};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const j=[{id:"library",label:"All Photos",icon:gt,count:a.totalPhotos},{id:"search",label:"Search Results",icon:Ie},{id:"map",label:"Map View",icon:la},{id:"people",label:"People",icon:Xe,count:a.people}],k=[{id:"collections",label:"Collections",icon:Ge,count:a.collections},{id:"smart",label:"Smart Albums",icon:kr},{id:"trips",label:"Trips",icon:ta}],v=[{id:"saved",label:"Saved Searches",icon:Yi},{id:"memories",label:"Memories",icon:Gt,count:a.favorites},{id:"tasks",label:"Tasks",icon:Qi}],f=h=>h?h>999?`${Math.floor(h/1e3)}k`:h.toString():null,p={expanded:{width:g?256:320},collapsed:{width:64}},w={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0}},T=h=>{const m=s===h.id,C=h.icon,I=f(h.count);return e.jsxs(we.button,{variants:w,whileHover:{scale:1.02,x:4},whileTap:{scale:.98},onClick:()=>t(h.id),className:Te("w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group relative overflow-hidden",{"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg shadow-blue-500/25":m,"text-gray-600 dark:text-gray-400 hover:bg-gray-100/80 dark:hover:bg-gray-800/50":!m}),children:[!m&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx(C,{className:Te("w-5 h-5 flex-shrink-0",{"text-white":m,"text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300":!m})}),!l&&e.jsx(oa,{mode:"wait",children:e.jsxs(we.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center justify-between flex-1",children:[e.jsx("span",{className:"font-medium",children:h.label}),I&&e.jsx("span",{className:Te("text-xs px-2 py-1 rounded-full font-medium",{"bg-white/20 text-white":m,"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":!m}),children:I})]})})]},h.id)};return e.jsxs(e.Fragment,{children:[e.jsxs(we.div,{initial:!1,animate:l?"collapsed":"expanded",variants:p,transition:{duration:.3,ease:[.4,0,.2,1]},className:"relative bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border-r border-gray-200/50 dark:border-gray-700/50 flex flex-col shadow-xl",children:[e.jsx("div",{className:"p-6 border-b border-gray-200/50 dark:border-gray-700/50 bg-gradient-to-r from-blue-500/5 to-purple-500/5 dark:from-blue-600/10 dark:to-purple-600/10",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(we.div,{whileHover:{rotate:360},transition:{duration:.5},className:"w-12 h-12 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Pr,{className:"w-7 h-7 text-white"})}),!l&&e.jsxs(we.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"PhotoVault"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:"AI-Powered Management"})]})]})}),e.jsxs("nav",{className:"flex-1 p-4 space-y-6 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[!l&&e.jsx("h3",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2",children:"Browse"}),e.jsx(we.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.05}}},children:j.map(T)})]}),(!l||g)&&e.jsxs("div",{className:"space-y-2",children:[!l&&e.jsx("h3",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2",children:"Organization"}),e.jsx(we.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.05}}},children:k.map(T)})]}),(!l||g)&&e.jsxs("div",{className:"space-y-2",children:[!l&&e.jsx("h3",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 px-2",children:"Smart Features"}),e.jsx(we.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.05}}},children:v.map(T)})]})]}),!l&&e.jsx(we.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-6 border-t border-gray-200/50 dark:border-gray-700/50",children:e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 via-blue-50 to-purple-50 dark:from-emerald-900/20 dark:via-blue-900/20 dark:to-purple-900/20 rounded-2xl p-4 border border-emerald-200/50 dark:border-emerald-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-0 w-3 h-3 bg-emerald-500 rounded-full animate-ping opacity-75"})]}),e.jsx("span",{className:"text-sm font-semibold text-emerald-700 dark:text-emerald-300",children:"AI System Ready"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Index"}),e.jsx(Zs,{className:"w-3 h-3 text-emerald-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r.fastIndexType}),e.jsx(Ht,{className:"w-3 h-3 text-blue-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"OCR"}),e.jsx(Ji,{className:"w-3 h-3 text-purple-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[r.freeSpace,"GB"]}),e.jsx(rs,{className:"w-3 h-3 text-gray-500"})]})]})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200/50 dark:border-gray-700/50 space-y-3",children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsx(we.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:c,className:"w-full flex items-center justify-center p-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200",children:e.jsx(rs,{className:"w-6 h-6"})}),e.jsx(we.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:u,className:"w-full flex items-center justify-center p-3 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:e.jsx(lt,{className:"w-5 h-5"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(we.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:c,className:"w-full flex items-center justify-center gap-3 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg shadow-blue-500/25 font-semibold",children:[e.jsx(rs,{className:"w-5 h-5"}),e.jsx("span",{children:"Select Library"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(we.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:u,className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Settings"})]}),e.jsx(we.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:i,className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:n?e.jsx(fs,{className:"w-4 h-4"}):e.jsx(ia,{className:"w-4 h-4"})})]})]})}),e.jsx(we.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>d(!l),className:"absolute -right-4 top-24 w-8 h-8 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full flex items-center justify-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 shadow-lg hover:shadow-xl transition-all duration-200 z-10",children:e.jsx(we.div,{animate:{rotate:l?180:0},transition:{duration:.3},children:e.jsx(ls,{className:"w-4 h-4"})})})]}),g&&!l&&e.jsx(we.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>d(!0),className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden"})]})},xd=s=>s.split("/").pop()||s;function pr({children:s,onEscape:t}){const a=ft.useRef(null);return ft.useEffect(()=>{const r=a.current;if(!r)return;const n=r.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'),i=Array.from(n).filter(c=>!c.hasAttribute("disabled"));i.length>0?(i.find(l=>l.getAttribute("tabindex")!=="-1")||i[0]).focus():(r.setAttribute("tabindex","-1"),r.focus());const u=c=>{if(c.key==="Escape"&&(c.stopPropagation(),c.preventDefault(),t&&t()),c.key==="Tab"){if(i.length===0)return;const l=i.indexOf(document.activeElement),d=c.shiftKey?-1:1;let g=l+d;g<0&&(g=i.length-1),g>=i.length&&(g=0),c.preventDefault(),i[g].focus()}};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[t]),e.jsx("div",{ref:a,children:s})}function pd(){const[s,t]=o.useState(!1);o.useEffect(()=>(t(!0),()=>t(!1)),[]);const{isMobile:a}=ud(),{trigger:r}=hd(),{hasCompletedTour:n,completeTour:i}=nd();Dn();const[u,c]=o.useState(!1),[l,d]=o.useState(!n),[g,y]=o.useState(!1),[j,k]=o.useState(!0),[v,f]=o.useState(null),p=Ho(),w=Vo(),T=qo(),h=Wo(),m=nl(),C=il(),I=sl(),E=al(),S=ol(),N=rl(),D=el(),_=Yo(),Q=Qo(),M=Jo(),H=Xo(),$=Zo(),F=ml(),V=xl(),Y=Go(),O=Ko(),J=ll(),L=cl(),X=ul(),le=hl(),A=dl(),K=gl(),Z=K,ne=fl(),oe=bl(),G=[],se=gn();fn();const B=pl(),U=yl(),pe=vl(),te=jl();wl();const me=Nl(),W=kl(),ge=Sl(),Ce=Cl(),ee=Tl(),re=bn(),ie=yn(),q=El(),De=Pl(),[fe,ke]=o.useState("library"),Le=ma(),Mt=Or(),[Me,bt]=o.useState(""),[Se,Ft]=o.useState(new Set),[Rn,On]=o.useState("medium"),[yt,$d]=o.useState("grid"),[Qt,Md]=o.useState("day"),[_n,Ln]=o.useState("all"),[Ts,Dt]=o.useState(!1),[Ze,Es]=o.useState(""),[et,Ps]=o.useState(""),[Re,be]=o.useState(null),[Ra,An]=o.useState(!1),[zn,tt]=o.useState(!1),[Ee,ct]=o.useState(null),[Ne,st]=o.useState(null),[Is,Un]=o.useState([]),Jt=o.useRef(Is),[Bn,Oa]=o.useState(!1),[Hn,Vn]=o.useState("home");o.useEffect(()=>{Jt.current=Is},[Is]);const qn=o.useCallback(x=>{f(x),console.log("Accessibility settings changed:",x)},[]),Wn=o.useCallback(()=>{d(!1),i(),q.setNote("Welcome to Photo Search! ")},[i,q]),Gn=o.useCallback(()=>{Ee!==null&&Ae(1)},[Ee,Ae]),Kn=o.useCallback(()=>{Ee!==null&&Ae(-1)},[Ee,Ae]),Yn=o.useCallback(async()=>{p&&(await rt(Us,0),q.setNote("Library refreshed"))},[p,rt,Us,q]);o.useCallback((x,b)=>{switch(x){case"favorite":b.path&&kt(p,b.path,!X.includes(b.path)).then(Qe).catch(()=>{}),r("light");break;case"rate":if(b.path){const P=b.rating||1;console.log(`Rate photo ${b.path} with ${P} stars`)}break;case"delete":b.path&&(Ft(new Set([b.path])),console.log(`Delete photo ${b.path}`)),q.setNote("Photo deleted"),r("medium");break;case"share":navigator.share&&a&&b.path?navigator.share({title:b.title||"Photo",url:b.path}):console.log(`Share photo ${b.path}`);break;default:console.log(`Action ${x} on photo ${b.path||b.id}`)}},[p,X,Qe,r,q,a]);const _a=o.useRef(null),[$s,Qn]=o.useState({cameras:[],places:[]}),[Jn,Rt]=o.useState(!1),[Ms,Ke]=o.useState([]),[Ot,La]=o.useState(!1),[Xn,Fs]=o.useState(void 0),[_t,Ds]=o.useState(void 0),[Zn,Rs]=o.useState(!1),[ei,ti]=o.useState(void 0),[si,Os]=o.useState(!1),[dt,Aa]=o.useState(0),[vt,Ye]=o.useState(null),[ai,za]=o.useState(!1),[ri,ni]=o.useState(()=>{try{return!localStorage.getItem("ps_hint_help_seen")}catch{return!0}}),[_s,ii]=o.useState([]),Xt=o.useRef(null),[Lt,Ls]=o.useState(()=>{try{const x=localStorage.getItem("userActions");return x?JSON.parse(x):[]}catch{return[]}}),[oi,li]=o.useState(()=>{try{const x=localStorage.getItem("onboardingSteps");return x?JSON.parse(x):[]}catch{return[]}}),at=o.useCallback(x=>{const b={select_directory:[],index_photos:["select_directory"],first_search:["index_photos"],explore_features:["first_search"]};li(P=>{if(P.includes(x)||!(b[x]||[]).every(ae=>P.includes(ae)))return P;const R=[...P,x];try{localStorage.setItem("onboardingSteps",JSON.stringify(R))}catch{}return R})},[]),[ci,Ua]=o.useState(!1),[di,Ba]=o.useState(!1),As=o.useMemo(()=>{const x={},b=B||{};for(const P of Object.keys(b)){const R=(b[P]||[]).find(ae=>/^rating:[1-5]$/.test(ae));R&&(x[P]=parseInt(R.split(":")[1],10))}return x},[B]);o.useEffect(()=>{try{localStorage.getItem("ps_theme")==="dark"&&document.documentElement.classList.add("dark")}catch{}},[]);const zs=Fa(),jt=tl();o.useEffect(()=>{const x=b=>{const P=document.activeElement;if(!(P&&(P.tagName==="INPUT"||P.tagName==="TEXTAREA"||P.isContentEditable))){if(b.key.toLowerCase()==="i"){b.preventDefault(),re.setShowInfoOverlay&&re.setShowInfoOverlay(!jt);return}if(b.key.toLowerCase()==="a"){b.preventDefault(),be({kind:"advanced"});return}if(b.key==="?"){b.preventDefault(),tt(z=>!z);return}if(fe==="results"&&yt==="timeline"){const z=R=>window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:R}}));if(b.key.toLowerCase()==="t"){b.preventDefault(),z("today");return}if(b.key.toLowerCase()==="m"){b.preventDefault(),z("this-month");return}if(b.key.toLowerCase()==="l"){b.preventDefault(),z("last-month");return}if(b.key.toLowerCase()==="o"){b.preventDefault(),z("oldest");return}}}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[jt,re,fe,yt]),o.useEffect(()=>{const x=document.body;zs?x.classList.add("high-contrast"):x.classList.remove("high-contrast")},[zs]);const ui=o.useMemo(()=>{const x=!!(_||Q||M||H||$||D),b=!!(Ze&&et),P=Array.isArray(W)&&W.length>0,z=!!(F&&F.trim()),R=dt>0||N;return!!(le||x||b||P||z||R)},[_,Q,M,H,$,D,Ze,et,W,F,dt,N,le]);o.useEffect(()=>{const b=(Le.pathname||"/library").split("/").filter(Boolean)[0]||"library",P=b==="search"?"results":b==="library"?"library":b==="people"?"people":b==="collections"?"collections":b==="settings"?"tasks":"library";fe!==P&&ke(P)},[Le.pathname,fe]),o.useEffect(()=>{const x=Le.pathname||"",b=fe==="results"?"/search":fe==="library"?"/library":fe==="people"?"/people":fe==="collections"?"/collections":"/settings";x!==b&&Mt({pathname:b,search:Le.search},{replace:!1})},[fe,Mt,Le.search]),o.useEffect(()=>{if(!s)return;const x=new URLSearchParams(Le.search),b=x.get("q")||"";b&&b!==Me&&bt(b);try{x.get("fav")==="1"&&ie.setFavOnly(!0);const z=x.get("tags")||"";z&&ie.setTagFilter(z);const R=x.get("date_from"),ae=x.get("date_to");R&&Es(R),ae&&Ps(ae);const he=x.get("place");he&&re.setPlace(he),x.get("has_text")==="1"&&re.setHasText(!0);const Pe=x.get("camera");Pe&&re.setCamera(Pe);const ze=x.get("iso_min");ze&&re.setIsoMin(parseFloat(ze));const Ue=x.get("iso_max");Ue&&re.setIsoMax(parseFloat(Ue));const ts=x.get("f_min");ts&&re.setFMin(parseFloat(ts));const Oe=x.get("f_max");Oe&&re.setFMax(parseFloat(Oe));const ss=x.get("person"),zt=x.get("persons");zt?De.setPersons(zt.split(",").map(Ut=>Ut.trim()).filter(Boolean)):ss&&De.setPersons([ss]);const ut=x.get("rv");ut&&re.setResultView&&re.setResultView(ut);const as=x.get("tb");as&&re.setTimelineBucket&&re.setTimelineBucket(as)}catch{}},[Le.search,s,Me,ie,re,De]),o.useEffect(()=>{Me&&Me.trim()&&Ls(x=>{if(!x.includes("searched")){const b=[...x,"searched"];try{localStorage.setItem("userActions",JSON.stringify(b))}catch{}return b}return x})},[Me]),o.useEffect(()=>{p&&(Ls(x=>{if(!x.includes("selected_directory")){const b=[...x,"selected_directory"];try{localStorage.setItem("userActions",JSON.stringify(b))}catch{}return b}return x}),at("select_directory"))},[p,at]),o.useEffect(()=>{se&&se.length>0&&Ls(x=>{if(!x.includes("indexed")){const b=[...x,"indexed"];try{localStorage.setItem("userActions",JSON.stringify(b))}catch{}return b}return x})},[se]),o.useEffect(()=>{["collections","saved","smart","memories","trips","videos","people","map"].includes(fe)&&at("explore_features")},[fe,at]),o.useEffect(()=>{Ua(!!(Lt.length===0||fe==="results"&&!Lt.includes("searched")||fe==="library"&&p&&!Lt.includes("searched")))},[fe,Lt,p]),o.useEffect(()=>{const b=!localStorage.getItem("onboardingComplete")&&p&&se&&se.length>0;Ba(b||!1)},[p,se]);const[Fd,Dd]=o.useState(0),Us=120,hi=o.useMemo(()=>(se||[]).map(x=>({path:x})),[se]),Qe=o.useCallback(async()=>{if(p)try{const x=await pa(p);ie.setFavorites(x.favorites||[])}catch{}},[p,ie]),Zt=o.useCallback(async()=>{if(p)try{const x=await ga(p);ie.setSaved(x.saved||[])}catch{}},[p,ie]),wt=o.useCallback(async()=>{if(p)try{const{apiGetPresets:x}=await ye(async()=>{const{apiGetPresets:P}=await Promise.resolve().then(()=>ve);return{apiGetPresets:P}},void 0,import.meta.url),b=await x(p);ii(b.presets||[])}catch{}},[p]),Ve=o.useCallback(async()=>{if(p)try{const x=await Na(p);ie.setTagsMap(x.tags||{}),ie.setAllTags(x.all||[])}catch{}},[p,ie]),es=o.useCallback(async()=>{if(p)try{const x=await ba(p,w,O?h:void 0,Y?T:void 0);De.setDiag(x)}catch{}},[p,w,O,h,Y,T,De]),Bs=o.useCallback(async()=>{if(p)try{const x=await Ea(p);De.setClusters(x.clusters||[])}catch{}},[p,De]),mi=o.useCallback(async()=>{if(p)try{const x=await fa(p);De.setPoints(x.points||[])}catch{}},[p,De]),rt=o.useCallback(async(x=120,b=0,P=!1)=>{try{if(!p)return;const z=await Yt(p,w,x,b,{openaiKey:O?h:void 0,hfToken:Y?T:void 0}),R=z.paths&&z.paths.length===x&&b+z.paths.length<z.total;P?z.paths&&z.paths.length>0&&ie.appendLibrary(z.paths):ie.setLibrary(z.paths||[]),ie.setLibHasMore(R)}catch{}},[p,w,O,h,Y,T,ie]),Ha=o.useCallback(async()=>{try{if(!p)return;const x=await Ca(p);Qn({cameras:x.cameras||[],places:x.places||[]})}catch{}},[p]);o.useEffect(()=>{let x=!1;return(async()=>{if(!p){Os(!1);return}try{const{apiOcrStatus:P}=await ye(async()=>{const{apiOcrStatus:R}=await Promise.resolve().then(()=>ve);return{apiOcrStatus:R}},void 0,import.meta.url),z=await P(p);x||Os(!!z.ready)}catch{x||Os(!1)}})(),()=>{x=!0}},[p]);const Nt=o.useCallback(async()=>{q.setNote("Indexing started in background. You can continue using the app."),La(!0);const x=`index-${Date.now()}`,b={id:x,type:"index",title:"Indexing Photos",description:`Analyzing photos in ${p}`,status:"running",startTime:new Date,canCancel:!0,total:(se||[]).length||void 0};Ke(z=>[...z,b]);let P;P=setInterval(async()=>{await rt(120,0)},3e3);try{const z=await Wt(p,w,32,Y?T:void 0,O?h:void 0);P&&clearInterval(P),q.setNote(`Indexing complete! New: ${z.new}, Updated: ${z.updated}, Total: ${z.total}`),Ke(R=>R.map(ae=>ae.id===x?{...ae,status:"completed",endTime:new Date,progress:z.total}:ae)),at("index_photos"),await rt(120,0)}catch(z){P&&clearInterval(P),q.setNote(z instanceof Error?z.message:"Index failed"),Ke(R=>R.map(ae=>ae.id===x?{...ae,status:"failed",endTime:new Date,error:z instanceof Error?z.message:"Index failed"}:ae))}finally{La(!1)}},[p,w,Y,T,O,h,rt,q,at]),nt=o.useCallback(async x=>{const b=(x??Me??"").trim();if(b){ie.setQuery(b);try{const P=new URLSearchParams;P.set("q",b),le&&P.set("fav","1"),F?.trim()&&P.set("tags",F),Ze&&et&&(P.set("date_from",Ze),P.set("date_to",et)),D?.trim()&&P.set("place",D),N&&P.set("has_text","1"),_?.trim()&&P.set("camera",_),Q&&P.set("iso_min",String(Q)),M&&P.set("iso_max",String(M)),H&&P.set("f_min",String(H)),$&&P.set("f_max",String($));const z=W.filter(Boolean);z.length===1&&P.set("person",z[0]),z.length>1&&P.set("persons",z.join(",")),Mt({pathname:"/search",search:`?${P.toString()}`},{replace:!1})}catch{}q.setBusy("Searching"),q.setNote("");try{const P=F.split(",").map(Pe=>Pe.trim()).filter(Boolean),z=W.filter(Boolean);let R;const ae=Ze?Math.floor(new Date(Ze).getTime()/1e3):void 0,he=et?Math.floor(new Date(et).getTime()/1e3):void 0;me?R=await wa(p,b,w,A,{favoritesOnly:le,tags:P,dateFrom:ae,dateTo:he,place:D||void 0,hasText:N,...z.length===1?{person:z[0]}:z.length>1?{persons:z}:{}}):R=await Ss(p,b,w,A,{hfToken:Y?T:void 0,openaiKey:O?h:void 0,favoritesOnly:le,tags:P,dateFrom:ae,dateTo:he,...m?{useFast:!0,fastKind:C||void 0}:{},useCaptions:I,useOcr:E,camera:_||void 0,isoMin:Q||void 0,isoMax:M||void 0,fMin:H||void 0,fMax:$||void 0,place:D||void 0,hasText:N||void 0,...z.length===1?{person:z[0]}:z.length>1?{persons:z}:{}});let je=R.results||[];dt>0&&(je=je.filter(Pe=>(As[Pe.path]||0)>=dt)),ie.setResults(je),ie.setSearchId(R.search_id||""),q.setNote(`Found ${R.results?.length||0} results.`),await Promise.all([Qe(),Zt(),Ve(),es()]),ke("results"),at("first_search")}catch(P){q.setNote(P instanceof Error?P.message:"Search failed")}finally{q.setBusy("")}}},[Me,ie,Mt,Le.search,q,B,W,Ze,et,me,p,w,A,le,D,N,Y,T,O,h,m,C,I,E,_,Q,M,H,$,dt,As,Qe,Zt,Ve,es,at]),Va=no(nt,300),xi=o.useCallback(async x=>{q.setBusy(`Preparing ${x.toUpperCase()}`);try{await ya(p,x,w,Y?T:void 0,O?h:void 0),q.setNote(`${x.toUpperCase()} ready`)}catch(b){q.setNote(b instanceof Error?b.message:"Failed to build index")}finally{q.setBusy("")}},[p,w,Y,T,O,h,q]),pi=o.useCallback(async()=>{q.setBusy("Extracting text (OCR)");try{const x=await va(p,w,["en"],Y?T:void 0,O?h:void 0);q.setNote(`OCR updated ${x.updated} images`),await Ve()}catch(x){q.setNote(x instanceof Error?x.message:"OCR failed")}finally{q.setBusy("")}},[p,w,Y,T,O,h,Ve,q]),gi=o.useCallback(async()=>{q.setBusy("Building metadata");try{const x=await Sa(p,w,Y?T:void 0,O?h:void 0);q.setNote(`Metadata ready (${x.updated})`)}catch(x){q.setNote(x instanceof Error?x.message:"Metadata build failed")}finally{q.setBusy("")}},[p,w,Y,T,O,h,q]);o.useEffect(()=>{if(!U||!p)return;let x,b="";const P=R=>{switch(R?.type){case"ocr_build":return`OCR updated ${R.updated}`;case"captions_build":return`Captions updated ${R.updated}`;case"fast_build":return`${String(R.kind).toUpperCase()} ${R.ok?"ready":"failed"}`;case"thumbs_build":return`Thumbs made ${R.made}`;case"trips_build":return`Trips ${R.trips}`;case"metadata_build":return`Metadata updated ${R.updated}`;case"export":return`Exported ${R.copied}, skipped ${R.skipped}`;default:return""}},z=async()=>{try{const{apiAnalytics:R}=await ye(async()=>{const{apiAnalytics:je}=await Promise.resolve().then(()=>ve);return{apiAnalytics:je}},void 0,import.meta.url),he=((await R(p,10)).events||[]).slice(-1)[0];if(he&&he.time!==b){b=he.time;const je=P(he);je&&q.setNote(je)}}catch{}x=window.setTimeout(z,2e3)};return z(),()=>{x&&window.clearTimeout(x)}},[U,p,q]),o.useEffect(()=>{if(!Ot||!p){Fs(void 0),Ds(void 0),Rs(!1);return}let x,b;const P=async()=>{try{const{apiIndexStatus:z}=await ye(async()=>{const{apiIndexStatus:ut}=await Promise.resolve().then(()=>ve);return{apiIndexStatus:ut}},void 0,import.meta.url),R=await z(p,w,Y?T:void 0,O?h:void 0),ae=Number(R.insert_done||0),he=Number(R.insert_total||0),je=Number(R.updated_done||0),Pe=Number(R.updated_total||0),ze=ae+je,Ue=Math.max(1,he+Pe),ts=Math.min(1,Math.max(0,ze/Ue));Ue>1&&Fs(ts),Rs(!!R.paused||R.state==="paused");const Oe=[];Ue>1&&Oe.push(`processed ${ze}/${Ue}`),typeof R.indexed=="number"&&Oe.push(`indexed ${R.indexed}`),typeof R.target=="number"&&R.target>0&&Oe.push(`target ${R.target}`),typeof R.coverage=="number"&&Oe.push(`coverage ${Math.round(R.coverage*100)}%`),typeof R.drift=="number"&&R.drift>0&&Oe.push(`drift ${R.drift}`),R.state==="complete"&&(typeof R.new=="number"&&Oe.push(`new ${R.new}`),typeof R.updated=="number"&&Oe.push(`updated ${R.updated}`),R.last_index_time&&Oe.push(`at ${R.last_index_time}`)),typeof _t=="number"&&isFinite(_t)&&_t>0&&Oe.push(`eta ~${Math.max(1,Math.ceil(_t/60))}m`),Oe.length>0&&ti(Oe.join("  ")),!b&&R.start&&(b=Date.parse(R.start));const ss=Date.now(),zt=b?Math.max(1,(ss-b)/1e3):void 0;if(zt&&ze>5){const ut=ze/zt,as=Math.max(0,Ue-ze),Ut=ut>0?as/ut:void 0;Ut&&isFinite(Ut)&&Ds(Ut)}R.state==="complete"&&(Fs(void 0),Ds(void 0),Rs(!1))}catch{}x=window.setTimeout(P,1e3)};return P(),()=>{x&&window.clearTimeout(x)}},[Ot,p,w,Y,T,O,h]),o.useEffect(()=>{try{const x=new URLSearchParams(Le.search);x.set("rv",yt),x.set("tb",Qt),Mt({pathname:Le.pathname,search:`?${x.toString()}`},{replace:!0})}catch{}},[yt,Qt]);const At=o.useCallback(x=>{Ft(b=>{const P=new Set(b);return P.has(x)?P.delete(x):P.add(x),P})},[]);o.useCallback(async x=>{if(!(!p||Se.size===0))try{const b=await $t(p,Array.from(Se),x,"copy",!1,!1);q.setNote(`Exported ${b.copied}, skipped ${b.skipped}, errors ${b.errors}  ${b.dest}`)}catch(b){q.setNote(b instanceof Error?b.message:"Export failed")}},[p,Se,q]);const qa=o.useCallback(x=>{const b=(J||[]).findIndex(P=>P.path===x);b>=0&&ct(b)},[J]),Ae=o.useCallback(x=>{ct(b=>{if(b===null)return null;const P=b+x;return!J||P<0||P>=J.length?b:P})},[J]),fi=o.useCallback(async x=>{if(!p||Se.size===0)return;const b=x.split(",").map(P=>P.trim()).filter(Boolean);try{const{apiSetTags:P}=await ye(async()=>{const{apiSetTags:z}=await Promise.resolve().then(()=>ve);return{apiSetTags:z}},void 0,import.meta.url);await Promise.all(Array.from(Se).map(z=>P(p,z,b))),q.setNote(`Updated tags for ${Se.size} photos`),await Ve()}catch(P){q.setNote(P instanceof Error?P.message:"Tag update failed")}},[p,Se,Ve,q]);o.useCallback(async x=>{if(!(!p||Se.size===0))try{const{apiSetTags:b}=await ye(async()=>{const{apiSetTags:R}=await Promise.resolve().then(()=>ve);return{apiSetTags:R}},void 0,import.meta.url),P=/^rating:[1-5]$/,z=Array.from(Se);await Promise.all(z.map(async R=>{const ae=(B?.[R]||[]).filter(je=>!P.test(je)),he=x===0?ae:[...ae,`rating:${x}`];await b(p,R,he)})),q.setNote(x===0?`Cleared rating for ${Se.size}`:`Set rating ${x} for ${Se.size}`),await Ve()}catch(b){q.setNote(b instanceof Error?b.message:"Rating update failed")}},[p,Se,B,Ve,q]);const bi=o.useCallback((x,b)=>x.length===b.length&&x.every((P,z)=>P.length===b[z].length&&P.every((R,ae)=>R===b[z][ae])),[]);o.useEffect(()=>{p&&(Qe(),Zt(),Ve(),es(),Bs(),rt(Us,0),Ha(),wt())},[p,Qe,Zt,Ve,es,Bs,rt,Ha,wt]),o.useEffect(()=>{if(!s)return;const x=J?.length??0;st(b=>{const P=x>0?b===null?0:Math.min(b,x-1):null;return Object.is(b,P)?b:P})},[J?.length,s]),o.useEffect(()=>{function x(b){const P=b.target;if(P&&(P.tagName==="INPUT"||P.tagName==="TEXTAREA"||P.isContentEditable)||Ra||Re||Ts)return;if(b.key==="/"){b.preventDefault();return}if(b.key==="?"||b.shiftKey&&b.key==="/"){b.preventDefault(),An(!0);return}if(!(fe!=="results"||!((J?.length||0)>0))){if(b.key==="Escape"){ct(null);return}if(Ee!==null){if((b.key==="ArrowLeft"||b.key==="k")&&(b.preventDefault(),Ae(-1)),(b.key==="ArrowRight"||b.key==="j")&&(b.preventDefault(),Ae(1)),b.key.toLowerCase()==="f"){b.preventDefault();const R=J?.[Ee]?.path;if(!R)return;kt(p,R,!X.includes(R)).then(Qe).catch(()=>{})}return}if(b.key.toLowerCase()==="a"){b.preventDefault(),Ft(new Set((J??[]).map(R=>R.path)));return}if(b.key.toLowerCase()==="c"){b.preventDefault(),Ft(new Set);return}if(b.key.toLowerCase()==="f"&&Ne!==null){b.preventDefault();const R=J?.[Ne]?.path;if(!R)return;kt(p,R,!X.includes(R)).then(Qe).catch(()=>{});return}if(b.key==="Enter"&&Ne!==null){b.preventDefault(),ct(Ne);return}if(b.key===" "&&Ne!==null){b.preventDefault();const R=J?.[Ne]?.path;if(!R)return;At(R);return}if(b.key==="ArrowLeft"){b.preventDefault(),Ne!==null&&st(Math.max(0,Ne-1));return}if(b.key==="ArrowRight"){b.preventDefault(),Ne!==null&&st(Math.min((J?.length??1)-1,Ne+1));return}if(b.key==="ArrowUp"&&Ne!==null){b.preventDefault();const R=Jt.current;let ae=R.findIndex(he=>he.includes(Ne));if(ae>0){const he=R[ae].indexOf(Ne),je=R[ae-1],Pe=je[Math.min(he,je.length-1)];typeof Pe=="number"&&st(Pe)}return}if(b.key==="ArrowDown"&&Ne!==null){b.preventDefault();const R=Jt.current;let ae=R.findIndex(he=>he.includes(Ne));if(ae>=0&&ae<R.length-1){const he=R[ae].indexOf(Ne),je=R[ae+1],Pe=je[Math.min(he,je.length-1)];typeof Pe=="number"&&st(Pe)}return}if(b.key==="Home"){b.preventDefault(),st(0);return}if(b.key==="End"){b.preventDefault(),st(J.length-1);return}if((b.key==="PageUp"||b.key==="PageDown")&&Ne!==null){b.preventDefault();const R=3,ae=Jt.current,he=ae.findIndex(je=>je.includes(Ne));if(he>=0){const je=ae[he].indexOf(Ne),Pe=b.key==="PageUp"?Math.max(0,he-R):Math.min(ae.length-1,he+R),ze=ae[Pe],Ue=ze[Math.min(je,ze.length-1)];typeof Ue=="number"&&st(Ue)}return}}}return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[fe,J?.length,Ee,p,X,Ae,At,Ra,Re,Ts]),o.useEffect(()=>{if(Ne===null)return;const b=document.getElementById("modern-results-grid")?.querySelector(`[data-photo-idx="${Ne}"]`);b&&b.scrollIntoView({block:"nearest",inline:"nearest"})},[Ne]);const yi=()=>p?se&&se.length===0?e.jsx("div",{className:"p-4",children:e.jsx(Vs,{type:"no-photos",onAction:()=>be({kind:"folder"}),onOpenHelp:()=>tt(!0)})}):e.jsxs("div",{className:"p-4",children:[e.jsx(Vl,{dir:p,engine:w,library:se,onLoadLibrary:rt,selected:Se,onToggleSelect:At,onOpen:x=>{const b=[{path:x,score:0}];ie.setResults(b),ct(0),ke("results")},tagsMap:B}),!Me&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-700 font-medium mb-2",children:"Try these searches"}),e.jsx(dr,{onSearch:nt})]})]}):e.jsxs("div",{className:"p-4",children:[e.jsx(Vs,{type:"no-directory",onAction:()=>be({kind:"folder"}),onDemoAction:async()=>{re.setDir("/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data");try{await Nt(),q.setNote("Demo library loaded! Try searching for 'beach sunset' or 'family photos'")}catch(b){console.error("Failed to setup demo:",b),q.setNote(b instanceof Error?b.message:"Failed to setup demo")}},onOpenHelp:()=>tt(!0),onStartTour:()=>tt(!0),sampleQueries:["beach sunset","birthday cake","mountain hike","red car"],onRunSample:x=>nt(x)}),e.jsx(nc,{onSelectDirectory:()=>be({kind:"folder"}),onImport:()=>{},onHelp:()=>tt(!0)})]});return e.jsx(gc,{children:e.jsx(Qc,{children:e.jsx(id,{children:e.jsx(ld,{children:e.jsxs(dd,{onSwipeLeft:Gn,onSwipeRight:Kn,onSwipeUp:()=>y(!g),enableSwipeGestures:a,enablePullToRefresh:!0,onPullToRefresh:Yn,children:[(Le.pathname||"").startsWith("/share/")?e.jsx(Kl,{}):(Le.pathname||"").startsWith("/mobile-test")?e.jsx(rc,{}):e.jsxs("div",{className:Te("flex h-screen bg-white dark:bg-gray-950 dark:text-gray-100",{"high-contrast":v?.highContrast,"large-text":v?.largeText}),children:[e.jsx(bc,{}),te&&e.jsx(tc,{onStartDemo:async()=>{const x="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";re.setDir(x),q.setShowWelcome(!1);try{await xt(x),await Nt()}catch(b){console.error("Failed to add demo path or index:",b),q.setNote(b instanceof Error?b.message:"Failed to setup demo")}},onSelectFolder:()=>{be({kind:"folder"}),q.setShowWelcome(!1)},onClose:()=>q.setShowWelcome(!1)}),e.jsx(ac,{open:!p&&Jn,onClose:()=>{Rt(!1),localStorage.setItem("hasSeenOnboarding","true")},onQuickStart:async x=>{try{const b=[];for(const P of x)try{const z=await fetch(`${xe}/scan_count`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([P])});z.ok&&(await z.json()).items?.[0]?.exists&&b.push(P)}catch{}if(b.length===0){Rt(!1),localStorage.setItem("hasSeenOnboarding","true");return}re.setDir(b[0]);for(const P of b){try{await xt(P)}catch{}(async()=>{try{await Wt(P,w,24,Y?T:void 0,O?h:void 0)}catch{}})()}Rt(!1),localStorage.setItem("hasSeenOnboarding","true")}catch(b){q.setNote(b instanceof Error?b.message:"Quick start failed")}},onCustom:()=>{be({kind:"folder"}),Rt(!1),localStorage.setItem("hasSeenOnboarding","true")},onDemo:async()=>{try{const x="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";re.setDir(x),await xt(x),await Nt()}catch(x){q.setNote(x instanceof Error?x.message:"Demo setup failed")}Rt(!1),localStorage.setItem("hasSeenOnboarding","true")},onTour:()=>{tt(!0)}}),a?e.jsx(md,{selectedView:fe,onViewChange:x=>ke(x),stats:{totalPhotos:se?.length||0,collections:Object.keys(ne||{}).length,people:(ge||[]).length,favorites:X.length},aiStatus:{indexReady:!0,fastIndexType:"FAISS",freeSpace:0},darkMode:!1,onDarkModeToggle:()=>{},onSettingsClick:()=>c(!0),onSelectLibrary:()=>be({kind:"folder"})}):e.jsx(pc,{selectedView:fe,onViewChange:x=>ke(x),library:se,favorites:X,collections:Object.keys(ne||{}),clusters:ge,savedSearches:Z,smart:Object.keys(oe||{}),trips:G,isOpen:Bn,onClose:()=>Oa(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(kc,{searchText:Me,setSearchText:bt,onSearch:nt,clusters:ge,allTags:V,meta:$s,diag:ee,busy:!!U,gridSize:Rn,setGridSize:On,selectedView:fe,setSelectedView:x=>ke(x),currentFilter:_n,setCurrentFilter:Ln,ratingMin:dt,setRatingMin:Aa,setModal:x=>be(x),setIsMobileMenuOpen:Oa,setShowFilters:Dt,selected:Se,setSelected:Ft,dir:p,engine:w,topK:A,useOsTrash:S,showInfoOverlay:jt,onToggleInfoOverlay:()=>re.setShowInfoOverlay?re.setShowInfoOverlay(!jt):void 0,resultView:yt,onChangeResultView:x=>re.setResultView?.(x),timelineBucket:Qt,onChangeTimelineBucket:x=>re.setTimelineBucket?.(x),photoActions:ie,uiActions:q,toastTimerRef:Xt,setToast:Ye,isIndexing:Ot,onIndex:Nt,activeJobs:Ms.filter(x=>x.status==="running").length,onOpenJobs:()=>be({kind:"jobs"}),progressPct:Xn,etaSeconds:_t,paused:Zn,tooltip:ei,ocrReady:si,onPause:async()=>{try{const{apiIndexPause:x}=await ye(async()=>{const{apiIndexPause:b}=await Promise.resolve().then(()=>ve);return{apiIndexPause:b}},void 0,import.meta.url);await x(p)}catch{}},onResume:async()=>{try{const{apiIndexResume:x}=await ye(async()=>{const{apiIndexResume:b}=await Promise.resolve().then(()=>ve);return{apiIndexResume:b}},void 0,import.meta.url);await x(p)}catch{}},onOpenThemeModal:()=>za(!0)}),e.jsxs("div",{className:"px-4 pt-2 flex items-center gap-2",children:[e.jsx(we.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c(!0),className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-label":"Accessibility settings",children:e.jsx("span",{className:"text-sm",children:""})}),e.jsx(we.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d(!0),className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-label":"Help and onboarding",children:e.jsx("span",{className:"text-sm",children:"?"})}),ri&&e.jsxs("div",{className:"flex-1 bg-yellow-50 text-yellow-800 border border-yellow-200 rounded px-3 py-1 text-xs flex items-center justify-between",children:[e.jsxs("span",{children:["Press ",e.jsx("span",{className:"font-mono",children:"?"})," for help and shortcuts"]}),e.jsx("button",{type:"button",className:"text-yellow-800 hover:text-yellow-900","aria-label":"Dismiss help hint",onClick:()=>{ni(!1);try{localStorage.setItem("ps_hint_help_seen","1")}catch{}},children:""})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",ref:_a,children:[fe==="results"&&e.jsx(hr,{sectionName:"Search Results",children:e.jsxs("div",{className:"p-4",children:[J&&J.length>0&&(Me||"").trim()&&e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[J.length," results"]}),e.jsx("button",{type:"button",className:"chip",title:"Save this search as a Smart Collection",onClick:async()=>{const x=(prompt("Save current search as Smart (name):")||"").trim();if(x)try{const b=(F||"").split(",").map(he=>he.trim()).filter(Boolean),P={query:(Me||"").trim(),favoritesOnly:le,tags:b,useCaptions:I,useOcr:E,hasText:N,camera:_||void 0,isoMin:Q||void 0,isoMax:M||void 0,fMin:H||void 0,fMax:$||void 0,place:D||void 0},z=(W||[]).filter(Boolean);z.length===1?P.person=z[0]:z.length>1&&(P.persons=z);const{apiSetSmart:R,apiGetSmart:ae}=await ye(async()=>{const{apiSetSmart:he,apiGetSmart:je}=await Promise.resolve().then(()=>ve);return{apiSetSmart:he,apiGetSmart:je}},void 0,import.meta.url);await R(p,x,P);try{const he=await ae(p);ie.setSmart(he.smart||{})}catch{}q.setNote(`Saved smart collection: ${x}`)}catch(b){q.setNote(b?.message||"Failed to save smart collection")}},children:"Save as Smart Collection"})]}),J&&J.length===0&&Me?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(Vs,{type:"no-results",searchQuery:Me,onAction:()=>{bt(""),ie.setQuery("")},onOpenFilters:()=>Dt(!0),onOpenAdvanced:()=>be({kind:"advanced"}),onClearSearch:()=>{le&&ie.setFavOnly(!1),F&&ie.setTagFilter(""),Es(""),Ps(""),re.setPlace(""),re.setCamera(""),re.setIsoMin(0),re.setIsoMax(0),re.setFMin(0),re.setFMax(0),re.setHasText(!1),De.setPersons([])},hasActiveFilters:ui,sampleQueries:["golden hour","city skyline","family dinner","blue car"],onRunSample:x=>nt(x),onOpenHelp:()=>tt(!0)}),e.jsx(dr,{onSearch:nt})]}):yt==="grid"?e.jsx(kn,{dir:p,engine:w,items:(J||[]).map(x=>({path:x.path,score:x.score})),selected:Se,onToggleSelect:At,onOpen:x=>qa(x),scrollContainerRef:_a,focusIndex:Ne??void 0,onLayout:x=>Un(b=>bi(b,x)?b:x),ratingMap:As,showInfoOverlay:jt}):e.jsx(Zl,{dir:p,engine:w,items:(J||[]).map(x=>({path:x.path,score:x.score})),selected:Se,onToggleSelect:At,onOpen:x=>qa(x),showInfoOverlay:jt,bucket:Qt})]})}),fe==="library"&&e.jsx(hr,{sectionName:"Library",children:e.jsx(yi,{})}),fe==="people"&&e.jsx("div",{className:"p-4",children:e.jsx(ql,{dir:p,engine:w,clusters:ge||[],persons:W,setPersons:De.setPersons,busy:U,setBusy:q.setBusy,setNote:q.setNote,onLoadFaces:Bs,onOpenPhotos:x=>{ie.setResults(x.map(b=>({path:b,score:0}))),ke("results"),q.setNote(`Viewing ${x.length} photos from face cluster`)}})}),fe==="map"&&e.jsx("div",{className:"p-4",children:e.jsx(Wl,{points:Ce||[],onLoadMap:mi})}),fe==="collections"&&e.jsx("div",{className:"p-4",children:e.jsx(Gl,{dir:p,engine:w,collections:ne,onLoadCollections:async()=>{const{apiGetCollections:x}=await ye(async()=>{const{apiGetCollections:P}=await Promise.resolve().then(()=>ve);return{apiGetCollections:P}},void 0,import.meta.url),b=await x(p);ie.setCollections(b.collections||{})},onOpen:x=>{const b=ne?.[x]||[];ie.setResults(b.map(P=>({path:P,score:0}))),ke("results"),q.setNote(`${b.length} in ${x}`)},onDelete:async x=>{try{const{apiDeleteCollection:b,apiGetCollections:P}=await ye(async()=>{const{apiDeleteCollection:R,apiGetCollections:ae}=await Promise.resolve().then(()=>ve);return{apiDeleteCollection:R,apiGetCollections:ae}},void 0,import.meta.url);await b(p,x);const z=await P(p);ie.setCollections(z.collections||{}),Ye({message:`Deleted collection ${x}`})}catch(b){q.setNote(b instanceof Error?b.message:"Delete failed")}}})}),fe==="saved"&&e.jsxs("div",{className:"p-4",children:[e.jsx(Ql,{saved:K,onRun:(x,b,P)=>{bt(b),P&&ie.setTopK(P),nt(b)},onDelete:async x=>{try{const{apiDeleteSaved:b,apiGetSaved:P}=await ye(async()=>{const{apiDeleteSaved:R,apiGetSaved:ae}=await Promise.resolve().then(()=>ve);return{apiDeleteSaved:R,apiGetSaved:ae}},void 0,import.meta.url);await b(p,x);const z=await P(p);ie.setSaved(z.saved||[])}catch(b){q.setNote(b instanceof Error?b.message:"Delete failed")}}}),e.jsxs("div",{className:"mt-4 bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Presets"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:wt,children:"Refresh"}),e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:()=>{try{const x=JSON.stringify(_s||[],null,2),b=new Blob([x],{type:"application/json"}),P=URL.createObjectURL(b),z=document.createElement("a");z.href=P,z.download="photo-search-presets.json",document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(P)}catch{}},children:"Export"}),e.jsxs("label",{className:"px-2 py-1 rounded border cursor-pointer",children:["Import",e.jsx("input",{type:"file",accept:"application/json",className:"hidden",onChange:async x=>{const b=x.target.files?.[0];if(b)try{const P=await b.text(),z=JSON.parse(P);if(Array.isArray(z)){const{apiAddPreset:R}=await ye(async()=>{const{apiAddPreset:ae}=await Promise.resolve().then(()=>ve);return{apiAddPreset:ae}},void 0,import.meta.url);for(const ae of z)ae&&typeof ae.name=="string"&&typeof ae.query=="string"&&await R(p,ae.name,ae.query);await wt(),Ye({message:`Imported ${z.length} preset(s)`})}else q.setNote("Invalid JSON format")}catch{q.setNote("Import failed")}finally{x.currentTarget.value=""}}})]})]})]}),_s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No presets yet. Use Advanced Search to create one."}):e.jsx("div",{className:"mt-2 divide-y",children:_s.map(x=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:x.name,children:x.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:x.query,children:x.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{bt(x.query),Va(x.query)},className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{type:"button",onClick:async()=>{try{const{apiDeletePreset:b}=await ye(async()=>{const{apiDeletePreset:P}=await Promise.resolve().then(()=>ve);return{apiDeletePreset:P}},void 0,import.meta.url);await b(p,x.name),await wt()}catch{}},className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},x.name))})]})]}),fe==="memories"&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"font-semibold",children:"Recent Favorites"})}),X.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No favorites yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:X.slice(0,24).map(x=>e.jsx("img",{src:Fe(p,w,x,196),alt:xd(x),className:"w-full h-24 object-cover rounded"},x))})]}),e.jsx("div",{children:e.jsx(cr,{dir:p,engine:w,setBusy:q.setBusy,setNote:q.setNote,setResults:ie.setResults})})]}),fe==="tasks"&&e.jsx("div",{className:"p-4",children:e.jsx(Xl,{})}),fe==="smart"&&e.jsx("div",{className:"p-4",children:e.jsx(Yl,{dir:p,engine:w,topK:A,smart:oe,setSmart:ie.setSmart,setResults:ie.setResults,setSearchId:ie.setSearchId,setNote:q.setNote,query:L,favOnly:le,tagFilter:F,useCaps:I,useOcr:E,hasText:N,camera:_,isoMin:String(Q||""),isoMax:String(M||""),fMin:String(H||""),fMax:String($||""),place:D,persons:W})}),fe==="trips"&&e.jsx("div",{className:"p-4",children:e.jsx(cr,{dir:p,engine:w,setBusy:q.setBusy,setNote:q.setNote,setResults:ie.setResults})}),fe==="videos"&&e.jsx("div",{className:"p-4",children:e.jsx(Tc,{currentDir:p,provider:w})})]}),e.jsx(Sc,{items:hi,note:pe,diag:ee,engine:w}),e.jsx(xc,{show:Ts,onClose:()=>Dt(!1),onApply:()=>{Dt(!1),nt(Me)},favOnly:le,setFavOnly:ie.setFavOnly,tagFilter:F,setTagFilter:ie.setTagFilter,camera:_,setCamera:re.setCamera,isoMin:String(Q||""),setIsoMin:x=>re.setIsoMin(parseFloat(x)||0),isoMax:String(M||""),setIsoMax:x=>re.setIsoMax(parseFloat(x)||0),dateFrom:Ze,setDateFrom:Es,dateTo:et,setDateTo:Ps,fMin:String(H||""),setFMin:x=>re.setFMin(parseFloat(x)||0),fMax:String($||""),setFMax:x=>re.setFMax(parseFloat(x)||0),place:D,setPlace:re.setPlace,useCaps:I,setUseCaps:re.setUseCaps,useOcr:E,setUseOcr:re.setUseOcr,hasText:N,setHasText:re.setHasText,ratingMin:dt,setRatingMin:Aa,availableCameras:$s?.cameras||[],yearRange:[2020,new Date().getFullYear()],filterPresets:[],onSavePreset:x=>{console.log("Save preset:",x)},onLoadPreset:x=>{console.log("Load preset:",x)},onDeletePreset:x=>{console.log("Delete preset:",x)}}),Re?.kind==="shareManage"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:x=>{x.key==="Escape"&&be(null)},children:e.jsx(pr,{onEscape:()=>be(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"Manage Shares"}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>be(null),children:"Close"})]}),e.jsx(dc,{dir:p})]})})}),Re?.kind==="export"&&e.jsx(Ic,{selected:Se,dir:p,onClose:()=>be(null),uiActions:q}),Re?.kind==="enhanced-share"&&e.jsx(Kc,{selected:Se,dir:p,onClose:()=>be(null),uiActions:q}),Re?.kind==="share"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:x=>{x.key==="Escape"&&be(null)},children:e.jsx(pr,{onEscape:()=>be(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Share (v1)"}),e.jsxs("form",{onSubmit:async x=>{if(x.preventDefault(),!p)return;const b=Array.from(Se);if(b.length===0){alert("Select photos to share");return}const P=x.target,z=parseInt(P.elements.namedItem("expiry").value||"24",10),R=P.elements.namedItem("pw").value.trim(),ae=P.elements.namedItem("viewonly").checked;try{const{apiCreateShare:he}=await ye(async()=>{const{apiCreateShare:Pe}=await Promise.resolve().then(()=>ve);return{apiCreateShare:Pe}},void 0,import.meta.url),je=await he(p,w,b,{expiryHours:Number.isNaN(z)?24:z,password:R||void 0,viewOnly:ae});await navigator.clipboard.writeText(window.location.origin+je.url),q.setNote("Share link copied to clipboard")}catch(he){q.setNote(he instanceof Error?he.message:"Share failed")}be(null)},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"expiry-input",children:"Expiry (hours)"}),e.jsx("input",{id:"expiry-input",name:"expiry",type:"number",min:1,defaultValue:24,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"pw-input",children:"Password (optional)"}),e.jsx("input",{id:"pw-input",name:"pw",type:"password",className:"w-full border rounded px-2 py-1",placeholder:""})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"viewonly",defaultChecked:!0})," ","View-only (disable downloads)"]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>be(null),"aria-label":"Cancel sharing",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Create shareable link",children:"Create Link"})]})]})]})})}),Re?.kind==="tag"&&e.jsx(Mc,{onClose:()=>be(null),onTagSelected:fi}),Re?.kind==="folder"&&e.jsx(Rc,{dir:p,useOsTrash:S,useFast:m,fastKind:C,useCaps:I,useOcr:E,hasText:N,highContrast:zs,onClose:()=>be(null),settingsActions:{...re,setHighContrast:()=>{}},uiActions:q,doIndex:Nt,prepareFast:x=>xi(x),buildOCR:pi,buildMetadata:gi}),Re?.kind==="likeplus"&&e.jsx(_c,{selected:Se,dir:p,engine:w,topK:A,onClose:()=>be(null),setSelectedView:x=>ke(x),photoActions:ie,uiActions:q}),Re?.kind==="save"&&e.jsx(Ac,{dir:p,searchText:Me,query:L,topK:A,onClose:()=>be(null),setSelectedView:x=>ke(x),photoActions:ie,uiActions:q}),Re?.kind==="collect"&&e.jsx(Uc,{selected:Se,dir:p,collections:ne,onClose:()=>be(null),setToast:Ye,photoActions:ie,uiActions:q}),Re?.kind==="removeCollect"&&e.jsx(Hc,{selected:Se,dir:p,collections:ne,onClose:()=>be(null),setToast:Ye,photoActions:ie,uiActions:q}),Ee!==null&&J&&J[Ee]&&(qe.isVideoFile(J[Ee].path)?e.jsx(Hl,{videoPath:J[Ee].path,videoUrl:`/api/media/${encodeURIComponent(J[Ee].path)}`,onPrevious:()=>Ae(-1),onNext:()=>Ae(1),onClose:()=>ct(null)}):e.jsx(Bl,{dir:p,engine:w,path:J[Ee].path,onPrev:()=>Ae(-1),onNext:()=>Ae(1),onClose:()=>ct(null),onReveal:async()=>{try{const{apiOpen:x}=await ye(async()=>{const{apiOpen:P}=await Promise.resolve().then(()=>ve);return{apiOpen:P}},void 0,import.meta.url),b=J&&Ee!==null?J[Ee]?.path:void 0;b&&await x(p,b)}catch{}},onFavorite:async()=>{try{const x=J&&Ee!==null?J[Ee]?.path:void 0;x&&(await kt(p,x,!X.includes(x)),await Qe())}catch{}},onMoreLikeThis:async()=>{try{const{apiSearchLike:x}=await ye(async()=>{const{apiSearchLike:z}=await Promise.resolve().then(()=>ve);return{apiSearchLike:z}},void 0,import.meta.url),b=J&&Ee!==null?J[Ee]?.path:void 0;if(!b)return;q.setBusy("Searching similar");const P=await x(p,b,w,A);ie.setResults(P.results||[]),ke("results")}catch(x){q.setNote(x instanceof Error?x.message:"Search failed")}finally{q.setBusy("")}}})),e.jsx("button",{type:"button",onClick:()=>be({kind:"jobs"}),className:"fixed bottom-4 right-4 bg-blue-600 text-white rounded-full shadow px-4 py-2",title:"Open Jobs","aria-label":"Open the jobs panel",children:"Jobs"}),Re?.kind==="jobs"&&e.jsx(ec,{open:!0,onClose:()=>be(null)}),Re?.kind==="advanced"&&e.jsx(Ec,{open:!0,onClose:()=>be(null),onApply:x=>{bt(x),Va(x),be(null)},onSave:async(x,b)=>{try{const{apiAddPreset:P}=await ye(async()=>{const{apiAddPreset:z}=await Promise.resolve().then(()=>ve);return{apiAddPreset:z}},void 0,import.meta.url);await P(p,x,b),Ye({message:`Saved preset ${x}`}),await wt()}catch(P){q.setNote(P instanceof Error?P.message:"Save failed")}},allTags:V||[],cameras:$s?.cameras||[],people:(ge||[]).filter(x=>x.name).map(x=>String(x.name))}),e.jsx(Wc,{isOpen:zn,onClose:()=>tt(!1),initialSection:"getting-started"}),e.jsx(Zc,{isOpen:ai,onClose:()=>za(!1)}),!!U&&e.jsx("div",{className:"fixed inset-0 z-[1050] bg-black/40 flex items-center justify-center",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-sm",children:[e.jsx(Cn,{size:"lg",message:U,className:"text-center"}),pe&&e.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300 text-center",children:pe})]})}),vt&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-[1070]",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"flex items-center gap-3 bg-gray-900 text-white px-4 py-2 rounded shadow",children:[e.jsx("span",{className:"text-sm",children:vt.message}),vt.actionLabel&&vt.onAction&&e.jsx("button",{type:"button",className:"text-sm underline",onClick:vt.onAction,children:vt.actionLabel}),e.jsx("button",{type:"button","aria-label":"Close notification",className:"ml-1",onClick:()=>{Ye(null),Xt.current&&(window.clearTimeout(Xt.current),Xt.current=null)},children:""})]})}),e.jsx(lc,{photoCount:se?.length||0,indexedCount:se?.length||0,searchProvider:w,isIndexing:Ot,isConnected:!0,currentDirectory:p,activeJobs:Ms.filter(x=>x.status==="running").length}),e.jsx(cc,{jobs:Ms,onPause:x=>{Ke(b=>b.map(P=>P.id===x?{...P,status:"paused"}:P))},onResume:x=>{Ke(b=>b.map(P=>P.id===x?{...P,status:"running"}:P))},onCancel:x=>{Ke(b=>b.map(P=>P.id===x?{...P,status:"cancelled"}:P))},onRetry:x=>{Ke(b=>b.map(P=>P.id===x?{...P,status:"queued"}:P))},onClear:x=>{Ke(b=>b.filter(P=>P.id!==x))},onClearAll:()=>{Ke(x=>x.filter(b=>b.status==="running"||b.status==="queued"))}}),e.jsx(Cc,{activeTab:Hn,onTabChange:x=>{switch(Vn(x),x){case"home":ke("library");break;case"search":ke("results");break;case"favorites":ke("results"),ie.setFavOnly(!0);break;case"settings":ke("tasks");break}},onShowFilters:()=>Dt(!0),onShowUpload:()=>be({kind:"folder"}),onShowLibrary:()=>be({kind:"folder"}),showSecondaryActions:!0})]}),e.jsx(ic,{isVisible:ci,onDismiss:()=>Ua(!1),context:fe,userActions:Lt}),e.jsx(oc,{isVisible:di,onComplete:()=>{Ba(!1);try{localStorage.setItem("onboardingComplete","true")}catch{}},completedSteps:oi,inProgressStepId:Ot?"index_photos":void 0,onStepComplete:()=>{},onStepAction:x=>{switch(x){case"select_directory":{ke("library"),be({kind:"folder"});break}case"index_photos":{ke("library"),p?Nt():be({kind:"folder"});break}case"first_search":{ke("results"),Ye({message:"Try searching: beach sunset, birthday cake, mountain hike"});break}case"explore_features":{ke("collections"),Ye({message:"Explore collections, favorites, and sharing"});break}}}}),e.jsx(Pn,{})]}),u&&e.jsx(ed,{isOpen:u,onClose:()=>c(!1),onSettingsChange:qn}),l&&e.jsx(sd,{isActive:l,onComplete:Wn,onSkip:()=>d(!1)})]})})})})})}const gd=({darkMode:s=!1,onDarkModeToggle:t})=>{const[a,r]=o.useState("library"),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState(new Set),[g,y]=o.useState(!1),[j,k]=o.useState(null),[v,f]=o.useState(null),[p,w]=o.useState(!1),[T,h]=o.useState(!1),[m,C]=o.useState(0),[I,E]=o.useState("medium"),[S,N]=o.useState(!1),D=o.useRef(null);o.useEffect(()=>{_()},[]),o.useEffect(()=>{v&&Q()},[v]);const _=async()=>{try{const L=await ja();console.log("Workspace loaded:",L)}catch(L){console.error("Failed to load workspace:",L)}},Q=async()=>{if(v){y(!0),k(null);try{console.log("Loading library from:",v);const L=await Yt(v);if(!L||!L.images)throw new Error("No images found in the selected folder");const X=L.images.map((le,A)=>({id:`photo-${A}`,path:le,thumbnail:Fe(le),title:le.split("/").pop()?.split(".")[0]||"Untitled",date:new Date().toLocaleDateString(),type:le.split(".").pop()?.toLowerCase()}));c(X),k(null),console.log(`Loaded ${X.length} photos`)}catch(L){console.error("Failed to load library:",L),k(L.message||"Failed to load photos from the selected folder"),c([])}finally{y(!1)}}},M=async L=>{if(L.preventDefault(),!!n.trim()){y(!0);try{const X=await Ss(n,20);if(X&&X.results){const le=X.results.map((A,K)=>({id:`search-${K}`,path:A.image,thumbnail:Fe(A.image),title:A.image.split("/").pop()?.split(".")[0],score:A.score}));c(le)}}catch(X){console.error("Search failed:",X)}finally{y(!1)}}},H=async()=>{if(window.electronAPI)try{const L=await window.electronAPI.selectFolder();L&&await F(L)}catch(L){console.error("Failed to select folder:",L)}else D.current?.click()},$=async L=>{const X=L.target.files;if(X&&X.length>0){const le=X[0].webkitRelativePath?.split("/")[0];if(le){const A=`/Users/pranay/Desktop/${le}`;await F(A)}}},F=async L=>{try{console.log("Adding path:",L),await xt(L),f(L),k(null)}catch(X){console.error("Failed to add path:",X),k("Failed to add the selected folder")}},V=L=>{const X=new Set(l);X.has(L.id)?X.delete(L.id):X.add(L.id),d(X)},Y=L=>{C(L),h(!0)},O=[{id:"library",label:"Library",icon:gt},{id:"memories",label:"Memories",icon:Gt},{id:"people",label:"People",icon:Xe},{id:"places",label:"Places",icon:la},{id:"recent",label:"Recent",icon:Pt}],J=a==="memories"?u.filter(L=>L.favorite):u;return e.jsxs("div",{className:`flex h-screen ${s?"dark":""}`,style:{background:"var(--bg-primary)"},children:[e.jsxs("div",{className:`sidebar ${S?"w-16":""}`,style:{width:S?"64px":"260px"},children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[!S&&e.jsx("h1",{className:"text-title",style:{fontSize:"1.25rem",fontWeight:600},children:"Photos"}),e.jsx("button",{onClick:()=>N(!S),className:"btn-ghost",style:{padding:"8px"},children:S?e.jsx(Tt,{size:18}):e.jsx(ls,{size:18})})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[!S&&e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"LIBRARY"}),O.map(L=>{const X=L.icon;return e.jsxs("div",{onClick:()=>r(L.id),className:`nav-item ${a===L.id?"active":""}`,style:{justifyContent:S?"center":"flex-start",padding:S?"12px":"10px 16px"},children:[e.jsx(X,{size:20}),!S&&e.jsx("span",{children:L.label})]},L.id)})]}),!S&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"ALBUMS"}),e.jsxs("div",{className:"nav-item",children:[e.jsx(er,{size:20}),e.jsx("span",{children:"All Albums"})]}),e.jsxs("div",{className:"nav-item",children:[e.jsx(Vt,{size:20}),e.jsx("span",{children:"Favorites"})]})]})]}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid var(--border-subtle)"},children:[e.jsx("button",{onClick:H,className:"btn btn-primary",style:{width:"100%",justifyContent:"center",fontSize:S?"0":"14px",padding:S?"12px":"10px 16px"},children:S?e.jsx(mt,{size:20}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{size:18}),e.jsx("span",{children:"Import Photos"})]})}),e.jsx("input",{ref:D,type:"file",webkitdirectory:"",directory:"",multiple:!0,onChange:$,style:{display:"none"}}),!S&&e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[e.jsx("button",{onClick:()=>w(!p),className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:e.jsx(lt,{size:18})}),e.jsx("button",{onClick:t,className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:s?e.jsx(fs,{size:18}):e.jsx(ia,{size:18})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",style:{background:"var(--bg-primary)"},children:[e.jsx("header",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-subtle)",background:"var(--bg-primary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("form",{onSubmit:M,className:"search-bar",style:{maxWidth:"500px"},children:[e.jsx(Ie,{size:18,style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)",color:"var(--text-tertiary)"}}),e.jsx("input",{type:"text",value:n,onChange:L=>i(L.target.value),placeholder:"Search photos...",className:"search-input"})]}),e.jsxs("div",{className:"flex items-center gap-12px",children:[l.size>0&&e.jsxs("div",{className:"flex items-center gap-8px",style:{marginRight:"16px"},children:[e.jsxs("span",{className:"text-caption",style:{color:"var(--text-secondary)"},children:[l.size," selected"]}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(gs,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(He,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px",color:"var(--error)"},children:e.jsx(ot,{size:16})})]}),e.jsx("div",{className:"flex items-center gap-4px",style:{padding:"4px",background:"var(--bg-tertiary)",borderRadius:"var(--radius-md)"},children:["small","medium","large"].map(L=>e.jsx("button",{onClick:()=>E(L),style:{padding:"6px 12px",background:I===L?"var(--bg-primary)":"transparent",border:"none",borderRadius:"var(--radius-sm)",color:I===L?"var(--text-primary)":"var(--text-secondary)",fontSize:"12px",fontWeight:500,cursor:"pointer",transition:"all var(--transition-fast)"},children:L.charAt(0).toUpperCase()+L.slice(1)},L))})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto",style:{padding:"24px"},children:[g&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse",style:{marginBottom:"16px"},children:e.jsx(js,{size:48,style:{color:"var(--text-tertiary)"}})}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)"},children:"Loading photos..."})]})}),j&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",style:{maxWidth:"400px"},children:[e.jsx(ys,{size:48,style:{color:"var(--error)",marginBottom:"16px"}}),e.jsx("p",{className:"text-body",style:{color:"var(--error)",marginBottom:"24px"},children:j}),e.jsx("button",{onClick:H,className:"btn btn-primary",children:"Select Another Folder"})]})}),!g&&!j&&u.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(er,{size:64,style:{color:"var(--text-tertiary)",marginBottom:"24px"}}),e.jsx("h2",{className:"text-headline",style:{marginBottom:"12px",fontSize:"24px"},children:"No photos yet"}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)",marginBottom:"32px"},children:"Import your photos to get started"}),e.jsxs("button",{onClick:H,className:"btn btn-primary",style:{fontSize:"16px",padding:"12px 32px"},children:[e.jsx(mt,{size:20}),"Select Photo Folder"]})]})}),!g&&!j&&u.length>0&&e.jsx("div",{className:"photo-grid",style:{gridTemplateColumns:I==="small"?"repeat(auto-fill, minmax(150px, 1fr))":I==="large"?"repeat(auto-fill, minmax(300px, 1fr))":"repeat(auto-fill, minmax(200px, 1fr))",gap:I==="small"?"4px":"8px"},children:J.map((L,X)=>e.jsxs("div",{className:"photo-item",onClick:()=>Y(X),style:{borderRadius:I==="small"?"4px":"8px",position:"relative"},children:[L.thumbnail?e.jsx("img",{src:L.thumbnail,alt:L.title,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{className:"skeleton",style:{width:"100%",height:"100%"}}),e.jsx("div",{onClick:le=>{le.stopPropagation(),V(L)},style:{position:"absolute",top:"8px",left:"8px",width:"24px",height:"24px",borderRadius:"50%",background:l.has(L.id)?"var(--accent-primary)":"rgba(255, 255, 255, 0.9)",border:l.has(L.id)?"none":"2px solid rgba(255, 255, 255, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",opacity:l.has(L.id)?1:0,transition:"opacity var(--transition-fast)"},className:"photo-select",children:l.has(L.id)&&e.jsx(Ct,{size:14,style:{color:"white"}})})]},L.id))})]})]}),T&&u[m]&&e.jsxs("div",{onClick:()=>h(!1),style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"var(--z-modal)"},children:[e.jsx("button",{onClick:L=>{L.stopPropagation(),h(!1)},style:{position:"absolute",top:"24px",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx($e,{size:20})}),m>0&&e.jsx("button",{onClick:L=>{L.stopPropagation(),C(m-1)},style:{position:"absolute",left:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(ls,{size:20})}),m<u.length-1&&e.jsx("button",{onClick:L=>{L.stopPropagation(),C(m+1)},style:{position:"absolute",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(Tt,{size:20})}),e.jsx("img",{src:u[m].path,alt:u[m].title,style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain"},onClick:L=>L.stopPropagation()})]}),e.jsx("style",{jsx:!0,children:`
        .photo-item:hover .photo-select {
          opacity: 1 !important;
        }
      `})]})},fd=()=>{const[s,t]=o.useState(()=>{const r=localStorage.getItem("darkMode");return r!==null?r==="true":window.matchMedia("(prefers-color-scheme: dark)").matches});o.useEffect(()=>{s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",s.toString())},[s]);const a=()=>{t(r=>!r)};return e.jsx(gd,{darkMode:s,onDarkModeToggle:a})};function bd(){return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Test App"}),e.jsx("p",{children:"This is a minimal test to see if React is working."})]})}function yd(){const[s,t]=o.useState([]),[a,r]=o.useState(null),[n,i]=o.useState("grid"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[g,y]=o.useState([]),[j,k]=o.useState(!1),v=Be();o.useEffect(()=>{f()},[]);const f=async()=>{k(!0);try{const m=await v.getCollections(),C=Object.entries(m.collections).map(([I,E])=>({name:I,paths:E,count:E.length,preview:E[0]}));t(C)}catch(m){console.error("Failed to load collections:",m)}finally{k(!1)}},p=async()=>{if(l.trim())try{await v.setCollection(l,g),await f(),c(!1),d(""),y([])}catch(m){console.error("Failed to create collection:",m)}},w=async m=>{if(confirm(`Delete collection "${m}"?`))try{await v.deleteCollection(m),await f(),a===m&&r(null)}catch(C){console.error("Failed to delete collection:",C)}},T=({collection:m})=>e.jsxs("div",{className:"collection-card",onClick:()=>r(m.name),children:[e.jsxs("div",{className:"collection-preview",children:[m.preview&&e.jsx("img",{src:v.getThumbnailUrl(m.preview),alt:m.name}),e.jsx("div",{className:"collection-overlay",children:e.jsx(gt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"collection-info",children:[e.jsx("h3",{children:m.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[m.count," items"]})]}),e.jsx("div",{className:"collection-actions",children:e.jsx("button",{onClick:C=>{C.stopPropagation(),w(m.name)},className:"btn-icon",children:e.jsx(ot,{className:"w-4 h-4"})})})]}),h=({collection:m})=>e.jsxs("div",{className:"collection-list-item",onClick:()=>r(m.name),children:[e.jsx(Tt,{className:"w-4 h-4 text-gray-400"}),e.jsx(Gs,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:m.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[m.count," items"]})]}),e.jsx("button",{onClick:C=>{C.stopPropagation(),w(m.name)},className:"btn-icon",children:e.jsx(ot,{className:"w-4 h-4"})})]});return e.jsxs("div",{className:"collections-manager",children:[e.jsxs("div",{className:"manager-header",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Collections"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{onClick:()=>i("grid"),className:n==="grid"?"active":"",children:e.jsx(gt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i("list"),className:n==="list"?"active":"",children:e.jsx(Cr,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary",children:[e.jsx(yr,{className:"w-4 h-4"}),"New Collection"]})]})]}),u&&e.jsxs("div",{className:"create-collection-panel",children:[e.jsx("input",{type:"text",placeholder:"Collection name...",value:l,onChange:m=>d(m.target.value),className:"input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"btn btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>{c(!1),d("")},className:"btn btn-secondary",children:"Cancel"})]})]}),j?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading collections..."})]}):e.jsx("div",{className:n==="grid"?"collections-grid":"collections-list",children:s.map(m=>n==="grid"?e.jsx(T,{collection:m},m.name):e.jsx(h,{collection:m},m.name))}),e.jsx("style",{jsx:!0,children:`
        .collections-manager {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .manager-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .view-toggle {
          display: flex;
          gap: 0.25rem;
          padding: 0.25rem;
          background: var(--bg-tertiary);
          border-radius: var(--radius-md);
        }

        .view-toggle button {
          padding: 0.5rem;
          background: transparent;
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .view-toggle button.active {
          background: var(--bg-primary);
          color: var(--accent-primary);
        }

        .create-collection-panel {
          background: var(--bg-secondary);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          margin-bottom: 2rem;
          display: flex;
          gap: 1rem;
          align-items: center;
        }

        .collections-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 1.5rem;
        }

        .collection-card {
          background: var(--bg-elevated);
          border-radius: var(--radius-lg);
          overflow: hidden;
          cursor: pointer;
          transition: all 0.3s;
        }

        .collection-card:hover {
          transform: translateY(-4px);
          box-shadow: var(--shadow-lg);
        }

        .collection-preview {
          position: relative;
          aspect-ratio: 1;
          background: var(--bg-tertiary);
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .collection-preview img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .collection-overlay {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.5);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-sm);
        }

        .collection-info {
          padding: 1rem;
        }

        .collection-info h3 {
          font-weight: 600;
          margin-bottom: 0.25rem;
        }

        .collection-actions {
          padding: 0 1rem 1rem;
          display: flex;
          gap: 0.5rem;
        }

        .collections-list {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .collection-list-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-elevated);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .collection-list-item:hover {
          background: var(--bg-tertiary);
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--error);
          color: white;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 300px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function vd(){const[s,t]=o.useState([]),[a,r]=o.useState(null),[n,i]=o.useState(null),[u,c]=o.useState(""),[l,d]=o.useState(!1),[g,y]=o.useState(!1),[j,k]=o.useState({totalFaces:0,namedPeople:0}),v=Be();o.useEffect(()=>{f()},[]);const f=async()=>{d(!0);try{const h=await v.getFaceClusters();t(h.clusters);const m=h.clusters.reduce((I,E)=>I+E.size,0),C=h.clusters.filter(I=>I.name).length;k({totalFaces:m,namedPeople:C})}catch(h){console.error("Failed to load face clusters:",h)}finally{d(!1)}},p=async()=>{y(!0);try{const h=await v.buildFaces();console.log(`Built faces: ${h.faces} faces in ${h.clusters} clusters`),await f()}catch(h){console.error("Failed to build face index:",h)}finally{y(!1)}},w=async h=>{if(u.trim())try{await v.nameFaceCluster(h,u),await f(),i(null),c("")}catch(m){console.error("Failed to name cluster:",m)}},T=({cluster:h})=>e.jsxs("div",{className:`face-cluster-card ${a===h.id?"selected":""}`,onClick:()=>r(h.id),children:[e.jsx("div",{className:"cluster-header",children:n===h.id?e.jsxs("div",{className:"name-editor",children:[e.jsx("input",{type:"text",value:u,onChange:m=>c(m.target.value),placeholder:"Enter name...",className:"name-input",autoFocus:!0,onClick:m=>m.stopPropagation()}),e.jsx("button",{onClick:m=>{m.stopPropagation(),w(h.id)},className:"btn-icon",children:e.jsx(Ct,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),i(null),c("")},className:"btn-icon",children:e.jsx($e,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"cluster-name",children:h.name||`Person ${h.id.slice(0,8)}`}),e.jsx("button",{onClick:m=>{m.stopPropagation(),i(h.id),c(h.name||"")},className:"btn-icon",children:e.jsx(Zi,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"cluster-stats",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[h.size," photos"]})}),e.jsx("div",{className:"face-examples",children:h.examples.slice(0,4).map(([m,C],I)=>e.jsx("div",{className:"face-thumbnail",children:e.jsx("img",{src:v.getFaceThumbnailUrl(m,C,96),alt:`Face ${I+1}`})},I))})]});return e.jsxs("div",{className:"face-detection",children:[e.jsxs("div",{className:"detection-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Xe,{className:"w-6 h-6"}),"People"]}),e.jsxs("p",{className:"text-gray-500 mt-1",children:[j.totalFaces," faces detected  ",j.namedPeople," people identified"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:p,disabled:g,className:"btn btn-secondary",children:[e.jsx(na,{className:`w-4 h-4 ${g?"animate-spin":""}`}),g?"Building...":"Rebuild Index"]})})]}),l?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading faces..."})]}):s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Xe,{className:"w-16 h-16 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mt-4",children:"No faces detected yet"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Build the face index to detect and group people in your photos"}),e.jsxs("button",{onClick:p,disabled:g,className:"btn btn-primary mt-4",children:[e.jsx(Xi,{className:"w-4 h-4"}),"Build Face Index"]})]}):e.jsx("div",{className:"clusters-grid",children:s.map(h=>e.jsx(T,{cluster:h},h.id))}),e.jsx("style",{jsx:!0,children:`
        .face-detection {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .detection-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .clusters-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 1.5rem;
        }

        .face-cluster-card {
          background: var(--bg-elevated);
          border: 2px solid transparent;
          border-radius: var(--radius-lg);
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.3s;
        }

        .face-cluster-card:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .face-cluster-card.selected {
          border-color: var(--accent-primary);
          box-shadow: 0 0 0 3px var(--accent-light);
        }

        .cluster-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.5rem;
        }

        .cluster-name {
          font-size: 1.125rem;
          font-weight: 600;
        }

        .name-editor {
          display: flex;
          gap: 0.5rem;
          width: 100%;
        }

        .name-input {
          flex: 1;
          padding: 0.25rem 0.5rem;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-sm);
          background: var(--bg-primary);
          font-size: 1rem;
        }

        .cluster-stats {
          margin-bottom: 1rem;
        }

        .face-examples {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 0.5rem;
        }

        .face-thumbnail {
          aspect-ratio: 1;
          border-radius: var(--radius-md);
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .face-thumbnail img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          text-align: center;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .animate-spin {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function jd(){const[s,t]=o.useState("library"),[a,r]=o.useState(null),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState([]),[g,y]=o.useState([]),[j,k]=o.useState([]),[v,f]=o.useState("/Users/pranay/Desktop"),[p,w]=o.useState(null),[T,h]=o.useState(!1),[m,C]=o.useState({});o.useEffect(()=>{const M={dir:v,provider:"openai",openaiKey:localStorage.getItem("openai_api_key")||"",hfToken:localStorage.getItem("hf_token")||""};Ol(M),I()},[v]);const I=async()=>{const M=Be();try{const H=await M.getWorkspace();k(H.folders),await E();const $=await M.getFavorites();y($.favorites)}catch(H){console.error("Failed to load initial data:",H)}},E=async()=>{h(!0);try{const H=await Be().getLibrary(120,0);d(H.paths)}catch(M){console.error("Failed to load library:",M)}finally{h(!1)}},S=async()=>{if(n.trim()){h(!0);try{const H=await Be().search(n,24);c(H.results),t("search")}catch(M){console.error("Search failed:",M)}finally{h(!1)}}},N=async M=>{h(!0);const H=Be();try{let $;switch(M){case"search":$=await H.buildIndex(32),console.log(`Indexed ${$.total} images`);break;case"faces":$=await H.buildFaces(),console.log(`Found ${$.faces} faces in ${$.clusters} clusters`);break;case"ocr":$=await H.buildOCR(["en"]),console.log(`Extracted text from ${$.updated} images`);break;case"metadata":$=await H.buildMetadata(),console.log(`Extracted metadata from ${$.updated} images`);break;case"captions":$=await H.buildCaptions("Salesforce/blip-image-captioning-large"),console.log(`Generated captions for ${$.updated} images`);break;case"trips":$=await H.buildTrips(),console.log(`Found ${$.trips.length} trips`);break;case"fast-annoy":$=await H.buildFastIndex("annoy");break;case"fast-faiss":$=await H.buildFastIndex("faiss");break;case"fast-hnsw":$=await H.buildFastIndex("hnsw");break}await E()}catch($){console.error(`Failed to build ${M} index:`,$)}finally{h(!1)}},D=async()=>{const M=prompt("Enter folder path:");if(M)try{const $=await Be().addToWorkspace(M);k($.folders)}catch(H){console.error("Failed to add workspace folder:",H)}},_=async()=>{h(!0);try{const H=await Be().runDiagnostics();w(H),t("diagnostics")}catch(M){console.error("Failed to run diagnostics:",M)}finally{h(!1)}},Q=()=>{switch(s){case"collections":return e.jsx(yd,{});case"people":return e.jsx(vd,{});case"editor":return a?e.jsx(Sn,{imagePath:a,onClose:()=>t("library"),onSave:M=>console.log("Saved:",M)}):null;case"search":return e.jsxs("div",{className:"search-results",children:[e.jsxs("h2",{children:['Search Results for "',n,'"']}),e.jsx("div",{className:"photo-grid",children:u.map((M,H)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(M.path),t("editor")},children:[e.jsx("img",{src:Be().getThumbnailUrl(M.path),alt:""}),e.jsx("div",{className:"photo-score",children:M.score.toFixed(2)})]},H))})]});case"library":return e.jsxs("div",{className:"library-view",children:[e.jsxs("div",{className:"library-header",children:[e.jsx("h2",{children:"Photo Library"}),e.jsxs("span",{className:"text-gray-500",children:[l.length," photos"]})]}),e.jsx("div",{className:"photo-grid",children:l.map((M,H)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(M),t("editor")},children:[e.jsx("img",{src:Be().getThumbnailUrl(M),alt:""}),g.includes(M)&&e.jsx("div",{className:"favorite-badge",children:e.jsx(Vt,{className:"w-4 h-4",fill:"currentColor"})})]},H))})]});case"diagnostics":return e.jsxs("div",{className:"diagnostics-view",children:[e.jsx("h2",{children:"System Diagnostics"}),p&&e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Storage"}),e.jsxs("p",{children:[p.free_gb.toFixed(2)," GB free"]}),e.jsxs("p",{children:["OS: ",p.os]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Indexes"}),p.engines.map(M=>e.jsxs("div",{children:[e.jsxs("p",{children:[M.key,": ",M.count," items"]}),M.fast&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Fast: Annoy=",M.fast.annoy?"":"","FAISS=",M.fast.faiss?"":"","HNSW=",M.fast.hnsw?"":""]})]},M.key))]})]})]});default:return null}};return e.jsxs("div",{className:"app-container",children:[e.jsxs("div",{className:"sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h1",{className:"text-xl font-bold",children:"PhotoVault Pro"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All 47 APIs Integrated"})]}),e.jsx("div",{className:"search-section",children:e.jsx("input",{type:"text",placeholder:"Search photos...",value:n,onChange:M=>i(M.target.value),onKeyPress:M=>M.key==="Enter"&&S(),className:"search-input"})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:`nav-item ${s==="library"?"active":""}`,onClick:()=>t("library"),children:[e.jsx(eo,{className:"w-5 h-5"}),"Library"]}),e.jsxs("div",{className:`nav-item ${s==="collections"?"active":""}`,onClick:()=>t("collections"),children:[e.jsx(gt,{className:"w-5 h-5"}),"Collections"]}),e.jsxs("div",{className:`nav-item ${s==="people"?"active":""}`,onClick:()=>t("people"),children:[e.jsx(Xe,{className:"w-5 h-5"}),"People"]}),e.jsxs("div",{className:`nav-item ${s==="places"?"active":""}`,onClick:()=>t("places"),children:[e.jsx(aa,{className:"w-5 h-5"}),"Places"]}),e.jsxs("div",{className:`nav-item ${s==="favorites"?"active":""}`,onClick:()=>t("favorites"),children:[e.jsx(Vt,{className:"w-5 h-5"}),"Favorites"]}),e.jsxs("div",{className:`nav-item ${s==="trips"?"active":""}`,onClick:()=>t("trips"),children:[e.jsx(la,{className:"w-5 h-5"}),"Trips"]})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsx("h3",{className:"section-title",children:"Build Indexes"}),e.jsxs("button",{onClick:()=>N("search"),className:"index-btn",children:[e.jsx(Ht,{className:"w-4 h-4"}),"Search Index"]}),e.jsxs("button",{onClick:()=>N("faces"),className:"index-btn",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Face Detection"]}),e.jsxs("button",{onClick:()=>N("ocr"),className:"index-btn",children:[e.jsx(Er,{className:"w-4 h-4"}),"OCR Text"]}),e.jsxs("button",{onClick:()=>N("metadata"),className:"index-btn",children:[e.jsx(is,{className:"w-4 h-4"}),"Metadata"]}),e.jsxs("button",{onClick:()=>N("captions"),className:"index-btn",children:[e.jsx(Pr,{className:"w-4 h-4"}),"AI Captions"]})]}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsxs("button",{onClick:_,className:"nav-item",children:[e.jsx(ea,{className:"w-5 h-5"}),"Diagnostics"]}),e.jsxs("button",{onClick:D,className:"nav-item",children:[e.jsx(Ge,{className:"w-5 h-5"}),"Add Folder"]})]})]}),e.jsxs("main",{className:"main-content",children:[T&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),Q()]}),e.jsx("style",{jsx:!0,children:`
        .app-container {
          display: flex;
          height: 100vh;
          background: var(--bg-primary);
        }

        .main-content {
          flex: 1;
          overflow-y: auto;
          position: relative;
        }

        .search-section {
          padding: 1rem;
        }

        .sidebar-section {
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .section-title {
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.75rem;
          text-transform: uppercase;
          letter-spacing: 0.05em;
        }

        .index-btn {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          width: 100%;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-md);
          font-size: 0.875rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .index-btn:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .sidebar-footer {
          margin-top: auto;
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .library-view, .search-results, .diagnostics-view {
          padding: 2rem;
        }

        .library-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .library-header h2 {
          font-size: 2rem;
          font-weight: 700;
        }

        .photo-item {
          position: relative;
        }

        .photo-score {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: var(--radius-sm);
          font-size: 0.75rem;
        }

        .favorite-badge {
          position: absolute;
          top: 0.5rem;
          right: 0.5rem;
          background: var(--warning);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-full);
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 1.5rem;
        }

        .stat-card {
          background: var(--bg-elevated);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          border: 1px solid var(--border-subtle);
        }

        .stat-card h3 {
          font-size: 1.125rem;
          font-weight: 600;
          margin-bottom: 1rem;
        }

        .loading-overlay {
          position: absolute;
          inset: 0;
          background: rgba(255, 255, 255, 0.9);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 100;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}const wd=o.createContext(null);function Nd({children:s}){const t=yn(),[a,r]=o.useState(""),[n,i]=o.useState([]),[u,c]=o.useState({favOnly:!1}),l=o.useCallback(j=>{c(k=>({...k,...j}))},[]),d=o.useCallback(j=>{i(j);try{t?.setResults?.(j)}catch{}},[t]),g=o.useCallback(j=>{r(j);try{t?.setQuery?.(j)}catch{}},[t]),y=o.useMemo(()=>({state:{query:a,results:n,filters:u},actions:{setQuery:g,setResults:d,setFilters:l}}),[a,n,u,g,d,l]);return e.jsx(wd.Provider,{value:y,children:s})}const kd=o.createContext(null);function Sd({children:s}){const t=gn()||[],a=!!fn(),[r,n]=o.useState(!1),i=bn(),u=o.useCallback(async d=>{const g=d?.dir||i?.state?.dir,y=d?.provider||i?.state?.engine||"local";if(g)try{n(!0),await Wt(g,y)}finally{n(!1)}},[i]),c=o.useCallback(async d=>{const g=d?.dir||i?.state?.dir,y=d?.provider||i?.state?.engine||"local";g&&await Yt(g,y,d?.limit??120,d?.offset??0)},[i]),l=o.useMemo(()=>({state:{paths:t,hasMore:a,isIndexing:r},actions:{index:u,load:c}}),[t,a,r,u,c]);return e.jsx(kd.Provider,{value:l,children:s})}const Cd=o.createContext(null);function Td({children:s}){const[t,a]=o.useState("local"),[r,n]=o.useState(!1),[i,u]=o.useState("faiss"),[c,l]=o.useState(!1),[d,g]=o.useState(!1),[y,j]=o.useState(60),k=o.useMemo(()=>({state:{engine:t,useFast:r,fastKind:i,useCaptions:c,useOcr:d,topK:y},actions:{setEngine:a,setUseFast:n,setFastKind:u,setUseCaptions:l,setUseOcr:g,setTopK:j}}),[t,r,i,c,d,y]);return e.jsx(Cd.Provider,{value:k,children:s})}function Ed({children:s}){return e.jsx($o,{children:e.jsx(Bo,{children:e.jsx(Td,{children:e.jsx(yc,{children:e.jsx(Sd,{children:e.jsx(Nd,{children:s})})})})})})}const Pd={};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(s=>{console.log("ServiceWorker registered:",s.scope),setInterval(()=>{s.update()},6e4),s.addEventListener("updatefound",()=>{const t=s.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&confirm("New version available! Refresh to update?")&&window.location.reload()})})}).catch(s=>{console.error("ServiceWorker registration failed:",s)})});window.addEventListener("beforeinstallprompt",s=>{s.preventDefault(),console.log("App can be installed")});function Id(){const t=new URLSearchParams(window.location.search).get("ui")??Pd?.VITE_UI??"modern";return t==="test"?e.jsx(bd,{}):t==="new"?e.jsx(fd,{}):t==="modular"?e.jsx(jd,{}):e.jsx(pd,{})}$r(document.getElementById("root")).render(e.jsx(Ed,{children:Id()}));
