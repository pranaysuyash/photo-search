var _n=Object.defineProperty;var On=(a,t,s)=>t in a?_n(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var oe=(a,t,s)=>On(a,typeof t!="symbol"?t+"":t,s);import{j as e,P as qe,H as Gt,S as Kt,D as _e,R as ks,A as Rn,a as Ln,b as An,c as Un,C as zn,M as Ua,d as Bn,X as Ce,e as Ss,f as ys,g as Nt,h as ot,i as Yt,k as ga,l as fa,V as qn,m as Vn,I as Qt,n as Hn,o as Wn,p as za,F as vs,G as Gn,T as lt,q as Ze,r as Jt,s as Kn,W as Yn,L as Qn,t as Ba,u as qa,U as it,v as Ee,w as Xt,x as Jn,y as St,z as Ct,B as ct,E as Cs,J as Va,K as Xn,N as Ha,O as Ts,Q as Bt,Y as Wa,Z as js,_ as Zn,$ as Ga,a0 as ei,a1 as Es,a2 as Ka,a3 as Ps,a4 as ti,a5 as dt,a6 as Ve,a7 as Is,a8 as Ya,a9 as si,aa as ai,ab as ri,ac as Qa,ad as Fs,ae as Ja,af as ba,ag as ni,ah as ii,ai as oi,aj as Xa,ak as Pt,al as qt,am as li,an as ci,ao as ya,ap as va,aq as di,ar as ja,as as ui,at as hi,au as mi,av as xi,aw as Za,ax as pi,ay as wa,az as er,aA as Na,aB as gi,aC as fi,aD as bi,aE as yi,aF as vi}from"./ui-BIpiSasV.js";import{a as ji,r as o,b as wi,R as et}from"./vendor-DfJzhmxv.js";import{c as tr}from"./utils-0qZyvErh.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var sr,ka=ji;sr=ka.createRoot,ka.hydrateRoot;const Ni="modulepreload",ki=function(a,t){return new URL(a,t).href},Sa={},he=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){const u=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");n=Promise.allSettled(s.map(d=>{if(d=ki(d,r),d in Sa)return;Sa[d]=!0;const p=d.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(!!r)for(let T=u.length-1;T>=0;T--){const f=u[T];if(f.href===d&&(!p||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${y}`))return;const w=document.createElement("link");if(w.rel=p?"stylesheet":Ni,p||(w.as="script"),w.crossOrigin="",w.href=d,l&&w.setAttribute("nonce",l),document.head.appendChild(w),p)return new Promise((T,f)=>{w.addEventListener("load",T),w.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(u){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=u,window.dispatchEvent(c),!c.defaultPrevented)throw u}return n.then(u=>{for(const c of u||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})};function Si(a,t){const[s]=o.useState(()=>{let r=null;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{a(...n),r=null},t)}});return s}function Ci(a,t=300){const[s,r]=o.useState(a);return o.useEffect(()=>{if(a.length<=2){r(a);return}const n=setTimeout(()=>{r(a)},t);return()=>{clearTimeout(n)}},[a,t]),s}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Tt(){return Tt=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},Tt.apply(this,arguments)}var Je;(function(a){a.Pop="POP",a.Push="PUSH",a.Replace="REPLACE"})(Je||(Je={}));const Ca="popstate";function Ti(a){a===void 0&&(a={});function t(n,i){let{pathname:u="/",search:c="",hash:l=""}=It(n.location.hash.substr(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),ws("",{pathname:u,search:c,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){let u=n.document.querySelector("base"),c="";if(u&&u.getAttribute("href")){let l=n.location.href,d=l.indexOf("#");c=d===-1?l:l.slice(0,d)}return c+"#"+(typeof i=="string"?i:ar(i))}function r(n,i){Ei(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return Ii(t,s,r,a)}function De(a,t){if(a===!1||a===null||typeof a>"u")throw new Error(t)}function Ei(a,t){if(!a){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Pi(){return Math.random().toString(36).substr(2,8)}function Ta(a,t){return{usr:a.state,key:a.key,idx:t}}function ws(a,t,s,r){return s===void 0&&(s=null),Tt({pathname:typeof a=="string"?a:a.pathname,search:"",hash:""},typeof t=="string"?It(t):t,{state:s,key:t&&t.key||r||Pi()})}function ar(a){let{pathname:t="/",search:s="",hash:r=""}=a;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function It(a){let t={};if(a){let s=a.indexOf("#");s>=0&&(t.hash=a.substr(s),a=a.substr(0,s));let r=a.indexOf("?");r>=0&&(t.search=a.substr(r),a=a.substr(0,r)),a&&(t.pathname=a)}return t}function Ii(a,t,s,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:i=!1}=r,u=n.history,c=Je.Pop,l=null,d=p();d==null&&(d=0,u.replaceState(Tt({},u.state,{idx:d}),""));function p(){return(u.state||{idx:null}).idx}function y(){c=Je.Pop;let N=p(),b=N==null?null:N-d;d=N,l&&l({action:c,location:f.location,delta:b})}function v(N,b){c=Je.Push;let C=ws(f.location,N,b);s&&s(C,N),d=p()+1;let x=Ta(C,d),m=f.createHref(C);try{u.pushState(x,"",m)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;n.location.assign(m)}i&&l&&l({action:c,location:f.location,delta:1})}function w(N,b){c=Je.Replace;let C=ws(f.location,N,b);s&&s(C,N),d=p();let x=Ta(C,d),m=f.createHref(C);u.replaceState(x,"",m),i&&l&&l({action:c,location:f.location,delta:0})}function T(N){let b=n.location.origin!=="null"?n.location.origin:n.location.href,C=typeof N=="string"?N:ar(N);return C=C.replace(/ $/,"%20"),De(b,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,b)}let f={get action(){return c},get location(){return a(n,u)},listen(N){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(Ca,y),l=N,()=>{n.removeEventListener(Ca,y),l=null}},createHref(N){return t(n,N)},createURL:T,encodeLocation(N){let b=T(N);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:v,replace:w,go(N){return u.go(N)}};return f}var Ea;(function(a){a.data="data",a.deferred="deferred",a.redirect="redirect",a.error="error"})(Ea||(Ea={}));function Fi(a,t){if(t==="/")return a;if(!a.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,r=a.charAt(s);return r&&r!=="/"?null:a.slice(s)||"/"}function $i(a,t){t===void 0&&(t="/");let{pathname:s,search:r="",hash:n=""}=typeof a=="string"?It(a):a;return{pathname:s?s.startsWith("/")?s:Mi(s,t):t,search:Li(r),hash:Ai(n)}}function Mi(a,t){let s=t.replace(/\/+$/,"").split("/");return a.split("/").forEach(n=>{n===".."?s.length>1&&s.pop():n!=="."&&s.push(n)}),s.length>1?s.join("/"):"/"}function gs(a,t,s,r){return"Cannot include a '"+a+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Di(a){return a.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function _i(a,t){let s=Di(a);return t?s.map((r,n)=>n===s.length-1?r.pathname:r.pathnameBase):s.map(r=>r.pathnameBase)}function Oi(a,t,s,r){r===void 0&&(r=!1);let n;typeof a=="string"?n=It(a):(n=Tt({},a),De(!n.pathname||!n.pathname.includes("?"),gs("?","pathname","search",n)),De(!n.pathname||!n.pathname.includes("#"),gs("#","pathname","hash",n)),De(!n.search||!n.search.includes("#"),gs("#","search","hash",n)));let i=a===""||n.pathname==="",u=i?"/":n.pathname,c;if(u==null)c=s;else{let y=t.length-1;if(!r&&u.startsWith("..")){let v=u.split("/");for(;v[0]==="..";)v.shift(),y-=1;n.pathname=v.join("/")}c=y>=0?t[y]:"/"}let l=$i(n,c),d=u&&u!=="/"&&u.endsWith("/"),p=(i||u===".")&&s.endsWith("/");return!l.pathname.endsWith("/")&&(d||p)&&(l.pathname+="/"),l}const Ri=a=>a.join("/").replace(/\/\/+/g,"/"),Li=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Ai=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a,rr=["post","put","patch","delete"];new Set(rr);const Ui=["get",...rr];new Set(Ui);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Vt(){return Vt=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},Vt.apply(this,arguments)}const nr=o.createContext(null),$s=o.createContext(null),Ms=o.createContext(null),Ds=o.createContext({outlet:null,matches:[],isDataRoute:!1});function _s(){return o.useContext(Ms)!=null}function Os(){return _s()||De(!1),o.useContext(Ms).location}function ir(a){o.useContext($s).static||o.useLayoutEffect(a)}function or(){let{isDataRoute:a}=o.useContext(Ds);return a?Hi():zi()}function zi(){_s()||De(!1);let a=o.useContext(nr),{basename:t,future:s,navigator:r}=o.useContext($s),{matches:n}=o.useContext(Ds),{pathname:i}=Os(),u=JSON.stringify(_i(n,s.v7_relativeSplatPath)),c=o.useRef(!1);return ir(()=>{c.current=!0}),o.useCallback(function(d,p){if(p===void 0&&(p={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let y=Oi(d,JSON.parse(u),i,p.relative==="path");a==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Ri([t,y.pathname])),(p.replace?r.replace:r.push)(y,p.state,p)},[t,r,u,i,a])}var lr=function(a){return a.UseBlocker="useBlocker",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a}(lr||{}),cr=function(a){return a.UseBlocker="useBlocker",a.UseLoaderData="useLoaderData",a.UseActionData="useActionData",a.UseRouteError="useRouteError",a.UseNavigation="useNavigation",a.UseRouteLoaderData="useRouteLoaderData",a.UseMatches="useMatches",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a.UseRouteId="useRouteId",a}(cr||{});function Bi(a){let t=o.useContext(nr);return t||De(!1),t}function qi(a){let t=o.useContext(Ds);return t||De(!1),t}function Vi(a){let t=qi(),s=t.matches[t.matches.length-1];return s.route.id||De(!1),s.route.id}function Hi(){let{router:a}=Bi(lr.UseNavigateStable),t=Vi(cr.UseNavigateStable),s=o.useRef(!1);return ir(()=>{s.current=!0}),o.useCallback(function(n,i){i===void 0&&(i={}),s.current&&(typeof n=="number"?a.navigate(n):a.navigate(n,Vt({fromRouteId:t},i)))},[a,t])}function Wi(a,t){a?.v7_startTransition,a?.v7_relativeSplatPath}function Gi(a){let{basename:t="/",children:s=null,location:r,navigationType:n=Je.Pop,navigator:i,static:u=!1,future:c}=a;_s()&&De(!1);let l=t.replace(/^\/*/,"/"),d=o.useMemo(()=>({basename:l,navigator:i,static:u,future:Vt({v7_relativeSplatPath:!1},c)}),[l,c,i,u]);typeof r=="string"&&(r=It(r));let{pathname:p="/",search:y="",hash:v="",state:w=null,key:T="default"}=r,f=o.useMemo(()=>{let N=Fi(p,l);return N==null?null:{location:{pathname:N,search:y,hash:v,state:w,key:T},navigationType:n}},[l,p,y,v,w,T,n]);return f==null?null:o.createElement($s.Provider,{value:d},o.createElement(Ms.Provider,{children:s,value:f}))}new Promise(()=>{});/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Ki="6";try{window.__reactRouterVersion=Ki}catch{}const Yi="startTransition",Pa=wi[Yi];function Qi(a){let{basename:t,children:s,future:r,window:n}=a,i=o.useRef();i.current==null&&(i.current=Ti({window:n,v5Compat:!0}));let u=i.current,[c,l]=o.useState({action:u.action,location:u.location}),{v7_startTransition:d}=r||{},p=o.useCallback(y=>{d&&Pa?Pa(()=>l(y)):l(y)},[l,d]);return o.useLayoutEffect(()=>u.listen(p),[u,p]),o.useEffect(()=>Wi(r),[r]),o.createElement(Gi,{basename:t,children:s,location:c.location,navigationType:c.action,navigator:u,future:r})}var Ia;(function(a){a.UseScrollRestoration="useScrollRestoration",a.UseSubmit="useSubmit",a.UseSubmitFetcher="useSubmitFetcher",a.UseFetcher="useFetcher",a.useViewTransitionState="useViewTransitionState"})(Ia||(Ia={}));var Fa;(function(a){a.UseFetcher="useFetcher",a.UseFetchers="useFetchers",a.UseScrollRestoration="useScrollRestoration"})(Fa||(Fa={}));const Ji={},ge=Ji?.VITE_API_BASE||typeof window<"u"&&window.location&&window.location.origin||"http://127.0.0.1:8000";async function ie(a,t){const s=await fetch(`${ge}${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(await s.text());return s.json()}async function Et(a,t,s=32,r,n){return ie("/index",{dir:a,provider:t,batch_size:s,hf_token:r,openai_key:n})}async function Xi(a,t,s,r){const n=new URLSearchParams({dir:a,provider:t});s&&n.set("hf_token",s),r&&n.set("openai_key",r);const i=await fetch(`${ge}/index/status?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function Zi(a){return ie("/index/pause",{dir:a})}async function eo(a){return ie("/index/resume",{dir:a})}async function Zt(a,t,s,r=24,n){if(!t?.trim())throw new Error("Search query cannot be empty");if(!a?.trim())throw new Error("Directory must be specified");if(r<1||r>1e3)throw new Error("Top K must be between 1 and 1000");try{const i=await ie("/search",{dir:a,provider:s,query:t,top_k:r,hf_token:n?.hfToken,openai_key:n?.openaiKey,favorites_only:n?.favoritesOnly,tags:n?.tags,date_from:n?.dateFrom,date_to:n?.dateTo,use_fast:n?.useFast,fast_kind:n?.fastKind,use_captions:n?.useCaptions,use_ocr:n?.useOcr,camera:n?.camera,iso_min:n?.isoMin,iso_max:n?.isoMax,f_min:n?.fMin,f_max:n?.fMax,flash:n?.flash,wb:n?.wb,metering:n?.metering,alt_min:n?.altMin,alt_max:n?.altMax,heading_min:n?.headingMin,heading_max:n?.headingMax,place:n?.place,has_text:n?.hasText,person:n?.person,persons:n?.persons,sharp_only:n?.sharpOnly,exclude_underexp:n?.excludeUnder,exclude_overexp:n?.excludeOver});try{const{searchHistoryService:u}=await he(async()=>{const{searchHistoryService:c}=await Promise.resolve().then(()=>Ul);return{searchHistoryService:c}},void 0,import.meta.url);u.addToHistory({query:t.trim(),timestamp:Date.now(),resultCount:i.results?.length||0,filters:{tags:n?.tags,favOnly:n?.favoritesOnly,dateFrom:n?.dateFrom,dateTo:n?.dateTo,person:n?.person,place:n?.place}})}catch(u){console.warn("Failed to save search to history:",u)}return i}catch(i){if(i instanceof Error){if(i.message.includes("network"))throw new Error("Network error: Please check your connection");if(i.message.includes("timeout"))throw new Error("Search timeout: Try a simpler query or check your connection");if(i.message.includes("401"))throw new Error("Authentication error: Please check your API keys");if(i.message.includes("403"))throw new Error("Access denied: Please check your permissions");if(i.message.includes("500"))throw new Error("Server error: Please try again later")}throw i}}async function dr(a,t,s,r=24,n,i=.5){return ie("/search_like_plus",{dir:a,path:t,provider:s,top_k:r,text:n,weight:i})}async function Rs(a,t,s,r){return ie("/share",{dir:a,provider:t,paths:s,expiry_hours:r?.expiryHours??24,password:r?.password,view_only:r?.viewOnly??!0})}async function ur(a){const t=a?`${ge}/share?dir=${encodeURIComponent(a)}`:`${ge}/share`,s=await fetch(t);if(!s.ok)throw new Error(await s.text());return s.json()}async function hr(a){return ie("/share/revoke",{token:a})}async function Ls(a,t=200){const s=await fetch(`${ge}/analytics?dir=${encodeURIComponent(a)}&limit=${t}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function mr(a,t,s,r,n){return ie("/captions/build",{dir:a,vlm_model:t,provider:s,hf_token:r,openai_key:n})}async function xr(a,t,s,r,n){return ie("/feedback",{dir:a,search_id:t,query:s,positives:r,note:n})}async function As(a){const t=await fetch(`${ge}/favorites?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function kt(a,t,s){return ie("/favorites",{dir:a,path:t,favorite:s})}async function Us(a){const t=await fetch(`${ge}/saved?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function pr(a,t,s,r){return ie("/saved",{dir:a,name:t,query:s,top_k:r})}async function gr(a,t){return ie("/saved/delete",{dir:a,name:t})}async function to(a){const t=await fetch(`${ge}/presets?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function so(a,t,s){return ie("/presets",{dir:a,name:t,query:s})}async function ao(a,t){return ie("/presets/delete",{dir:a,name:t})}async function zs(a){const t=await fetch(`${ge}/map?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Bs(a,t,s,r){const n=new URLSearchParams({dir:a});t&&n.set("provider",t),r&&n.set("hf_token",r),s&&n.set("openai_key",s);const i=await fetch(`${ge}/diagnostics?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function Ft(a,t,s=120,r=0,n){const i=new URLSearchParams({dir:a,provider:t,limit:String(s),offset:String(r)});n?.hfToken&&i.set("hf_token",n.hfToken),n?.openaiKey&&i.set("openai_key",n.openaiKey);const u=await fetch(`${ge}/library?${i.toString()}`);if(!u.ok)throw new Error(await u.text());return u.json()}async function qs(a,t,s,r,n){return ie("/fast/build",{dir:a,kind:t,provider:s,hf_token:r,openai_key:n})}async function Vs(a,t,s,r,n){return ie("/ocr/build",{dir:a,provider:t,languages:s,hf_token:r,openai_key:n})}async function fr(a,t=5){const s=await fetch(`${ge}/lookalikes?dir=${encodeURIComponent(a)}&max_distance=${t}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function br(a,t){return ie("/lookalikes/resolve",{dir:a,group_paths:t})}async function Hs(){const a=await fetch(`${ge}/workspace`);if(!a.ok)throw new Error(await a.text());return a.json()}async function Xe(a){return ie("/workspace/add",{path:a})}async function yr(a){return ie("/workspace/remove",{path:a})}async function ut(a,t){const s=await fetch(`${ge}/metadata/detail?dir=${encodeURIComponent(a)}&path=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function Ws(a,t,s,r=24,n){return ie("/search_workspace",{dir:a,provider:s,query:t,top_k:r,favorites_only:n?.favoritesOnly,tags:n?.tags,date_from:n?.dateFrom,date_to:n?.dateTo,place:n?.place,has_text:n?.hasText,person:n?.person,persons:n?.persons})}async function Gs(a){const t=await fetch(`${ge}/tags?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function vr(a,t,s){return ie("/tags",{dir:a,path:t,tags:s})}function Ne(a,t,s,r=256){const n=new URLSearchParams({dir:a,provider:t,path:s,size:String(r)});return`${ge}/thumb?${n.toString()}`}function Ks(a,t,s,r,n=196){const i=new URLSearchParams({dir:a,provider:t,path:s,emb:String(r),size:String(n)});return`${ge}/thumb_face?${i.toString()}`}async function jr(a,t){return ie("/open",{dir:a,path:t})}async function wr(a,t,s){return ie("/edit/ops",{dir:a,path:t,rotate:s.rotate||0,flip:s.flip,crop:s.crop})}async function Nr(a,t,s=2,r="pil"){return ie("/edit/upscale",{dir:a,path:t,scale:s,engine:r})}async function ht(a,t,s,r="copy",n=!1,i=!1,u){return ie("/export",{dir:a,paths:t,dest:s,mode:r,strip_exif:n,overwrite:i,strip_gps:u?.stripGps,keep_copyright_only:u?.keepCopyrightOnly,preset:u?.preset,resize_long:u?.resizeLong,quality:u?.quality})}async function Ys(a,t,s,r){return ie("/metadata/build",{dir:a,provider:t,hf_token:s,openai_key:r})}async function Qs(a){const t=await fetch(`${ge}/metadata?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function kr(a,t,s,r=24){return ie("/search_like",{dir:a,path:t,provider:s,top_k:r})}async function Sr(a){const t=await fetch(`${ge}/collections?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Ht(a,t,s){return ie("/collections",{dir:a,name:t,paths:s})}async function Cr(a,t){return ie("/collections/delete",{dir:a,name:t})}async function Tr(a){const t=await fetch(`${ge}/smart_collections?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Er(a,t,s){return ie("/smart_collections",{dir:a,name:t,rules:s})}async function Pr(a,t){return ie("/smart_collections/delete",{dir:a,name:t})}async function Ir(a,t,s,r=24){return ie("/smart_collections/resolve",{dir:a,name:t,provider:s,top_k:r})}async function Fr(a,t,s=160){return ie("/ocr/snippets",{dir:a,paths:t,limit:s})}async function ro(a){const t=await fetch(`${ge}/ocr/status?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Js(a,t){return ie("/faces/build",{dir:a,provider:t})}async function Xs(a){const t=await fetch(`${ge}/faces/clusters?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Zs(a,t,s){return ie("/faces/name",{dir:a,cluster_id:t,name:s})}async function $r(a,t){return ie("/trips/build",{dir:a,provider:t})}async function Mr(a){const t=await fetch(`${ge}/trips?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function ea(){const a=await fetch(`${ge}/todo`);if(!a.ok)throw new Error(await a.text());return a.json()}async function ta(a,t){return ie("/autotag",{dir:a,provider:t})}async function sa(a,t,s){const r=await fetch(`${ge}/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:a,paths:t,os_trash:!!s})});if(!r.ok)throw new Error(await r.text());return r.json()}async function aa(a){const t=await fetch(`${ge}/undo_delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:a})});if(!t.ok)throw new Error(await t.text());return t.json()}async function Dr(a){const t=await fetch(`${ge}/videos?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function _r(a,t){const s=await fetch(`${ge}/video/metadata?dir=${encodeURIComponent(a)}&path=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}function Or(a,t,s=1,r=256){const n=new URLSearchParams({dir:a,path:t,frame_time:String(s),size:String(r)});return`${ge}/video/thumbnail?${n.toString()}`}async function Rr(a,t="local"){return ie("/videos/index",{dir:a,provider:t})}async function no(a,t,s=!1){return ie("/batch/delete",{dir:a,paths:t,os_trash:s})}async function io(a,t,s,r="add"){return ie("/batch/tag",{dir:a,paths:t,tags:s,operation:r})}async function Lr(a,t){const s=await fetch(`${ge}/faces/photos?dir=${encodeURIComponent(a)}&cluster_id=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}const pe=Object.freeze(Object.defineProperty({__proto__:null,apiAddPreset:so,apiAddSaved:pr,apiAnalytics:Ls,apiAutotag:ta,apiBatchDelete:no,apiBatchTag:io,apiBuildCaptions:mr,apiBuildFaces:Js,apiBuildFast:qs,apiBuildMetadata:Ys,apiBuildOCR:Vs,apiCreateShare:Rs,apiDelete:sa,apiDeleteCollection:Cr,apiDeletePreset:ao,apiDeleteSaved:gr,apiDeleteSmart:Pr,apiDiagnostics:Bs,apiEditOps:wr,apiExport:ht,apiFacesClusters:Xs,apiFacesName:Zs,apiFeedback:xr,apiGetCollections:Sr,apiGetFacePhotos:Lr,apiGetFavorites:As,apiGetMetadata:Qs,apiGetPresets:to,apiGetSaved:Us,apiGetSmart:Tr,apiGetTags:Gs,apiGetVideoMetadata:_r,apiIndex:Et,apiIndexPause:Zi,apiIndexResume:eo,apiIndexStatus:Xi,apiIndexVideos:Rr,apiLibrary:Ft,apiListShares:ur,apiListVideos:Dr,apiLookalikes:fr,apiMap:zs,apiMetadataDetail:ut,apiOcrSnippets:Fr,apiOcrStatus:ro,apiOpen:jr,apiResolveLookalike:br,apiResolveSmart:Ir,apiRevokeShare:hr,apiSearch:Zt,apiSearchLike:kr,apiSearchLikePlus:dr,apiSearchWorkspace:Ws,apiSetCollection:Ht,apiSetFavorite:kt,apiSetSmart:Er,apiSetTags:vr,apiTodo:ea,apiTripsBuild:$r,apiTripsList:Mr,apiUndoDelete:aa,apiUpscale:Nr,apiWorkspaceAdd:Xe,apiWorkspaceList:Hs,apiWorkspaceRemove:yr,thumbFaceUrl:Ks,thumbUrl:Ne,videoThumbnailUrl:Or},Symbol.toStringTag,{value:"Module"})),oo={settings:{dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"faiss",useCaps:!1,vlmModel:"gpt-4o",useOcr:!1,hasText:!1,useOsTrash:!1,camera:"",isoMin:0,isoMax:25600,fMin:.7,fMax:32,place:"",showInfoOverlay:!1,resultView:"grid",timelineBucket:"day",includeVideos:!0},photo:{results:[],searchId:"",query:"",topK:24,fav:[],favOnly:!1,tags:{allTags:[],tagsMap:{},tagFilter:""},saved:[],collections:{},smart:{},library:[],libHasMore:!0},ui:{busy:"",note:"",viewMode:"grid",showWelcome:!1,showHelp:!1},workspace:{workspace:"",wsToggle:!1,persons:[],clusters:[],groups:[],points:[],diag:null}},Ar=o.createContext(null),lo=({children:a})=>{const[t,s]=o.useState(oo),r=o.useCallback(c=>{s(l=>({...l,settings:{...l.settings,...c}}))},[]),n=o.useCallback(c=>{s(l=>({...l,photo:{...l.photo,...typeof c=="function"?c(l):c}}))},[]),i=o.useCallback(c=>{s(l=>({...l,ui:{...l.ui,...c}}))},[]),u=o.useCallback(c=>{s(l=>({...l,workspace:{...l.workspace,...c}}))},[]);return e.jsx(Ar.Provider,{value:{state:t,setSettings:r,setPhoto:n,setUI:i,setWorkspace:u},children:a})},ae=()=>{const a=o.useContext(Ar);if(!a)throw new Error("useSimpleStore must be used within SimpleStoreProvider");return a},co=()=>ae().state.settings.dir,uo=()=>ae().state.settings.engine,ho=()=>ae().state.settings.hfToken,mo=()=>ae().state.settings.openaiKey,xo=()=>ae().state.settings.engine.startsWith("hf"),po=()=>ae().state.settings.engine==="openai",go=()=>ae().state.settings.camera,fo=()=>ae().state.settings.isoMin,bo=()=>ae().state.settings.isoMax,yo=()=>ae().state.settings.fMin,vo=()=>ae().state.settings.fMax,jo=()=>ae().state.settings.place,wo=()=>ae().state.settings.showInfoOverlay,No=()=>ae().state.settings.useCaps,ko=()=>ae().state.settings.useOcr,So=()=>ae().state.settings.hasText,Co=()=>ae().state.settings.useFast,To=()=>ae().state.settings.fastKind,Eo=()=>ae().state.settings.useOsTrash,Po=()=>ae().state.photo.results,Io=()=>ae().state.photo.query,Fo=()=>ae().state.photo.topK,$o=()=>ae().state.photo.fav,Mo=()=>ae().state.photo.favOnly,Do=()=>ae().state.photo.tags.tagFilter,_o=()=>ae().state.photo.tags.allTags,Oo=()=>ae().state.photo.tags.tagsMap,Ro=()=>ae().state.photo.saved,Lo=()=>ae().state.photo.collections,Ao=()=>ae().state.photo.smart,Ur=()=>ae().state.photo.library,zr=()=>ae().state.photo.libHasMore,Uo=()=>ae().state.ui.busy,zo=()=>ae().state.ui.note,Bo=()=>ae().state.ui.showWelcome,qo=()=>ae().state.ui.showHelp,Vo=()=>ae().state.workspace.wsToggle,Ho=()=>ae().state.workspace.persons,Wo=()=>ae().state.workspace.clusters,Go=()=>ae().state.workspace.points,Ko=()=>ae().state.workspace.diag,Br=()=>{const{setSettings:a}=ae();return et.useMemo(()=>({setDir:t=>a({dir:t}),setEngine:t=>a({engine:t}),setHfToken:t=>a({hfToken:t}),setOpenaiKey:t=>a({openaiKey:t}),setUseFast:t=>a({useFast:t}),setFastKind:t=>a({fastKind:t}),setUseCaps:t=>a({useCaps:t}),setVlmModel:t=>a({vlmModel:t}),setUseOcr:t=>a({useOcr:t}),setHasText:t=>a({hasText:t}),setUseOsTrash:t=>a({useOsTrash:t}),setCamera:t=>a({camera:t}),setIsoMin:t=>a({isoMin:t}),setIsoMax:t=>a({isoMax:t}),setFMin:t=>a({fMin:t}),setFMax:t=>a({fMax:t}),setPlace:t=>a({place:t}),setShowInfoOverlay:t=>a({showInfoOverlay:t}),setResultView:t=>a({resultView:t}),setTimelineBucket:t=>a({timelineBucket:t}),setIncludeVideos:t=>a({includeVideos:t})}),[a])},qr=()=>{const{setPhoto:a}=ae();return et.useMemo(()=>({setResults:t=>a({results:t}),setSearchId:t=>a({searchId:t}),setQuery:t=>a({query:t}),setTopK:t=>a({topK:t}),setFavorites:t=>a({fav:t}),setFavOnly:t=>a({favOnly:t}),setAllTags:t=>a(s=>({tags:{...s.photo.tags,allTags:t}})),setTagsMap:t=>a(s=>({tags:{...s.photo.tags,tagsMap:t}})),setTagFilter:t=>a(s=>({tags:{...s.photo.tags,tagFilter:t}})),setSaved:t=>a({saved:t}),setCollections:t=>a({collections:t}),setSmart:t=>a({smart:t}),setLibrary:t=>a({library:t}),setLibHasMore:t=>a({libHasMore:t}),appendLibrary:t=>a(s=>({library:[...s.photo.library,...t]})),resetSearch:()=>a({results:[],searchId:"",query:""})}),[a])},Yo=()=>{const{setUI:a}=ae();return et.useMemo(()=>({setBusy:t=>a({busy:t}),setNote:t=>a({note:t}),setViewMode:t=>a({viewMode:t}),setShowWelcome:t=>a({showWelcome:t}),setShowHelp:t=>a({showHelp:t})}),[a])},Qo=()=>{const{setWorkspace:a}=ae();return et.useMemo(()=>({setWorkspace:t=>a({workspace:t}),setWsToggle:t=>a({wsToggle:t}),setPersons:t=>a({persons:t}),setClusters:t=>a({clusters:t}),setGroups:t=>a({groups:t}),setPoints:t=>a({points:t}),setDiag:t=>a({diag:t})}),[a])},Jo=a=>(t,s,r)=>{const n=r.subscribe;return r.subscribe=(u,c,l)=>{let d=u;if(c){const p=l?.equalityFn||Object.is;let y=u(r.getState());d=v=>{const w=u(v);if(!p(y,w)){const T=y;c(y=w,T)}},l?.fireImmediately&&c(y,y)}return n(d)},a(t,s,r)},Vr=Jo;function Xo(a,t){let s;try{s=a()}catch{return}return{getItem:n=>{var i;const u=l=>l===null?null:JSON.parse(l,void 0),c=(i=s.getItem(n))!=null?i:null;return c instanceof Promise?c.then(u):u(c)},setItem:(n,i)=>s.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>s.removeItem(n)}}const Ns=a=>t=>{try{const s=a(t);return s instanceof Promise?s:{then(r){return Ns(r)(s)},catch(r){return this}}}catch(s){return{then(r){return this},catch(r){return Ns(r)(s)}}}},Zo=(a,t)=>(s,r,n)=>{let i={storage:Xo(()=>localStorage),partialize:f=>f,version:0,merge:(f,N)=>({...N,...f}),...t},u=!1;const c=new Set,l=new Set;let d=i.storage;if(!d)return a((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...f)},r,n);const p=()=>{const f=i.partialize({...r()});return d.setItem(i.name,{state:f,version:i.version})},y=n.setState;n.setState=(f,N)=>(y(f,N),p());const v=a((...f)=>(s(...f),p()),r,n);n.getInitialState=()=>v;let w;const T=()=>{var f,N;if(!d)return;u=!1,c.forEach(C=>{var x;return C((x=r())!=null?x:v)});const b=((N=i.onRehydrateStorage)==null?void 0:N.call(i,(f=r())!=null?f:v))||void 0;return Ns(d.getItem.bind(d))(i.name).then(C=>{if(C)if(typeof C.version=="number"&&C.version!==i.version){if(i.migrate){const x=i.migrate(C.state,C.version);return x instanceof Promise?x.then(m=>[!0,m]):[!0,x]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,C.state];return[!1,void 0]}).then(C=>{var x;const[m,S]=C;if(w=i.merge(S,(x=r())!=null?x:v),s(w,!0),m)return p()}).then(()=>{b?.(w,void 0),w=r(),u=!0,l.forEach(C=>C(w))}).catch(C=>{b?.(void 0,C)})};return n.persist={setOptions:f=>{i={...i,...f},f.storage&&(d=f.storage)},clearStorage:()=>{d?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>T(),hasHydrated:()=>u,onHydrate:f=>(c.add(f),()=>{c.delete(f)}),onFinishHydration:f=>(l.add(f),()=>{l.delete(f)})},i.skipHydration||T(),w||v},Hr=Zo,Te=tr()(Hr(Vr((a,t)=>({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0,setThemeMode:s=>a({themeMode:s}),setColorScheme:s=>a({colorScheme:s}),setDensity:s=>a({density:s}),setCustomColors:s=>a({customColors:s}),resetTheme:()=>a({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0})})),{name:"photo-search-theme",partialize:a=>({themeMode:a.themeMode,colorScheme:a.colorScheme,density:a.density,customColors:a.customColors})})),es=tr()(Hr(Vr((a,t)=>({dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"",useCaps:!1,vlmModel:"Qwen/Qwen2-VL-2B-Instruct",useOcr:!1,hasText:!1,useOsTrash:!1,showExplain:!1,showInfoOverlay:!1,highContrast:!1,camera:"",isoMin:"",isoMax:"",fMin:"",fMax:"",place:"",setDir:s=>a({dir:s}),setEngine:s=>a({engine:s}),setHfToken:s=>a({hfToken:s}),setOpenaiKey:s=>a({openaiKey:s}),setUseFast:s=>a({useFast:s}),setFastKind:s=>a({fastKind:s}),setUseCaps:s=>a({useCaps:s}),setVlmModel:s=>a({vlmModel:s}),setUseOcr:s=>a({useOcr:s}),setHasText:s=>a({hasText:s}),setUseOsTrash:s=>a({useOsTrash:s}),setShowExplain:s=>a({showExplain:s}),setShowInfoOverlay:s=>a({showInfoOverlay:s}),setHighContrast:s=>a({highContrast:s}),setCamera:s=>a({camera:s}),setIsoMin:s=>a({isoMin:s}),setIsoMax:s=>a({isoMax:s}),setFMin:s=>a({fMin:s}),setFMax:s=>a({fMax:s}),setPlace:s=>a({place:s})})),{name:"photo-search-settings",partialize:a=>({dir:a.dir,engine:a.engine,useFast:a.useFast,fastKind:a.fastKind,useCaps:a.useCaps,vlmModel:a.vlmModel,useOcr:a.useOcr,hasText:a.hasText,useOsTrash:a.useOsTrash,showExplain:a.showExplain,showInfoOverlay:a.showInfoOverlay,camera:a.camera,isoMin:a.isoMin,isoMax:a.isoMax,fMin:a.fMin,fMax:a.fMax,place:a.place})})),Wr=()=>es(a=>a.dir),el=()=>es(a=>a.engine),ra=()=>es(a=>a.highContrast);class Me{static isVideoFile(t){const s=t.toLowerCase().substring(t.lastIndexOf("."));return this.supportedFormats.includes(s)}static async extractMetadata(t){return new Promise((s,r)=>{const n=document.createElement("video");n.preload="metadata",n.onloadedmetadata=()=>{const i={duration:n.duration,width:n.videoWidth,height:n.videoHeight,codec:this.detectCodec(t),fps:30,bitrate:0,hasAudio:n.mozHasAudio||n.webkitAudioDecodedByteCount>0||n.audioTracks?.length>0||!0};n.remove(),s(i)},n.onerror=()=>{n.remove(),r(new Error("Failed to load video metadata"))},n.src=t})}static async generateThumbnail(t,s=2,r=320,n=240){return new Promise((i,u)=>{const c=document.createElement("video"),l=document.createElement("canvas"),d=l.getContext("2d");if(!d){u(new Error("Canvas context not available"));return}c.crossOrigin="anonymous",c.currentTime=s,c.onseeked=()=>{l.width=r,l.height=n;const p=c.videoWidth/c.videoHeight,y=r/n;let v=r,w=n,T=0,f=0;p>y?(w=r/p,f=(n-w)/2):(v=n*p,T=(r-v)/2),d.drawImage(c,T,f,v,w);const N=l.toDataURL("image/jpeg",.8);c.remove(),l.remove(),i(N)},c.onerror=()=>{c.remove(),l.remove(),u(new Error("Failed to generate thumbnail"))},c.src=t})}static async extractKeyframes(t,s=10,r=160,n=90){const u=(await this.extractMetadata(t)).duration/(s+1),c=[];for(let l=1;l<=s;l++)try{const d=u*l,p=await this.generateThumbnail(t,d,r,n);c.push(p)}catch(d){console.warn(`Failed to extract keyframe at ${u*l}s:`,d)}return c}static detectCodec(t){const s=t.toLowerCase().substring(t.lastIndexOf(".")+1);return{mp4:"H.264",mov:"H.264/ProRes",webm:"VP8/VP9",mkv:"H.264/H.265",avi:"Various",wmv:"WMV",flv:"FLV"}[s]||"Unknown"}static async getVideoInfo(t,s){if(this.videoCache.has(t))return this.videoCache.get(t);try{const r=await this.extractMetadata(s),n=await this.generateThumbnail(s),i={path:t,type:"video",format:t.substring(t.lastIndexOf(".")+1).toUpperCase(),metadata:r,thumbnailUrl:n,streamUrl:s};if(this.videoCache.set(t,i),this.videoCache.size>100){const u=this.videoCache.keys().next().value;this.videoCache.delete(u)}return i}catch(r){throw console.error("Failed to get video info:",r),r}}static clearCache(){this.videoCache.clear()}static formatDuration(t){const s=Math.floor(t/3600),r=Math.floor(t%3600/60),n=Math.floor(t%60);return s>0?`${s}:${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${r}:${n.toString().padStart(2,"0")}`}static getResolutionLabel(t,s){return s>=2160?"4K":s>=1440?"2K":s>=1080?"Full HD":s>=720?"HD":s>=480?"SD":"Low"}}oe(Me,"supportedFormats",[".mp4",".mov",".avi",".webm",".mkv",".m4v",".mpg",".mpeg",".wmv",".flv"]),oe(Me,"videoCache",new Map);class tl{constructor(t={}){oe(this,"intersectionObserver",null);oe(this,"imageCache",new Map);oe(this,"loadingQueue",new Set);oe(this,"maxCacheSize",100*1024*1024);oe(this,"currentCacheSize",0);oe(this,"options");this.options={threshold:t.threshold??.1,rootMargin:t.rootMargin??"50px",quality:t.quality??"medium",enableProgressiveLoading:t.enableProgressiveLoading??!0},this.initIntersectionObserver()}initIntersectionObserver(){typeof window>"u"||!window.IntersectionObserver||(this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(s=>{if(s.isIntersecting){const r=s.target,n=r.dataset.src;n&&!r.src&&(this.loadImage(n,r),this.intersectionObserver?.unobserve(r))}})},{threshold:this.options.threshold,rootMargin:this.options.rootMargin}))}observeImage(t,s){if(!this.intersectionObserver){this.loadImage(s,t);return}t.dataset.src=s,this.options.enableProgressiveLoading&&(t.style.backgroundColor="#f3f4f6",t.style.backgroundImage="linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",t.style.backgroundSize="200% 100%",t.style.animation="shimmer 2s infinite linear"),this.intersectionObserver.observe(t)}async loadImage(t,s){if(this.loadingQueue.has(t))return;const r=this.imageCache.get(t);if(r){this.applyImageToElement(r.url,s),this.imageCache.delete(t),this.imageCache.set(t,r);return}this.loadingQueue.add(t);try{const n=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(!n.ok)throw new Error(`Failed to load image: ${n.status}`);const i=await n.blob(),u=URL.createObjectURL(i),c={blob:i,url:u,timestamp:Date.now(),size:i.size};this.addToCache(t,c),this.applyImageToElement(u,s)}catch(n){console.warn("Failed to load image:",t,n),s.style.backgroundColor="#fee2e2",s.alt="Failed to load"}finally{this.loadingQueue.delete(t)}}applyImageToElement(t,s){s.onload=()=>{s.style.backgroundColor="",s.style.backgroundImage="",s.style.animation=""},s.src=t}addToCache(t,s){for(this.currentCacheSize+=s.size;this.currentCacheSize>this.maxCacheSize&&this.imageCache.size>0;){const[r,n]=this.imageCache.entries().next().value;this.imageCache.delete(r),this.currentCacheSize-=n.size,URL.revokeObjectURL(n.url)}this.imageCache.set(t,s)}preloadImages(t,s="low"){s==="low"?window.requestIdleCallback?window.requestIdleCallback(()=>{this.preloadImageBatch(t)}):setTimeout(()=>this.preloadImageBatch(t),100):this.preloadImageBatch(t)}async preloadImageBatch(t){const s=t.filter(r=>!this.imageCache.has(r)&&!this.loadingQueue.has(r)).slice(0,10).map(r=>this.preloadSingleImage(r));await Promise.allSettled(s)}async preloadSingleImage(t){if(!(this.imageCache.has(t)||this.loadingQueue.has(t))){this.loadingQueue.add(t);try{const s=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(s.ok){const r=await s.blob(),n=URL.createObjectURL(r),i={blob:r,url:n,timestamp:Date.now(),size:r.size};this.addToCache(t,i)}}catch{}finally{this.loadingQueue.delete(t)}}}clearCache(){for(const t of this.imageCache.values())URL.revokeObjectURL(t.url);this.imageCache.clear(),this.currentCacheSize=0}getCacheStats(){return{size:this.imageCache.size,totalSize:this.currentCacheSize,maxSize:this.maxCacheSize,hitRate:this.imageCache.size>0?Array.from(this.imageCache.values()).filter(t=>Date.now()-t.timestamp<3e5).length/this.imageCache.size:0}}destroy(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.clearCache(),this.loadingQueue.clear()}}const Gr=new tl;if(typeof document<"u"){const a=document.createElement("style");a.textContent=`
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
  `,document.head.appendChild(a)}const na=o.memo(({src:a,alt:t,onLoad:s,onError:r,className:n="",enableProgressiveLoading:i=!0,quality:u="medium",...c})=>{const l=o.useRef(null),[d,p]=o.useState(!1),[y,v]=o.useState(!1);o.useEffect(()=>{const T=l.current;if(!T||!a)return;const f=()=>{p(!0),s?.()},N=()=>{v(!0),r?.()};return T.addEventListener("load",f),T.addEventListener("error",N),Gr.observeImage(T,a),()=>{T.removeEventListener("load",f),T.removeEventListener("error",N)}},[a,s,r]);const w=`
    ${n}
    ${i&&!d?"transition-opacity duration-300 opacity-0":""}
    ${d?"opacity-100":""}
    ${y?"bg-red-100":""}
  `.trim();return e.jsx("img",{ref:l,alt:t,className:w,...c,style:{...c.style,...i&&!d?{backgroundColor:"#f3f4f6",backgroundImage:"linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",backgroundSize:"200% 100%",animation:"shimmer 2s infinite linear"}:{}}})});na.displayName="LazyImage";const Kr=o.memo(({dir:a,engine:t,items:s,gap:r=8,targetRowHeight:n=196,scrollContainerRef:i,selected:u,onToggleSelect:c,onOpen:l,focusIndex:d=null,onLayout:p,ratingMap:y,showInfoOverlay:v})=>{const w=o.useRef(null),[T,f]=o.useState(0),[N,b]=o.useState({}),[C,x]=o.useState(null),[m,S]=o.useState({}),j=4/3,[I,E]=o.useState({});o.useEffect(()=>{const H=i.current;if(!H)return;const Q=new ResizeObserver(()=>f(H.clientWidth));return Q.observe(H),f(H.clientWidth),()=>Q.disconnect()},[i]),o.useEffect(()=>{let H=!1;return s.slice(0,200).forEach(({path:U})=>{if(N[U])return;const V=new Image;V.onload=()=>{!H&&V.naturalWidth&&V.naturalHeight&&b($=>({...$,[U]:V.naturalWidth/V.naturalHeight}))},V.src=Ne(a,t,U,256)}),()=>{H=!0}},[s,a,t]);const k=o.useMemo(()=>{if(!T||s.length===0)return[];const H=[];let Q=[],U=0;const $=Math.max(0,T-2*16);if(s.forEach((G,J)=>{const X=N[G.path]||j;if(Q.push(G),U+=X,U*n+r*(Q.length-1)>=$){const le=Math.max(120,Math.floor(($-r*(Q.length-1))/U));H.push({items:Q,height:le}),Q=[],U=0}}),Q.length>0){const G=Math.min(n,Math.floor(($-r*(Q.length-1))/Math.max(1,U)));H.push({items:Q,height:G})}return H},[s,N,T,r,n]),R=o.useMemo(()=>{const H=[];if(!s.length||k.length===0)return H;let Q=0;for(const U of k){const V=[];for(let $=0;$<U.items.length;$++)V.push(Q++);H.push(V)}return H},[k,s.length]);o.useEffect(()=>{p&&p(R)},[R,p]);const z=(H,Q)=>{const U=Q.touches[0],V=Date.now();m[H]?.longPressTimer&&clearTimeout(m[H].longPressTimer);const $={startX:U.clientX,startY:U.clientY,startTime:V,isLongPress:!1,longPressTimer:window.setTimeout(()=>{S(G=>({...G,[H]:{...G[H],isLongPress:!0}})),x(H)},500)};S(G=>({...G,[H]:$}))},Z=(H,Q)=>{const U=Q.touches[0],V=m[H];if(!V)return;const $=Math.abs(U.clientX-V.startX),G=Math.abs(U.clientY-V.startY);($>10||G>10)&&V.longPressTimer&&(clearTimeout(V.longPressTimer),S(J=>({...J,[H]:{...J[H],longPressTimer:null}})))},O=(H,Q)=>{const U=m[H];if(!U)return;U.longPressTimer&&clearTimeout(U.longPressTimer);const $=Date.now()-U.startTime;U.isLongPress||($<200&&c(H),setTimeout(()=>{S(G=>{const J={...G};return delete J[H],J})},100))},K=(H,Q)=>{switch(x(null),Q){case"open":l(H);break;case"favorite":console.log("Favorite:",H);break;case"share":console.log("Share:",H);break;case"download":console.log("Download:",H);break}},[D,M]=o.useState(0),B=i.current?.clientHeight||0;o.useEffect(()=>{const H=i.current;if(!H)return;const Q=()=>M(H.scrollTop);return H.addEventListener("scroll",Q,{passive:!0}),M(H.scrollTop),()=>H.removeEventListener("scroll",Q)},[i]);const{totalH:te,offsets:F}=o.useMemo(()=>{let H=0;const Q=[];for(const U of k)Q.push(H),H+=U.height+r;return{totalH:H,offsets:Q}},[k,r]),me=600,A=o.useMemo(()=>{const H=Math.max(0,D-me);let Q=0;for(;Q<F.length&&F[Q]+k[Q].height<H;)Q++;return Q},[F,k,D]),se=o.useMemo(()=>{const H=D+B+me;let Q=A;for(;Q<F.length&&F[Q]<H;)Q++;return Math.min(Q+5,k.length)},[F,k,D,B,A]);o.useEffect(()=>{const H=k.slice(se,se+3).flatMap(Q=>Q.items.map(U=>Ne(a,t,U.path,256)));H.length>0&&Gr.preloadImages(H,"low")},[se,k,a,t]),o.useEffect(()=>{if(!v)return;const H=[];k.slice(A,se).forEach(($,G)=>{$.items.forEach(J=>{H.push(J.path)})});const Q=H.filter($=>!I[$]);if(Q.length===0)return;const U=Q.slice(0,16);let V=!1;return Promise.all(U.map(async $=>{try{const G=await ut(a,$);!V&&G&&G.meta&&E(J=>J[$]?J:{...J,[$]:G.meta})}catch{}})),()=>{V=!0}},[v,k,A,se,a,I]),o.useEffect(()=>{if(!v)return;const H=s.slice(0,48).map(U=>U.path).filter(U=>!I[U]);if(H.length===0)return;let Q=!1;return Promise.all(H.slice(0,24).map(async U=>{try{const V=await ut(a,U);!Q&&V&&V.meta&&E($=>$[U]?$:{...$,[U]:V.meta})}catch{}})),()=>{Q=!0}},[v,s,a]);const de=d!==null?`photo-${d}`:void 0;return e.jsx("div",{id:"modern-results-grid",ref:w,className:"relative",style:{height:te},role:"grid","aria-multiselectable":"true","aria-activedescendant":de,tabIndex:0,children:k.slice(A,se).map((H,Q)=>{const U=A+Q,V=F[U],$=Math.max(0,T-2*16),G=H.items.reduce((X,L)=>X+(N[L.path]||j),0),J=Math.max(120,Math.floor(($-r*(H.items.length-1))/Math.max(.01,G)));return e.jsx("div",{className:"absolute left-0 right-0",style:{top:V},children:e.jsx("div",{className:"flex",style:{gap:r},children:H.items.map((X,L)=>{const le=R[U]?.[L],Y=N[X.path]||j,ne=Math.floor(J*Y),q=u.has(X.path),ue=d!==null&&le===d,ye=X.path.split("/").pop()||X.path;return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden transition-all duration-200 hover:shadow ${q?"ring-2 ring-blue-500":""} ${ue?"outline outline-2 outline-indigo-500":""} ${m[X.path]?"scale-95":""}`,style:{width:ne,height:J},onClick:()=>c(X.path),onDoubleClick:()=>l(X.path),onTouchStart:ee=>z(X.path,ee),onTouchMove:ee=>Z(X.path,ee),onTouchEnd:ee=>O(X.path),title:X.path,"data-photo-idx":le,id:`photo-${le}`,role:"gridcell","aria-selected":q,tabIndex:ue?0:-1,children:[e.jsx(na,{src:Ne(a,t,X.path,256),alt:X.path,className:"w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",enableProgressiveLoading:!0}),Me.isVideoFile(X.path)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(qe,{className:"w-6 h-6 text-white ml-1"})})}),v&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:ye,children:ye}),e.jsx("div",{className:"flex items-center gap-1",children:(()=>{const ee=I[X.path],ve=[];return ee&&(ee.camera&&ve.push(String(ee.camera)),typeof ee.fnumber=="number"&&ve.push(`f/${ee.fnumber}`),typeof ee.iso=="number"&&ve.push(`ISO ${ee.iso}`)),typeof X.score=="number"&&ve.push(X.score.toFixed(2)),ve.slice(0,3).map((He,Oe)=>e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:He},Oe))})()})]}),y&&typeof y[X.path]=="number"&&y[X.path]>0&&e.jsxs("div",{className:"absolute bottom-1 left-1 px-1 py-0.5 rounded bg-black/50 text-yellow-300 text-[10px] flex items-center gap-0.5",children:[e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M12 .587l3.668 7.431 8.2 1.193-5.934 5.787 1.401 8.168L12 18.896l-7.335 3.87 1.401-8.168L.132 9.211l8.2-1.193z"})}),e.jsx("span",{children:y[X.path]})]}),q&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),C===X.path&&e.jsxs("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center gap-3",onClick:()=>x(null),children:[e.jsx("div",{className:"text-white text-sm font-medium mb-2",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),K(X.path,"open")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),K(X.path,"open"))},className:"w-12 h-12 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Open",children:e.jsx(qe,{className:"w-5 h-5 ml-0.5"})}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),K(X.path,"favorite")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),K(X.path,"favorite"))},className:"w-12 h-12 bg-pink-500 hover:bg-pink-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Favorite",children:e.jsx(Gt,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),K(X.path,"share")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),K(X.path,"share"))},className:"w-12 h-12 bg-green-500 hover:bg-green-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Share",children:e.jsx(Kt,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),K(X.path,"download")},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),K(X.path,"download"))},className:"w-12 h-12 bg-purple-500 hover:bg-purple-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Download",children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsx("button",{type:"button",onClick:ee=>{ee.stopPropagation(),x(null)},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),ee.stopPropagation(),x(null))},className:"mt-4 text-white/70 hover:text-white text-xs",children:"Tap anywhere to close"})]})]},X.path)})})},U)})})});Kr.displayName="JustifiedResults";class sl{constructor(t){oe(this,"config");this.config=t}async search(t,s=24){return Zt(this.config.dir,t,this.config.provider,s)}async searchWorkspace(t,s=24){return Ws(this.config.dir,t,this.config.provider,s)}async searchSimilar(t,s=24){return kr(this.config.dir,t,this.config.provider,s)}async searchSimilarPlus(t,s,r=.5,n=24){return dr(this.config.dir,t,this.config.provider,n,s,r)}async buildIndex(t=32){return Et(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async buildFastIndex(t){return qs(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async buildCaptions(t){return mr(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getCollections(){return Sr(this.config.dir)}async setCollection(t,s){return Ht(this.config.dir,t,s)}async deleteCollection(t){return Cr(this.config.dir,t)}async getSmartCollections(){return Tr(this.config.dir)}async setSmartCollection(t,s){return Er(this.config.dir,t,s)}async deleteSmartCollection(t){return Pr(this.config.dir,t)}async resolveSmartCollection(t,s=24){return Ir(this.config.dir,t,this.config.provider,s)}async buildTrips(){return $r(this.config.dir,this.config.provider)}async getTrips(){return Mr(this.config.dir)}async buildFaces(){return Js(this.config.dir,this.config.provider)}async getFaceClusters(){return Xs(this.config.dir)}async nameFaceCluster(t,s){return Zs(this.config.dir,t,s)}async buildOCR(t){return Vs(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async getOCRSnippets(t,s=160){return Fr(this.config.dir,t,s)}async getMetadata(){return Qs(this.config.dir)}async getMetadataDetail(t){return ut(this.config.dir,t)}async buildMetadata(){return Ys(this.config.dir,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getTags(){return Gs(this.config.dir)}async setTags(t,s){return vr(this.config.dir,t,s)}async getMapData(){return zs(this.config.dir)}async getFavorites(){return As(this.config.dir)}async setFavorite(t,s){return kt(this.config.dir,t,s)}async getSavedSearches(){return Us(this.config.dir)}async addSavedSearch(t,s,r){return pr(this.config.dir,t,s,r)}async deleteSavedSearch(t){return gr(this.config.dir,t)}async editImage(t,s){return wr(this.config.dir,t,s)}async upscaleImage(t,s=2,r="pil"){return Nr(this.config.dir,t,s,r)}async exportImages(t,s,r="copy",n=!1,i=!1){return ht(this.config.dir,t,s,r,n,i)}async openExternal(t){return jr(this.config.dir,t)}async getLibrary(t=120,s=0){return Ft(this.config.dir,this.config.provider,t,s,{hfToken:this.config.hfToken,openaiKey:this.config.openaiKey})}async getWorkspace(){return Hs()}async addToWorkspace(t){return Xe(t)}async removeFromWorkspace(t){return yr(t)}async deleteImages(t,s=!0){return sa(this.config.dir,t,s)}async undoDelete(){return aa(this.config.dir)}async findLookalikes(t=5){return fr(this.config.dir,t)}async resolveLookalikes(t){return br(this.config.dir,t)}async runDiagnostics(){return Bs(this.config.dir,this.config.provider,this.config.openaiKey,this.config.hfToken)}async submitFeedback(t,s,r,n){return xr(this.config.dir,t,s,r,n)}async getTodos(){return ea()}getThumbnailUrl(t){return Ne(this.config.dir,this.config.provider,t)}getFaceThumbnailUrl(t,s,r=196){return Ks(this.config.dir,this.config.provider,t,s,r)}async autoTag(){return ta(this.config.dir,this.config.provider)}}let Wt=null;function al(a){return Wt=new sl(a),Wt}function Fe(){if(!Wt)throw new Error("PhotoVault API not initialized. Call initializeAPI first.");return Wt}function Yr({imagePath:a,onClose:t,onSave:s}){const[r,n]=o.useState(a),[i,u]=o.useState(a),[c,l]=o.useState(0),[d,p]=o.useState(!1),[y,v]=o.useState(!1),[w,T]=o.useState(!1),[f,N]=o.useState({x:0,y:0,w:100,h:100}),[b,C]=o.useState(2),[x,m]=o.useState("pil"),[S,j]=o.useState(!1),[I,E]=o.useState([a]),[k,R]=o.useState(0),[z,Z]=o.useState(!1),[O,K]=o.useState({brightness:100,contrast:100,saturation:100}),D=Fe(),M=o.useRef(null),B=o.useRef(null),te=async G=>{j(!0);try{const J={rotate:G},X=await D.editImage(r,J);de(X.out_path),n(X.out_path),l(0)}catch(J){console.error("Failed to rotate image:",J)}finally{j(!1)}},F=async G=>{j(!0);try{const J={flip:G},X=await D.editImage(r,J);de(X.out_path),n(X.out_path),G==="h"?p(!1):v(!1)}catch(J){console.error("Failed to flip image:",J)}finally{j(!1)}},me=async()=>{if(M.current){j(!0);try{const G=M.current,X={crop:{x:Math.round(f.x/100*G.naturalWidth),y:Math.round(f.y/100*G.naturalHeight),w:Math.round(f.w/100*G.naturalWidth),h:Math.round(f.h/100*G.naturalHeight)}},L=await D.editImage(r,X);de(L.out_path),n(L.out_path),T(!1)}catch(G){console.error("Failed to crop image:",G)}finally{j(!1)}}},A=async()=>{j(!0);try{const G=await D.upscaleImage(r,b,x);de(G.out_path),n(G.out_path)}catch(G){console.error("Failed to upscale image:",G)}finally{j(!1)}},se=async()=>{if(!(O.brightness===100&&O.contrast===100&&O.saturation===100)){j(!0);try{alert("Adjustments would be applied here. In a full implementation, this would process the image with the selected adjustments.")}catch(G){console.error("Failed to apply adjustments:",G)}finally{j(!1)}}},de=G=>{const J=I.slice(0,k+1);J.push(G),E(J),R(J.length-1)},H=()=>{k>0&&(R(k-1),n(I[k-1]))},Q=()=>{k<I.length-1&&(R(k+1),n(I[k+1]))},U=()=>{n(i),E([i]),R(0),K({brightness:100,contrast:100,saturation:100})},V=()=>{s&&s(r),t&&t()},$=async()=>{try{const G=prompt("Enter export destination folder:");if(!G)return;const J=await D.exportImages([r],G,"copy",!1,!1);alert(`Exported to: ${J.dest}`)}catch(G){console.error("Failed to export image:",G)}};return e.jsxs("div",{className:"image-editor",children:[e.jsxs("div",{className:"editor-toolbar",children:[e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:()=>te(90),disabled:S,className:"toolbar-btn",title:"Rotate 90°",children:e.jsx(ks,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>F("h"),disabled:S,className:"toolbar-btn",title:"Flip Horizontal",children:[e.jsx(Rn,{className:"w-4 h-4"}),e.jsx(Ln,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>F("v"),disabled:S,className:"toolbar-btn",title:"Flip Vertical",children:[e.jsx(An,{className:"w-4 h-4"}),e.jsx(Un,{className:"w-4 h-4"})]}),e.jsx("button",{onClick:()=>T(!w),disabled:S,className:`toolbar-btn ${w?"active":""}`,title:"Crop",children:e.jsx(zn,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"toolbar-group",children:e.jsx("button",{onClick:()=>Z(!z),className:"toolbar-btn",title:"Before/After Toggle",children:e.jsx("span",{children:"Before/After"})})}),e.jsxs("div",{className:"toolbar-group",children:[e.jsxs("select",{value:b,onChange:G=>C(Number(G.target.value)),className:"toolbar-select",children:[e.jsx("option",{value:2,children:"2x"}),e.jsx("option",{value:4,children:"4x"})]}),e.jsxs("select",{value:x,onChange:G=>m(G.target.value),className:"toolbar-select",children:[e.jsx("option",{value:"pil",children:"PIL"}),e.jsx("option",{value:"realesrgan",children:"RealESRGAN"})]}),e.jsx("button",{onClick:A,disabled:S,className:"toolbar-btn",title:"Upscale",children:e.jsx(Ua,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:H,disabled:k===0||S,className:"toolbar-btn",children:"Undo"}),e.jsx("button",{onClick:Q,disabled:k===I.length-1||S,className:"toolbar-btn",children:"Redo"})]}),e.jsxs("div",{className:"toolbar-group ml-auto",children:[e.jsx("button",{onClick:U,className:"toolbar-btn",title:"Revert to Original",children:"Revert"}),e.jsxs("button",{onClick:$,className:"toolbar-btn",children:[e.jsx(_e,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:V,className:"btn btn-primary",children:[e.jsx(Bn,{className:"w-4 h-4"}),"Save"]}),t&&e.jsx("button",{onClick:t,className:"toolbar-btn",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"adjustment-panel",children:[e.jsxs("div",{className:"adjustment-control",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsx("label",{children:"Brightness"}),e.jsx("input",{type:"range",min:"0",max:"200",value:O.brightness,onChange:G=>K({...O,brightness:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[O.brightness,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("label",{children:"Contrast"}),e.jsx("input",{type:"range",min:"0",max:"200",value:O.contrast,onChange:G=>K({...O,contrast:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[O.contrast,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("label",{children:"Saturation"}),e.jsx("input",{type:"range",min:"0",max:"200",value:O.saturation,onChange:G=>K({...O,saturation:parseInt(G.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[O.saturation,"%"]})]}),e.jsx("button",{onClick:se,disabled:S,className:"btn btn-secondary",children:"Apply Adjustments"})]}),e.jsxs("div",{className:"editor-canvas",children:[S&&e.jsxs("div",{className:"processing-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),e.jsxs("div",{className:"image-container",children:[z?e.jsxs("div",{className:"before-after-container",children:[e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"Before"}),e.jsx("img",{src:D.getThumbnailUrl(i),alt:"Original"})]}),e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"After"}),e.jsx("img",{src:D.getThumbnailUrl(r),alt:"Edited"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{ref:M,src:D.getThumbnailUrl(r),alt:"Editing",style:{transform:`rotate(${c}deg) ${d?"scaleX(-1)":""} ${y?"scaleY(-1)":""}`,filter:`brightness(${O.brightness}%) contrast(${O.contrast}%) saturate(${O.saturation}%)`}}),e.jsx("canvas",{ref:B,style:{display:"none"}})]}),w&&e.jsx("div",{className:"crop-overlay",style:{left:`${f.x}%`,top:`${f.y}%`,width:`${f.w}%`,height:`${f.h}%`},children:e.jsxs("div",{className:"crop-controls",children:[e.jsxs("button",{onClick:me,className:"btn btn-primary btn-sm",children:[e.jsx(ot,{className:"w-3 h-3"}),"Apply"]}),e.jsxs("button",{onClick:()=>T(!1),className:"btn btn-secondary btn-sm",children:[e.jsx(Ce,{className:"w-3 h-3"}),"Cancel"]})]})})]})]}),e.jsx("style",{jsx:!0,children:`
        .image-editor {
          display: flex;
          flex-direction: column;
          height: 100vh;
          background: var(--bg-primary);
        }

        .editor-toolbar {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .toolbar-group {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .toolbar-group.ml-auto {
          margin-left: auto;
        }

        .toolbar-btn {
          display: flex;
          align-items: center;
          gap: 0.25rem;
          padding: 0.5rem 0.75rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .toolbar-btn:hover:not(:disabled) {
          background: var(--bg-tertiary);
          border-color: var(--accent-primary);
        }

        .toolbar-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .toolbar-btn.active {
          background: var(--accent-primary);
          color: white;
        }

        .toolbar-select {
          padding: 0.5rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
        }

        .adjustment-panel {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 0.5rem 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .adjustment-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .adjustment-control label {
          font-size: 0.875rem;
          white-space: nowrap;
        }

        .adjustment-slider {
          width: 100px;
        }

        .editor-canvas {
          flex: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .processing-overlay {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 10;
          color: white;
        }

        .image-container {
          position: relative;
          max-width: 90%;
          max-height: 90%;
        }

        .before-after-container {
          display: flex;
          gap: 2rem;
          max-width: 100%;
          max-height: 100%;
        }

        .before-after-panel {
          flex: 1;
          text-align: center;
        }

        .before-after-panel h3 {
          margin-bottom: 0.5rem;
          color: white;
        }

        .before-after-panel img {
          max-width: 100%;
          max-height: 80vh;
          object-fit: contain;
        }

        .image-container img {
          max-width: 100%;
          max-height: 100%;
          transition: transform 0.3s;
        }

        .crop-overlay {
          position: absolute;
          border: 2px solid var(--accent-primary);
          background: rgba(0, 122, 255, 0.1);
          cursor: move;
        }

        .crop-controls {
          position: absolute;
          bottom: -40px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 0.5rem;
          white-space: nowrap;
        }

        .btn-sm {
          padding: 0.25rem 0.5rem;
          font-size: 0.875rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .editor-toolbar {
            flex-direction: column;
            align-items: stretch;
          }
          
          .toolbar-group {
            flex-wrap: wrap;
            justify-content: center;
          }
          
          .adjustment-panel {
            flex-direction: column;
            align-items: stretch;
          }
          
          .adjustment-control {
            justify-content: space-between;
          }
        }
      `})]})}class nt{static async verifyFaces(t,s,r){const n=[];for(const i of s){let u={clusterId:"",confidence:0};for(const[c,l]of r){const d=this.calculateFaceSimilarity(i.embedding,l.centroid);d>u.confidence&&(u={clusterId:c,confidence:d})}u.confidence>this.faceThreshold&&n.push({clusterId:u.clusterId,confidence:u.confidence,suggested:!0,faceBox:i.box})}return n}static async detectPets(t){const s=[],r=[{type:"dog",breed:"Golden Retriever",confidence:.92},{type:"cat",breed:"Siamese",confidence:.88}];for(const n of r)n.confidence>this.petThreshold&&s.push({...n,box:{x:100,y:100,width:200,height:200}});return s}static async analyzeScene(t){const s={wedding:["bride","groom","ceremony","cake","dress"],birthday:["cake","candles","balloons","party","celebration"],hiking:["mountain","trail","backpack","forest","outdoors"],beach:["ocean","sand","waves","sunset","swimming"],sports:["ball","field","court","team","game"],concert:["stage","crowd","lights","music","performance"],graduation:["cap","gown","diploma","ceremony","academic"]},r={primary:"outdoor",categories:["nature","landscape"],activities:[],events:[],objects:[{name:"mountain",confidence:.95},{name:"trees",confidence:.89},{name:"sky",confidence:.92}],confidence:.88};for(const[n,i]of Object.entries(s))i.filter(c=>r.objects.some(l=>l.name.includes(c))).length>=2&&r.events.push(n);return r.objects.some(n=>n.name.includes("sport"))&&r.activities.push("sports"),r.objects.some(n=>n.name.includes("mountain")||n.name.includes("trail"))&&r.activities.push("hiking"),r}static async assessQuality(t,s){const r={overall:0,sharpness:0,exposure:0,composition:0,colorBalance:0,noise:0,issues:[]};return s?(r.sharpness=this.calculateSharpness(s),r.exposure=this.calculateExposure(s),r.composition=this.calculateComposition(s),r.colorBalance=this.calculateColorBalance(s),r.noise=this.calculateNoise(s)):(r.sharpness=Math.random()*100,r.exposure=Math.random()*100,r.composition=Math.random()*100,r.colorBalance=Math.random()*100,r.noise=100-Math.random()*30),r.overall=r.sharpness*this.qualityWeights.sharpness+r.exposure*this.qualityWeights.exposure+r.composition*this.qualityWeights.composition+r.colorBalance*this.qualityWeights.colorBalance+r.noise*this.qualityWeights.noise,r.sharpness<40&&r.issues.push("Blurry"),r.exposure<30&&r.issues.push("Underexposed"),r.exposure>85&&r.issues.push("Overexposed"),r.composition<40&&r.issues.push("Poor composition"),r.noise<70&&r.issues.push("Noisy"),r}static async generateAutoTags(t){const s=[];t.scene&&(s.push({tag:t.scene.primary,confidence:t.scene.confidence}),t.scene.categories.forEach(n=>s.push({tag:n,confidence:t.scene.confidence*.9})),t.scene.activities.forEach(n=>s.push({tag:n,confidence:.85})),t.scene.events.forEach(n=>s.push({tag:n,confidence:.9}))),t.quality&&(t.quality.overall>80&&s.push({tag:"high-quality",confidence:.95}),t.quality.sharpness>85&&s.push({tag:"sharp",confidence:.9}),t.quality.issues.forEach(n=>s.push({tag:n.toLowerCase(),confidence:.8}))),t.pets&&t.pets.length>0&&t.pets.forEach(n=>{s.push({tag:n.type,confidence:n.confidence}),n.breed&&s.push({tag:n.breed,confidence:n.confidence*.8})});const r=new Map;return s.forEach(n=>{const i=r.get(n.tag);(!i||n.confidence>i)&&r.set(n.tag,n.confidence)}),Array.from(r.entries()).map(([n,i])=>({tag:n,confidence:i})).sort((n,i)=>i.confidence-n.confidence)}static calculateFaceSimilarity(t,s){let r=0,n=0,i=0;for(let u=0;u<t.length;u++)r+=t[u]*s[u],n+=t[u]*t[u],i+=s[u]*s[u];return r/(Math.sqrt(n)*Math.sqrt(i))}static calculateSharpness(t){const{data:s,width:r,height:n}=t;let i=0,u=0,c=0;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const p=(l*r+d)*4,v=-((s[p]+s[p+1]+s[p+2])/3)+(s[((l-1)*r+d)*4]+s[((l+1)*r+d)*4]+s[(l*r+(d-1))*4]+s[(l*r+(d+1))*4])/4;u+=v,c++}u/=c;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const p=(l*r+d)*4,v=-((s[p]+s[p+1]+s[p+2])/3)+(s[((l-1)*r+d)*4]+s[((l+1)*r+d)*4]+s[(l*r+(d-1))*4]+s[(l*r+(d+1))*4])/4;i+=Math.pow(v-u,2)}return i/=c,Math.min(100,Math.sqrt(i)*10)}static calculateExposure(t){const{data:s}=t,r=new Array(256).fill(0);for(let l=0;l<s.length;l+=4){const d=(s[l]+s[l+1]+s[l+2])/3;r[Math.floor(d)]++}const n=s.length/4,i=r.slice(0,20).reduce((l,d)=>l+d,0)/n,u=r.slice(235,256).reduce((l,d)=>l+d,0)/n;let c=100;return c-=i*200,c-=u*200,Math.max(0,Math.min(100,c))}static calculateComposition(t){const{width:s,height:r}=t;return 70+Math.random()*30}static calculateColorBalance(t){const{data:s}=t;let r=0,n=0,i=0;const u=s.length/4;for(let w=0;w<s.length;w+=4)r+=s[w],n+=s[w+1],i+=s[w+2];const c=r/u,l=n/u,d=i/u,p=Math.max(c,l,d),y=Math.min(c,l,d);return(1-(p-y)/p)*100}static calculateNoise(t){const{data:s,width:r,height:n}=t;let i=0,u=0;for(let c=1;c<n-1;c+=10)for(let l=1;l<r-1;l+=10){const d=(c*r+l)*4,p=(s[d]+s[d+1]+s[d+2])/3;let y=0;for(let v=-1;v<=1;v++)for(let w=-1;w<=1;w++){const T=((c+v)*r+(l+w))*4,f=(s[T]+s[T+1]+s[T+2])/3;y+=Math.pow(f-p,2)}i+=Math.sqrt(y/9),u++}return i/=u,Math.max(0,100-i)}}oe(nt,"faceThreshold",.85),oe(nt,"petThreshold",.7),oe(nt,"sceneThreshold",.6),oe(nt,"qualityWeights",{sharpness:.3,exposure:.25,composition:.25,colorBalance:.15,noise:.05});function rl({imagePath:a,detectedFaces:t=[],knownPeople:s,onVerify:r,onCreateNew:n}){const[i,u]=o.useState([]),[c,l]=o.useState(0),[d,p]=o.useState(""),[y,v]=o.useState(!1),[w,T]=o.useState(!1);o.useEffect(()=>{async function b(){if(t.length){T(!0);try{const C=await nt.verifyFaces(a,t,s);u(C)}catch(C){console.error("Face verification failed:",C)}finally{T(!1)}}}b()},[a,t,s]);const f=(b,C)=>{r(b,C),u(x=>x.map(m=>m.clusterId===b?{...m,verified:C}:m))},N=()=>{d.trim()&&(n(d),p(""),v(!1))};return t.length?w?e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Analyzing faces..."})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Face Recognition"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," face",t.length!==1?"s":""," detected"]})]}),t.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:t.map((b,C)=>e.jsx("button",{onClick:()=>l(C),className:`relative w-16 h-16 rounded overflow-hidden border-2 transition-colors ${c===C?"border-blue-500":"border-gray-300"}`,children:e.jsx("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium",children:C+1})})},C))}),i[c]&&e.jsxs("div",{className:"space-y-3",children:[i[c].suggested?e.jsx("div",{className:"p-3 bg-blue-50 rounded",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Suggested: ",s.get(i[c].clusterId)?.name||"Unknown"]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Confidence: ",(i[c].confidence*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(i[c].clusterId,!0),className:`px-3 py-1 text-xs rounded ${i[c].verified===!0?"bg-green-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"✓ Correct"}),e.jsx("button",{onClick:()=>f(i[c].clusterId,!1),className:`px-3 py-1 text-xs rounded ${i[c].verified===!1?"bg-red-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"✗ Wrong"})]})]})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-600",children:"No match found"})}),y?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:b=>p(b.target.value),onKeyPress:b=>b.key==="Enter"&&N(),placeholder:"Enter person's name",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:border-blue-500",autoFocus:!0}),e.jsx("button",{onClick:N,className:"px-3 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Add"}),e.jsx("button",{onClick:()=>{v(!1),p("")},className:"px-3 py-2 text-sm bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"})]}):e.jsx("button",{onClick:()=>v(!0),className:"w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50",children:"+ Tag as new person"})]})]}):e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No faces detected in this photo"})})}function nl({imagePath:a,show:t,imageData:s}){const[r,n]=o.useState(null),[i,u]=o.useState(!1);if(o.useEffect(()=>{if(!t)return;async function p(){u(!0);try{const y=await nt.assessQuality(a,s);n(y)}catch(y){console.error("Quality assessment failed:",y)}finally{u(!1)}}p()},[a,t,s]),!t)return null;const c=p=>p>=80?"text-green-600":p>=60?"text-yellow-600":p>=40?"text-orange-600":"text-red-600",l=p=>p>=80?"Excellent":p>=60?"Good":p>=40?"Fair":"Poor",d=(p,y)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:y}),e.jsx("span",{className:c(p),children:p.toFixed(0)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all ${p>=80?"bg-green-500":p>=60?"bg-yellow-500":p>=40?"bg-orange-500":"bg-red-500"}`,style:{width:`${p}%`}})})]});return i?e.jsx("div",{className:"absolute top-2 left-2 bg-white/90 backdrop-blur rounded-lg p-3 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Analyzing quality..."})]})}):r?e.jsxs("div",{className:"absolute top-2 left-2 bg-white/95 backdrop-blur rounded-lg p-3 shadow-lg max-w-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:"Quality Score"}),e.jsx("p",{className:`text-2xl font-bold ${c(r.overall)}`,children:r.overall.toFixed(0)})]}),e.jsx("div",{className:`text-sm ${c(r.overall)}`,children:l(r.overall)})]}),e.jsxs("div",{className:"space-y-2",children:[d(r.sharpness,"Sharpness"),d(r.exposure,"Exposure"),d(r.composition,"Composition"),d(r.colorBalance,"Color Balance"),d(r.noise,"Noise Level")]}),r.issues.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Issues Detected:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.issues.map((p,y)=>e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded",children:p},y))})]})]}):null}const il={minSwipeDistance:50,maxSwipeTime:300,minPinchDistance:10,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!0,pullToRefreshThreshold:80};class ol{constructor(t={}){oe(this,"config");oe(this,"touchStartPoints",[]);oe(this,"gestureState",{isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0});oe(this,"touchStartTime",0);oe(this,"lastTouchEndTime",0);oe(this,"doubleTapTimer",null);oe(this,"pullStartY",0);oe(this,"isPulling",!1);oe(this,"onSwipeCallback");oe(this,"onPinchCallback");oe(this,"onPanCallback");oe(this,"onDoubleTapCallback");oe(this,"onPullToRefreshCallback");this.config={...il,...t}}onSwipe(t){return this.onSwipeCallback=t,this}onPinch(t){return this.onPinchCallback=t,this}onPan(t){return this.onPanCallback=t,this}onDoubleTap(t){return this.onDoubleTapCallback=t,this}onPullToRefresh(t){return this.onPullToRefreshCallback=t,this}handleTouchStart(t){this.touchStartTime=Date.now(),this.touchStartPoints=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));const s=Date.now();this.doubleTapTimer&&s-this.lastTouchEndTime<300?(this.handleDoubleTap(this.touchStartPoints[0].x,this.touchStartPoints[0].y),this.clearDoubleTapTimer()):this.startDoubleTapTimer(),this.gestureState.lastScale=this.gestureState.scale,this.gestureState.lastTranslateX=this.gestureState.translateX,this.gestureState.lastTranslateY=this.gestureState.translateY,this.config.enablePullToRefresh&&this.isAtTopOfPage()&&(this.pullStartY=this.touchStartPoints[0].y,this.isPulling=!0)}handleTouchMove(t){t.preventDefault();const s=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));s.length===1?this.handleSingleTouchMove(s[0]):s.length===2&&this.handlePinchMove(s)}handleTouchEnd(t){const s=Date.now()-this.touchStartTime;this.lastTouchEndTime=Date.now(),this.gestureState.isSwiping&&s<this.config.maxSwipeTime&&this.handleSwipe(t.changedTouches[0]),this.gestureState.isPinching=!1,this.gestureState.isPanning=!1,this.gestureState.isSwiping=!1,this.isPulling=!1}handleSingleTouchMove(t){const s=this.touchStartPoints[0];if(!s)return;const r=t.x-s.x,n=t.y-s.y,i=Math.sqrt(r*r+n*n);if(this.isPulling&&this.config.enablePullToRefresh&&t.y-this.pullStartY>this.config.pullToRefreshThreshold){this.triggerPullToRefresh(),this.isPulling=!1;return}if(this.gestureState.scale>1){this.gestureState.isPanning=!0,this.gestureState.translateX=this.gestureState.lastTranslateX+r,this.gestureState.translateY=this.gestureState.lastTranslateY+n,this.onPanCallback&&this.onPanCallback(r,n);return}i>this.config.minSwipeDistance&&!this.gestureState.isPanning&&(this.gestureState.isSwiping=!0)}handlePinchMove(t){if(t.length!==2)return;const s=this.touchStartPoints.find(u=>u.id===t[0].id),r=this.touchStartPoints.find(u=>u.id===t[1].id);if(!s||!r)return;const n=this.getDistance(s,r),i=this.getDistance(t[0],t[1]);if(Math.abs(i-n)>this.config.minPinchDistance){this.gestureState.isPinching=!0;const u=i/n*this.gestureState.lastScale,c=Math.max(this.config.minScale,Math.min(this.config.maxScale,u)),l=(t[0].x+t[1].x)/2,d=(t[0].y+t[1].y)/2;this.gestureState.scale=c,this.onPinchCallback&&this.onPinchCallback(c,l,d)}}handleSwipe(t){const s=this.touchStartPoints[0];if(!s)return;const r=t.clientX-s.x,n=t.clientY-s.y,i=Math.abs(r),u=Math.abs(n);if(i>u&&i>this.config.minSwipeDistance){const c={left:r<0,right:r>0,up:!1,down:!1};this.onSwipeCallback&&this.onSwipeCallback(c)}}handleDoubleTap(t,s){this.onDoubleTapCallback&&this.onDoubleTapCallback(t,s)}triggerPullToRefresh(){this.onPullToRefreshCallback&&this.onPullToRefreshCallback()}getDistance(t,s){const r=s.x-t.x,n=s.y-t.y;return Math.sqrt(r*r+n*n)}isAtTopOfPage(){return window.scrollY<=10}startDoubleTapTimer(){this.clearDoubleTapTimer(),this.doubleTapTimer=window.setTimeout(()=>{this.doubleTapTimer=null},300)}clearDoubleTapTimer(){this.doubleTapTimer&&(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null)}reset(){this.gestureState={isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0},this.touchStartPoints=[],this.isPulling=!1}getScale(){return this.gestureState.scale}getTranslation(){return{x:this.gestureState.translateX,y:this.gestureState.translateY}}isGestureActive(){return this.gestureState.isPinching||this.gestureState.isPanning||this.gestureState.isSwiping}}function ll(a,t){const s=React.useRef();return React.useEffect(()=>{if(!a.current)return;s.current=new ol(t);const r=a.current,n=c=>{s.current?.handleTouchStart(c)},i=c=>{s.current?.handleTouchMove(c)},u=c=>{s.current?.handleTouchEnd(c)};return r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("touchmove",i,{passive:!1}),r.addEventListener("touchend",u,{passive:!1}),()=>{r.removeEventListener("touchstart",n),r.removeEventListener("touchmove",i),r.removeEventListener("touchend",u)}},[a,t]),s.current}function cl({dir:a,engine:t,path:s,onPrev:r,onNext:n,onClose:i,onReveal:u,onFavorite:c,onMoreLikeThis:l}){if(!s)return null;const d=o.useRef(null),p=o.useRef(null),[y,v]=o.useState(1),[w,T]=o.useState(0),[f,N]=o.useState(0),[b,C]=o.useState(!1),x=o.useRef({x:0,y:0,tx:0,ty:0}),[m,S]=o.useState(!1),[j,I]=o.useState(!1),[E,k]=o.useState(null),[R,z]=o.useState(!1),[Z,O]=o.useState(s),[K,D]=o.useState(!1),[M,B]=o.useState(!1),[te,F]=o.useState(null),[me,A]=o.useState(!1),se=ll(d,{minSwipeDistance:50,maxSwipeTime:300,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!1});o.useEffect(()=>{se&&se.onSwipe(q=>{q.left?n():q.right&&r()}).onPinch((q,ue,ye)=>{de(q-y,ue,ye)}).onDoubleTap((q,ue)=>{y===1?de(1,q,ue):G()})},[se,r,n,y]);function de(q,ue,ye){const ee=y,ve=Math.min(5,Math.max(1,+(ee+q).toFixed(2)));if(ve===ee)return;const He=p.current;if(He&&ue!==void 0&&ye!==void 0){const Oe=He.getBoundingClientRect(),ts=ue-Oe.left,$t=ye-Oe.top,Mt=ve/ee;T(w+(ts-ts*Mt)),N(f+($t-$t*Mt))}v(ve)}function H(q){q.preventDefault();const ue=q.deltaY<0?.1:-.1;de(ue,q.clientX,q.clientY)}function Q(q){y!==1&&(C(!0),x.current={x:q.clientX,y:q.clientY,tx:w,ty:f})}function U(q){if(!b)return;const ue=q.clientX-x.current.x,ye=q.clientY-x.current.y;T(x.current.tx+ue),N(x.current.ty+ye)}function V(){C(!1)}function $(){C(!1)}function G(){v(1),T(0),N(0)}function J(){de(.2)}function X(){de(-.2)}function L(q){y===1?de(1,q.clientX,q.clientY):G()}function le(q){if(q.touches.length===1){const ue=q.touches[0];F({x:ue.clientX,y:ue.clientY}),A(!1)}}function Y(q){if(!te||q.touches.length!==1)return;const ue=q.touches[0],ye=ue.clientX-te.x,ee=ue.clientY-te.y,ve=Math.abs(ye),He=Math.abs(ee);ve>He&&ve>30&&A(!0)}function ne(q){if(!te||!me){F(null),A(!1);return}const ye=q.changedTouches[0].clientX-te.x;Math.abs(ye)>50&&(ye>0?r():n()),F(null),A(!1)}return o.useEffect(()=>{d.current?.focus()},[s]),o.useEffect(()=>{let q=!1;async function ue(){if(!(!m||!s))try{I(!0);const ye=await ut(a,s);q||k(ye.meta||{})}catch{q||k(null)}finally{q||I(!1)}}return ue(),()=>{q=!0}},[m,a,s]),e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center",onClick:i,onKeyDown:q=>{q.key==="Escape"&&(q.stopPropagation(),i())},children:e.jsxs("div",{className:"relative max-w-6xl w-full p-4",onClick:q=>q.stopPropagation(),ref:d,role:"dialog","aria-modal":"true","aria-label":s,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 text-white",children:[e.jsx("div",{className:"truncate text-sm",children:s}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"bg-white/20 rounded px-2 py-1",children:"◀"}),e.jsx("button",{type:"button",onClick:n,className:"bg-white/20 rounded px-2 py-1",children:"▶"}),e.jsx("button",{type:"button",onClick:()=>S(q=>!q),className:`rounded px-2 py-1 ${m?"bg-blue-600 text-white":"bg-white/20"}`,children:"Info"}),e.jsx("button",{type:"button",onClick:()=>D(q=>!q),className:`rounded px-2 py-1 ${K?"bg-green-600 text-white":"bg-white/20"}`,children:"Quality"}),e.jsx("button",{type:"button",onClick:()=>B(q=>!q),className:`rounded px-2 py-1 ${M?"bg-purple-600 text-white":"bg-white/20"}`,children:"Faces"}),e.jsx("button",{type:"button",onClick:i,className:"bg-white text-black rounded px-2 py-1",children:"Close"})]})]}),e.jsxs("div",{className:"relative bg-black/40 rounded overflow-hidden",onWheel:H,onMouseDown:Q,onMouseMove:U,onMouseUp:V,onMouseLeave:$,onDoubleClick:L,onTouchStart:le,onTouchMove:Y,onTouchEnd:ne,style:{cursor:y>1&&b?"grabbing":y>1?"grab":"default"},children:[e.jsx("img",{ref:p,src:Ne(a,t,s,1024),className:"w-full h-auto select-none",style:{transform:`translate(${w}px, ${f}px) scale(${y})`,transformOrigin:"0 0"},alt:s,draggable:!1}),e.jsx(nl,{imagePath:s,show:K})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/10 rounded p-1",children:[e.jsx("button",{type:"button",onClick:X,className:"px-2 py-1 bg-white/20 text-white rounded",children:"−"}),e.jsxs("div",{className:"text-white text-sm w-12 text-center",children:[Math.round(y*100),"%"]}),e.jsx("button",{type:"button",onClick:J,className:"px-2 py-1 bg-white/20 text-white rounded",children:"+"}),e.jsx("button",{type:"button",onClick:G,className:"px-2 py-1 bg-white/20 text-white rounded",children:"Reset"})]}),e.jsx("button",{type:"button",onClick:u,className:"px-3 py-1 bg-gray-200 rounded",children:"Reveal in Finder/Explorer"}),e.jsx("button",{type:"button",onClick:()=>z(!0),className:"px-3 py-1 bg-green-600 text-white rounded",children:"✏️ Edit"}),e.jsx("button",{type:"button",onClick:c,className:"px-3 py-1 bg-pink-600 text-white rounded",children:"♥ Favorite"}),l&&e.jsx("button",{type:"button",onClick:l,className:"px-3 py-1 bg-blue-600 text-white rounded",children:"More like this"})]}),m&&e.jsx("div",{className:"mt-3 bg-white text-gray-900 rounded p-3 max-h-72 overflow-auto",children:j?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading EXIF…"}):E?e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[E.camera&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Camera"}),e.jsx("div",{className:"font-medium",children:E.camera})]}),E.lens&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Lens"}),e.jsx("div",{className:"font-medium",children:E.lens})]}),E.iso&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"ISO"}),e.jsx("div",{className:"font-medium",children:E.iso})]}),E.fnumber&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Aperture"}),e.jsxs("div",{className:"font-medium",children:["f/",E.fnumber]})]}),E.shutter&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Shutter"}),e.jsx("div",{className:"font-medium",children:E.shutter})]}),E.datetime&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Date"}),e.jsx("div",{className:"font-medium",children:new Date(E.datetime*1e3).toLocaleString()})]}),E.place&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-500",children:"Place"}),e.jsx("div",{className:"font-medium",children:E.place})]}),Array.isArray(E.tags)&&E.tags.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-500",children:"Tags"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:E.tags.map(q=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 rounded text-xs",children:q},q))})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"No metadata."})}),M&&e.jsx("div",{className:"mt-3 bg-white text-gray-900 rounded p-3",children:e.jsx(rl,{imagePath:s,detectedFaces:E?.faces||[],knownPeople:new Map,onVerify:(q,ue)=>{console.log("Face verified:",q,ue)},onCreateNew:q=>{console.log("New person created:",q)}})}),R&&e.jsx(Yr,{imagePath:s,onSave:q=>{O(q),z(!1)},onClose:()=>z(!1)})]})})}function dl({videoPath:a,videoUrl:t,onClose:s,onNext:r,onPrevious:n}){const i=o.useRef(null),u=o.useRef(null),[c,l]=o.useState(null),[d,p]=o.useState(!1),[y,v]=o.useState(!1),[w,T]=o.useState(0),[f,N]=o.useState(0),[b,C]=o.useState(1),[x,m]=o.useState(!0),[S,j]=o.useState(!0),[I,E]=o.useState(0),[k,R]=o.useState(!1),[z,Z]=o.useState([]),[O,K]=o.useState(null),[D,M]=o.useState(!1),B=o.useRef();o.useEffect(()=>(te(),()=>{B.current&&clearTimeout(B.current)}),[a,t]);const te=async()=>{j(!0);try{const Y=await Me.getVideoInfo(a,t);l(Y),Me.extractKeyframes(t,10,120,68).then(ne=>Z(ne)).catch(console.error)}catch(Y){console.error("Failed to load video info:",Y)}finally{j(!1)}},F=()=>{i.current&&(d?i.current.pause():i.current.play(),p(!d))},me=()=>{i.current&&(i.current.muted=!y,v(!y))},A=Y=>{const ne=parseFloat(Y.target.value);C(ne),i.current&&(i.current.volume=ne,v(ne===0))},se=Y=>{if(i.current&&u.current){const ne=u.current.getBoundingClientRect(),ue=(Y.clientX-ne.left)/ne.width*f;i.current.currentTime=ue,T(ue)}},de=()=>{if(i.current&&(T(i.current.currentTime),i.current.buffered.length>0)){const Y=i.current.buffered.end(i.current.buffered.length-1);E(Y/f*100)}},H=()=>{i.current&&N(i.current.duration)},Q=Y=>{i.current&&(i.current.currentTime+=Y)},U=()=>{i.current&&(document.fullscreenElement?document.exitFullscreen():i.current.requestFullscreen())},V=()=>{m(!0),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{d&&m(!1)},3e3)},$=Y=>{switch(Y.key){case" ":Y.preventDefault(),F();break;case"ArrowLeft":Q(-10);break;case"ArrowRight":Q(10);break;case"ArrowUp":C(Math.min(1,b+.1));break;case"ArrowDown":C(Math.max(0,b-.1));break;case"m":me();break;case"f":U();break;case"Escape":s();break}},G=Y=>{if(Y.touches.length===1){const ne=Y.touches[0];K({x:ne.clientX,y:ne.clientY}),M(!1)}},J=Y=>{if(!O||Y.touches.length!==1)return;const ne=Y.touches[0],q=ne.clientX-O.x,ue=ne.clientY-O.y,ye=Math.abs(q),ee=Math.abs(ue);ye>ee&&ye>30&&M(!0)},X=Y=>{if(!O||!D){K(null),M(!1);return}const q=Y.changedTouches[0].clientX-O.x;Math.abs(q)>50&&(q>0?n&&n():r&&r()),K(null),M(!1)},L=Y=>Me.formatDuration(Y),le=f>0?w/f*100:0;return e.jsxs("div",{className:"video-lightbox",onMouseMove:V,onKeyDown:$,onTouchStart:G,onTouchMove:J,onTouchEnd:X,tabIndex:0,children:[e.jsx("div",{className:"video-container",children:S?e.jsxs("div",{className:"loading-spinner",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading video..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:i,src:t,onTimeUpdate:de,onLoadedMetadata:H,onEnded:()=>p(!1),onClick:F,className:"video-player"}),e.jsxs("div",{className:`video-controls ${x?"visible":"hidden"}`,children:[e.jsxs("div",{className:"timeline-container",children:[e.jsxs("div",{ref:u,className:"progress-bar",onClick:se,children:[e.jsx("div",{className:"buffered-bar",style:{width:`${I}%`}}),e.jsx("div",{className:"progress-fill",style:{width:`${le}%`}}),e.jsx("div",{className:"progress-handle",style:{left:`${le}%`}}),z.length>0&&e.jsx("div",{className:"keyframes",children:z.map((Y,ne)=>e.jsx("img",{src:Y,className:"keyframe",style:{left:`${(ne+1)*(100/(z.length+1))}%`},alt:""},ne))})]}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:L(w)}),e.jsx("span",{className:"separator",children:"/"}),e.jsx("span",{children:L(f)})]})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsxs("div",{className:"controls-left",children:[e.jsx("button",{onClick:F,className:"control-btn",children:d?e.jsx(Yt,{}):e.jsx(qe,{})}),e.jsx("button",{onClick:()=>Q(-10),className:"control-btn",children:e.jsx(ga,{})}),e.jsx("button",{onClick:()=>Q(10),className:"control-btn",children:e.jsx(fa,{})}),e.jsxs("div",{className:"volume-control",children:[e.jsx("button",{onClick:me,className:"control-btn",children:y||b===0?e.jsx(qn,{}):e.jsx(Vn,{})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:b,onChange:A,className:"volume-slider"})]})]}),e.jsxs("div",{className:"controls-right",children:[e.jsx("button",{onClick:()=>R(!k),className:"control-btn",children:e.jsx(Qt,{})}),e.jsx("button",{onClick:U,className:"control-btn",children:e.jsx(Ua,{})}),e.jsx("a",{href:t,download:a.split("/").pop(),className:"control-btn",children:e.jsx(_e,{})})]})]})]}),k&&c&&e.jsxs("div",{className:"video-info-overlay",children:[e.jsx("h3",{children:a.split("/").pop()}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{children:["Format: ",c.format]}),e.jsxs("div",{children:["Resolution: ",c.metadata.width,"×",c.metadata.height]}),e.jsxs("div",{children:["Duration: ",L(c.metadata.duration)]}),e.jsxs("div",{children:["Codec: ",c.metadata.codec]}),e.jsxs("div",{children:["Quality: ",Me.getResolutionLabel(c.metadata.width,c.metadata.height)]}),e.jsxs("div",{children:["Audio: ",c.metadata.hasAudio?"Yes":"No"]})]})]})]})}),n&&e.jsx("button",{onClick:n,className:"nav-btn nav-prev",children:e.jsx(ga,{})}),r&&e.jsx("button",{onClick:r,className:"nav-btn nav-next",children:e.jsx(fa,{})}),e.jsx("button",{onClick:s,className:"close-btn",children:"×"}),e.jsx("style",{jsx:!0,children:`
        .video-lightbox {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.95);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
        }

        .video-container {
          position: relative;
          width: 90%;
          max-width: 1200px;
          height: 80vh;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .video-player {
          width: 100%;
          height: 100%;
          object-fit: contain;
          cursor: pointer;
        }

        .video-controls {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
          padding: 2rem 1rem 1rem;
          transition: opacity 0.3s;
        }

        .video-controls.hidden {
          opacity: 0;
          pointer-events: none;
        }

        .timeline-container {
          margin-bottom: 1rem;
        }

        .progress-bar {
          position: relative;
          height: 6px;
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
          cursor: pointer;
          margin-bottom: 0.5rem;
        }

        .progress-bar:hover {
          height: 10px;
        }

        .buffered-bar {
          position: absolute;
          height: 100%;
          background: rgba(255, 255, 255, 0.3);
          border-radius: 3px;
        }

        .progress-fill {
          position: absolute;
          height: 100%;
          background: var(--accent-primary);
          border-radius: 3px;
        }

        .progress-handle {
          position: absolute;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 14px;
          height: 14px;
          background: white;
          border-radius: 50%;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .keyframes {
          position: absolute;
          top: -80px;
          left: 0;
          right: 0;
          height: 68px;
          opacity: 0;
          transition: opacity 0.2s;
          pointer-events: none;
        }

        .progress-bar:hover .keyframes {
          opacity: 1;
        }

        .keyframe {
          position: absolute;
          height: 68px;
          width: 120px;
          object-fit: cover;
          border: 2px solid white;
          border-radius: 4px;
          transform: translateX(-50%);
        }

        .time-display {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: white;
          font-size: 0.875rem;
        }

        .control-buttons {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .controls-left, .controls-right {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .control-btn {
          background: none;
          border: none;
          color: white;
          cursor: pointer;
          padding: 0.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: opacity 0.2s;
        }

        .control-btn:hover {
          opacity: 0.7;
        }

        .control-btn svg {
          width: 20px;
          height: 20px;
        }

        .volume-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .volume-slider {
          width: 80px;
          opacity: 0;
          transition: opacity 0.2s;
        }

        .volume-control:hover .volume-slider {
          opacity: 1;
        }

        .video-info-overlay {
          position: absolute;
          top: 2rem;
          left: 2rem;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 1.5rem;
          border-radius: 8px;
          max-width: 400px;
        }

        .video-info-overlay h3 {
          margin-bottom: 1rem;
          font-size: 1.125rem;
        }

        .info-grid {
          display: grid;
          gap: 0.5rem;
          font-size: 0.875rem;
        }

        .nav-btn {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(0, 0, 0, 0.5);
          border: none;
          color: white;
          padding: 1rem;
          cursor: pointer;
          transition: background 0.2s;
        }

        .nav-btn:hover {
          background: rgba(0, 0, 0, 0.8);
        }

        .nav-prev {
          left: 1rem;
        }

        .nav-next {
          right: 1rem;
        }

        .close-btn {
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: none;
          border: none;
          color: white;
          font-size: 2rem;
          cursor: pointer;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .loading-spinner {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 1rem;
          color: white;
        }

        .spinner {
          width: 48px;
          height: 48px;
          border: 3px solid rgba(255, 255, 255, 0.2);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function ul({dir:a,engine:t,library:s,onLoadLibrary:r,selected:n=new Set,onToggleSelect:i,onOpen:u,tagsMap:c={}}){const[l,d]=o.useState("name"),[p,y]=o.useState("asc"),[v,w]=o.useState(!1),T=o.useCallback(m=>{const S=m.split("/").pop()||m,j=S.split(".").pop()?.toLowerCase()||"",E=(c[m]||[]).find(R=>R.startsWith("rating:")),k=E?parseInt(E.split(":")[1]):0;return{name:S,ext:j,rating:k,isVideo:Me.isVideoFile(m)}},[c]),f=o.useMemo(()=>s.length?[...s].sort((m,S)=>{const j=T(m),I=T(S);let E=0;switch(l){case"name":E=j.name.localeCompare(I.name);break;case"rating":E=I.rating-j.rating;break;case"date":E=m.localeCompare(S);break;case"size":E=j.name.localeCompare(I.name);break;case"camera":E=j.name.localeCompare(I.name);break;default:E=0}return p==="desc"?-E:E}):[],[s,l,p,T]),N=o.useMemo(()=>{const m=s.length,S=s.filter(k=>Me.isVideoFile(k)).length,j=m-S,I=n.size,E={1:0,2:0,3:0,4:0,5:0};return s.forEach(k=>{const z=(c[k]||[]).find(Z=>Z.startsWith("rating:"));if(z){const Z=parseInt(z.split(":")[1]);Z>=1&&Z<=5&&E[Z]++}}),{total:m,photos:j,videos:S,selected:I,ratings:E}},[s,n,c]),b=m=>{l===m?y(S=>S==="asc"?"desc":"asc"):(d(m),y("asc"))},C=()=>{i&&s.forEach(m=>{n.has(m)||i(m)})},x=()=>{i&&Array.from(n).forEach(m=>{i(m)})};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"font-semibold",children:"Library"}),e.jsx("button",{onClick:()=>w(!v),className:`p-1 rounded ${v?"bg-blue-100 text-blue-600":"text-gray-500 hover:bg-gray-100"}`,title:"Toggle statistics",children:e.jsx(Hn,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Wn,{className:"w-3 h-3 text-gray-400"}),e.jsxs("select",{value:l,onChange:m=>b(m.target.value),className:"text-xs border rounded px-1 py-0.5",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"rating",children:"Rating"}),e.jsx("option",{value:"size",children:"Size"}),e.jsx("option",{value:"camera",children:"Camera"})]}),e.jsx("button",{onClick:()=>y(m=>m==="asc"?"desc":"asc"),className:"text-xs text-gray-500 hover:text-gray-700",title:`Sort ${p==="asc"?"descending":"ascending"}`,children:p==="asc"?"↑":"↓"})]}),i&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("button",{onClick:C,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"All"}),e.jsx("button",{onClick:x,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"None"})]}),e.jsx("button",{onClick:()=>r(120,0),className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Reload"})]})]}),v&&s.length>0&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 rounded text-xs",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Total: ",N.total]}),e.jsxs("div",{className:"text-gray-600",children:["Photos: ",N.photos]}),e.jsxs("div",{className:"text-gray-600",children:["Videos: ",N.videos]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Selected: ",N.selected]}),e.jsx("div",{className:"text-gray-600",children:N.selected>0&&`${(N.selected/N.total*100).toFixed(1)}%`})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Ratings:"}),e.jsx("div",{className:"flex gap-1",children:Object.entries(N.ratings).map(([m,S])=>e.jsxs("span",{className:"text-gray-600",title:`${m} stars: ${S} photos`,children:[m,"★:",S]},m))})]})]})}),n.size>0&&e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[n.size," item",n.size!==1?"s":""," selected"]}),s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No items yet. Build the index, then click Reload."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:f.map((m,S)=>{const j=n.has(m),I=T(m);return e.jsxs("div",{className:`relative group cursor-pointer rounded overflow-hidden ${j?"ring-2 ring-blue-500":""}`,onClick:()=>u?u(m):void 0,children:[i&&e.jsx("button",{onClick:E=>{E.stopPropagation(),i(m)},className:`absolute top-1 left-1 z-10 w-5 h-5 rounded border-2 flex items-center justify-center
                      ${j?"bg-blue-600 border-blue-600":"bg-white/80 border-gray-300 opacity-0 group-hover:opacity-100"} transition-opacity`,children:j&&e.jsx(ot,{className:"w-3 h-3 text-white"})}),e.jsx("img",{src:Ne(a,t,m,196),alt:I.name,title:`${I.name}${I.rating>0?` - ${"★".repeat(I.rating)}`:""}`,className:"w-full h-24 object-cover"}),I.isVideo&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-8 h-8 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-white ml-0.5"})})}),I.rating>0&&e.jsx("div",{className:"absolute top-1 right-1 bg-black/60 text-white text-xs px-1 rounded",children:"★".repeat(I.rating)}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"p-1 text-white text-xs truncate",children:I.name})})]},m)})})]})}function hl({dir:a,engine:t,clusters:s,persons:r,setPersons:n,busy:i,setBusy:u,setNote:c,onLoadFaces:l,onOpenPhotos:d}){const[p,y]=o.useState(null),[v,w]=o.useState([]),[T,f]=o.useState(!1),N=async b=>{try{u("Loading photos...");const C=await Lr(a,b);w(C.photos),y(b),f(!0),u(""),c(`Found ${C.photos.length} photos in cluster`)}catch(C){u(""),c(C.message)}};return T&&p?e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Photos in Cluster"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(!1),className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Back"}),e.jsxs("button",{onClick:()=>d?.(v),className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:["View All (",v.length,")"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:v.map((b,C)=>e.jsx("img",{src:Ne(a,t,b,196),alt:`Photo ${C+1}`,className:"w-full h-24 object-cover rounded cursor-pointer hover:ring-2 hover:ring-blue-500",onClick:()=>d?.([b])},C))})]}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"People"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{try{u("Scanning faces…");const b=await Js(a,t);u(""),c(`Faces: ${b.faces}, clusters: ${b.clusters}`),await l()}catch(b){u(""),c(b.message)}},className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build/Update"}),e.jsx("button",{onClick:l,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No face clusters yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-sm",children:s.map(b=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:b.name||`Cluster ${b.id}`,children:b.name||`Cluster ${b.id}`}),e.jsx("div",{className:"text-xs text-gray-600",children:b.size})]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-1",children:b.examples.map(([C,x],m)=>e.jsx("img",{src:Ks(a,t,C,x,196),className:"w-full h-16 object-cover rounded"},m))}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{const C=b.name||"";if(!C)return;const x=r.includes(C)?r.filter(m=>m!==C):[...r,C];n(x)},disabled:!b.name,className:`px-2 py-1 rounded text-xs ${b.name&&r.includes(b.name)?"bg-blue-700 text-white":b.name?"bg-blue-600 text-white":"bg-gray-200"}`,children:b.name&&r.includes(b.name)?"Remove":"Add"}),e.jsx("button",{onClick:async()=>{const C=prompt("Name this person as…",b.name||"")||"";if(C.trim())try{await Zs(a,String(b.id),C.trim()),await l()}catch{}},className:"px-2 py-1 rounded bg-gray-200 text-xs",children:"Name"})]}),e.jsxs("button",{onClick:()=>N(b.id),className:"px-2 py-1 rounded bg-green-600 text-white text-xs w-full",children:["View Photos (",b.size,")"]})]})]},b.id))}),r.length>0&&e.jsxs("div",{className:"mt-2 text-sm flex items-center gap-2 flex-wrap",children:[r.map(b=>e.jsxs("span",{className:"px-2 py-1 bg-blue-600 text-white rounded flex items-center gap-2",children:[b," ",e.jsx("button",{onClick:()=>n(r.filter(C=>C!==b)),className:"bg-white/20 rounded px-1",children:"×"})]},b)),e.jsx("button",{onClick:()=>n([]),className:"px-2 py-1 bg-gray-200 rounded",children:"Clear"})]})]})}function ml({points:a,onLoadMap:t}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Map (GPS)"}),e.jsx("button",{onClick:t,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Load"})]}),a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No GPS points found."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 text-xs",children:a.map((s,r)=>e.jsxs("div",{className:"border rounded p-2",children:[s.lat.toFixed(5),", ",s.lon.toFixed(5)]},r))})]})}function xl({dir:a,engine:t,collections:s,onLoadCollections:r,onOpen:n,onDelete:i,onShare:u,onExport:c,selectedPhotos:l=[],onCollectionUpdate:d}){const[p,y]=o.useState(null),[v,w]=o.useState(null),[T,f]=o.useState(!1),[N,b]=o.useState(""),[C,x]=o.useState(!1),[m,S]=o.useState(null),j=o.useRef(0),I=o.useCallback(async()=>{if(!(!N.trim()||C)){x(!0);try{if(await Ht(a,N.trim(),l),b(""),f(!1),r(),d){const D={...s,[N.trim()]:l};d(D)}}catch(D){console.error("Failed to create collection:",D),alert(D instanceof Error?D.message:"Failed to create collection")}finally{x(!1)}}},[N,l,a,r,s,d]),E=o.useCallback((D,M)=>{const B={type:"collection",data:M,name:M};y(B),D.dataTransfer.effectAllowed="move",D.dataTransfer.setData("text/plain",JSON.stringify(B))},[]),k=o.useCallback((D,M)=>{D.preventDefault(),D.dataTransfer.dropEffect="copy",w(M)},[]),R=o.useCallback((D,M)=>{D.preventDefault(),j.current++,w(M)},[]),z=o.useCallback(D=>{j.current--,j.current===0&&w(null)},[]),Z=o.useCallback(async(D,M)=>{D.preventDefault(),j.current=0,w(null);try{const B=D.dataTransfer.getData("text/plain");let te;if(B)te=JSON.parse(B);else{if(!p)return;te=p}if(te.type==="photo"){const F=Array.isArray(te.data)?te.data:[te.data],me=s[M]||[],A=Array.from(new Set([...me,...F]));if(await Ht(a,M,A),r(),d){const se={...s,[M]:A};d(se)}}}catch(B){console.error("Failed to update collection:",B),alert("Failed to update collection")}finally{y(null)}},[s,a,r,d,p]),O=o.useCallback(async D=>{if(u)u(D,s[D]||[]);else try{const M=s[D]||[];if(M.length===0){alert("Collection is empty");return}const B=await Rs(a,t,M,{expiryHours:24,viewOnly:!0});await navigator.clipboard.writeText(window.location.origin+B.url),alert("Share link copied to clipboard!")}catch(M){console.error("Failed to share collection:",M),alert(M instanceof Error?M.message:"Failed to share collection")}},[u,s,a,t]),K=o.useCallback(async D=>{if(c)c(D,s[D]||[]);else{const M=prompt(`Export collection "${D}" to folder:`,D);if(!M)return;try{const B=s[D]||[];if(B.length===0){alert("Collection is empty");return}await ht(a,B,M,"copy",!1,!1),alert(`Exported ${B.length} photos to ${M}`)}catch(B){console.error("Failed to export collection:",B),alert(B instanceof Error?B.message:"Failed to export collection")}}},[c,s,a]);return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-semibold",children:"Collections"}),l.length>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[l.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.length>0&&e.jsxs("button",{onClick:()=>f(!0),className:"bg-green-600 text-white rounded px-3 py-1 text-sm hover:bg-green-700 flex items-center gap-1",children:[e.jsx(za,{className:"w-3 h-3"}),"New"]}),e.jsx("button",{onClick:r,className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Refresh"})]})]}),T&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4 text-blue-600"}),e.jsx("input",{type:"text",placeholder:"Collection name",value:N,onChange:D=>b(D.target.value),className:"flex-1 border rounded px-2 py-1 text-sm",onKeyDown:D=>{D.key==="Enter"&&I(),D.key==="Escape"&&f(!1)},autoFocus:!0}),e.jsx("button",{onClick:I,disabled:!N.trim()||C,className:"bg-blue-600 text-white px-3 py-1 text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:C?"Creating...":"Create"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700 px-2 py-1 text-sm",children:"Cancel"})]}),l.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["Will add ",l.length," selected photo",l.length!==1?"s":""]})]}),Object.keys(s||{}).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(vs,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"No collections yet"}),l.length>0?e.jsxs("button",{onClick:()=>f(!0),className:"text-sm text-blue-600 hover:text-blue-800",children:["Create your first collection with ",l.length," selected photo",l.length!==1?"s":""]}):e.jsx("div",{className:"text-xs text-gray-500",children:"Select photos and create collections to organize them"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:Object.keys(s).map(D=>{const M=v===D,B=s[D]||[];return e.jsxs("div",{draggable:!0,onDragStart:te=>E(te,D),onDragOver:te=>k(te,D),onDragEnter:te=>R(te,D),onDragLeave:z,onDrop:te=>Z(te,D),className:`border rounded-lg p-3 transition-all cursor-move ${M?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"} ${m===D?"ring-2 ring-blue-200":""}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(Gn,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:D,children:D}),e.jsxs("div",{className:"text-xs text-gray-600",children:[B.length," item",B.length!==1?"s":"",M&&e.jsx("span",{className:"ml-2 text-blue-600 font-medium",children:"Drop here to add"})]})]})]}),e.jsxs("div",{className:"flex gap-1 mb-3 overflow-hidden",children:[B.slice(0,4).map((te,F)=>e.jsx("img",{src:Ne(a,t,te,96),alt:te.split("/").pop()||te,className:`object-cover rounded ${B.length===1?"w-full h-20":B.length===2?"w-1/2 h-16":"w-1/4 h-12"}`},te)),B.length>4&&e.jsxs("div",{className:"w-1/4 h-12 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:["+",B.length-4]}),B.length===0&&e.jsx("div",{className:"w-full h-16 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:"Empty collection"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>n(D),className:"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 text-xs",children:"Open"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>O(D),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-blue-600",title:"Share collection",disabled:B.length===0,children:e.jsx(Kt,{className:"w-3 h-3"})}),e.jsx("button",{type:"button",onClick:()=>K(D),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-green-600",title:"Export collection",disabled:B.length===0,children:e.jsx(_e,{className:"w-3 h-3"})}),i&&e.jsx("button",{type:"button",onClick:()=>i(D),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-red-600",title:"Delete collection",children:e.jsx(lt,{className:"w-3 h-3"})})]})]})]},D)})}),l.length>0&&Object.keys(s||{}).length>0&&e.jsx("div",{className:"mt-3 text-xs text-center text-gray-500 border-t pt-2",children:"💡 Drag photos onto collections to add them, or create a new collection above"})]})}function pl(){const a=Os(),t=or(),s=o.useMemo(()=>a.pathname.split("/").filter(Boolean)[1]||"",[a.pathname]),[r,n]=o.useState(null),[i,u]=o.useState(""),[c,l]=o.useState(""),[d,p]=o.useState(!1);async function y(){p(!0),l("");try{const w=new URLSearchParams({token:s});i.trim()&&w.set("password",i.trim());const f=await(await fetch(`/share/detail?${w.toString()}`)).json();n(f),f.ok||(f.error==="expired"?l("This link has expired"):f.error==="password_required"?l("Password required or incorrect"):l("Unable to open share"))}catch(w){l(w instanceof Error?w.message:"Failed to load share")}finally{p(!1)}}if(o.useEffect(()=>{s&&y()},[s]),!s)return e.jsx("div",{className:"h-screen bg-gray-950 text-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl mb-2",children:"Invalid share link"}),e.jsx("button",{className:"px-3 py-1 rounded bg-gray-800 border border-gray-700",onClick:()=>t("/"),children:"Back"})]})});const v=r?.ok&&r?.paths&&r?.dir;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-gray-100",children:[e.jsxs("header",{className:"px-4 py-3 border-b border-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:"Shared Photos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r?.expires&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Expires ",new Date(r.expires).toLocaleString()]}),e.jsx("button",{className:"px-2 py-1 rounded bg-gray-800 border border-gray-700 text-sm",onClick:()=>t("/"),children:"Back"})]})]}),e.jsxs("main",{className:"p-4",children:[(!r||!r.ok&&r.error==="password_required")&&e.jsxs("div",{className:"max-w-md mx-auto",children:[c&&e.jsx("div",{className:"mb-2 text-red-400 text-sm",children:c}),e.jsx("label",{className:"block text-sm mb-1",children:"Password"}),e.jsx("input",{className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded",value:i,onChange:w=>u(w.target.value),placeholder:"Enter password (if required)",type:"password"}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:y,disabled:d,children:d?"Opening…":"Open"})})]}),r&&!r.ok&&r.error==="expired"&&e.jsx("div",{className:"text-center text-gray-300",children:"This link has expired."}),v&&e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))"},children:r.paths.map(w=>e.jsx("div",{className:"border border-gray-800 rounded overflow-hidden bg-gray-900",children:e.jsx("img",{src:Ne(r.dir,r.provider||"local",w,256),alt:"photo",className:"w-full h-[140px] object-cover"})},w))})]})]})}function gl({dir:a,engine:t,topK:s,smart:r,setSmart:n,setResults:i,setSearchId:u,setNote:c,query:l,favOnly:d,tagFilter:p,useCaps:y,useOcr:v,hasText:w,camera:T,isoMin:f,isoMax:N,fMin:b,fMax:C,place:x,persons:m}){const S=async()=>{const k=(prompt("Save current search as Smart (name):")||"").trim();if(k)try{const R=p.split(",").map(M=>M.trim()).filter(Boolean),z={query:l,favoritesOnly:d,tags:R,useCaptions:y,useOcr:v,hasText:w,camera:T||void 0,isoMin:f?parseInt(f,10):void 0,isoMax:N?parseInt(N,10):void 0,fMin:b?parseFloat(b):void 0,fMax:C?parseFloat(C):void 0,place:x||void 0},Z=m.filter(Boolean);Z.length===1?z.person=Z[0]:Z.length>1&&(z.persons=Z);const{apiSetSmart:O,apiGetSmart:K}=await he(async()=>{const{apiSetSmart:M,apiGetSmart:B}=await Promise.resolve().then(()=>pe);return{apiSetSmart:M,apiGetSmart:B}},void 0,import.meta.url);await O(a,k,z);const D=await K(a);n(D.smart||{}),c("Saved smart collection")}catch(R){c(R.message||"Failed to save smart")}},j=async()=>{try{const{apiGetSmart:k}=await he(async()=>{const{apiGetSmart:z}=await Promise.resolve().then(()=>pe);return{apiGetSmart:z}},void 0,import.meta.url),R=await k(a);n(R.smart||{})}catch(k){c(k.message||"Failed to load smart")}},I=async k=>{try{const{apiResolveSmart:R}=await he(async()=>{const{apiResolveSmart:Z}=await Promise.resolve().then(()=>pe);return{apiResolveSmart:Z}},void 0,import.meta.url),z=await R(a,k,t,s);i(z.results||[]),u(z.search_id||""),c(`Opened smart: ${k}`)}catch(R){c(R.message)}},E=async k=>{if(confirm(`Delete smart collection "${k}"?`))try{const{apiDeleteSmart:R,apiGetSmart:z}=await he(async()=>{const{apiDeleteSmart:O,apiGetSmart:K}=await Promise.resolve().then(()=>pe);return{apiDeleteSmart:O,apiGetSmart:K}},void 0,import.meta.url);await R(a,k);const Z=await z(a);n(Z.smart||{})}catch(R){c(R.message)}};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Smart Collections"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"}),e.jsx("button",{onClick:S,className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:"Save current as Smart"})]})]}),Object.keys(r||{}).length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No smart collections yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.keys(r).map(k=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:k,children:k}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(k),className:"px-2 py-1 bg-blue-600 text-white rounded",children:"Open"}),e.jsx("button",{onClick:()=>E(k),className:"px-2 py-1 bg-red-600 text-white rounded",children:"Delete"})]})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 truncate",children:JSON.stringify(r[k])})]},k))})]})}function $a({dir:a,engine:t,setBusy:s,setNote:r,setResults:n}){const i=async()=>{try{const{apiTripsBuild:l}=await he(async()=>{const{apiTripsBuild:p}=await Promise.resolve().then(()=>pe);return{apiTripsBuild:p}},void 0,import.meta.url);s("Grouping trips…");const d=await l(a,t);s(""),window._trips=d.trips||[],r(`Trips: ${d.trips?.length||0}`)}catch(l){s(""),r(l.message)}},u=async()=>{try{const{apiTripsList:l}=await he(async()=>{const{apiTripsList:p}=await Promise.resolve().then(()=>pe);return{apiTripsList:p}},void 0,import.meta.url),d=await l(a);window._trips=d.trips||[],r(`Loaded ${d.trips.length} trips`)}catch(l){r(l.message)}},c=l=>{n((l.paths||[]).map(d=>({path:d,score:1}))),r("Opened trip")};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Trips"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:i,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build"}),e.jsx("button",{onClick:u,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:window._trips?.slice(0,6)?.map((l,d)=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:l.place||"",children:l.place||"Trip"}),e.jsx("div",{children:l.count})]}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-1",children:(l.paths||[]).slice(0,3).map((p,y)=>e.jsx("img",{src:Ne(a,t,p,196),className:"w-full h-16 object-cover rounded"},y))}),e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx("button",{onClick:()=>c(l),className:"bg-blue-600 text-white rounded px-3 py-1",children:"Open"})})]},l.id||d))})]})}function fl({saved:a,onRun:t,onDelete:s}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"font-semibold",children:"Saved Searches"})}),!a||a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No saved searches yet."}):e.jsx("div",{className:"mt-2 divide-y",children:a.map(r=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:r.name,children:r.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:r.query,children:r.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:()=>t(r.name,r.query,r.top_k),className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{onClick:()=>s(r.name),className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},r.name))})]})}function bl(a){const t=a.split(/\r?\n/),s=[];let r=[];function n(){r.length&&(s.push(e.jsx("ul",{className:"list-disc ml-6 space-y-1",children:r.map((i,u)=>e.jsx("li",{children:i},u))},`ul-${s.length}`)),r=[])}return t.forEach((i,u)=>{const c=i.match(/^(#+)\s+(.*)$/);if(c){n();const d=c[1].length,p=c[2],y=d===1?"h1":d===2?"h2":"h3";s.push(e.jsx(y,{className:"font-semibold mt-4",children:p},`h-${u}`));return}const l=i.match(/^[-*]\s+(.*)$/);if(l){r.push(l[1]);return}if(i.trim()===""){n(),s.push(e.jsx("div",{className:"h-2"},`sp-${u}`));return}n(),s.push(e.jsx("p",{children:i},`p-${u}`))}),n(),s}function yl(){const a=Wr(),t=el(),[s,r]=o.useState(""),[n,i]=o.useState(!0),[u,c]=o.useState(""),[l,d]=o.useState([]),[p,y]=o.useState(!1),[v,w]=o.useState(null);o.useEffect(()=>{let f=!1;return ea().then(N=>{f||(r(N.text||""),i(!1))}).catch(N=>{f||(c(String(N)),i(!1))}),()=>{f=!0}},[]),o.useEffect(()=>{let f=!1;if(!a){d([]);return}return Ls(a,200).then(N=>{f||d(N.events||[])}).catch(()=>{}),()=>{f=!0}},[a]);const T=async()=>{if(a)try{y(!0),w(null);const f=await ta(a,t),N=Object.values(f.tags||{}).reduce((b,C)=>b+C.length,0);w(`Successfully generated ${N} tags for ${Object.keys(f.tags||{}).length} photos`)}catch(f){w(`Error: ${f.message}`)}finally{y(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Project Tasks (TODO.md)"}),n?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading…"}):u?e.jsx("div",{className:"text-sm text-red-600",children:u}):e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:bl(s)}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Auto-tag Photos"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 border rounded p-3 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Generate smart tags for your photos using AI analysis. This will analyze photo content and automatically assign relevant tags."}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:T,disabled:p||!a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Generating Tags...":"Generate Auto Tags"})}),v&&e.jsx("div",{className:`p-2 rounded text-sm ${v.startsWith("Error:")?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"}`,children:v})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Recent Events"}),e.jsx("div",{className:"border rounded divide-y",children:l.length===0?e.jsx("div",{className:"p-2 text-sm text-gray-600",children:"No recent events."}):l.map((f,N)=>e.jsxs("div",{className:"p-2 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:f.type}),e.jsx("span",{children:f.query?`"${f.query}"`:f.token?`share:${f.token.slice(0,6)}…`:""})]}),e.jsx("div",{className:"text-gray-500",children:new Date(f.time).toLocaleString()})]},N))})]})]})}function vl({dir:a,engine:t,items:s,selected:r,onToggleSelect:n,onOpen:i,showInfoOverlay:u,bucket:c="day"}){const[l,d]=o.useState({}),[p,y]=o.useState(new Set);o.useEffect(()=>{const m=s.slice(0,200).map(I=>I.path).filter(I=>!l[I]&&!p.has(I)).slice(0,32);if(m.length===0)return;const S=new Set(p);m.forEach(I=>S.add(I)),y(S);let j=!1;return Promise.all(m.map(async I=>{try{const E=await ut(a,I);!j&&E&&E.meta&&d(k=>({...k,[I]:{mtime:E.meta.mtime,camera:E.meta.camera,fnumber:E.meta.fnumber,iso:E.meta.iso}}))}catch{}})).finally(()=>{j||y(I=>{const E=new Set(I);return m.forEach(k=>E.delete(k)),E})}),()=>{j=!0}},[s,a,l,p]);const v=o.useMemo(()=>{const m=z=>!z||!isFinite(z)?"Unknown":new Date(z*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),S=z=>!z||!isFinite(z)?"Unknown":new Date(z*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}),j=z=>{if(!z||!isFinite(z))return"Unknown";const Z=new Date(z*1e3),O=new Date(Date.UTC(Z.getFullYear(),Z.getMonth(),Z.getDate())),K=O.getUTCDay()||7;O.setUTCDate(O.getUTCDate()+4-K);const D=new Date(Date.UTC(O.getUTCFullYear(),0,1)),M=Math.ceil(((O.getTime()-D.getTime())/864e5+1)/7);return`${O.getUTCFullYear()} • W${String(M).padStart(2,"0")}`},I=z=>c==="month"?S(z):c==="week"?j(z):m(z),E=s.map(z=>({it:z,ts:l[z.path]?.mtime}));E.sort((z,Z)=>(Z.ts||0)-(z.ts||0));const k={};for(const{it:z,ts:Z}of E){const O=I(Z);k[O]||(k[O]=[]),k[O].push(z)}const R=Object.keys(k);return R.sort((z,Z)=>z==="Unknown"?1:Z==="Unknown"?-1:0),R.map(z=>({key:z,items:k[z]}))},[s,l,c]),w=o.useMemo(()=>{const m=new Set;if(c==="week")for(const S of v){const j=S.items[0]?.path,I=j?l[j]?.mtime:void 0;if(I&&isFinite(I)){const E=new Date(I*1e3);m.add(E.toLocaleDateString(void 0,{year:"numeric",month:"short"}))}}else for(const S of v){const j=S.key.split(" ");j.length>=2&&m.add(`${j[0]} ${j[1]}`)}return Array.from(m)},[v,c,l]),T=o.useMemo(()=>{const m={};if(c==="week")for(const S of v){const j=S.items[0]?.path,I=j?l[j]?.mtime:void 0;if(I&&isFinite(I)){const k=new Date(I*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});m[k]=(m[k]||0)+S.items.length}}else for(const S of v){const j=S.key.split(" ").slice(0,2).join(" ");m[j]=(m[j]||0)+S.items.length}return m},[v,c,l]),f=o.useMemo(()=>Object.values(T).reduce((m,S)=>Math.max(m,S||0),0)||1,[T]),N=o.useRef({}),b=o.useRef(null),[C,x]=o.useState(null);return o.useEffect(()=>{const m=b.current;if(!m)return;const S=new IntersectionObserver(j=>{for(const I of j)if(I.isIntersecting){const E=I.target.dataset.month||null;E&&x(E)}},{root:m,threshold:.1});return Object.values(N.current).forEach(j=>j&&S.observe(j)),()=>S.disconnect()},[v]),o.useEffect(()=>{const m=S=>{try{const j=S?.detail?.kind;if(!j)return;const I=Date.now()/1e3;if(j==="today"){const E=c==="month"?new Date(I*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const R=new Date(I*1e3),z=new Date(Date.UTC(R.getFullYear(),R.getMonth(),R.getDate())),Z=z.getUTCDay()||7;z.setUTCDate(z.getUTCDate()+4-Z);const O=new Date(Date.UTC(z.getUTCFullYear(),0,1)),K=Math.ceil(((z.getTime()-O.getTime())/864e5+1)/7);return`${z.getUTCFullYear()} • W${String(K).padStart(2,"0")}`})():new Date(I*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"});N.current[E]?.scrollIntoView({behavior:"smooth",block:"start"})}else if(j==="this-month"){const E=new Date(I*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(N.current).find(R=>R?.dataset.month&&R.dataset.month.startsWith(E))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(j==="last-month"){const E=new Date,R=new Date(E.getFullYear(),E.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(N.current).find(Z=>Z?.dataset.month&&Z.dataset.month.startsWith(R))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(j==="oldest"){const E=Object.keys(N.current);E.length>0&&N.current[E[E.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})}}catch{}};return window.addEventListener("timeline-jump",m),()=>window.removeEventListener("timeline-jump",m)},[c]),e.jsxs("div",{ref:b,className:"space-y-8 relative",style:{scrollSnapType:"y proximity"},children:[e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-4 z-10 bg-blue-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=Date.now()/1e3,S=c==="month"?new Date(m*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const I=new Date(m*1e3),E=new Date(Date.UTC(I.getFullYear(),I.getMonth(),I.getDate())),k=E.getUTCDay()||7;E.setUTCDate(E.getUTCDate()+4-k);const R=new Date(Date.UTC(E.getUTCFullYear(),0,1)),z=Math.ceil(((E.getTime()-R.getTime())/864e5+1)/7);return`${E.getUTCFullYear()} • W${String(z).padStart(2,"0")}`})():new Date(m*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),j=N.current[S];j&&j.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to today",children:"Today"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-14 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=Date.now()/1e3,S=new Date(m*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(N.current).find(I=>I?.dataset.month&&I.dataset.month.startsWith(S))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to this month",children:"This Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-20 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=new Date,j=new Date(m.getFullYear(),m.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(N.current).find(E=>E?.dataset.month&&E.dataset.month.startsWith(j))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to last month",children:"Last Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-24 z-10 bg-gray-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const m=Object.keys(N.current);m.length>0&&N.current[m[m.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to oldest",children:"Oldest"}),w.length>1&&e.jsx("div",{className:"hidden md:flex flex-col gap-1 fixed right-4 top-1/2 -translate-y-1/2 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur p-2 rounded shadow max-h-[60vh] overflow-auto",children:w.map(m=>e.jsxs("button",{type:"button",className:`text-xs px-2 py-0.5 rounded flex items-center gap-1 ${C===m?"bg-blue-600 text-white":"text-blue-700 hover:bg-blue-100"}`,onClick:()=>{Object.values(N.current).find(j=>j?.dataset.month===m)?.scrollIntoView({behavior:"smooth",block:"start"})},children:[e.jsx("span",{children:m}),e.jsxs("span",{className:"opacity-70",children:["(",T[m]||0,")"]}),e.jsx("span",{className:"inline-block h-1 bg-current opacity-50",style:{width:`${Math.max(6,Math.round((T[m]||0)/f*60))}px`}})]},m))}),v.map(m=>e.jsxs("section",{"aria-label":m.key,ref:S=>{S&&(N.current[m.key]=S)},"data-month":m.key.split(" ").slice(0,2).join(" "),style:{scrollSnapAlign:"start"},children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur px-2 py-1 border-b text-sm font-medium",children:[m.key," • ",m.items.length]}),e.jsx("div",{className:"mt-3 grid gap-2 grid-cols-[repeat(auto-fill,minmax(160px,1fr))]",children:m.items.map(S=>{const j=r.has(S.path),I=S.path.split("/").pop()||S.path,E=l[S.path];return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden border ${j?"ring-2 ring-blue-500":"border-transparent"}`,onClick:()=>n(S.path),onDoubleClick:()=>i(S.path),title:S.path,children:[e.jsx(na,{src:Ne(a,t,S.path,256),alt:S.path,className:"w-full h-[160px] object-cover",enableProgressiveLoading:!0}),u&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:I,children:I}),e.jsxs("div",{className:"flex items-center gap-1",children:[E?.camera&&e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:E.camera}),typeof E?.fnumber=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["f/",E.fnumber]}),typeof E?.iso=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["ISO ",E.iso]})]})]})]},S.path)})})]},m.key))]})}function jl({open:a,onClose:t}){const s=Wr(),[r,n]=o.useState([]),[i,u]=o.useState(!1);return o.useEffect(()=>{let c;async function l(){if(s){u(!0);try{const d=await Ls(s,200);n(d.events||[])}catch{}u(!1),c=setTimeout(l,3500)}}return a&&l(),()=>{c&&clearTimeout(c)}},[s,a]),a?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:t}),e.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-full sm:w-[420px] bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-800 p-3 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Jobs"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:t,children:"Close"})]}),i&&e.jsx("div",{className:"text-sm text-gray-600",children:"Loading…"}),e.jsxs("div",{className:"space-y-2",children:[r.map((c,l)=>e.jsxs("div",{className:"p-2 border rounded text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:c.type}),c.type==="export"&&e.jsxs("span",{children:[c.copied," copied, ",c.skipped," skipped",c.errors?`, ${c.errors} errors`:""]}),c.type==="backup_run"&&e.jsxs("span",{children:[c.copied," backed up, ",c.skipped," skipped"]}),c.type==="backup_restore"&&e.jsxs("span",{children:[c.restored," restored"]}),c.type==="captions_build"&&e.jsxs("span",{children:[c.updated," captions"]}),c.type==="ocr_build"&&e.jsxs("span",{children:[c.updated," OCR"]}),c.type==="fast_build"&&e.jsxs("span",{children:[c.kind," index ",c.ok?"ok":"failed"]}),c.type==="trips_build"&&e.jsxs("span",{children:[c.trips," trips"]}),c.type==="thumbs_build"&&e.jsxs("span",{children:[c.made," thumbs"]}),c.type==="metadata_build"&&e.jsxs("span",{children:[c.updated," metadata"]}),c.type==="share_created"&&e.jsxs("span",{children:["link • ",c.count," items"]}),c.type==="share_open"&&e.jsx("span",{children:"link opened"}),c.type==="search"&&e.jsxs("span",{children:["“",c.query,"”"]})]}),e.jsx("div",{className:"text-gray-500",children:new Date(c.time).toLocaleString()})]},l)),r.length===0&&!i&&e.jsx("div",{className:"text-sm text-gray-600",children:"No recent jobs."})]})]})]}):null}function wl({onStartDemo:a,onSelectFolder:t,onClose:s}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",onClick:r=>r.stopPropagation(),children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto flex items-center justify-center mb-6",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-12 h-12 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Find any photo instantly"}),e.jsx("p",{className:"text-gray-600 mb-8 max-w-xl mx-auto",children:`Just describe what you're looking for - like "that beach sunset" or "my daughter's birthday" - and we'll find it. No more endless scrolling!`}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Search naturally"}),e.jsx("p",{className:"text-gray-600 text-sm",children:`Type what you remember - "kids at the park" or "that amazing sunset" - we'll find it.`})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Find people instantly"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"We recognize faces so you can find all photos of someone special in seconds."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx("button",{onClick:a,className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:"See it in action"}),e.jsx("button",{onClick:t,className:"px-8 py-4 bg-white border-2 border-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-50 transition-all shadow-md",children:"Use my photos"})]}),e.jsx("button",{onClick:s,className:"mt-6 text-gray-500 hover:text-gray-700 transition-colors",children:"Maybe later"})]})})})})}function Nl(){try{const a=navigator.userAgent,t=a.includes("Windows")||a.includes("Win64"),s=a.includes("Macintosh")||a.includes("Mac OS");return t?["~/Pictures","~/Desktop","~/Downloads","~/OneDrive/Pictures"]:s?["~/Pictures","~/Desktop","~/Downloads","~/Documents/Screenshots"]:["~/Pictures","~/Downloads","~/Desktop"]}catch{return["~/Pictures","~/Downloads"]}}function kl({open:a,onClose:t,onQuickStart:s,onCustom:r,onDemo:n,onTour:i}){const[u,c]=o.useState([]),[l,d]=o.useState(!1),[p,y]=o.useState(Nl()),v=ae(),w=v.state.settings.includeVideos,T=v.setSettings,[f,N]=o.useState(w),b=o.useMemo(()=>u.reduce((I,E)=>I+(E.files||0),0),[u]),[C,x]=o.useState(!1),[m,S]=o.useState("");o.useEffect(()=>{if(!a)return;let I=!1;return(async()=>{d(!0);try{const k=await fetch(`/scan_count?include_videos=${f?"1":"0"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!k.ok)throw new Error(await k.text());const R=await k.json();I||c(R.items||[])}catch{I||c([])}finally{I||d(!1)}})(),()=>{I=!0}},[a,p,f]);const j=I=>{if(!I)return"0 B";const E=["B","KB","MB","GB","TB"];let k=0,R=I;for(;R>=1024&&k<E.length-1;)R/=1024,k++;return`${R.toFixed(R<10?1:0)} ${E[k]}`};return a?e.jsxs("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center",children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1101] bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl p-5",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Welcome — let’s find your photos"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Get started fast (no cloud, local‑only)."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:"🚀 Quick Start (Recommended)"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Index common locations (local only)"}),e.jsx("ul",{className:"text-xs text-gray-700 mb-2",children:u.map(I=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:I.path}),e.jsx("span",{children:I.exists?`${I.files} • ${j(I.bytes)} (Found)`:"Not found"})]},I.path))}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 mb-2",children:[e.jsx("input",{id:"incl-videos",type:"checkbox",checked:f,onChange:I=>{N(I.target.checked);try{T({includeVideos:I.target.checked})}catch{}}}),e.jsx("label",{htmlFor:"incl-videos",children:"Include videos (may take longer)"})]}),e.jsx("button",{className:"px-3 py-1 rounded bg-blue-600 text-white text-sm disabled:opacity-50",disabled:l||C,onClick:async()=>{x(!0),S("Starting indexing…");try{s(p);const I=u.find(k=>k.exists)?.path||p[0],E=Date.now()+7e3;for(;Date.now()<E;){try{const k=await fetch(`/analytics?dir=${encodeURIComponent(I)}&limit=5`);if(k.ok){const z=((await k.json()).events||[]).find(Z=>Z.type==="index");if(z){S(`Indexed ${z.new}+${z.updated} (total ${z.total})`);break}}}catch{}await new Promise(k=>setTimeout(k,1e3))}}finally{setTimeout(()=>{x(!1),t()},1e3)}},children:l?"Calculating…":C?m||"Starting…":`Start indexing (${b} files • ${j(u.reduce((I,E)=>I+(E.bytes||0),0))})`}),!C&&!l&&e.jsx("div",{className:"mt-2 text-[11px] text-gray-600",children:"Runs in the background; you can start searching."})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:"🎯 Custom Setup"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Choose specific folders to index"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:r,children:"Select Folders…"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:"📂 Demo Mode"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Try with sample photos first"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:n,children:"Try Demo"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:"🎓 Guided Tour"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Learn the basics in under a minute"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:()=>i&&i(),children:"Start Tour"})]})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-600",children:"This runs locally; nothing leaves your device."}),e.jsx("div",{className:"text-xs text-gray-600",children:"You can add or remove folders anytime."}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:t,children:"Skip"})})]})]}):null}function Ma({onSearch:a}){const t=["photos from last summer","my kids playing","that trip to Paris","birthday celebrations","sunset at the beach","our dog running","Christmas morning","backyard BBQ","first day of school","weekend adventures","family dinner","vacation memories","funny moments","beautiful landscapes","selfies with friends"];return e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Try searching for:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.map(s=>e.jsx("button",{type:"button",onClick:()=>a(s),className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-600 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 text-left",children:s},s))}),e.jsx("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:"💡 Just describe what you're looking for in your own words"})]})}function Sl({onSelectDirectory:a,onImport:t,onHelp:s}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-6",children:[e.jsxs("button",{type:"button",onClick:a,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(Ze,{className:"w-8 h-8 text-blue-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Select Directory"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose a folder with your photos"})]}),e.jsxs("button",{type:"button",onClick:t,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(_e,{className:"w-8 h-8 text-green-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Import Photos"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Import from camera or device"})]}),e.jsxs("button",{type:"button",onClick:s,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(Jt,{className:"w-8 h-8 text-purple-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Get Help"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View tutorials and documentation"})]})]})}function fs({type:a,searchQuery:t,onAction:s,onDemoAction:r,onClearSearch:n,onOpenFilters:i,onOpenAdvanced:u,onOpenHelp:c,onStartTour:l,onOpenJobs:d,sampleQueries:p,onRunSample:y,hasActiveFilters:v,indexingProgress:w=0,estimatedTime:T}){const[f,N]=o.useState(!1),b=["beach sunset","birthday cake","mountain hike","red car"],C=Array.isArray(p)&&p.length>0?p:b,m=(()=>{switch(a){case"no-directory":return{icon:e.jsx(Ze,{className:"w-16 h-16 text-gray-400"}),title:"Welcome to Photo Search",description:"Get started by selecting a folder containing your photos. We'll analyze them to make them searchable.",actionLabel:"Select Photo Folder",action:s,demoActionLabel:"Try Demo Photos",demoAction:r,tips:["Choose a folder with JPEG, PNG, or other common photo formats","We'll scan and analyze your photos using AI for natural language search","Your photos stay on your device - we only create searchable indexes","You can always add more folders later from the settings"]};case"no-photos":return{icon:e.jsx(Xt,{className:"w-16 h-16 text-gray-400"}),title:"No Photos Found",description:"This folder doesn't contain any photos yet. Add some photos or select a different folder.",actionLabel:"Select Different Folder",action:s,tips:["Make sure your photos are in common formats like JPEG, PNG, or TIFF","Check that the folder contains actual photo files, not just subfolders","If you just added photos, try refreshing the library","You can also import photos from other locations"]};case"no-results":return{icon:e.jsx(Ee,{className:"w-16 h-16 text-gray-400"}),title:`No results for "${t}"`,description:"Try adjusting your search terms or filters. Here are some suggestions:",suggestions:["Use simpler words or phrases","Try searching for colors, objects, or locations","Check your spelling","Remove filters if any are applied","Try searching for people or events"],actionLabel:"Clear Search",action:s};case"indexing":return{icon:e.jsx(it,{className:"w-16 h-16 text-blue-500 animate-pulse"}),title:"Indexing Your Photos",description:`Analyzing your photos to make them searchable. ${w}% complete.`,progress:w,estimatedTime:T,tips:["This process analyzes each photo using AI to understand its content","You'll be able to search by objects, scenes, colors, and more","The process typically takes about 30 seconds per 100 photos","You can continue using other features while indexing runs"]};default:return{icon:e.jsx(Jt,{className:"w-16 h-16 text-gray-400"}),title:"Something went wrong",description:"We're having trouble loading this content.",actionLabel:"Try Again",action:s}}})();return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8 text-center",role:a==="indexing"?"status":void 0,"aria-live":a==="indexing"?"polite":void 0,children:[e.jsx("div",{className:"mb-6",children:m.icon}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-3",children:m.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md leading-relaxed",children:m.description}),m.progress!==void 0&&e.jsxs("div",{className:"w-full max-w-md mb-6",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${m.progress}%`}})}),m.estimatedTime&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Estimated time remaining: ",m.estimatedTime]})]}),m.suggestions&&e.jsxs("div",{className:"mb-6 text-left max-w-md",children:[e.jsx("ul",{className:"space-y-2",children:m.suggestions.map((S,j)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"•"}),S]},`suggestion-${S.substring(0,10)}-${j}`))}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[i&&e.jsxs("button",{type:"button",onClick:i,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx(Kn,{className:"w-4 h-4"})," Filters"]}),u&&e.jsxs("button",{type:"button",onClick:u,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx(Yn,{className:"w-4 h-4"})," Advanced"]}),v&&n&&e.jsx("button",{type:"button",onClick:n,className:"px-3 py-1.5 rounded border text-sm",children:"Clear filters"})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:C.map(S=>e.jsx("button",{type:"button",onClick:()=>y&&y(S),className:"px-2 py-1.5 rounded bg-gray-100 dark:bg-gray-800 text-xs",children:S},S))})]}),e.jsxs("div",{className:"flex gap-3 mb-6 flex-wrap justify-center",children:[m.action&&e.jsx("button",{type:"button",onClick:m.action,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:m.actionLabel}),m.demoAction&&e.jsx("button",{type:"button",onClick:m.demoAction,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:m.demoActionLabel}),a==="no-directory"&&l&&e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Start Tour"}),a==="indexing"&&d&&e.jsx("button",{type:"button",onClick:d,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"View Progress"}),c&&e.jsxs("button",{type:"button",onClick:c,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[e.jsx(Qn,{className:"w-4 h-4"})," Help"]})]}),m.tips&&e.jsxs("div",{className:"max-w-md",children:[e.jsxs("button",{type:"button",onClick:()=>N(!f),className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:[f?e.jsx(Ba,{className:"w-4 h-4"}):e.jsx(qa,{className:"w-4 h-4"}),f?"Hide tips":"Show tips"]}),f&&e.jsx("div",{className:"mt-4 text-left",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-3",children:"💡 Tips"}),e.jsx("ul",{className:"space-y-2",children:m.tips.map((S,j)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"•"}),S]},`tip-${S.substring(0,10)}-${j}`))})]})})]})]})}function Cl({isVisible:a,onDismiss:t,context:s,userActions:r}){const[n,i]=o.useState(0),[u,c]=o.useState(!1),d={search:[{title:"Natural Language Search",content:"Try searching for 'sunset at beach' or 'family birthday party' - our AI understands what you're looking for naturally.",trigger:!r.includes("searched")},{title:"Search by Colors & Objects",content:"Search for colors like 'red car' or objects like 'mountains' - our AI can find visual elements in your photos.",trigger:r.includes("searched")&&!r.includes("filtered")},{title:"Advanced Filters",content:"Use the filter panel to narrow by date, camera, location, or rating for more precise results.",trigger:r.includes("searched")&&r.length>3}],library:[{title:"Getting Started",content:"Select a folder with your photos to begin. We'll analyze them to make them searchable.",trigger:!r.includes("selected_directory")},{title:"Indexing Process",content:"After selecting photos, we'll index them using AI. This takes about 30 seconds per 100 photos.",trigger:r.includes("selected_directory")&&!r.includes("indexed")},{title:"Browse Your Photos",content:"Once indexed, you can browse all your photos here. Use the search bar above to find specific ones.",trigger:r.includes("indexed")}],results:[{title:"Photo Actions",content:"Select photos to share, favorite, tag, or organize them into collections.",trigger:!r.includes("selected_photo")},{title:"Quick Actions",content:"Use keyboard shortcuts: Space to select, Enter to view full size, F to favorite.",trigger:r.includes("selected_photo")&&!r.includes("used_keyboard")},{title:"Save Searches",content:"Save your favorite searches to quickly access them later from the Saved Searches section.",trigger:r.includes("searched")&&r.length>5}],collections:[{title:"Organize Your Photos",content:"Create collections to group related photos together, like 'Vacation 2024' or 'Family Events'.",trigger:!r.includes("created_collection")},{title:"Smart Collections",content:"Set up smart collections that automatically include photos based on your criteria.",trigger:r.includes("created_collection")}],settings:[{title:"Customize Your Experience",content:"Configure AI models, indexing preferences, and interface settings to match your needs.",trigger:!r.includes("changed_setting")},{title:"Performance Tuning",content:"Adjust indexing speed and search accuracy based on your hardware and preferences.",trigger:r.includes("changed_setting")}]}[s]?.filter(v=>v.trigger)||[];if(o.useEffect(()=>{if(d.length>0&&!u){const y=setInterval(()=>{i(v=>(v+1)%d.length)},8e3);return()=>clearInterval(y)}},[d.length,u]),!a||d.length===0)return null;const p=d[n];return e.jsx("div",{className:"fixed bottom-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jn,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Tip"})]}),e.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Dismiss tip",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:p.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed",children:p.content})]}),d.length>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:d.map((y,v)=>e.jsx("button",{type:"button",onClick:()=>i(v),className:`w-2 h-2 rounded-full transition-colors ${v===n?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`,"aria-label":`Go to tip ${v+1}`},`tip-${y.title}-${v}`))}),e.jsxs("button",{type:"button",onClick:()=>i((n+1)%d.length),className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:["Next",e.jsx(St,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:()=>{c(!0),t()},className:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Don't show tips like this"})})]})})}function Tl({isVisible:a,onComplete:t,completedSteps:s,onStepComplete:r}){const[n,i]=o.useState(!1),u=[{id:"select_directory",title:"Select Photo Directory",description:"Choose a folder containing your photos",action:"Get Started"},{id:"index_photos",title:"Index Your Photos",description:"Let AI analyze your photos for search",action:"Start Indexing"},{id:"first_search",title:"Try Your First Search",description:'Search for something like "beach sunset"',action:"Search Now"},{id:"explore_features",title:"Explore Features",description:"Try collections, favorites, and sharing",action:"Explore"}],c=s.length,l=u.length,d=c===l;return o.useEffect(()=>{if(d){const p=setTimeout(t,2e3);return()=>clearTimeout(p)}},[d,t]),a?e.jsx("div",{className:"fixed top-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>i(!n),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d?"bg-green-100 dark:bg-green-900/20":"bg-blue-100 dark:bg-blue-900/20"}`,children:d?e.jsx(Ct,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(Jt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Getting Started"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[c," of ",l," steps complete"]})]})]}),e.jsx(St,{className:`w-4 h-4 transition-transform ${n?"rotate-90":""}`})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${c/l*100}%`}})})}),n&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-h-80 overflow-y-auto",children:u.map((p,y)=>{const v=s.includes(p.id),w=s.length===y;return e.jsx("div",{className:`px-4 py-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0 ${v?"bg-green-50 dark:bg-green-900/10":w?"bg-blue-50 dark:bg-blue-900/10":"bg-gray-50 dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 ${v?"bg-green-100 dark:bg-green-900/20":"bg-gray-200 dark:bg-gray-600"}`,children:v?e.jsx(Ct,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:y+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-medium text-sm ${v?"text-green-800 dark:text-green-200":"text-gray-900 dark:text-white"}`,children:p.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:p.description}),!v&&w&&e.jsx("button",{type:"button",onClick:()=>r(p.id),className:"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",children:p.action})]})]})},p.id)})})})]})}):null}function El({isVisible:a,onComplete:t,onCancel:s,directory:r,engine:n}){const[i,u]=o.useState({phase:"scanning",progress:0,totalFiles:0,processedFiles:0,message:"Scanning your photo directory..."}),[c,l]=o.useState(!1),[d,p]=o.useState(!1);o.useEffect(()=>{if(!a||c)return;const w=[{phase:"scanning",duration:2e3,message:"Scanning your photo directory..."},{phase:"analyzing",duration:3e3,message:"Analyzing photo metadata..."},{phase:"indexing",duration:8e3,message:"Building AI search index..."},{phase:"complete",duration:1e3,message:"Indexing complete! Ready to search."}];let T=0,f=0;const N=w.reduce((C,x)=>C+x.duration,0),b=setInterval(()=>{if(T>=w.length){clearInterval(b),t();return}const C=w[T],x=f/N*100;u({phase:C.phase,progress:Math.min(x,100),totalFiles:1250,processedFiles:Math.floor(f/N*1250),currentFile:C.phase==="indexing"?`/photos/vacation-${Math.floor(Math.random()*100)}.jpg`:void 0,estimatedTimeRemaining:C.phase==="indexing"?Math.max(0,Math.floor((N-f)/1e3)):void 0,message:C.message}),f+=100,f>=w.slice(0,T+1).reduce((m,S)=>m+S.duration,0)&&T++},100);return()=>clearInterval(b)},[a,c,t]);const y=w=>{switch(w){case"scanning":return e.jsx(ct,{className:"w-5 h-5 text-blue-500"});case"analyzing":return e.jsx(Va,{className:"w-5 h-5 text-purple-500 animate-spin"});case"indexing":return e.jsx(qe,{className:"w-5 h-5 text-green-500"});case"complete":return e.jsx(Ct,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(Cs,{className:"w-5 h-5 text-red-500"});default:return e.jsx(ct,{className:"w-5 h-5 text-gray-500"})}},v=w=>{switch(w){case"scanning":return"bg-blue-500";case"analyzing":return"bg-purple-500";case"indexing":return"bg-green-500";case"complete":return"bg-green-500";case"error":return"bg-red-500";default:return"bg-gray-500"}};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Setting up your photo search"}),e.jsx("button",{type:"button",onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Cancel indexing",children:e.jsx(Ce,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[y(i.phase),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:[i.phase==="scanning"&&"Scanning photos",i.phase==="analyzing"&&"Analyzing metadata",i.phase==="indexing"&&"Building search index",i.phase==="complete"&&"Ready to search!",i.phase==="error"&&"Indexing failed"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.message})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round(i.progress),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${v(i.phase)}`,style:{width:`${i.progress}%`}})})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("span",{children:[i.processedFiles," of ",i.totalFiles," photos"]}),i.estimatedTimeRemaining&&e.jsxs("span",{children:[i.estimatedTimeRemaining,"s remaining"]})]}),i.currentFile&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 mb-4 truncate",children:["Processing: ",i.currentFile]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>l(!c),className:"flex items-center gap-2 px-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:c?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4"}),"Resume"]}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-4 h-4"}),"Pause"]})}),e.jsxs("button",{type:"button",onClick:()=>p(!d),className:"flex items-center gap-2 px-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),d?"Hide":"Show"," Details"]})]}),d&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"What's happening?"}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Scanning: Finding all your photos and videos"}),e.jsx("p",{children:"• Analyzing: Extracting metadata and features"}),e.jsx("p",{children:"• Indexing: Building AI search model for fast queries"}),e.jsx("p",{children:"• Complete: Ready for natural language search!"})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 text-center",children:"💡 Tip: You can continue using the app while indexing runs in the background"})})]})}):null}function Pl({photoCount:a=0,indexedCount:t=0,searchProvider:s="local",isIndexing:r=!1,isConnected:n=!0,currentDirectory:i="",lastSync:u,activeJobs:c=0}){const[l,d]=o.useState(0),[p,y]=o.useState(0);o.useEffect(()=>{const T=setInterval(()=>{d(Math.random()*30+(r?40:10)),y(Math.random()*20+30)},2e3);return()=>clearInterval(T)},[r]);const v=T=>{if(!T)return"No directory selected";const f=T.split("/");return f.length>3?`.../${f.slice(-2).join("/")}`:T},w=T=>{if(!T)return"Never";const N=new Date().getTime()-T.getTime(),b=Math.floor(N/6e4);if(b<1)return"Just now";if(b<60)return`${b}m ago`;const C=Math.floor(b/60);return C<24?`${C}h ago`:`${Math.floor(C/24)}d ago`};return e.jsx("div",{className:"status-bar",children:e.jsxs("div",{className:"status-content",children:[e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Xn,{className:"status-icon"}),e.jsx("span",{className:"status-text",children:v(i)})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(Xt,{className:"status-icon"}),e.jsxs("span",{children:[a.toLocaleString()," photos"]})]}),r?e.jsxs("div",{className:"status-item",children:[e.jsx("div",{className:"status-spinner"}),e.jsxs("span",{className:"status-text processing",children:["Indexing... ",t,"/",a]})]}):e.jsxs("div",{className:"status-item",children:[e.jsx(Ct,{className:"status-icon"}),e.jsxs("span",{className:"status-text success",children:[t.toLocaleString()," indexed"]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Ee,{className:"status-icon"}),e.jsx("span",{className:"capitalize",children:s})]}),c>0&&e.jsxs("div",{className:"status-item",children:[e.jsx(Ha,{className:"status-icon"}),e.jsxs("span",{className:"status-text warning",children:[c," active job",c!==1?"s":""]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(ct,{className:"status-icon"}),e.jsxs("span",{children:["Synced ",w(u)]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Ts,{className:"status-icon"}),e.jsxs("span",{children:[l.toFixed(0),"%"]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(Bt,{className:"status-icon"}),e.jsxs("span",{children:[p.toFixed(0),"%"]})]}),e.jsx("div",{className:"status-item",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Wa,{className:"status-icon"}),e.jsx("span",{className:"status-text success",children:"Connected"})]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"status-icon"}),e.jsx("span",{className:"status-text error",children:"Offline"})]})})]})]})})}function Il({jobs:a,onPause:t,onResume:s,onCancel:r,onRetry:n,onClear:i,onClearAll:u}){const[c,l]=o.useState(!1),[d,p]=o.useState(new Set),y=a.filter(x=>x.status==="running"||x.status==="paused"),v=a.filter(x=>x.status==="completed"||x.status==="failed"||x.status==="cancelled"),w=x=>{const m=new Set(d);m.has(x)?m.delete(x):m.add(x),p(m)},T=x=>({index:e.jsx(Bt,{className:"w-4 h-4"}),search:e.jsx(Ee,{className:"w-4 h-4"}),edit:e.jsx(Xt,{className:"w-4 h-4"}),export:e.jsx(_e,{className:"w-4 h-4"}),import:e.jsx(it,{className:"w-4 h-4"}),backup:e.jsx(Bt,{className:"w-4 h-4"}),analyze:e.jsx(Ts,{className:"w-4 h-4"}),restore:e.jsx(ks,{className:"w-4 h-4"})})[x],f=x=>({queued:"text-gray-500",running:"text-blue-500",paused:"text-yellow-500",completed:"text-green-500",failed:"text-red-500",cancelled:"text-gray-400"})[x],N=x=>{switch(x){case"queued":return e.jsx(ct,{className:"w-4 h-4"});case"running":return e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"});case"paused":return e.jsx(Yt,{className:"w-4 h-4"});case"completed":return e.jsx(Ct,{className:"w-4 h-4"});case"failed":return e.jsx(Zn,{className:"w-4 h-4"});case"cancelled":return e.jsx(Cs,{className:"w-4 h-4"})}},b=(x,m)=>{if(!x)return"";const j=(m||new Date).getTime()-x.getTime(),I=Math.floor(j/1e3),E=Math.floor(I/60),k=Math.floor(E/60);return k>0?`${k}h ${E%60}m`:E>0?`${E}m ${I%60}s`:`${I}s`},C=x=>{const m=Math.floor(x/60),S=Math.floor(m/60);return S>0?`${S} hour${S>1?"s":""}`:m>0?`${m} minute${m>1?"s":""}`:`${x} second${x>1?"s":""}`};return a.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:e.jsxs("button",{onClick:()=>l(!c),className:"bg-white dark:bg-gray-800 rounded-full shadow-lg p-3 flex items-center gap-2 hover:shadow-xl transition-shadow",children:[e.jsx(Ha,{className:"w-5 h-5 text-blue-500"}),y.length>0&&e.jsx("span",{className:"bg-blue-500 text-white text-xs rounded-full px-2 py-0.5",children:y.length})]})}),c&&e.jsxs("div",{className:"fixed bottom-20 right-4 w-96 max-h-[600px] bg-white dark:bg-gray-800 rounded-lg shadow-2xl z-40 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold",children:"What's happening"}),e.jsxs("div",{className:"flex items-center gap-2",children:[v.length>0&&e.jsx("button",{onClick:u,className:"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Clear All"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[y.length>0&&e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Working on"}),e.jsx("div",{className:"space-y-2",children:y.map(x=>e.jsx(Da,{job:x,isExpanded:d.has(x.id),onToggleExpanded:()=>w(x.id),onPause:t,onResume:s,onCancel:r,getJobIcon:T,getStatusIcon:N,getStatusColor:f,formatDuration:b,formatTimeRemaining:C},x.id))})]}),v.length>0&&e.jsxs("div",{className:"p-3 border-t dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Recently finished"}),e.jsx("div",{className:"space-y-2",children:v.map(x=>e.jsx(Da,{job:x,isExpanded:d.has(x.id),onToggleExpanded:()=>w(x.id),onRetry:n,onClear:i,getJobIcon:T,getStatusIcon:N,getStatusColor:f,formatDuration:b,formatTimeRemaining:C},x.id))})]})]})]})]})}function Da({job:a,isExpanded:t,onToggleExpanded:s,onPause:r,onResume:n,onCancel:i,onRetry:u,onClear:c,getJobIcon:l,getStatusIcon:d,getStatusColor:p,formatDuration:y,formatTimeRemaining:v}){const w=a.total?(a.progress||0)/a.total*100:0;return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("div",{className:"mt-0.5",children:l(a.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:a.title}),e.jsxs("div",{className:`flex items-center gap-1 ${p(a.status)}`,children:[d(a.status),e.jsx("span",{className:"text-xs capitalize",children:a.status})]})]}),a.status==="running"&&a.total&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:[a.progress||0," of ",a.total,a.type==="backup"?" photos saved":a.type==="index"?" photos found":a.type==="export"?" photos exported":" items"]}),e.jsxs("span",{children:[w.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all",style:{width:`${w}%`}})}),(a.estimatedTimeRemaining||a.speed)&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mt-1",children:[a.estimatedTimeRemaining&&e.jsxs("span",{children:["About ",v(a.estimatedTimeRemaining)," left"]}),a.speed&&e.jsx("span",{children:a.speed})]}),a.currentItem&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:[a.type==="backup"?"Saving: ":a.type==="index"?"Looking at: ":"Processing: ",a.currentItem]})]}),a.startTime&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[a.status==="completed"?"Finished in ":a.status==="failed"?"Failed after ":a.status==="running"?"Running for ":"",y(a.startTime,a.endTime),a.status==="completed"&&e.jsxs("span",{className:"ml-2",children:[a.successCount&&e.jsxs("span",{className:"text-green-500",children:["✓ ",a.successCount]}),a.warningCount&&e.jsxs("span",{className:"text-yellow-500 ml-1",children:["⚠ ",a.warningCount]}),a.errorCount&&e.jsxs("span",{className:"text-red-500 ml-1",children:["✗ ",a.errorCount]})]})]}),t&&(a.error||a.description)&&e.jsx("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300",children:a.error?e.jsx("div",{className:"text-red-500",children:a.error}):e.jsx("div",{children:a.description})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[a.status==="running"&&a.canPause&&e.jsx("button",{onClick:()=>r?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Yt,{className:"w-3 h-3"})}),a.status==="paused"&&e.jsx("button",{onClick:()=>n?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(qe,{className:"w-3 h-3"})}),(a.status==="running"||a.status==="paused")&&a.canCancel&&e.jsx("button",{onClick:()=>i?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded text-red-500",children:e.jsx(Ce,{className:"w-3 h-3"})}),a.status==="failed"&&a.canRetry&&e.jsx("button",{onClick:()=>u?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(ks,{className:"w-3 h-3"})}),(a.status==="completed"||a.status==="failed"||a.status==="cancelled")&&e.jsx("button",{onClick:()=>c?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(lt,{className:"w-3 h-3"})}),(a.error||a.description)&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:t?e.jsx(Ba,{className:"w-3 h-3"}):e.jsx(qa,{className:"w-3 h-3"})})]})]})})}function Fl({dir:a}){const[t,s]=o.useState([]),[r,n]=o.useState(!1),[i,u]=o.useState("");async function c(){n(!0),u("");try{const l=await ur(a||void 0);s(l.shares||[])}catch(l){u(l instanceof Error?l.message:"Failed to load shares")}finally{n(!1)}}return o.useEffect(()=>{c()},[a]),e.jsxs("div",{children:[i&&e.jsx("div",{className:"text-red-700 text-sm mb-2",children:i}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," link",t.length!==1?"s":""]}),e.jsx("button",{onClick:c,className:"px-2 py-1 border rounded text-sm",children:"Refresh"})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 pr-2",children:"Token"}),e.jsx("th",{className:"py-1 pr-2",children:"Created"}),e.jsx("th",{className:"py-1 pr-2",children:"Expires"}),e.jsx("th",{className:"py-1 pr-2",children:"Count"}),e.jsx("th",{className:"py-1 pr-2",children:"Access"}),e.jsx("th",{className:"py-1 pr-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[t.map(l=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 pr-2 font-mono text-xs",children:l.token}),e.jsx("td",{className:"py-1 pr-2",children:new Date(l.created).toLocaleString()}),e.jsxs("td",{className:"py-1 pr-2",children:[l.expires?new Date(l.expires).toLocaleString():"—",l.expired?e.jsx("span",{className:"ml-1 text-red-700",children:"(expired)"}):null,!l.expired&&l.expires&&(()=>{const d=new Date(l.expires).getTime()-Date.now();return d>0&&d<24*3600*1e3?e.jsx("span",{className:"ml-1 text-amber-700",children:"(expires soon)"}):null})()]}),e.jsx("td",{className:"py-1 pr-2",children:l.count}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:l.view_only?"View-only":"Downloadable"}),l.has_password?e.jsx("span",{className:"text-xs bg-gray-200 rounded px-1",children:"Protected"}):null]})}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;window.open(d,"_blank")},children:"Open"}),e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;await navigator.clipboard.writeText(d),alert("Copied link to clipboard")},children:"Copy Link"}),e.jsx("button",{className:"px-2 py-0.5 border rounded text-red-700",onClick:async()=>{if(confirm("Revoke this share link?"))try{await hr(l.token),await c()}catch{}},children:"Revoke"})]})})]},l.token)),t.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"No share links yet."})}),r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"Loading…"})})]})]})})]})}function $l({cameras:a=[],popularISOs:t=[100,200,400,800,1600,3200],popularApertures:s=[1.4,1.8,2.8,4,5.6,8],yearRange:r,camera:n,setCamera:i,isoMin:u,setIsoMin:c,isoMax:l,setIsoMax:d,fMin:p,setFMin:y,fMax:v,setFMax:w,dateFrom:T,setDateFrom:f,dateTo:N,setDateTo:b,onApplyFilters:C,onClearFilters:x,compact:m=!1}){const[S,j]=o.useState("camera"),I=n||u||l||p||v||T||N,E=[{id:"camera",label:"Camera",icon:Ga,content:e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>i(""),className:`px-2 py-1 text-xs rounded border ${n?"bg-white border-gray-300 hover:bg-gray-50":"bg-blue-600 text-white border-blue-600"}`,children:"Any Camera"}),a.slice(0,m?4:8).map(k=>e.jsx("button",{type:"button",onClick:()=>i(n===k?"":k),className:`px-2 py-1 text-xs rounded border truncate max-w-32 ${n===k?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,title:k,children:k.length>20?k.substring(0,20)+"...":k},k))]})})},{id:"aperture",label:"Aperture",icon:ei,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select f-stop range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{y(""),w("")},className:`px-2 py-1 text-xs rounded border ${!p&&!v?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),s.map(k=>e.jsxs("button",{type:"button",onClick:()=>{const R=k.toString();p===R&&v===R?(y(""),w("")):(y(R),w(R))},className:`px-2 py-1 text-xs rounded border ${p===k.toString()&&v===k.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:["f/",k]},k))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:p,onChange:k=>y(k.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"1.4"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:v,onChange:k=>w(k.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"8.0"})]})]})]})},{id:"iso",label:"ISO",icon:Es,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select ISO range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{c(""),d("")},className:`px-2 py-1 text-xs rounded border ${!u&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),e.jsx("button",{type:"button",onClick:()=>{c(""),d("800")},className:`px-2 py-1 text-xs rounded border ${!u&&l==="800"?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Low (≤800)"}),e.jsx("button",{type:"button",onClick:()=>{c("800"),d("")},className:`px-2 py-1 text-xs rounded border ${u==="800"&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"High (≥800)"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(k=>e.jsx("button",{type:"button",onClick:()=>{const R=k.toString();u===R&&l===R?(c(""),d("")):(c(R),d(R))},className:`px-2 py-1 text-xs rounded border ${u===k.toString()&&l===k.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:k},k))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:u,onChange:k=>c(k.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:l,onChange:k=>d(k.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"3200"})]})]})]})},{id:"date",label:"Date",icon:Ka,content:e.jsxs("div",{className:"space-y-2",children:[r&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>{f(""),b("")},className:`px-2 py-1 text-xs rounded border ${!T&&!N?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any Year"}),Array.from({length:Math.min(6,r[0]-r[1]+1)},(k,R)=>r[0]-R).map(k=>e.jsx("button",{type:"button",onClick:()=>{const R=`${k}-01-01`,z=`${k}-12-31`;T===R&&N===z?(f(""),b("")):(f(R),b(z))},className:`px-2 py-1 text-xs rounded border ${T===`${k}-01-01`&&N===`${k}-12-31`?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:k},k))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From"}),e.jsx("input",{type:"date",value:T,onChange:k=>f(k.target.value),className:"w-full text-xs border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To"}),e.jsx("input",{type:"date",value:N,onChange:k=>b(k.target.value),className:"w-full text-xs border rounded px-2 py-1"})]})]})]})}];return m?e.jsxs("div",{className:"bg-white border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Quick Filters"}),I&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:C,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700",children:"Apply"}),I&&e.jsx("button",{type:"button",onClick:x,className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",children:"Clear"})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:E.map(k=>{const R=k.icon;return e.jsxs("div",{className:"flex-shrink-0 min-w-48",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(R,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:k.label})]}),e.jsx("div",{className:"text-xs",children:k.content})]},k.id)})})]}):e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Quick Filters"}),I&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[[n,u,l,p,v,T,N].filter(Boolean).length," active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:C,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"Apply"}),I&&e.jsx("button",{type:"button",onClick:x,className:"text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300",children:"Clear All"})]})]}),e.jsx("div",{className:"flex border-b",children:E.map(k=>{const R=k.icon;return e.jsxs("button",{type:"button",onClick:()=>j(k.id),className:`flex-1 flex items-center justify-center gap-2 p-3 text-sm border-r last:border-r-0 ${S===k.id?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(R,{className:"w-4 h-4"}),k.label]},k.id)})}),e.jsx("div",{className:"p-4",children:E.find(k=>k.id===S)?.content})]})}function Ml({show:a,onClose:t,onApply:s,favOnly:r,setFavOnly:n,tagFilter:i,setTagFilter:u,camera:c,setCamera:l,isoMin:d,setIsoMin:p,isoMax:y,setIsoMax:v,dateFrom:w,setDateFrom:T,dateTo:f,setDateTo:N,fMin:b,setFMin:C,fMax:x,setFMax:m,place:S,setPlace:j,useCaps:I,setUseCaps:E,useOcr:k,setUseOcr:R,hasText:z,setHasText:Z,availableCameras:O=[],yearRange:K}){const[D,M]=o.useState("quick");if(!a)return null;const B=()=>{n(!1),u(""),l(""),p(""),v(""),T(""),N(""),C(""),m(""),j(""),E(!1),R(!1),Z(!1)},te=!!(r||i||c||d||y||w||f||b||x||S||I||k||z);return e.jsxs("div",{className:"absolute right-6 top-20 z-50 bg-white border border-gray-200 shadow-lg rounded-lg w-[500px] max-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"font-semibold",children:"Advanced Filters"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[te&&e.jsx("button",{type:"button",className:"text-sm px-2 py-1 border rounded text-gray-700 hover:bg-gray-50",onClick:B,title:"Clear all filters",children:"Clear all"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 p-1",onClick:t,children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{type:"button",onClick:()=>M("quick"),className:`flex-1 flex items-center justify-center gap-2 p-3 text-sm border-r ${D==="quick"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(Es,{className:"w-4 h-4"}),"Quick Filters"]}),e.jsxs("button",{type:"button",onClick:()=>M("advanced"),className:`flex-1 flex items-center justify-center gap-2 p-3 text-sm ${D==="advanced"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(ti,{className:"w-4 h-4"}),"Advanced"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:D==="quick"?e.jsx($l,{cameras:O,yearRange:K,camera:c,setCamera:l,isoMin:d,setIsoMin:p,isoMax:y,setIsoMax:v,fMin:b,setFMin:C,fMax:x,setFMax:m,dateFrom:w,setDateFrom:T,dateTo:f,setDateTo:N,onApplyFilters:s,onClearFilters:B,compact:!0}):e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Basic Filters"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"flt-fav",children:"Favorites only"}),e.jsx("input",{id:"flt-fav",type:"checkbox",checked:r,onChange:F=>n(F.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-tags",children:"Tags (comma-separated)"}),e.jsx("input",{id:"flt-tags",className:"w-full border rounded px-2 py-1",value:i,onChange:F=>u(F.target.value),placeholder:"portrait, landscape, vacation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-place",children:"Location/Place"}),e.jsx("input",{id:"flt-place",className:"w-full border rounded px-2 py-1",value:S,onChange:F=>j(F.target.value),placeholder:"New York, Beach, Mountains"})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Search Features"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-caps",children:[e.jsx("span",{children:"Use AI captions"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search in generated image descriptions"})]}),e.jsx("input",{id:"flt-caps",type:"checkbox",checked:I,onChange:F=>E(F.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-ocr",children:[e.jsx("span",{children:"Use OCR"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search for text within images"})]}),e.jsx("input",{id:"flt-ocr",type:"checkbox",checked:k,onChange:F=>R(F.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-hastext",children:[e.jsx("span",{children:"Has text"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Only images containing readable text"})]}),e.jsx("input",{id:"flt-hastext",type:"checkbox",checked:z,onChange:F=>Z(F.target.checked)})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Manual Input"}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-camera-manual",children:"Camera Model"}),e.jsx("input",{id:"flt-camera-manual",className:"w-full border rounded px-2 py-1",value:c,onChange:F=>l(F.target.value),placeholder:"Canon EOS R5, iPhone 12 Pro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-iso-min-manual",children:"ISO Min"}),e.jsx("input",{id:"flt-iso-min-manual",type:"number",min:"50",max:"102400",className:"w-full border rounded px-2 py-1",value:d,onChange:F=>p(F.target.value),placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-iso-max-manual",children:"ISO Max"}),e.jsx("input",{id:"flt-iso-max-manual",type:"number",min:"50",max:"102400",className:"w-full border rounded px-2 py-1",value:y,onChange:F=>v(F.target.value),placeholder:"3200"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-fmin-manual",children:"f-stop Min"}),e.jsx("input",{id:"flt-fmin-manual",type:"number",step:"0.1",min:"0.7",max:"32",className:"w-full border rounded px-2 py-1",value:b,onChange:F=>C(F.target.value),placeholder:"1.4"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-fmax-manual",children:"f-stop Max"}),e.jsx("input",{id:"flt-fmax-manual",type:"number",step:"0.1",min:"0.7",max:"32",className:"w-full border rounded px-2 py-1",value:x,onChange:F=>m(F.target.value),placeholder:"8.0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-from-manual",children:"Date From"}),e.jsx("input",{id:"flt-date-from-manual",type:"date",className:"w-full border rounded px-2 py-1",value:w,onChange:F=>T(F.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-to-manual",children:"Date To"}),e.jsx("input",{id:"flt-date-to-manual",type:"date",className:"w-full border rounded px-2 py-1",value:f,onChange:F=>N(F.target.value)})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t bg-gray-50",children:[e.jsx("button",{type:"button",onClick:B,className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear All Filters"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded border border-gray-300 hover:bg-gray-50",onClick:t,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",onClick:s,children:"Apply Filters"})]})]})]})}function Dl({selectedView:a,onViewChange:t,library:s=[],favorites:r=[],collections:n=[],clusters:i=[],savedSearches:u=[],smart:c=[],trips:l=[],isOpen:d=!1,onClose:p}){const y=[{id:"library",label:"All Photos",icon:dt,count:s?.length||0},{id:"results",label:"Search Results",icon:Ee},{id:"favorites",label:"Favorites",icon:Gt,count:r?.length||0}],v=[{id:"people",label:"People",icon:Ve,count:i?.length||0},{id:"map",label:"Places",icon:Is},{id:"calendar",label:"Calendar",icon:Ka},{id:"collections",label:"Collections",icon:Ya,count:n?.length||0},{id:"trips",label:"Trips",icon:si,count:l?.length||0}],w=[{id:"smart",label:"Smart Collections",icon:ai,count:c?.length||0},{id:"saved",label:"Saved Searches",icon:Ee,count:u?.length||0},{id:"tasks",label:"Tasks",icon:ri}],T=f=>e.jsxs("button",{type:"button",onClick:()=>t(f.id),className:`nav-item ${a===f.id?"active":""}`,children:[e.jsxs("div",{className:"nav-item-content",children:[e.jsx(f.icon,{className:"nav-item-icon"}),e.jsx("span",{className:"nav-item-label",children:f.label})]}),f.count!==void 0&&e.jsx("span",{className:"nav-item-count",children:f.count})]},f.id);return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:p}),e.jsxs("div",{className:`sidebar-container ${d?"open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"sidebar-title",children:"PhotoVault"}),e.jsx("p",{className:"sidebar-subtitle",children:"AI-Powered Photo Management"})]}),e.jsx("button",{type:"button",onClick:p,className:"sidebar-close",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Library"}),e.jsx("div",{className:"nav-items",children:y.map(T)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Organize"}),e.jsx("div",{className:"nav-items",children:v.map(T)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Smart Features"}),e.jsx("div",{className:"nav-items",children:w.map(T)})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsx("button",{type:"button",className:"sidebar-settings-button",onClick:()=>window.location.href="/settings",children:"Settings"})})]})]})}class _a extends o.Component{constructor(s){super(s);oe(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});oe(this,"handleReload",()=>{window.location.reload()});oe(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),this.setState(n=>({errorInfo:r,errorCount:n.errorCount+1})),this.props.onError&&this.props.onError(s,r),typeof window<"u"&&window.logErrorToService&&window.logErrorToService({error:s.toString(),errorInfo:r.componentStack,timestamp:new Date().toISOString()})}render(){return this.state.hasError?this.props.fallback?e.jsx(e.Fragment,{children:this.props.fallback}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx(Qa,{className:"w-6 h-6 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 mb-2",children:"Oops! Something unexpected happened"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Don't worry - your photos are safe. Let's get you back on track."}),!1,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:this.handleReset,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Try again"]}),e.jsx("button",{onClick:this.handleReload,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Reload page"}),e.jsxs("button",{onClick:this.handleGoHome,className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Ja,{className:"w-4 h-4"}),"Go to home"]})]}),this.state.errorCount>2&&e.jsx("p",{className:"mt-4 text-xs text-center text-gray-500",children:"Having trouble? A quick refresh usually helps."})]})}):this.props.children}}class Oa extends o.Component{constructor(s){super(s);oe(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error(`Error in ${this.props.sectionName||"section"}:`,s),this.setState({errorInfo:r})}render(){return this.state.hasError?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qa,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-red-900",children:["Couldn't load ",this.props.sectionName||"this section"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:this.state.error?.message||"Something went wrong, but we can fix it"}),e.jsx("button",{onClick:this.handleReset,className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"Try again"})]})]})}):this.props.children}}class _l{constructor(){oe(this,"QUEUE_KEY","offline_action_queue");oe(this,"MAX_RETRIES",3);oe(this,"isOnline");oe(this,"syncInProgress",!1);oe(this,"listeners",new Set);this.isOnline=navigator.onLine,this.setupEventListeners(),this.checkConnection()}setupEventListeners(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),setInterval(()=>this.checkConnection(),3e4)}async checkConnection(){try{const t=await fetch("/api/ping",{method:"HEAD",cache:"no-cache"});this.setOnlineStatus(t.ok)}catch{this.setOnlineStatus(!1)}}setOnlineStatus(t){this.isOnline!==t&&(this.isOnline=t,this.notifyListeners(t),t&&this.syncQueue())}handleOnline(){console.log("[Offline Service] Connection restored"),this.setOnlineStatus(!0)}handleOffline(){console.log("[Offline Service] Connection lost"),this.setOnlineStatus(!1)}notifyListeners(t){this.listeners.forEach(s=>s(t))}onStatusChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}getStatus(){return this.isOnline}async queueAction(t){const s={...t,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),retries:0},r=this.getQueue();return r.push(s),this.saveQueue(r),this.isOnline&&this.syncQueue(),s.id}getQueue(){try{const t=localStorage.getItem(this.QUEUE_KEY);return t?JSON.parse(t):[]}catch{return[]}}saveQueue(t){try{localStorage.setItem(this.QUEUE_KEY,JSON.stringify(t))}catch(s){console.error("[Offline Service] Failed to save queue:",s)}}async syncQueue(){if(!this.isOnline||this.syncInProgress)return;this.syncInProgress=!0;const t=this.getQueue(),s=[];for(const r of t)try{await this.processAction(r),console.log(`[Offline Service] Synced action: ${r.id}`)}catch(n){console.error(`[Offline Service] Failed to sync action: ${r.id}`,n),r.retries++,r.retries<this.MAX_RETRIES?s.push(r):console.error(`[Offline Service] Max retries reached for action: ${r.id}`)}this.saveQueue(s),this.syncInProgress=!1,s.length>0&&setTimeout(()=>this.syncQueue(),6e4)}async processAction(t){const{apiSearch:s,apiSetCollection:r,apiBatchTag:n,apiBatchDelete:i}=await he(async()=>{const{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}=await Promise.resolve().then(()=>pe);return{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}},void 0,import.meta.url);switch(t.type){case"search":await s(t.payload.dir,t.payload.query,t.payload.topK);break;case"collection":await r(t.payload.dir,t.payload.name,t.payload.paths);break;case"tag":await n(t.payload.dir,t.payload.paths,t.payload.tags,t.payload.operation);break;case"delete":await i(t.payload.dir,t.payload.paths,t.payload.useOsTrash);break;default:throw new Error(`Unknown action type: ${t.type}`)}}async precacheImages(t){if("caches"in window)try{await(await caches.open("photovault-images")).addAll(t)}catch(s){console.error("[Offline Service] Failed to precache images:",s)}}async getCachedImage(t){if(!("caches"in window))return null;try{return await(await caches.open("photovault-images")).match(t)}catch{return null}}async registerBackgroundSync(t){if(!(!("serviceWorker"in navigator)||!("sync"in ServiceWorkerRegistration.prototype)))try{await(await navigator.serviceWorker.ready).sync.register(t),console.log(`[Offline Service] Background sync registered: ${t}`)}catch(s){console.error("[Offline Service] Failed to register background sync:",s)}}async clearOfflineData(){if(localStorage.removeItem(this.QUEUE_KEY),"caches"in window){const t=await caches.keys();await Promise.all(t.filter(s=>s.startsWith("photovault-")).map(s=>caches.delete(s)))}console.log("[Offline Service] Offline data cleared")}}const bs=new _l;function Ol(){const[a,t]=o.useState(!0),[s,r]=o.useState(!1),[n,i]=o.useState(!1);return o.useEffect(()=>(t(bs.getStatus()),bs.onStatusChange(c=>{t(c),r(!0),c&&(i(!0),bs.syncQueue().then(()=>{i(!1)})),setTimeout(()=>r(!1),3e3)})),[]),a&&!s&&!n?null:e.jsxs(e.Fragment,{children:[!a&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg shadow-lg",children:[e.jsx(js,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Offline Mode"})]}),s&&e.jsx("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg transition-all duration-300 ${a?"bg-green-500 text-white":"bg-orange-500 text-white"}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Wa,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Back Online"}),n&&e.jsx("div",{className:"text-sm opacity-90",children:"Syncing changes..."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"You're Offline"}),e.jsx("div",{className:"text-sm opacity-90",children:"Changes will sync when reconnected"})]})]})}),n&&a&&!s&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Syncing offline changes..."})]})]})}function Qr({size:a="md",message:t,className:s="",inline:r=!1}){const n={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"};return r?e.jsxs("span",{className:`inline-flex items-center gap-2 ${s}`,children:[e.jsx(ba,{className:`${n[a]} animate-spin text-blue-600`}),t&&e.jsx("span",{className:"text-sm text-gray-600",children:t})]}):e.jsxs("div",{className:`flex flex-col items-center justify-center ${s}`,children:[e.jsx(ba,{className:`${n[a]} animate-spin text-blue-600`}),t&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t})]})}const Jr=o.createContext(null);function Rl({children:a}){const[t,s]=o.useState(!0),[r,n]=o.useState(()=>localStorage.getItem("ps_theme")||"light"),[i,u]=o.useState({help:!1,onboarding:!1});o.useEffect(()=>{localStorage.setItem("ps_theme",r),r==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[r]);const c=o.useMemo(()=>({state:{sidebarOpen:t,theme:r,modals:i},actions:{toggleSidebar:()=>s(l=>!l),setTheme:n,openModal:l=>u(d=>({...d,[l]:!0})),closeModal:l=>u(d=>({...d,[l]:!1}))}}),[t,r,i]);return e.jsx(Jr.Provider,{value:c,children:a})}function Ll(){const a=o.useContext(Jr);if(!a)throw new Error("useUIContext must be used within UIProvider");return a}class Al{constructor(){oe(this,"STORAGE_KEY","photo_search_history");oe(this,"MAX_HISTORY_ENTRIES",100);oe(this,"MAX_SUGGESTIONS",20)}getHistory(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?s:[]}catch{return[]}}addToHistory(t){try{const r=this.getHistory().filter(i=>i.query.toLowerCase()!==t.query.toLowerCase());r.unshift(t);const n=r.slice(0,this.MAX_HISTORY_ENTRIES);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(s){console.warn("Failed to save search history:",s)}}getSuggestions(t){const s=t.toLowerCase().trim();if(!s)return this.getRecentSuggestions();const r=this.getHistory(),n=[];return r.forEach(u=>{u.query.toLowerCase().includes(s)&&n.push({query:u.query,type:"history",score:this.calculateHistoryScore(u,s),metadata:{lastUsed:u.timestamp,useCount:this.getUseCount(u.query)}})}),this.generateSimilarQueries(s,r).forEach(u=>{n.push({query:u,type:"similar",score:this.calculateSimilarityScore(s,u)})}),n.sort((u,c)=>c.score-u.score).slice(0,this.MAX_SUGGESTIONS)}getRecentSuggestions(){return this.getHistory().slice(0,10).map(s=>({query:s.query,type:"history",score:this.calculateRecencyScore(s),metadata:{lastUsed:s.timestamp,useCount:this.getUseCount(s.query)}}))}calculateHistoryScore(t,s){const r=this.calculateRecencyScore(t),n=this.getUseCount(t.query)/10,i=this.calculateMatchScore(t.query,s);return r*.3+n*.3+i*.4}calculateRecencyScore(t){const r=Date.now()-t.timestamp,n=30*24*60*60*1e3;return Math.max(0,1-r/n)}calculateMatchScore(t,s){const r=t.toLowerCase(),n=s.toLowerCase();if(r===n)return 1;if(r.startsWith(n))return .9;if(r.includes(n))return .7;const i=r.split(/\s+/),u=n.split(/\s+/);return i.filter(l=>u.includes(l)).length/Math.max(i.length,u.length)}calculateSimilarityScore(t,s){return this.calculateMatchScore(s,t)*.6}getUseCount(t){return this.getHistory().filter(r=>r.query.toLowerCase()===t.toLowerCase()).length}generateSimilarQueries(t,s){const r=t.split(/\s+/),n=[];return s.forEach(i=>{const u=i.query.toLowerCase().split(/\s+/);r.filter(l=>u.some(d=>d.includes(l.toLowerCase()))).length>0&&i.query.toLowerCase()!==t.toLowerCase()&&n.push(i.query)}),Array.from(new Set(n)).slice(0,5)}clearHistory(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(t){console.warn("Failed to clear search history:",t)}}getPopularSearches(t=10){const s=this.getHistory(),r=new Map;return s.forEach(n=>{const i=n.query.toLowerCase();r.set(i,(r.get(i)||0)+1)}),Array.from(r.entries()).sort((n,i)=>i[1]-n[1]).slice(0,t).map(([n])=>n)}}const Xr=new Al,Ul=Object.freeze(Object.defineProperty({__proto__:null,searchHistoryService:Xr},Symbol.toStringTag,{value:"Module"})),Zr=o.memo(({searchText:a,setSearchText:t,onSearch:s,clusters:r=[],allTags:n=[],meta:i={}})=>{const[u,c]=o.useState(!1),[l,d]=o.useState([]),p=o.useRef(null),y=Ci(a,150);o.useEffect(()=>{if(u){const b=Xr.getSuggestions(y);d(b)}},[y,u]);const v=b=>{s(b),c(!1)},w=b=>{const x=Date.now()-b,m=Math.floor(x/(1e3*60)),S=Math.floor(x/(1e3*60*60)),j=Math.floor(x/(1e3*60*60*24));return m<60?`${m}m ago`:S<24?`${S}h ago`:`${j}d ago`},f=u?(()=>{const b=a.toLowerCase(),C=[];l.length>0&&l.forEach(j=>{(!b||j.query.toLowerCase().includes(b))&&C.push({cat:j.type==="history"?"Recent":"Similar",label:j.query,icon:j.type==="history"?ct:ni,subtitle:j.metadata?.lastUsed?`${j.metadata.useCount||1} times, ${w(j.metadata.lastUsed)}`:void 0,type:"history"})});const x=(r||[]).map(j=>j.name).filter(Boolean);for(const j of x)(!b||j.toLowerCase().includes(b))&&C.push({cat:"People",label:j,type:"metadata"});for(const j of n||[])(!b||j.toLowerCase().includes(b))&&C.push({cat:"Tag",label:j,type:"metadata"});for(const j of i.cameras||[])(!b||j.toLowerCase().includes(b))&&C.push({cat:"Camera",label:j,type:"metadata"});for(const j of i.places||[])(!b||String(j).toLowerCase().includes(b))&&C.push({cat:"Place",label:String(j),type:"metadata"});const m=C.filter(j=>j.type==="history").slice(0,8),S=C.filter(j=>j.type==="metadata").slice(0,12);return[...m,...S].slice(0,20)})():[],N=(()=>{const b=[],C=(a||"").trim();if(!C)return b;try{let x=0;for(const j of C)if(j==="("?x++:j===")"&&x--,x<0){b.push("Unbalanced parentheses");break}x>0&&b.push("Unbalanced parentheses");const m=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),S=C.split(/\s+/);for(const j of S){const I=j.indexOf(":");if(I>0){const E=j.slice(0,I).toLowerCase();m.has(E)||b.push(`Unknown field: ${E}`)}}}catch{}return Array.from(new Set(b))})();return e.jsxs("div",{className:"search-bar-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(Ee,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"What are you looking for? Try 'kids at the park' or 'last summer'",value:a,onChange:b=>{t(b.target.value),c(!0)},onKeyDown:b=>{b.key==="Enter"&&v(a)},onFocus:()=>c(!0),onBlur:()=>setTimeout(()=>c(!1),120),ref:p,className:"search-input"}),N.length>0&&e.jsx("div",{className:"ml-2 text-red-600 text-xs",title:N.join(`
`),"aria-label":"Query warnings",children:"!"})]}),N.length>0&&e.jsx("div",{className:"text-[11px] text-red-600 mt-1 px-1",children:N.slice(0,2).map((b,C)=>e.jsx("div",{children:b},C))}),u&&e.jsx("div",{className:"suggestions-dropdown",children:f.length===0?e.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No suggestions"}):f.map(b=>e.jsxs("button",{type:"button",className:"suggestion-item",onMouseDown:C=>{C.preventDefault();let x=b.label;b.cat==="People"?x=`person:"${b.label}"`:b.cat==="Camera"?x=`camera:"${b.label}"`:b.cat==="Place"?x=`place:"${b.label}"`:b.cat==="Tag"&&(x=`tag:${b.label}`);const m=(a||"").trim(),S=m?`${m} ${x}`:x;t(S),c(!1),setTimeout(()=>v(S),0)},children:[e.jsxs("div",{className:"suggestion-content",children:[b.icon&&e.jsx(b.icon,{className:"suggestion-icon"}),e.jsxs("div",{className:"suggestion-text",children:[e.jsxs("div",{className:"suggestion-main",children:[e.jsxs("span",{className:"suggestion-category",children:[b.cat,":"]}),e.jsx("span",{className:"suggestion-label",children:b.label})]}),b.subtitle&&e.jsx("div",{className:"suggestion-subtitle",children:b.subtitle})]})]}),e.jsx("span",{className:"suggestion-hint",children:"↵"})]},`${b.cat}:${b.label}`))})]})});Zr.displayName="SearchBar";const Ra={};function zl({searchText:a,setSearchText:t,onSearch:s,clusters:r,allTags:n,meta:i,busy:u,gridSize:c,setGridSize:l,selectedView:d,setSelectedView:p,currentFilter:y,setCurrentFilter:v,ratingMin:w,setRatingMin:T,setModal:f,setIsMobileMenuOpen:N,setShowFilters:b,selected:C,setSelected:x,dir:m,engine:S,topK:j,useOsTrash:I,showInfoOverlay:E,onToggleInfoOverlay:k,resultView:R,onChangeResultView:z,timelineBucket:Z,onChangeTimelineBucket:O,diag:K,isIndexing:D,onIndex:M,activeJobs:B,onOpenJobs:te,progressPct:F,etaSeconds:me,paused:A,onPause:se,onResume:de,tooltip:H,ocrReady:Q,photoActions:U,uiActions:V,toastTimerRef:$,setToast:G,onOpenThemeModal:J}){const{state:X}=Ll();return e.jsxs("div",{className:"top-bar top-bar-mobile",children:[u&&e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill"})}),e.jsxs("div",{className:"top-bar-content",children:[e.jsxs("div",{className:"top-bar-left",children:[e.jsx("button",{type:"button",className:"mobile-menu-button",onClick:()=>N(!0),"aria-label":"Open menu",children:e.jsx(ii,{className:"w-5 h-5"})}),e.jsx(Zr,{searchText:a,setSearchText:t,onSearch:s,clusters:r,allTags:n,meta:i}),e.jsxs("div",{className:"quick-filters hidden md:flex items-center gap-2 ml-2",children:[(i?.cameras||[]).slice(0,3).map(L=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const le=`camera:"${L}"`,Y=(a||"").trim(),ne=Y?`${Y} ${le}`:le;t(ne),s(ne)},title:`Filter camera: ${L}`,children:String(L)},`cam-${L}`)),(n||[]).slice(0,6).map(L=>e.jsxs("button",{type:"button",className:"chip",onClick:()=>{const le=`tag:${L}`,Y=(a||"").trim(),ne=Y?`${Y} ${le}`:le;t(ne),s(ne)},title:`Filter tag: ${L}`,children:["#",L]},`tag-${L}`)),(r||[]).filter(L=>L.name).slice(0,6).map(L=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const Y=`person:"${String(L.name)}"`,ne=(a||"").trim(),q=ne?`${ne} ${Y}`:Y;t(q),s(q)},title:`Filter person: ${String(L.name)}`,children:String(L.name)},`person-${L.name}`)),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const L="has_text:true",le=(a||"").trim(),Y=le?`${le} ${L}`:L;t(Y),s(Y)},title:"Filter photos that contain text",children:"Text"}),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const L="(filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi) AND duration:>30",le=(a||"").trim(),Y=le?`${le} ${L}`:L;t(Y),s(Y)},title:"Find videos longer than 30 seconds",children:"Videos > 30s"})]}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>b(L=>!L),"aria-label":"Show filters",children:[e.jsx(Ps,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Filters"})]}),/(camera:|tag:|person:|has_text:|iso:|fnumber:|width:|height:|place:)/i.test(a||"")&&e.jsx("button",{type:"button",className:"chip",onClick:()=>{const L=(a||"").replace(/\b(camera|tag|person|has_text|iso|fnumber|width|height|place):[^\s]+/gi,"").replace(/\s{2,}/g," ").trim();t(L),s(L)},title:"Clear filter tokens from query","aria-label":"Clear filter tokens",children:"Clear filters"}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>f({kind:"save"}),title:"Save this search for later","aria-label":"Save current search",children:[e.jsx(oi,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Remember"})]})]}),e.jsxs("div",{className:"top-bar-right",children:[K&&(K.engines?.length||0)>=1&&e.jsxs("div",{className:"indexed-chip relative",children:[e.jsx("span",{className:"indexed-label",children:"Indexed"}),e.jsx("span",{className:"indexed-count",children:K.engines?.[0]?.count||0}),e.jsx("button",{type:"button",className:"indexed-action",onClick:()=>M&&M(),disabled:!!D,"aria-label":D?"Indexing photos (indeterminate)":K.engines?.[0]?.count?"Reindex your library":"Start indexing your library",title:D?"Indexing runs in the background. You can keep working.":K.engines?.[0]?.count?"Reindex photos":"Start indexing",children:D?"Indexing…":K.engines?.[0]?.count?"Reindex":"Index"}),D&&e.jsx("div",{className:"indexed-progress","aria-hidden":!0,children:e.jsx("div",{className:"indexed-progress-bar",style:typeof F=="number"&&F>=0&&F<=1?{width:`${Math.max(4,Math.round(F*100))}%`}:void 0})}),D&&typeof me=="number"&&isFinite(me)&&me>0&&e.jsxs("span",{className:"ml-2 text-[11px] text-gray-600",title:"Estimated time remaining",children:["~",Math.max(1,Math.ceil(me/60)),"m"]}),D&&e.jsx("button",{type:"button",className:"ml-2 chip",onClick:()=>A?de?.():se?.(),"aria-label":A?"Resume indexing":"Pause indexing",title:A?"Resume indexing":"Pause indexing",children:A?"Resume":"Pause"}),H&&e.jsx("div",{className:"tooltip-card",role:"tooltip","aria-hidden":!0,children:(H.split(" • ")||[]).map((L,le)=>e.jsx("div",{className:"tooltip-line",children:L},le))})]}),Q&&e.jsx("span",{className:"chip",title:"OCR ready: search text inside images",children:"OCR"}),typeof B=="number"&&B>0&&e.jsxs("button",{type:"button",className:"chip",onClick:()=>te&&te(),title:"View running tasks","aria-label":`Open Jobs (${B})`,children:["Jobs (",B,")"]}),e.jsx("div",{className:"grid-size-control",children:["small","medium","large"].map(L=>e.jsx("button",{type:"button",onClick:()=>l(L),className:`grid-size-button ${c===L?"active":""}`,"aria-label":`Set grid size to ${L}`,children:L.charAt(0).toUpperCase()+L.slice(1)},L))}),e.jsxs("div",{className:"view-mode-control",children:[e.jsx("button",{type:"button",onClick:()=>p("results"),className:`view-mode-button ${d==="results"?"active":""}`,"aria-label":"Grid view",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>p("library"),className:`view-mode-button ${d==="library"?"active":""}`,"aria-label":"List view",children:e.jsx(Xa,{className:"w-4 h-4"})})]}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Settings & Indexing",onClick:()=>f({kind:"folder"}),"aria-label":"Open settings and indexing options",children:e.jsx(Pt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Open theme settings","aria-label":"Open theme settings",onClick:()=>J?.(),children:e.jsx(Nt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"filter-chips",children:["All","Today","This Week","This Month","Favorites","People","Screenshots"].map(L=>e.jsx("button",{type:"button",onClick:()=>{v(L.toLowerCase()),L==="Favorites"&&(U.setFavOnly(!0),s(a))},className:`chip ${y===L.toLowerCase()?"active":""}`,"aria-label":`Filter by ${L}`,children:L},L))}),e.jsxs("div",{className:"rating-filter",children:[e.jsx("span",{children:"Min rating:"}),[0,1,2,3,4,5].map(L=>e.jsx("button",{type:"button",className:`rating-button ${w===L?"active":""}`,onClick:()=>T(L),"aria-label":`Filter by minimum rating of ${L}`,children:L===0?"Any":`${"★".repeat(L)}`},L))]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"View:"}),e.jsx("button",{type:"button",className:`view-button ${R==="grid"?"active":""}`,onClick:()=>z("grid"),"aria-pressed":R==="grid",children:"Grid"}),e.jsx("button",{type:"button",className:`view-button ${R==="timeline"?"active":""}`,onClick:()=>z("timeline"),"aria-pressed":R==="timeline",children:"Timeline"})]}),e.jsxs("div",{className:"text-[11px] text-gray-600 mt-1",children:["Boolean: AND, OR, NOT, ( ) • Fields:"," ",e.jsx("span",{className:"font-mono",children:"camera:"})," ",e.jsx("span",{className:"font-mono",children:"place:"})," ",e.jsx("span",{className:"font-mono",children:"tag:"})," ",e.jsx("span",{className:"font-mono",children:"rating:"})," ",e.jsx("span",{className:"font-mono",children:"person:"})," ",e.jsx("span",{className:"font-mono",children:"has_text:"})," ",e.jsx("span",{className:"font-mono",children:"filetype:"})," • Numeric:"," ",e.jsx("span",{className:"font-mono",children:"iso:"})," ",e.jsx("span",{className:"font-mono",children:"fnumber:"})," ",e.jsx("span",{className:"font-mono",children:"width:"})," ",e.jsx("span",{className:"font-mono",children:"height:"})," ",e.jsx("span",{className:"font-mono",children:"mtime:"})," ",e.jsx("span",{className:"font-mono",children:"brightness:"})," ",e.jsx("span",{className:"font-mono",children:"sharpness:"})," ",e.jsx("span",{className:"font-mono",children:"exposure:"})," ",e.jsx("span",{className:"font-mono",children:"focal:"})," ",e.jsx("span",{className:"font-mono",children:"duration:"})," (supports >=, <=, >, <, =)"]}),e.jsx("div",{className:"preset-filters hidden md:flex flex-wrap gap-2 mt-1",children:[{label:"High ISO",expr:"iso:>=1600"},{label:"Shallow DoF",expr:"fnumber:<2.8"},{label:"Text in Image",expr:"has_text:true"},{label:"Large",expr:"width:>=3000 height:>=2000"},{label:"Recent (30d)",expr:`mtime:>=${Math.floor(Date.now()/1e3-30*24*3600)}`},{label:"Underexposed",expr:"brightness:<50"},{label:"Sharp Only",expr:"sharpness:>=60"},{label:"Video > 30s",expr:"filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi AND duration:>30"}].map(L=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const le=L.expr,Y=(a||"").trim(),ne=Y?`${Y} ${le}`:le;t(ne),s(ne)},title:L.expr,children:L.label},L.label))}),R==="timeline"&&e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"Bucket:"}),["day","week","month"].map(L=>e.jsx("button",{type:"button",className:`view-button ${Z===L?"active":""}`,onClick:()=>O&&O(L),"aria-pressed":Z===L,children:L[0].toUpperCase()+L.slice(1)},L))]}),C.size>0&&e.jsxs("div",{className:"selected-actions",children:[e.jsxs("span",{className:"selected-count",children:[C.size," photo",C.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"export"}),"aria-label":"Export selected photos",children:[e.jsx(_e,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"enhanced-share"}),"aria-label":"Share selected photos",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Share"]}),Ra?.VITE_FF_SHARING_V1==="1"&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"share"}),"aria-label":"Share selected photos",children:[e.jsx(Ee,{className:"w-4 h-4"})," Share"]}),Ra?.VITE_FF_SHARING_V1==="1"&&e.jsx("button",{type:"button",className:"action-button",onClick:()=>f({kind:"shareManage"}),"aria-label":"Manage shared links",children:"Manage Shares"}),e.jsxs("button",{type:"button",className:`action-button ${E?"active":""}`,onClick:k,"aria-pressed":E,"aria-label":"Toggle info overlay on grid items",children:[e.jsx(Qt,{className:"w-4 h-4"})," Info"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>f({kind:"advanced"}),"aria-label":"Open advanced search",children:"Advanced"}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"tag"}),"aria-label":"Tag selected photos",children:[e.jsx(Ya,{className:"w-4 h-4"}),"Tag"]}),C.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:async()=>{const L=Array.from(C)[0],{apiSearchLike:le}=await he(async()=>{const{apiSearchLike:Y}=await Promise.resolve().then(()=>pe);return{apiSearchLike:Y}},void 0,import.meta.url);V.setBusy("Searching similar…");try{const Y=await le(m,L,S,j);U.setResults(Y.results||[]),p("results")}catch(Y){V.setNote(Y instanceof Error?Y.message:"Search failed")}finally{V.setBusy("")}},"aria-label":"Find similar photos to the selected photo",children:[e.jsx(Ee,{className:"w-4 h-4"})," Similar"]}),C.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"likeplus"}),"aria-label":"Find similar photos with additional text query",children:[e.jsx(Ee,{className:"w-4 h-4"})," Similar + Text"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"collect"}),"aria-label":"Add selected photos to a collection",children:[e.jsx(Ze,{className:"w-4 h-4"})," Add to Collection"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"removeCollect"}),"aria-label":"Remove selected photos from a collection",children:[e.jsx(Ze,{className:"w-4 h-4 rotate-180"})," Remove from Collection"]}),e.jsxs("button",{type:"button",className:"action-button danger",onClick:async()=>{if(C.size!==0&&confirm(`Move ${C.size} item(s) to Trash?`))try{V.setBusy("Deleting…");const L=await sa(m,Array.from(C),I);V.setNote(`Moved ${L.moved} to ${I?"OS Trash":"Trash"}`),x(new Set),I?G({message:`Moved ${L.moved} to OS Trash`}):($.current&&window.clearTimeout($.current),G({message:`Moved ${L.moved} to Trash`,actionLabel:"Undo",onAction:async()=>{try{const le=await aa(m);V.setNote(`Restored ${le.restored}`)}catch{}G(null),$.current&&(window.clearTimeout($.current),$.current=null)}}),$.current=window.setTimeout(()=>{G(null),$.current=null},1e4))}catch(L){V.setNote(L instanceof Error?L.message:"Delete failed")}finally{V.setBusy("")}},"aria-label":"Delete selected photos",children:[e.jsx(lt,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function Bl({items:a,note:t,diag:s,engine:r}){const n=a.length,i=(s?.engines||[]).find(c=>c.key===r),u=i?.fast&&(i.fast.annoy||i.fast.faiss||i.fast.hnsw);return e.jsx("div",{className:"stats-bar",children:e.jsxs("div",{className:"stats-content",children:[e.jsxs("div",{className:"stats-left",children:[e.jsxs("span",{children:[n," photos"]}),t?e.jsx("span",{className:"text-gray-800",children:t}):null]}),e.jsxs("div",{className:"stats-right",children:[e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${i?.count?"ready":"empty"}`}),e.jsxs("span",{children:["AI Index ",i?.count?"Ready":"Empty"]})]}),e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${u?"fast-ready":"empty"}`}),e.jsxs("span",{children:["Fast Index ",u?"Ready":"—"]})]})]})]})})}function ql({activeTab:a,onTabChange:t,onShowFilters:s,onShowUpload:r,onShowLibrary:n,showSecondaryActions:i=!0}){const u=[{id:"home",icon:Ja,label:"Home"},{id:"search",icon:Ee,label:"Search"},{id:"favorites",icon:Gt,label:"Favorites"},{id:"settings",icon:Pt,label:"Settings"}];return e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 md:hidden",children:[i&&e.jsxs("div",{className:"flex items-center justify-around py-2 px-4 border-b border-gray-100",children:[e.jsxs("button",{type:"button",onClick:s,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-blue-600 transition-colors","aria-label":"Show filters",children:[e.jsx(Ps,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Filters"})]}),e.jsxs("button",{type:"button",onClick:r,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-green-600 transition-colors","aria-label":"Upload",children:[e.jsx(it,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Upload"})]}),e.jsxs("button",{type:"button",onClick:n,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-purple-600 transition-colors","aria-label":"Library",children:[e.jsx(Ze,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Library"})]})]}),e.jsx("div",{className:"flex items-center justify-around py-2 px-4",children:u.map(({id:c,icon:l,label:d})=>e.jsxs("button",{type:"button",onClick:()=>t(c),className:`flex flex-col items-center gap-1 p-2 min-w-[64px] transition-colors ${a===c?"text-blue-600":"text-gray-600 hover:text-gray-900"}`,"aria-label":d,"aria-current":a===c,children:[e.jsx(l,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs font-medium",children:d}),a===c&&e.jsx("div",{className:"w-1 h-1 bg-blue-600 rounded-full mt-1"})]},c))})]})}function Vl({currentDir:a,provider:t}){const[s,r]=o.useState([]),[n,i]=o.useState(!1),[u,c]=o.useState(!1),[l,d]=o.useState(null),[p,y]=o.useState(null),[v,w]=o.useState(null);o.useEffect(()=>{a&&T()},[a]);const T=async()=>{try{i(!0),w(null);const x=await Dr(a);r(x.videos)}catch(x){w(x instanceof Error?x.message:"Failed to load videos")}finally{i(!1)}},f=async()=>{try{c(!0),w(null);const x=await Rr(a,t);alert(`Indexed ${x.indexed} out of ${x.total} videos`),await T()}catch(x){w(x instanceof Error?x.message:"Failed to index videos")}finally{c(!1)}},N=async x=>{d(x);try{const m=await _r(a,x.path);y(m.metadata)}catch(m){console.error("Failed to load video metadata:",m),y(null)}},b=x=>{const m=["Bytes","KB","MB","GB","TB"];if(x===0)return"0 Bytes";const S=Math.floor(Math.log(x)/Math.log(1024));return Math.round(x/Math.pow(1024,S)*100)/100+" "+m[S]},C=x=>{const m=Math.floor(x/60),S=Math.floor(x%60);return`${m}:${S.toString().padStart(2,"0")}`};return n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(Qr,{})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Video Manager"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:T,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"Refresh"}),e.jsx("button",{onClick:f,disabled:u||s.length===0,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:u?"Indexing...":"Index Videos"})]})]}),v&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:v}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Videos (",s.length,")"]}),s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No videos found in this directory"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.map((x,m)=>e.jsxs("div",{onClick:()=>N(x),className:`p-3 border rounded cursor-pointer transition-colors ${l?.path===x.path?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium truncate",title:x.path,children:x.path.split("/").pop()||x.path}),e.jsxs("div",{className:"text-sm text-gray-500",children:[b(x.size)," • ",new Date(x.mtime*1e3).toLocaleDateString()]})]},m))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Video Details"}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video bg-gray-100 rounded overflow-hidden",children:e.jsx("img",{src:Or(a,l.path),alt:"Video thumbnail",className:"w-full h-full object-cover",onError:x=>{x.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjNjM2MzYzIi8+Cjwvc3ZnPgo="}})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded space-y-2",children:[e.jsx("div",{className:"font-medium",children:"File Information"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Path:"})," ",l.path]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",b(l.size)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Modified:"})," ",new Date(l.mtime*1e3).toLocaleString()]})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium mt-4",children:"Video Metadata"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Dimensions:"})," ",p.width," × ",p.height]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Rate:"})," ",p.fps?.toFixed(2)," fps"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",C(p.duration)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Count:"})," ",p.frame_count?.toLocaleString()]})]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Select a video to view details"})]})]})]})}const en=o.memo(()=>{const[a,t]=o.useState(null),[s,r]=o.useState(!1);return o.useEffect(()=>{},[]),o.useEffect(()=>{const n=i=>{i.ctrlKey&&i.shiftKey&&i.key==="P"&&r(u=>!u)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[]),null});en.displayName="PerformanceMonitor";function Hl({open:a,onClose:t,onApply:s,onSave:r,allTags:n,cameras:i,people:u}){const[c,l]=o.useState(""),[d,p]=o.useState(""),[y,v]=o.useState(""),[w,T]=o.useState(""),[f,N]=o.useState(""),[b,C]=o.useState("any"),[x,m]=o.useState(""),[S,j]=o.useState(""),[I,E]=o.useState(""),[k,R]=o.useState(""),[z,Z]=o.useState(""),[O,K]=o.useState(""),[D,M]=o.useState(""),B=o.useMemo(()=>{const F=[];return c.trim()&&F.push(c.trim()),d.trim()&&F.push(`camera:"${d.trim()}"`),y.trim()&&F.push(`place:"${y.trim()}"`),w.trim()&&F.push(`tag:${w.trim()}`),f.trim()&&F.push(`person:"${f.trim()}"`),b==="true"&&F.push("has_text:true"),b==="false"&&F.push("has_text:false"),x.trim()&&F.push(`iso:>=${x.trim()}`),S.trim()&&F.push(`fnumber:<${S.trim()}`),I.trim()&&F.push(`width:>=${I.trim()}`),k.trim()&&F.push(`height:>=${k.trim()}`),z.trim()&&F.push(`filetype:${z.trim().toLowerCase()}`),O.trim()&&F.push(`duration:>${O.trim()}`),F.join(" AND ")},[c,d,y,w,f,b,x,S,I,k,z,O]),te=o.useMemo(()=>{const F=[],me=B||"";let A=0;for(const se of me)if(se==="("?A++:se===")"&&A--,A<0){F.push("Unbalanced parentheses");break}A>0&&F.push("Unbalanced parentheses");try{const se=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),de=me.split(/\s+/);for(const H of de){const Q=H.indexOf(":");if(Q>0){const U=H.slice(0,Q).toLowerCase();se.has(U)||F.push(`Unknown field: ${U}`)}}}catch{}return Array.from(new Set(F))},[B]);return a?e.jsxs("div",{className:"fixed inset-0 z-[1080] flex items-center justify-center",onKeyDown:F=>{F.key==="Escape"&&t()},children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1081] bg-white dark:bg-gray-900 rounded-lg shadow p-4 w-full max-w-2xl",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Advanced Search"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Base Text"}),e.jsx("input",{className:"input",value:c,onChange:F=>l(F.target.value),placeholder:'e.g., "golden hour" OR beach'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Camera"}),e.jsx("input",{list:"cam-list",className:"input",value:d,onChange:F=>p(F.target.value),placeholder:"Canon, Sony..."}),e.jsx("datalist",{id:"cam-list",children:i.map(F=>e.jsx("option",{value:F},F))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Place"}),e.jsx("input",{className:"input",value:y,onChange:F=>v(F.target.value),placeholder:"City, location..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Tag"}),e.jsx("input",{list:"tag-list",className:"input",value:w,onChange:F=>T(F.target.value),placeholder:"Any tag"}),e.jsx("datalist",{id:"tag-list",children:n.map(F=>e.jsx("option",{value:F},F))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Person"}),e.jsx("input",{list:"person-list",className:"input",value:f,onChange:F=>N(F.target.value),placeholder:"Person name"}),e.jsx("datalist",{id:"person-list",children:u.map(F=>e.jsx("option",{value:F},F))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Has Text"}),e.jsxs("select",{className:"input",value:b,onChange:F=>C(F.target.value),children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"ISO ≥"}),e.jsx("input",{className:"input",value:x,onChange:F=>m(F.target.value),placeholder:"e.g., 1600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"f-number <"}),e.jsx("input",{className:"input",value:S,onChange:F=>j(F.target.value),placeholder:"e.g., 2.8"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Width ≥"}),e.jsx("input",{className:"input",value:I,onChange:F=>E(F.target.value),placeholder:"e.g., 3000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Height ≥"}),e.jsx("input",{className:"input",value:k,onChange:F=>R(F.target.value),placeholder:"e.g., 2000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Filetype"}),e.jsx("input",{className:"input",value:z,onChange:F=>Z(F.target.value),placeholder:"jpg, png, mp4, ..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Duration > (s)"}),e.jsx("input",{className:"input",value:O,onChange:F=>K(F.target.value),placeholder:"e.g., 30"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Preview"}),e.jsx("div",{className:"text-sm font-mono bg-gray-100 dark:bg-gray-800 rounded p-2 break-words",style:{minHeight:"2.2rem"},children:B||"—"}),te.length>0&&e.jsx("ul",{className:"mt-2 text-xs text-red-600 list-disc pl-5",children:te.map((F,me)=>e.jsx("li",{children:F},me))})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",placeholder:"Preset name",value:D,onChange:F=>M(F.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{D.trim()&&(r(D.trim(),B),M(""))},children:"Save Preset"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"Close"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(B),children:"Apply"})]})]})]})]}):null}const Wl=({onEscape:a,children:t})=>e.jsx("div",{children:t}),Gl=({selected:a,dir:t,onClose:s,uiActions:r})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:n=>{n.key==="Escape"&&s()},children:e.jsx(Wl,{onEscape:s,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Export Selected"}),e.jsxs("form",{onSubmit:n=>{n.preventDefault();const i=n.target,u=i.elements.namedItem("dest").value.trim();if(!u)return;const c=i.elements.namedItem("preset")?.value||"web",l=i.elements.namedItem("strip_all")?.checked||!1,d=i.elements.namedItem("strip_gps")?.checked||!1,p=i.elements.namedItem("keep_copy")?.checked||!1,y=i.elements.namedItem("overwrite")?.checked||!1;(async()=>{try{const v=Array.from(a),w=c;let T,f;if(w==="custom"){const b=parseInt(i.elements.namedItem("custom_long")?.value||""),C=parseInt(i.elements.namedItem("custom_quality")?.value||"");T=isNaN(b)?void 0:b,f=isNaN(C)?void 0:C}const N=await ht(t,v,u,"copy",l,y,{stripGps:d,keepCopyrightOnly:p,preset:w,resizeLong:T,quality:f});r.setNote(`Exported ${N.copied}, skipped ${N.skipped}, errors ${N.errors} → ${N.dest}`)}catch(v){r.setNote(v instanceof Error?v.message:"Export failed")}})(),s()},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"dest-input",children:"Destination"}),e.jsx("input",{id:"dest-input",name:"dest",className:"w-full border rounded px-2 py-1",placeholder:"/absolute/path"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-sm font-medium mb-1",children:"Preset"}),e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"web",defaultChecked:!0})," Web"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"email"})," Email"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"print"})," Print"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"custom"})," Custom"]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Custom long edge"}),e.jsx("input",{type:"number",name:"custom_long",className:"border rounded px-2 py-1 w-28",placeholder:"1600"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Quality (1–100)"}),e.jsx("input",{type:"number",name:"custom_quality",min:1,max:100,className:"border rounded px-2 py-1 w-28",placeholder:"85"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Privacy"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_all"})," Strip all EXIF/IPTC"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_gps"})," Strip GPS only"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"keep_copy"})," Keep copyright only"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Options"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"overwrite"})," Overwrite existing files"]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:s,"aria-label":"Cancel export",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Export selected photos",children:"Export"})]})]})]})})}),Kl=({onEscape:a,children:t})=>e.jsx("div",{children:t}),Yl=({onClose:a,onTagSelected:t})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:s=>{s.key==="Escape"&&a()},children:e.jsx(Kl,{onEscape:a,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Tag Selected"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Enter comma-separated tags"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault();const n=s.target.elements.namedItem("tags").value.trim();n&&(t(n),a())},children:[e.jsx("label",{htmlFor:"tags-input",className:"sr-only",children:"Tags"}),e.jsx("input",{id:"tags-input",name:"tags",className:"w-full border rounded px-2 py-1",placeholder:"family, beach, 2024"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:a,"aria-label":"Cancel tagging",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save tags",children:"Save"})]})]})]})})});function Ql({onFolderSelect:a,currentPath:t}){const[s,r]=o.useState(t||""),[n,i]=o.useState(!1),[u,c]=o.useState(null),[l,d]=o.useState(""),p=o.useCallback(async f=>{if(f.trim()){i(!0),d("");try{const N=await fetch("/scan_count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([f])});if(!N.ok)throw new Error("Failed to scan folder");const b=await N.json();b.items&&b.items.length>0&&c(b.items[0])}catch(N){d(N instanceof Error?N.message:"Failed to scan folder"),c(null)}finally{i(!1)}}},[]),y=o.useCallback(()=>{p(s)},[s,p]),v=o.useCallback(()=>{u&&u.exists&&u.files>0&&a(u.path)},[u,a]),w=f=>{if(f===0)return"0 Bytes";const N=1024,b=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(f)/Math.log(N));return parseFloat((f/Math.pow(N,C)).toFixed(2))+" "+b[C]},T=[{name:"Pictures",path:"~/Pictures"},{name:"Desktop",path:"~/Desktop"},{name:"Downloads",path:"~/Downloads"},{name:"Documents",path:"~/Documents"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Folder Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:f=>r(f.target.value),placeholder:"/path/to/your/photos or ~/Pictures",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:f=>f.key==="Enter"&&y()}),e.jsx("button",{onClick:y,disabled:n||!s.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Fs,{className:"w-4 h-4 animate-spin"}),"Scanning"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-4 h-4"}),"Scan"]})})]})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Cs,{className:"w-4 h-4"}),l]}),u&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Path:"}),e.jsx("span",{className:"text-sm text-gray-600 truncate",children:u.path})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx("span",{className:`text-sm ${u.exists?"text-green-600":"text-red-600"}`,children:u.exists?"Exists":"Not Found"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Photos Found:"}),e.jsx("span",{className:"text-sm text-gray-600",children:u.files})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Size:"}),e.jsx("span",{className:"text-sm text-gray-600",children:w(u.bytes)})]})]}),u.exists&&u.files>0&&e.jsxs("button",{onClick:v,className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:["Use This Folder (",u.files," photos)"]}),u.exists&&u.files===0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-sm text-yellow-800",children:"No photos found in this folder. Supported formats: JPG, PNG, GIF, TIF, WebP, HEIC, MP4, MOV, MKV, AVI, WebM"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Quick Select:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:T.map(f=>e.jsx("button",{onClick:()=>{r(f.path),p(f.path)},className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:f.name},f.path))})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Tip: You can also drag and drop a folder onto the app, or use the file picker in the main interface."})]})}const Jl=({onEscape:a,children:t})=>e.jsx("div",{children:t}),Xl=({dir:a,useOsTrash:t,useFast:s,fastKind:r,useCaps:n,useOcr:i,hasText:u,highContrast:c,onClose:l,settingsActions:d,uiActions:p,doIndex:y,prepareFast:v,buildOCR:w,buildMetadata:T})=>{const[f,N]=o.useState(a),b=x=>{N(x)},C=async x=>{if(x.preventDefault(),f){d.setDir(f),l();try{await Xe(f),await y()}catch(m){console.error("Failed to add path or index:",m),p.setNote(m instanceof Error?m.message:"Failed to add path")}}};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:x=>{x.key==="Escape"&&l()},children:e.jsx(Jl,{onEscape:l,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-4",children:"Set Photo Folder"}),e.jsx(Ql,{onFolderSelect:b,currentPath:f}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("label",{htmlFor:"use-os-trash",className:"text-sm",children:"Use OS Trash (no Undo)"}),e.jsx("input",{id:"use-os-trash",type:"checkbox",checked:t,onChange:x=>d.setUseOsTrash(x.target.checked)})]}),e.jsxs("div",{className:"mt-4 border-t pt-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Preferences"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-fast",children:"Use Fast Index"}),e.jsx("input",{id:"pref-fast",type:"checkbox",checked:s,onChange:x=>d.setUseFast(x.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{htmlFor:"pref-fastkind",children:"Fast Kind"}),e.jsxs("select",{id:"pref-fastkind",className:"border rounded px-2 py-1",value:r,onChange:x=>d.setFastKind(x.target.value),children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"annoy",children:"Annoy"}),e.jsx("option",{value:"faiss",children:"FAISS"}),e.jsx("option",{value:"hnsw",children:"HNSW"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-caps",children:"Use Captions"}),e.jsx("input",{id:"pref-caps",type:"checkbox",checked:n,onChange:x=>d.setUseCaps(x.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-ocr",children:"Use OCR"}),e.jsx("input",{id:"pref-ocr",type:"checkbox",checked:i,onChange:x=>d.setUseOcr(x.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-hastext",children:"Default: Has Text"}),e.jsx("input",{id:"pref-hastext",type:"checkbox",checked:u,onChange:x=>d.setHasText(x.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-high-contrast",children:"High Contrast"}),e.jsx("input",{id:"pref-high-contrast",type:"checkbox",checked:c,onChange:x=>d.setHighContrast(x.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pref-vlm",className:"block mb-1",children:"VLM Model"}),e.jsx("input",{id:"pref-vlm",className:"w-full border rounded px-2 py-1",defaultValue:"",onChange:x=>{}})]})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:y,"aria-label":"Index files in the selected folder",children:"Index"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>v("annoy"),"aria-label":"Prepare fast index",children:"Fast"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:w,"aria-label":"Build OCR index",children:"OCR"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:T,"aria-label":"Build metadata index",children:"Metadata"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:l,"aria-label":"Close settings",children:"Close"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save settings",children:"Save"})]})]})]})]})})})},Zl=({onEscape:a,children:t})=>e.jsx("div",{children:t}),ec=({selected:a,dir:t,engine:s,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(Zl,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Similar + Text"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const d=l.target,p=d.elements.namedItem("text").value.trim(),y=parseFloat(d.elements.namedItem("weight").value);if(a.size===1)try{const v=Array.from(a)[0],{apiSearchLikePlus:w}=await he(async()=>{const{apiSearchLikePlus:f}=await Promise.resolve().then(()=>pe);return{apiSearchLikePlus:f}},void 0,import.meta.url);c.setBusy("Searching…");const T=await w(t,v,s,r,p||void 0,Number.isNaN(y)?.5:y);u.setResults(T.results||[]),i("results")}catch(v){c.setNote(v instanceof Error?v.message:"Search failed")}finally{c.setBusy("")}n()},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"likeplus-text",children:"Text (optional)"}),e.jsx("input",{id:"likeplus-text",name:"text",className:"w-full border rounded px-2 py-1",placeholder:"e.g. beach at sunset"}),e.jsx("label",{className:"block text-sm mt-3 mb-1",htmlFor:"mix-weight",children:"Weight (image vs text)"}),e.jsx("input",{id:"mix-weight",name:"weight",type:"range",min:"0",max:"1",step:"0.05",defaultValue:"0.5",className:"w-full"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel similar search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Search for similar photos with text",children:"Search"})]})]})]})})}),tc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),sc=({dir:a,searchText:t,query:s,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(tc,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Save Search"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const p=l.target.elements.namedItem("name").value.trim();if(p){try{const{apiAddSaved:y,apiGetSaved:v}=await he(async()=>{const{apiAddSaved:T,apiGetSaved:f}=await Promise.resolve().then(()=>pe);return{apiAddSaved:T,apiGetSaved:f}},void 0,import.meta.url);await y(a,p,t||s||"",r);const w=await v(a);u.setSaved(w.saved||[]),i("saved")}catch(y){c.setNote(y instanceof Error?y.message:"Save failed")}n()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"save-name",children:"Name"}),e.jsx("input",{id:"save-name",name:"name",className:"w-full border rounded px-2 py-1",placeholder:"e.g. Dogs on beach"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel saving search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save search",children:"Save"})]})]})]})})}),ac=({onEscape:a,children:t})=>e.jsx("div",{children:t}),rc=({selected:a,dir:t,collections:s,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(ac,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Add to Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiSetCollection:p,apiGetCollections:y}=await he(async()=>{const{apiSetCollection:w,apiGetCollections:T}=await Promise.resolve().then(()=>pe);return{apiSetCollection:w,apiGetCollections:T}},void 0,import.meta.url);await p(t,d,Array.from(a));const v=await y(t);i.setCollections(v.collections||{}),n({message:`Added ${a.size} to ${d}`})}catch(p){u.setNote(p instanceof Error?p.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name",children:"Collection"}),e.jsx("input",{id:"col-name",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Type or choose…"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(s||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel adding to collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Add to collection",children:"Add"})]})]})]})})}),nc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),ic=({selected:a,dir:t,collections:s,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(nc,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Remove from Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiGetCollections:p,apiSetCollection:y}=await he(async()=>{const{apiGetCollections:N,apiSetCollection:b}=await Promise.resolve().then(()=>pe);return{apiGetCollections:N,apiSetCollection:b}},void 0,import.meta.url),w=(await p(t)).collections?.[d]||[],T=w.filter(N=>!a.has(N));await y(t,d,T);const f=await p(t);i.setCollections(f.collections||{}),n({message:`Removed ${w.length-T.length} from ${d}`})}catch(p){u.setNote(p instanceof Error?p.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name-remove",children:"Collection"}),e.jsx("input",{id:"col-name-remove",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Choose collection"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(s||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel removing from collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Remove from collection",children:"Remove"})]})]})]})})}),oc=[{key:"D",shift:!0,description:"Toggle dark mode",action:()=>{try{const t=document.documentElement.classList.toggle("dark");localStorage.setItem("ps_theme",t?"dark":"light")}catch{}}},{key:"/",description:"Focus search",action:()=>{document.querySelector('input[placeholder*="Try"]')?.focus()}},{key:"a",description:"Open Advanced Search",action:()=>{const a=document.querySelector('[aria-label*="Open advanced search"]');a&&a.click()}},{key:"t",description:"Timeline: Jump to Today",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"today"}}))}},{key:"m",description:"Timeline: Jump to This Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"this-month"}}))}},{key:"l",description:"Timeline: Jump to Last Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"last-month"}}))}},{key:"o",description:"Timeline: Jump to Oldest",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"oldest"}}))}},{key:"Escape",description:"Close modal/Clear selection",action:()=>{const a=document.querySelector('[aria-label*="Close"]');a?.click(),a||document.querySelector('button:has-text("Clear Selection")')?.click()}},{key:"g",shift:!0,description:"Toggle grid view",action:()=>{document.querySelector('[aria-label*="Grid"]')?.click()}},{key:"l",shift:!0,description:"Toggle list view",action:()=>{document.querySelector('[aria-label*="List"]')?.click()}},{key:"a",ctrl:!0,description:"Select all",action:()=>{document.querySelector('[aria-label*="Select all"]')?.click()},enabled:!0},{key:"d",ctrl:!0,description:"Deselect all",action:()=>{document.querySelector('[aria-label*="Clear selection"]')?.click()},enabled:!0},{key:"Delete",description:"Delete selected",action:()=>{document.querySelector('button:has-text("Delete")')?.click()}},{key:"f",ctrl:!0,description:"Focus filter",action:()=>{document.querySelector('[placeholder*="Filter"]')?.focus()},enabled:!0},{key:"n",ctrl:!0,description:"New collection",action:()=>{document.querySelector('button:has-text("New Collection")')?.click()},enabled:!0},{key:"e",ctrl:!0,description:"Export selected",action:()=>{document.querySelector('button:has-text("Export")')?.click()},enabled:!0},{key:"s",ctrl:!0,description:"Save search",action:()=>{document.querySelector('button:has-text("Save Search")')?.click()},enabled:!0},{key:"ArrowLeft",description:"Previous photo",action:()=>{document.querySelector('[aria-label*="Previous"]')?.click()}},{key:"ArrowRight",description:"Next photo",action:()=>{document.querySelector('[aria-label*="Next"]')?.click()}},{key:" ",description:"Play/Pause slideshow",action:()=>{document.querySelector('[aria-label*="Play"]')?.click()}},{key:"i",description:"Toggle info panel",action:()=>{document.querySelector('[aria-label*="Info"]')?.click()}},{key:"?",shift:!0,description:"Show keyboard shortcuts",action:()=>{document.querySelector('[aria-label*="Help"]')?.click()}},{key:"h",description:"Go home",action:()=>{window.location.href="/"}},{key:"1",description:"Photos view",action:()=>{document.querySelector('[href*="/photos"]')?.click()}},{key:"2",description:"Albums view",action:()=>{document.querySelector('[href*="/albums"]')?.click()}},{key:"3",description:"People view",action:()=>{document.querySelector('[href*="/people"]')?.click()}}];function tn(){const a=oc,t=s=>{const r=[];return s.ctrl&&r.push("Ctrl"),s.alt&&r.push("Alt"),s.shift&&r.push("Shift"),s.meta&&r.push("Cmd"),r.push(s.key===" "?"Space":s.key),r.join("+")};return a.map(s=>({keys:t(s),description:s.description}))}function lc({isOpen:a,onClose:t}){const s=tn();if(!a)return null;const r={Navigation:["/","1","2","3","Arrow","t","m","l","o"],Selection:["Ctrl+A","Ctrl+D","Space"],Actions:["Delete","Ctrl+E","Ctrl+S","Ctrl+N","a"],View:["Shift+G","Shift+L","i"],General:["Escape","Shift+?"]},n=i=>s.filter(u=>{const c=u.keys.toLowerCase();return i.some(l=>c.includes(l.toLowerCase()))});return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:i=>{i.key==="Escape"&&t()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close shortcuts",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(r).map(([i,u])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:i}),e.jsx("div",{className:"space-y-2",children:n(u).map((c,l)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded border border-gray-300 dark:border-gray-600",children:c.keys})]},l))})]},i))}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Pro Tips"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsxs("li",{children:["• Press ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"?"})," anytime to show this help"]}),e.jsx("li",{children:"• Most shortcuts work globally except when typing in inputs"}),e.jsxs("li",{children:["• Use ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"Escape"})," to close modals or clear selection"]}),e.jsx("li",{children:"• Navigate photos with arrow keys in lightbox view"})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Press any key to try it out"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})})]})})}function cc({isOpen:a,onClose:t,initialSection:s="getting-started"}){const[r,n]=o.useState(s),[i,u]=o.useState(!1),c=tn();if(!a)return null;const l=[{id:"getting-started",title:"Getting Started",icon:e.jsx(qe,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Welcome to Photo Search!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Your AI-powered photo search and management tool. Here's how to get started:"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["Tip: Press ",e.jsx("span",{className:"font-mono",children:"?"})," anytime to open this help."]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-1",children:"Select Your Photo Directory"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"Choose the folder containing your photos. The app will index them for fast searching."})]})]})}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-1",children:"Try the Demo Library"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400",children:`Don't have photos ready? Click "Try Demo" to explore with sample photos and see how search works.`})]})]})}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-semibold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-300 mb-1",children:"Start Searching"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-400",children:'Use natural language to search: "beach sunset", "family photos", "mountains", or "red car".'})]})]})})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 dark:text-yellow-300 mb-2",children:"💡 Pro Tip"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:`The more specific your search terms, the better results you'll get. Try combining concepts like "golden hour beach wedding" or "snowy mountain landscape".`})]})]})},{id:"features",title:"Features",icon:e.jsx(Es,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Powerful Features"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Discover what makes Photo Search special:"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Ee,{className:"w-6 h-6 text-blue-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"AI-Powered Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search by visual content, not just filenames. Find photos using natural language descriptions."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Ve,{className:"w-6 h-6 text-green-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Face Recognition"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Automatically detect and group photos by people. Find all photos of specific individuals."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Is,{className:"w-6 h-6 text-red-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Location Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search photos by location data. Find all photos taken in Paris, at the beach, or at home."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(qt,{className:"w-6 h-6 text-yellow-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Smart Collections"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Create dynamic collections based on search criteria. Automatically updated as you add new photos."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Pt,{className:"w-6 h-6 text-purple-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Filter by date, camera, lens, ISO, aperture, and more. Combine with AI search for precise results."})]})]})]})]})},{id:"shortcuts",title:"Keyboard Shortcuts",icon:e.jsx(li,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"py-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Most Useful"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:c.slice(0,12).map((d,p)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-200",children:d.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600",children:d.keys})]},p))}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"View All Shortcuts"})})]})},{id:"troubleshooting",title:"Troubleshooting",icon:e.jsx(Jt,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Common Issues & Solutions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Having trouble? Here are solutions to common problems:"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-red-900 dark:text-red-300 mb-2",children:"🔍 No Search Results"}),e.jsxs("ul",{className:"text-sm text-red-700 dark:text-red-400 space-y-1",children:[e.jsx("li",{children:"• Try more general search terms"}),e.jsx("li",{children:"• Check if your photos are indexed (look for the indexing progress)"}),e.jsx("li",{children:"• Try searching for colors, objects, or activities"}),e.jsx("li",{children:"• Use the demo library to test search functionality"})]})]}),e.jsxs("div",{className:"border border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-300 mb-2",children:"📁 Photos Not Loading"}),e.jsxs("ul",{className:"text-sm text-orange-700 dark:text-orange-400 space-y-1",children:[e.jsx("li",{children:"• Ensure the photo directory is accessible"}),e.jsx("li",{children:"• Check file permissions"}),e.jsx("li",{children:"• Try re-selecting the directory"}),e.jsx("li",{children:"• Restart the application if thumbnails don't appear"})]})]}),e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"🐌 Slow Performance"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsx("li",{children:"• Large photo libraries may take time to index initially"}),e.jsx("li",{children:'• Use the "Fast" indexing option for quicker but less accurate results'}),e.jsx("li",{children:"• Close other applications to free up memory"}),e.jsx("li",{children:"• Consider using smaller batch sizes for indexing"})]})]}),e.jsxs("div",{className:"border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-2",children:"🎯 Face Recognition Issues"}),e.jsxs("ul",{className:"text-sm text-green-700 dark:text-green-400 space-y-1",children:[e.jsx("li",{children:"• Face detection works best with clear, well-lit photos"}),e.jsx("li",{children:"• Ensure faces are not obstructed or at extreme angles"}),e.jsx("li",{children:"• Re-index your photos after making changes"}),e.jsx("li",{children:"• Check the People view to see detected faces"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Still Need Help?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"If you're still experiencing issues, try:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2 space-y-1",children:[e.jsx("li",{children:"• Restarting the application"}),e.jsx("li",{children:"• Checking the browser console for error messages"}),e.jsx("li",{children:"• Ensuring your browser supports modern web features"}),e.jsx("li",{children:"• Clearing browser cache and cookies"})]})]})]})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:d=>{d.key==="Escape"&&t()},role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ci,{className:"w-6 h-6 text-blue-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Help Center"})]}),e.jsx("button",{type:"button",onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close help",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:e.jsx("div",{className:"flex gap-1",children:l.map(d=>e.jsxs("button",{type:"button",onClick:()=>n(d.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${r===d.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[d.icon,d.title]},d.id))})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:l.find(d=>d.id===r)?.content}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Need more help? Check out the demo library to explore features."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors text-sm font-medium",children:"Keyboard Shortcuts"}),e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})]})})]})}),e.jsx(lc,{isOpen:i,onClose:()=>u(!1)})]})}const dc={facebook:{name:"Facebook",icon:e.jsx(xi,{className:"w-5 h-5"}),maxSize:2048,aspectRatio:"1.91:1"},instagram:{name:"Instagram",icon:e.jsx(mi,{className:"w-5 h-5"}),maxSize:1080,aspectRatio:"1:1"},twitter:{name:"Twitter",icon:e.jsx(hi,{className:"w-5 h-5"}),maxSize:1200,aspectRatio:"16:9"}},La={web:{name:"Web",description:"Optimized for websites",maxSize:1920,quality:85},email:{name:"Email",description:"Small size for email",maxSize:1024,quality:80},print:{name:"Print",description:"High quality for printing",maxSize:3e3,quality:95},instagram:{name:"Instagram",description:"Square format for Instagram",maxSize:1080,quality:90},twitter:{name:"Twitter",description:"Wide format for Twitter",maxSize:1200,quality:85},facebook:{name:"Facebook",description:"Wide format for Facebook",maxSize:2048,quality:90}},uc=({selected:a,dir:t,onClose:s,uiActions:r})=>{const[n,i]=o.useState("link"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[p,y]=o.useState(!1),[v,w]=o.useState({expiryHours:24,viewOnly:!1}),[T,f]=o.useState("web"),[N,b]=o.useState(""),[C,x]=o.useState(""),[m,S]=o.useState(""),j=o.useRef(null),I=a.size,E=I>1,k=async()=>{if(!(!t||I===0)){c(!0);try{const M=Array.from(a),B=await Rs(t,"local",M,v),te=`${window.location.origin}/share/${B.token}/view`;d(te),await navigator.clipboard.writeText(te),y(!0),r.setNote("Share link created and copied to clipboard!")}catch(M){r.setNote(M instanceof Error?M.message:"Share failed")}finally{c(!1)}}},R=async()=>{if(!(!t||I===0||!N)){c(!0);try{const M=Array.from(a),B=La[T],te=await ht(t,M,N,"copy",!1,!1,{preset:T==="instagram"||T==="twitter"||T==="facebook"?"web":T,resizeLong:B.maxSize,quality:B.quality});r.setNote(`Exported ${te.copied} photos to ${N}`),s()}catch(M){r.setNote(M instanceof Error?M.message:"Export failed")}finally{c(!1)}}},z=async()=>{l||await k()},Z=async()=>{const M=C.split(/[\n,;]+/).map(me=>me.trim()).filter(Boolean);if(M.length===0){r.setNote("Add at least one recipient");return}await z();const B=E?`Photos (${I})`:"Photo",te=`${m?m+`

`:""}${l}`,F=`mailto:${encodeURIComponent(M.join(","))}?subject=${encodeURIComponent(B)}&body=${encodeURIComponent(te)}`;try{window.location.href=F,s()}catch(me){r.setNote(me instanceof Error?me.message:"Could not open email client")}},O=M=>{if(!l)return;const B=`Check out ${E?`these ${I} photos`:"this photo"}!`,te={facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(l)}`,twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(B)}&url=${encodeURIComponent(l)}`,instagram:`instagram://library?AssetPath=${encodeURIComponent(l)}`};window.open(te[M],"_blank","width=600,height=400")},K=o.useCallback(()=>{!l||!j.current||(j.current.innerHTML=`<div style="font-family: monospace; font-size: 12px; line-height: 1; white-space: pre;">${D()}</div>`)},[l]),D=M=>`
 █▀▀▀▀▀█ █ ▀█▀ █▀▀▀▀▀█
 █ ███ █ █ █ █ █ ███ █
 █ ▀▀▀ █ █▄█▄█ █ ▀▀▀ █
 ▀▀▀▀▀▀▀ █ ▀ █ ▀▀▀▀▀▀▀
 █▀█▀▀█▄ ▀ █ ▀ ▄█▀▀█▀█
 █ ▀ ▀ █ ▀█ ▀█ █ ▀ ▀ █
 █▄█▄█▄█ ▀ ▀ ▀ █▄█▄█▄█
 ▀▀▀▀▀▀▀ ▀ ▀ ▀ ▀▀▀▀▀▀▀
 █ ▀█ ▀█▀ █▀█ █ ▀█ ▀█▀
 █ █ █ █ █ █ █ █ █ █ █
 █▄█▄█▄█ ▀ ▀ ▀ █▄█▄█▄█
    `.trim();return et.useEffect(()=>{l&&K()},[l,K]),e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center",children:e.jsx(Kt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Share ",E?`${I} Photos`:"Photo"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose how you'd like to share your photos"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{id:"link",icon:e.jsx(ya,{className:"w-5 h-5"}),label:"Share Link",desc:"Create shareable link"},{id:"email",icon:e.jsx(va,{className:"w-5 h-5"}),label:"Email",desc:"Send via email"},{id:"social",icon:e.jsx(Ve,{className:"w-5 h-5"}),label:"Social Media",desc:"Share on social platforms"},{id:"export",icon:e.jsx(_e,{className:"w-5 h-5"}),label:"Export",desc:"Download to folder"}].map(M=>e.jsx("button",{type:"button",onClick:()=>i(M.id),className:`p-4 rounded-xl border-2 transition-all ${n===M.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n===M.id?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:M.icon}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:M.label}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:M.desc})]})]})},M.id))})}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[n==="link"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Link Expires In"}),e.jsxs("select",{id:"expiry-select",value:v.expiryHours,onChange:M=>w(B=>({...B,expiryHours:parseInt(M.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[e.jsx("option",{value:1,children:"1 hour"}),e.jsx("option",{value:24,children:"24 hours"}),e.jsx("option",{value:168,children:"1 week"}),e.jsx("option",{value:720,children:"1 month"}),e.jsx("option",{value:8760,children:"1 year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password (Optional)"}),e.jsx("input",{id:"password-input",type:"password",value:v.password||"",onChange:M=>w(B=>({...B,password:M.target.value||void 0})),placeholder:"Leave empty for no password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"viewOnly",checked:v.viewOnly,onChange:M=>w(B=>({...B,viewOnly:M.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"viewOnly",className:"text-sm text-gray-700 dark:text-gray-300",children:"View-only (prevent downloads)"})]}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 dark:text-green-200",children:[e.jsx(ot,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Share link created!"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"}),e.jsxs("button",{type:"button",onClick:async()=>{await navigator.clipboard.writeText(l),y(!0),setTimeout(()=>y(!1),2e3)},className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded flex items-center gap-1",children:[p?e.jsx(ot,{className:"w-4 h-4"}):e.jsx(di,{className:"w-4 h-4"}),p?"Copied!":"Copy"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ja,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"QR Code"})]}),e.jsx("div",{ref:j,className:"flex justify-center",children:e.jsx("div",{className:"w-32 h-32 bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(ja,{className:"w-16 h-16 text-gray-400"})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-2",children:"Scan to open on mobile"})]})]}):e.jsx("button",{type:"button",onClick:k,disabled:u,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Share Link..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"w-5 h-5"}),"Create Share Link"]})})]}),n==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Addresses"}),e.jsx("textarea",{id:"email-input",value:C,onChange:M=>x(M.target.value),placeholder:"Enter email addresses separated by commas",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message (Optional)"}),e.jsx("textarea",{id:"email-message",placeholder:"Add a personal message...",value:m,onChange:M=>S(M.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 h-20"})]}),e.jsxs("button",{type:"button",onClick:Z,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center justify-center gap-2",children:[e.jsx(va,{className:"w-5 h-5"}),"Send Email"]})]}),n==="social"&&e.jsx("div",{className:"space-y-4",children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Share your photos on social media:"}),Object.entries(dc).map(([M,B])=>e.jsxs("button",{type:"button",onClick:()=>O(M),className:"w-full p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:B.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium",children:B.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[B.aspectRatio," • Max ",B.maxSize,"px"]})]}),e.jsx(ui,{className:"w-5 h-5 text-gray-400"})]},M))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"First create a share link, then share on social media"}),e.jsx("button",{type:"button",onClick:()=>i("link"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Create Share Link First"})]})}),n==="export"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"export-destination",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Destination"}),e.jsx("input",{id:"export-destination",type:"text",value:N,onChange:M=>b(M.target.value),placeholder:"/absolute/path/to/export/folder",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Preset"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(La).map(([M,B])=>e.jsxs("button",{type:"button",onClick:()=>f(M),className:`p-3 border rounded-lg text-left ${T===M?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:B.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:B.description}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["Max ",B.maxSize,"px • ",B.quality,"% quality"]})]},M))})]}),e.jsx("button",{type:"button",onClick:R,disabled:u||!N,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-5 h-5"}),"Export ",I," Photo",E?"s":""]})})]})]})]})})},hc={blue:{primary:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#3b82f6"},green:{primary:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#22c55e"},purple:{primary:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#a855f7"},orange:{primary:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#f97316"},gray:{primary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#6b7280"}};function mc({children:a}){const t=Te(l=>l.themeMode),s=Te(l=>l.colorScheme),r=Te(l=>l.density),n=Te(l=>l.customColors),i=ra(),u=o.useMemo(()=>t==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t,[t]),c=o.useMemo(()=>{const l=n?{primary:n.primary,secondary:n.secondary,accent:n.accent}:hc[s],d={};return n?(d["--color-primary"]=n.primary,d["--color-primary-hover"]=n.primary,d["--color-primary-active"]=n.primary):Object.entries(l.primary).forEach(([p,y])=>{d[`--color-primary-${p}`]=y}),n?d["--color-secondary"]=n.secondary:Object.entries(l.secondary).forEach(([p,y])=>{d[`--color-secondary-${p}`]=y}),d["--color-accent"]=n?n.accent:l.accent,u==="dark"?(d["--color-background"]="#0f172a",d["--color-surface"]="#1e293b",d["--color-surface-hover"]="#334155",d["--color-border"]="#334155",d["--color-border-hover"]="#475569",d["--color-text-primary"]="#f8fafc",d["--color-text-secondary"]="#cbd5e1",d["--color-text-tertiary"]="#94a3b8"):(d["--color-background"]="#ffffff",d["--color-surface"]="#f8fafc",d["--color-surface-hover"]="#f1f5f9",d["--color-border"]="#e2e8f0",d["--color-border-hover"]="#cbd5e1",d["--color-text-primary"]="#0f172a",d["--color-text-secondary"]="#475569",d["--color-text-tertiary"]="#64748b"),i&&(d["--color-background"]="#000000",d["--color-surface"]="#000000",d["--color-surface-hover"]="#000000",d["--color-border"]="#ffffff",d["--color-border-hover"]="#ffffff",d["--color-text-primary"]="#ffffff",d["--color-text-secondary"]="#ffffff",d["--color-text-tertiary"]="#ffffff",d["--color-primary"]="#ffffff",d["--color-accent"]="#00ff00"),d},[u,s,n,i]);return o.useEffect(()=>{const l=document.documentElement;Object.entries(c).forEach(([d,p])=>{l.style.setProperty(d,p)}),l.classList.remove("light","dark"),l.classList.add(u),l.classList.remove("density-compact","density-normal","density-spacious"),l.classList.add(`density-${r}`),i?l.classList.add("high-contrast"):l.classList.remove("high-contrast")},[c,u,r,i]),o.useEffect(()=>{if(t!=="auto")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>{document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(l.matches?"dark":"light")};return l.addEventListener("change",d),()=>l.removeEventListener("change",d)},[t]),e.jsx(e.Fragment,{children:a})}const xc=[{id:"blue",name:"Blue",color:"#3b82f6"},{id:"green",name:"Green",color:"#22c55e"},{id:"purple",name:"Purple",color:"#a855f7"},{id:"orange",name:"Orange",color:"#f97316"},{id:"gray",name:"Gray",color:"#6b7280"}],pc=[{id:"compact",name:"Compact",description:"Tighter spacing, smaller elements"},{id:"normal",name:"Normal",description:"Balanced spacing and sizing"},{id:"spacious",name:"Spacious",description:"More breathing room, larger elements"}];function gc({isOpen:a,onClose:t}){const[s,r]=o.useState("appearance"),n=Te(x=>x.themeMode),i=Te(x=>x.colorScheme),u=Te(x=>x.density),c=Te(x=>x.customColors),l=Te(x=>x.setThemeMode),d=Te(x=>x.setColorScheme),p=Te(x=>x.setDensity),y=Te(x=>x.setCustomColors),v=Te(x=>x.resetTheme),w=ra(),T=es(x=>x.setHighContrast),[f,N]=o.useState(c||{primary:"#3b82f6",secondary:"#64748b",accent:"#3b82f6"});if(!a)return null;const b=(x,m)=>{const S={...f,[x]:m};N(S),y(S)},C=x=>{d(x),x!=="custom"&&y(void 0)};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-xl flex items-center justify-center",children:e.jsx(Nt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Theme Settings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Customize your app appearance"})]})]}),e.jsx("button",{type:"button",onClick:t,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center","aria-label":"Close theme settings",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[{id:"appearance",name:"Appearance",icon:Pt},{id:"colors",name:"Colors",icon:Nt},{id:"accessibility",name:"Accessibility",icon:ys}].map(x=>e.jsxs("button",{type:"button",onClick:()=>r(x.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${s===x.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(x.icon,{className:"w-4 h-4"}),x.name]},x.id))}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[s==="appearance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Theme Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{id:"light",name:"Light",icon:Ss},{id:"dark",name:"Dark",icon:Za},{id:"auto",name:"Auto",icon:pi}].map(x=>e.jsxs("button",{type:"button",onClick:()=>l(x.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${n===x.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx(x.icon,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:x.name})]},x.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Density"}),e.jsx("div",{className:"space-y-3",children:pc.map(x=>e.jsx("button",{type:"button",onClick:()=>p(x.id),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${u===x.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:x.name}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:x.description})]}),u===x.id&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full"})]})},x.id))})]})]}),s==="colors"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Color Scheme"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[xc.map(x=>e.jsxs("button",{type:"button",onClick:()=>C(x.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i===x.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-gray-300 dark:border-gray-600",style:{backgroundColor:x.color}}),e.jsx("span",{className:"text-sm font-medium",children:x.name})]},x.id)),e.jsxs("button",{type:"button",onClick:()=>C("custom"),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i==="custom"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-dashed border-gray-400 dark:border-gray-500 flex items-center justify-center",children:e.jsx(Nt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})}),e.jsx("span",{className:"text-sm font-medium",children:"Custom"})]})]})]}),i==="custom"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Custom Colors"}),e.jsx("div",{className:"space-y-4",children:[{key:"primary",label:"Primary"},{key:"secondary",label:"Secondary"},{key:"accent",label:"Accent"}].map(({key:x,label:m})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:`${x}-color`,className:"text-sm font-medium text-gray-700 dark:text-gray-300 min-w-16",children:m}),e.jsx("input",{id:`${x}-color`,type:"color",value:f[x],onChange:S=>b(x,S.target.value),className:"w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),e.jsx("input",{type:"text",value:f[x],onChange:S=>b(x,S.target.value),className:"flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"#000000"})]},x))})]})]}),s==="accessibility"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"High Contrast Mode"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ys,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"High Contrast"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Increases contrast for better accessibility"})]})]}),e.jsx("button",{type:"button",onClick:()=>T?.(!w),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${w?"bg-blue-600":"bg-gray-200 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${w?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Reset Theme"}),e.jsxs("button",{type:"button",onClick:()=>{v(),T?.(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx(Va,{className:"w-4 h-4"}),"Reset to Defaults"]})]})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors",children:"Close"})})]})})}const fc=a=>a.split("/").pop()||a;function Aa({children:a,onEscape:t}){const s=et.useRef(null);return et.useEffect(()=>{const r=s.current;if(!r)return;const n=r.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'),i=Array.from(n).filter(c=>!c.hasAttribute("disabled"));i.length>0?(i.find(l=>l.getAttribute("tabindex")!=="-1")||i[0]).focus():(r.setAttribute("tabindex","-1"),r.focus());const u=c=>{if(c.key==="Escape"&&(c.stopPropagation(),c.preventDefault(),t&&t()),c.key==="Tab"){if(i.length===0)return;const l=i.indexOf(document.activeElement),d=c.shiftKey?-1:1;let p=l+d;p<0&&(p=i.length-1),p>=i.length&&(p=0),c.preventDefault(),i[p].focus()}};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[t]),e.jsx("div",{ref:s,children:a})}function bc(){const[a,t]=o.useState(!1);o.useEffect(()=>(t(!0),()=>t(!1)),[]);const s=co(),r=uo(),n=ho(),i=mo(),u=Co(),c=To(),l=No(),d=ko(),p=Eo(),y=So(),v=jo(),w=go(),T=fo(),f=bo(),N=yo(),b=vo(),C=Do(),x=_o(),m=xo(),S=po(),j=Po(),I=Io(),E=$o(),k=Mo(),R=Fo(),z=Ro(),Z=z,O=Lo(),K=Ao(),D=[],M=Ur();zr();const B=Oo(),te=Uo(),F=zo(),me=Bo();qo();const A=Vo(),se=Ho(),de=Wo(),H=Go(),Q=Ko(),U=Br(),V=qr(),$=Yo(),G=Qo(),[J,X]=o.useState("library"),L=Os(),le=or(),[Y,ne]=o.useState("");if((L.pathname||"").startsWith("/share/"))return e.jsx(_a,{children:e.jsx(pl,{})});const[q,ue]=o.useState(new Set),[ye,ee]=o.useState("medium"),[ve,He]=o.useState("grid"),[Oe,ts]=o.useState("day"),[$t,Mt]=o.useState("all"),[ss,mt]=o.useState(!1),[Le,as]=o.useState(""),[Ae,rs]=o.useState(""),[ke,xe]=o.useState(null),[ia,sn]=o.useState(!1),[an,Ue]=o.useState(!1),[we,We]=o.useState(null),[be,ze]=o.useState(null),[ns,rn]=o.useState([]),Dt=o.useRef(ns),[nn,oa]=o.useState(!1),[on,ln]=o.useState("home");o.useEffect(()=>{Dt.current=ns},[ns]);const cn=o.useCallback((h,g)=>h.length===g.length&&h.every((P,W)=>P.length===g[W].length&&P.every((_,re)=>_===g[W][re])),[]),la=o.useRef(null),[ca,dn]=o.useState({cameras:[],places:[]}),[un,xt]=o.useState(!1),[is,Re]=o.useState([]),[pt,_t]=o.useState(!1),[hn,os]=o.useState(void 0),[gt,ls]=o.useState(void 0),[mn,cs]=o.useState(!1),[xn,pn]=o.useState(void 0),[gn,ds]=o.useState(!1),[tt,fn]=o.useState(0),[st,Ge]=o.useState(null),[bn,da]=o.useState(!1),[yn,vn]=o.useState(()=>{try{return!localStorage.getItem("ps_hint_help_seen")}catch{return!0}}),[us,jn]=o.useState([]),Ot=o.useRef(null),[ft,hs]=o.useState(()=>{try{const h=localStorage.getItem("userActions");return h?JSON.parse(h):[]}catch{return[]}}),[wn,Nn]=o.useState(()=>{try{const h=localStorage.getItem("onboardingSteps");return h?JSON.parse(h):[]}catch{return[]}}),[kn,ua]=o.useState(!1),[Sn,ha]=o.useState(!1),ms=o.useMemo(()=>{const h={},g=B||{};for(const P of Object.keys(g)){const _=(g[P]||[]).find(re=>/^rating:[1-5]$/.test(re));_&&(h[P]=parseInt(_.split(":")[1],10))}return h},[B]);o.useEffect(()=>{try{localStorage.getItem("ps_theme")==="dark"&&document.documentElement.classList.add("dark")}catch{}},[]);const xs=ra(),at=wo();o.useEffect(()=>{const h=g=>{const P=document.activeElement;if(!(P&&(P.tagName==="INPUT"||P.tagName==="TEXTAREA"||P.isContentEditable))){if(g.key.toLowerCase()==="i"){g.preventDefault(),U.setShowInfoOverlay&&U.setShowInfoOverlay(!at);return}if(g.key.toLowerCase()==="a"){g.preventDefault(),xe({kind:"advanced"});return}if(g.key==="?"){g.preventDefault(),Ue(W=>!W);return}if(J==="results"&&ve==="timeline"){const W=_=>window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:_}}));if(g.key.toLowerCase()==="t"){g.preventDefault(),W("today");return}if(g.key.toLowerCase()==="m"){g.preventDefault(),W("this-month");return}if(g.key.toLowerCase()==="l"){g.preventDefault(),W("last-month");return}if(g.key.toLowerCase()==="o"){g.preventDefault(),W("oldest");return}}}};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[at,U,J,ve]),o.useEffect(()=>{const h=document.body;xs?h.classList.add("high-contrast"):h.classList.remove("high-contrast")},[xs]);const Cn=o.useMemo(()=>{const h=!!(w||T||f||N||b||v),g=!!(Le&&Ae),P=Array.isArray(se)&&se.length>0,W=!!(C&&C.trim()),_=tt>0||y;return!!(k||h||g||P||W||_)},[w,T,f,N,b,v,Le,Ae,se,C,tt,y,k]);o.useEffect(()=>{const g=(L.pathname||"/library").split("/").filter(Boolean)[0]||"library",P=g==="search"?"results":g==="library"?"library":g==="people"?"people":g==="collections"?"collections":g==="settings"?"tasks":"library";J!==P&&X(P)},[L.pathname,J]),o.useEffect(()=>{const h=L.pathname||"",g=J==="results"?"/search":J==="library"?"/library":J==="people"?"/people":J==="collections"?"/collections":"/settings";h!==g&&le({pathname:g,search:L.search},{replace:!1})},[J,le,L.search]),o.useEffect(()=>{if(!a)return;const h=new URLSearchParams(L.search),g=h.get("q")||"";g&&g!==Y&&ne(g);try{h.get("fav")==="1"&&V.setFavOnly(!0);const W=h.get("tags")||"";W&&V.setTagFilter(W);const _=h.get("date_from"),re=h.get("date_to");_&&as(_),re&&rs(re);const ce=h.get("place");ce&&U.setPlace(ce),h.get("has_text")==="1"&&U.setHasText(!0);const je=h.get("camera");je&&U.setCamera(je);const Pe=h.get("iso_min");Pe&&U.setIsoMin(parseFloat(Pe));const Ie=h.get("iso_max");Ie&&U.setIsoMax(parseFloat(Ie));const At=h.get("f_min");At&&U.setFMin(parseFloat(At));const Se=h.get("f_max");Se&&U.setFMax(parseFloat(Se));const Ut=h.get("person"),jt=h.get("persons");jt?G.setPersons(jt.split(",").map(wt=>wt.trim()).filter(Boolean)):Ut&&G.setPersons([Ut]);const Qe=h.get("rv");Qe&&U.setResultView&&U.setResultView(Qe);const zt=h.get("tb");zt&&U.setTimelineBucket&&U.setTimelineBucket(zt)}catch{}},[L.search,a,Y,V,U,G]),o.useEffect(()=>{Y&&Y.trim()&&hs(h=>{if(!h.includes("searched")){const g=[...h,"searched"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return h})},[Y]),o.useEffect(()=>{s&&hs(h=>{if(!h.includes("selected_directory")){const g=[...h,"selected_directory"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return h})},[s]),o.useEffect(()=>{M&&M.length>0&&hs(h=>{if(!h.includes("indexed")){const g=[...h,"indexed"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return h})},[M]),o.useEffect(()=>{ua(!!(ft.length===0||J==="results"&&!ft.includes("searched")||J==="library"&&s&&!ft.includes("searched")))},[J,ft,s]),o.useEffect(()=>{const g=!localStorage.getItem("onboardingComplete")&&s&&M&&M.length>0;ha(g||!1)},[s,M]);const[Dc,_c]=o.useState(0),Tn=120,En=o.useMemo(()=>(M||[]).map(h=>({path:h})),[M]),Ke=o.useCallback(async()=>{if(s)try{const h=await As(s);V.setFavorites(h.favorites||[])}catch{}},[s,V]),Rt=o.useCallback(async()=>{if(s)try{const h=await Us(s);V.setSaved(h.saved||[])}catch{}},[s,V]),rt=o.useCallback(async()=>{if(s)try{const{apiGetPresets:h}=await he(async()=>{const{apiGetPresets:P}=await Promise.resolve().then(()=>pe);return{apiGetPresets:P}},void 0,import.meta.url),g=await h(s);jn(g.presets||[])}catch{}},[s]),$e=o.useCallback(async()=>{if(s)try{const h=await Gs(s);V.setTagsMap(h.tags||{}),V.setAllTags(h.all||[])}catch{}},[s,V]),Lt=o.useCallback(async()=>{if(s)try{const h=await Bs(s,r,S?i:void 0,m?n:void 0);G.setDiag(h)}catch{}},[s,r,S,i,m,n,G]),ps=o.useCallback(async()=>{if(s)try{const h=await Xs(s);G.setClusters(h.clusters||[])}catch{}},[s,G]),Pn=o.useCallback(async()=>{if(s)try{const h=await zs(s);G.setPoints(h.points||[])}catch{}},[s,G]),bt=o.useCallback(async(h=120,g=0,P=!1)=>{try{if(!s)return;const W=await Ft(s,r,h,g,{openaiKey:S?i:void 0,hfToken:m?n:void 0}),_=W.paths&&W.paths.length===h&&g+W.paths.length<W.total;P?W.paths&&W.paths.length>0&&V.appendLibrary(W.paths):V.setLibrary(W.paths||[]),V.setLibHasMore(_)}catch{}},[s,r,S,i,m,n,V]),ma=o.useCallback(async()=>{try{if(!s)return;const h=await Qs(s);dn({cameras:h.cameras||[],places:h.places||[]})}catch{}},[s]);o.useEffect(()=>{let h=!1;return(async()=>{if(!s){ds(!1);return}try{const{apiOcrStatus:P}=await he(async()=>{const{apiOcrStatus:_}=await Promise.resolve().then(()=>pe);return{apiOcrStatus:_}},void 0,import.meta.url),W=await P(s);h||ds(!!W.ready)}catch{h||ds(!1)}})(),()=>{h=!0}},[s]);const yt=o.useCallback(async()=>{$.setBusy("Indexing…"),$.setNote(""),_t(!0);const h=`index-${Date.now()}`,g={id:h,type:"index",title:"Indexing Photos",description:`Analyzing photos in ${s}`,status:"running",startTime:new Date,canCancel:!0,total:(M||[]).length||void 0};Re(P=>[...P,g]);try{const P=await Et(s,r,32,m?n:void 0,S?i:void 0);$.setNote(`Indexed. New ${P.new}, Updated ${P.updated}, Total ${P.total}`),Re(W=>W.map(_=>_.id===h?{..._,status:"completed",endTime:new Date,progress:P.total}:_)),await bt(120,0)}catch(P){$.setNote(P instanceof Error?P.message:"Index failed"),Re(W=>W.map(_=>_.id===h?{..._,status:"failed",endTime:new Date,error:P instanceof Error?P.message:"Index failed"}:_))}finally{$.setBusy(""),_t(!1)}},[s,r,m,n,S,i,bt,$]),Be=o.useCallback(async h=>{const g=(h??Y??"").trim();if(g){V.setQuery(g);try{const P=new URLSearchParams;P.set("q",g),k&&P.set("fav","1"),C?.trim()&&P.set("tags",C),Le&&Ae&&(P.set("date_from",Le),P.set("date_to",Ae)),v?.trim()&&P.set("place",v),y&&P.set("has_text","1"),w?.trim()&&P.set("camera",w),T&&P.set("iso_min",String(T)),f&&P.set("iso_max",String(f)),N&&P.set("f_min",String(N)),b&&P.set("f_max",String(b));const W=se.filter(Boolean);W.length===1&&P.set("person",W[0]),W.length>1&&P.set("persons",W.join(",")),le({pathname:"/search",search:`?${P.toString()}`},{replace:!1})}catch{}$.setBusy("Searching…"),$.setNote("");try{const P=C.split(",").map(je=>je.trim()).filter(Boolean),W=se.filter(Boolean);let _;const re=Le?Math.floor(new Date(Le).getTime()/1e3):void 0,ce=Ae?Math.floor(new Date(Ae).getTime()/1e3):void 0;A?_=await Ws(s,g,r,R,{favoritesOnly:k,tags:P,dateFrom:re,dateTo:ce,place:v||void 0,hasText:y,...W.length===1?{person:W[0]}:W.length>1?{persons:W}:{}}):_=await Zt(s,g,r,R,{hfToken:m?n:void 0,openaiKey:S?i:void 0,favoritesOnly:k,tags:P,dateFrom:re,dateTo:ce,...u?{useFast:!0,fastKind:c||void 0}:{},useCaptions:l,useOcr:d,camera:w||void 0,isoMin:T||void 0,isoMax:f||void 0,fMin:N||void 0,fMax:b||void 0,place:v||void 0,hasText:y||void 0,...W.length===1?{person:W[0]}:W.length>1?{persons:W}:{}});let fe=_.results||[];tt>0&&(fe=fe.filter(je=>(ms[je.path]||0)>=tt)),V.setResults(fe),V.setSearchId(_.search_id||""),$.setNote(`Found ${_.results?.length||0} results.`),await Promise.all([Ke(),Rt(),$e(),Lt()]),X("results")}catch(P){$.setNote(P instanceof Error?P.message:"Search failed")}finally{$.setBusy("")}}},[Y,V,le,L.search,$,B,se,Le,Ae,A,s,r,R,k,v,y,m,n,S,i,u,c,l,d,w,T,f,N,b,tt,ms,Ke,Rt,$e,Lt]),xa=Si(Be,300),In=o.useCallback(async h=>{$.setBusy(`Preparing ${h.toUpperCase()}…`);try{await qs(s,h,r,m?n:void 0,S?i:void 0),$.setNote(`${h.toUpperCase()} ready`)}catch(g){$.setNote(g instanceof Error?g.message:"Failed to build index")}finally{$.setBusy("")}},[s,r,m,n,S,i,$]),Fn=o.useCallback(async()=>{$.setBusy("Extracting text (OCR)…");try{const h=await Vs(s,r,["en"],m?n:void 0,S?i:void 0);$.setNote(`OCR updated ${h.updated} images`),await $e()}catch(h){$.setNote(h instanceof Error?h.message:"OCR failed")}finally{$.setBusy("")}},[s,r,m,n,S,i,$e,$]),$n=o.useCallback(async()=>{$.setBusy("Building metadata…");try{const h=await Ys(s,r,m?n:void 0,S?i:void 0);$.setNote(`Metadata ready (${h.updated})`)}catch(h){$.setNote(h instanceof Error?h.message:"Metadata build failed")}finally{$.setBusy("")}},[s,r,m,n,S,i,$]);o.useEffect(()=>{if(!te||!s)return;let h,g="";const P=_=>{switch(_?.type){case"ocr_build":return`OCR updated ${_.updated}`;case"captions_build":return`Captions updated ${_.updated}`;case"fast_build":return`${String(_.kind).toUpperCase()} ${_.ok?"ready":"failed"}`;case"thumbs_build":return`Thumbs made ${_.made}`;case"trips_build":return`Trips ${_.trips}`;case"metadata_build":return`Metadata updated ${_.updated}`;case"export":return`Exported ${_.copied}, skipped ${_.skipped}`;default:return""}},W=async()=>{try{const{apiAnalytics:_}=await he(async()=>{const{apiAnalytics:fe}=await Promise.resolve().then(()=>pe);return{apiAnalytics:fe}},void 0,import.meta.url),ce=((await _(s,10)).events||[]).slice(-1)[0];if(ce&&ce.time!==g){g=ce.time;const fe=P(ce);fe&&$.setNote(fe)}}catch{}h=window.setTimeout(W,2e3)};return W(),()=>{h&&window.clearTimeout(h)}},[te,s,$]),o.useEffect(()=>{if(!pt||!s){os(void 0),ls(void 0),cs(!1);return}let h,g;const P=async()=>{try{const{apiIndexStatus:W}=await he(async()=>{const{apiIndexStatus:Qe}=await Promise.resolve().then(()=>pe);return{apiIndexStatus:Qe}},void 0,import.meta.url),_=await W(s,r,m?n:void 0,S?i:void 0),re=Number(_.insert_done||0),ce=Number(_.insert_total||0),fe=Number(_.updated_done||0),je=Number(_.updated_total||0),Pe=re+fe,Ie=Math.max(1,ce+je),At=Math.min(1,Math.max(0,Pe/Ie));Ie>1&&os(At),cs(!!_.paused||_.state==="paused");const Se=[];Ie>1&&Se.push(`processed ${Pe}/${Ie}`),typeof _.indexed=="number"&&Se.push(`indexed ${_.indexed}`),typeof _.target=="number"&&_.target>0&&Se.push(`target ${_.target}`),typeof _.coverage=="number"&&Se.push(`coverage ${Math.round(_.coverage*100)}%`),typeof _.drift=="number"&&_.drift>0&&Se.push(`drift ${_.drift}`),_.state==="complete"&&(typeof _.new=="number"&&Se.push(`new ${_.new}`),typeof _.updated=="number"&&Se.push(`updated ${_.updated}`),_.last_index_time&&Se.push(`at ${_.last_index_time}`)),typeof gt=="number"&&isFinite(gt)&&gt>0&&Se.push(`eta ~${Math.max(1,Math.ceil(gt/60))}m`),Se.length>0&&pn(Se.join(" • ")),!g&&_.start&&(g=Date.parse(_.start));const Ut=Date.now(),jt=g?Math.max(1,(Ut-g)/1e3):void 0;if(jt&&Pe>5){const Qe=Pe/jt,zt=Math.max(0,Ie-Pe),wt=Qe>0?zt/Qe:void 0;wt&&isFinite(wt)&&ls(wt)}_.state==="complete"&&(os(void 0),ls(void 0),cs(!1))}catch{}h=window.setTimeout(P,1e3)};return P(),()=>{h&&window.clearTimeout(h)}},[pt,s,r,m,n,S,i]),o.useEffect(()=>{try{const h=new URLSearchParams(L.search);h.set("rv",ve),h.set("tb",Oe),le({pathname:L.pathname,search:`?${h.toString()}`},{replace:!0})}catch{}},[ve,Oe]);const vt=o.useCallback(h=>{ue(g=>{const P=new Set(g);return P.has(h)?P.delete(h):P.add(h),P})},[]);o.useCallback(async h=>{if(!(!s||q.size===0))try{const g=await ht(s,Array.from(q),h,"copy",!1,!1);$.setNote(`Exported ${g.copied}, skipped ${g.skipped}, errors ${g.errors} → ${g.dest}`)}catch(g){$.setNote(g instanceof Error?g.message:"Export failed")}},[s,q,$]);const pa=o.useCallback(h=>{const g=(j||[]).findIndex(P=>P.path===h);g>=0&&We(g)},[j]),Ye=o.useCallback(h=>{We(g=>{if(g===null)return null;const P=g+h;return!j||P<0||P>=j.length?g:P})},[j]),Mn=o.useCallback(async h=>{if(!s||q.size===0)return;const g=h.split(",").map(P=>P.trim()).filter(Boolean);try{const{apiSetTags:P}=await he(async()=>{const{apiSetTags:W}=await Promise.resolve().then(()=>pe);return{apiSetTags:W}},void 0,import.meta.url);await Promise.all(Array.from(q).map(W=>P(s,W,g))),$.setNote(`Updated tags for ${q.size} photos`),await $e()}catch(P){$.setNote(P instanceof Error?P.message:"Tag update failed")}},[s,q,$e,$]);o.useCallback(async h=>{if(!(!s||q.size===0))try{const{apiSetTags:g}=await he(async()=>{const{apiSetTags:_}=await Promise.resolve().then(()=>pe);return{apiSetTags:_}},void 0,import.meta.url),P=/^rating:[1-5]$/,W=Array.from(q);await Promise.all(W.map(async _=>{const re=(B?.[_]||[]).filter(fe=>!P.test(fe)),ce=h===0?re:[...re,`rating:${h}`];await g(s,_,ce)})),$.setNote(h===0?`Cleared rating for ${q.size}`:`Set rating ${h} for ${q.size}`),await $e()}catch(g){$.setNote(g instanceof Error?g.message:"Rating update failed")}},[s,q,B,$e,$]),o.useEffect(()=>{if(!a)return;const h=I||"";ne(g=>g===h?g:h)},[I,a]),o.useEffect(()=>{s&&(Ke(),Rt(),$e(),Lt(),ps(),bt(Tn,0),ma(),rt())},[s,Ke,Rt,$e,Lt,ps,bt,ma,rt]),o.useEffect(()=>{if(!a)return;const h=j?.length??0;ze(g=>{const P=h>0?g===null?0:Math.min(g,h-1):null;return Object.is(g,P)?g:P})},[j?.length,a]),o.useEffect(()=>{function h(g){const P=g.target;if(P&&(P.tagName==="INPUT"||P.tagName==="TEXTAREA"||P.isContentEditable)||ia||ke||ss)return;if(g.key==="/"){g.preventDefault();return}if(g.key==="?"||g.shiftKey&&g.key==="/"){g.preventDefault(),sn(!0);return}if(!(J!=="results"||!((j?.length||0)>0))){if(g.key==="Escape"){We(null);return}if(we!==null){if((g.key==="ArrowLeft"||g.key==="k")&&(g.preventDefault(),Ye(-1)),(g.key==="ArrowRight"||g.key==="j")&&(g.preventDefault(),Ye(1)),g.key.toLowerCase()==="f"){g.preventDefault();const _=j?.[we]?.path;if(!_)return;kt(s,_,!E.includes(_)).then(Ke).catch(()=>{})}return}if(g.key.toLowerCase()==="a"){g.preventDefault(),ue(new Set((j??[]).map(_=>_.path)));return}if(g.key.toLowerCase()==="c"){g.preventDefault(),ue(new Set);return}if(g.key.toLowerCase()==="f"&&be!==null){g.preventDefault();const _=j?.[be]?.path;if(!_)return;kt(s,_,!E.includes(_)).then(Ke).catch(()=>{});return}if(g.key==="Enter"&&be!==null){g.preventDefault(),We(be);return}if(g.key===" "&&be!==null){g.preventDefault();const _=j?.[be]?.path;if(!_)return;vt(_);return}if(g.key==="ArrowLeft"){g.preventDefault(),be!==null&&ze(Math.max(0,be-1));return}if(g.key==="ArrowRight"){g.preventDefault(),be!==null&&ze(Math.min((j?.length??1)-1,be+1));return}if(g.key==="ArrowUp"&&be!==null){g.preventDefault();const _=Dt.current;let re=_.findIndex(ce=>ce.includes(be));if(re>0){const ce=_[re].indexOf(be),fe=_[re-1],je=fe[Math.min(ce,fe.length-1)];typeof je=="number"&&ze(je)}return}if(g.key==="ArrowDown"&&be!==null){g.preventDefault();const _=Dt.current;let re=_.findIndex(ce=>ce.includes(be));if(re>=0&&re<_.length-1){const ce=_[re].indexOf(be),fe=_[re+1],je=fe[Math.min(ce,fe.length-1)];typeof je=="number"&&ze(je)}return}if(g.key==="Home"){g.preventDefault(),ze(0);return}if(g.key==="End"){g.preventDefault(),ze(j.length-1);return}if((g.key==="PageUp"||g.key==="PageDown")&&be!==null){g.preventDefault();const _=3,re=Dt.current,ce=re.findIndex(fe=>fe.includes(be));if(ce>=0){const fe=re[ce].indexOf(be),je=g.key==="PageUp"?Math.max(0,ce-_):Math.min(re.length-1,ce+_),Pe=re[je],Ie=Pe[Math.min(fe,Pe.length-1)];typeof Ie=="number"&&ze(Ie)}return}}}return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[J,j?.length,we,s,E,Ye,vt,ia,ke,ss]),o.useEffect(()=>{if(be===null)return;const g=document.getElementById("modern-results-grid")?.querySelector(`[data-photo-idx="${be}"]`);g&&g.scrollIntoView({block:"nearest",inline:"nearest"})},[be]);const Dn=()=>s?M&&M.length===0?e.jsx("div",{className:"p-4",children:e.jsx(fs,{type:"no-photos",onAction:()=>xe({kind:"folder"}),onOpenHelp:()=>Ue(!0)})}):e.jsxs("div",{className:"p-4",children:[e.jsx(ul,{dir:s,engine:r,library:M,onLoadLibrary:bt,selected:q,onToggleSelect:vt,onOpen:h=>{const g=[{path:h,score:0}];V.setResults(g),We(0),X("results")},tagsMap:B}),!Y&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-700 font-medium mb-2",children:"Try these searches"}),e.jsx(Ma,{onSearch:Be})]})]}):e.jsxs("div",{className:"p-4",children:[e.jsx(fs,{type:"no-directory",onAction:()=>xe({kind:"folder"}),onDemoAction:async()=>{U.setDir("/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data");try{await yt(),$.setNote("Demo library loaded! Try searching for 'beach sunset' or 'family photos'")}catch(g){console.error("Failed to setup demo:",g),$.setNote(g instanceof Error?g.message:"Failed to setup demo")}},onOpenHelp:()=>Ue(!0),onStartTour:()=>Ue(!0),sampleQueries:["beach sunset","birthday cake","mountain hike","red car"],onRunSample:h=>Be(h)}),e.jsx(Sl,{onSelectDirectory:()=>xe({kind:"folder"}),onImport:()=>{},onHelp:()=>Ue(!0)})]});return e.jsx(_a,{children:e.jsx(mc,{children:e.jsxs("div",{className:"flex h-screen bg-white dark:bg-gray-950 dark:text-gray-100",children:[e.jsx(Ol,{}),me&&e.jsx(wl,{onStartDemo:async()=>{const h="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";U.setDir(h),$.setShowWelcome(!1);try{await Xe(h),await yt()}catch(g){console.error("Failed to add demo path or index:",g),$.setNote(g instanceof Error?g.message:"Failed to setup demo")}},onSelectFolder:()=>{xe({kind:"folder"}),$.setShowWelcome(!1)},onClose:()=>$.setShowWelcome(!1)}),e.jsx(kl,{open:!s&&un,onClose:()=>{xt(!1),localStorage.setItem("hasSeenOnboarding","true")},onQuickStart:async h=>{try{const g=[];for(const P of h)try{const W=await fetch("/scan_count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([P])});W.ok&&(await W.json()).items?.[0]?.exists&&g.push(P)}catch{}if(g.length===0){xt(!1),localStorage.setItem("hasSeenOnboarding","true");return}U.setDir(g[0]);for(const P of g){try{await Xe(P)}catch{}(async()=>{try{await Et(P,r,24,m?n:void 0,S?i:void 0)}catch{}})()}xt(!1),localStorage.setItem("hasSeenOnboarding","true")}catch(g){$.setNote(g instanceof Error?g.message:"Quick start failed")}},onCustom:()=>{xe({kind:"folder"}),xt(!1),localStorage.setItem("hasSeenOnboarding","true")},onDemo:async()=>{try{const h="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";U.setDir(h),await Xe(h),await yt()}catch(h){$.setNote(h instanceof Error?h.message:"Demo setup failed")}xt(!1),localStorage.setItem("hasSeenOnboarding","true")},onTour:()=>{Ue(!0)}}),e.jsx(Dl,{selectedView:J,onViewChange:h=>X(h),library:M,favorites:E,collections:Object.keys(O||{}),clusters:de,savedSearches:Z,smart:Object.keys(K||{}),trips:D,isOpen:nn,onClose:()=>oa(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(zl,{searchText:Y,setSearchText:ne,onSearch:Be,clusters:de,allTags:x,meta:ca,diag:Q,busy:!!te,gridSize:ye,setGridSize:ee,selectedView:J,setSelectedView:h=>X(h),currentFilter:$t,setCurrentFilter:Mt,ratingMin:tt,setRatingMin:fn,setModal:h=>xe(h),setIsMobileMenuOpen:oa,setShowFilters:mt,selected:q,setSelected:ue,dir:s,engine:r,topK:R,useOsTrash:p,showInfoOverlay:at,onToggleInfoOverlay:()=>U.setShowInfoOverlay?U.setShowInfoOverlay(!at):void 0,resultView:ve,onChangeResultView:h=>U.setResultView?.(h),timelineBucket:Oe,onChangeTimelineBucket:h=>U.setTimelineBucket?.(h),photoActions:V,uiActions:$,toastTimerRef:Ot,setToast:Ge,isIndexing:pt,onIndex:yt,activeJobs:is.filter(h=>h.status==="running").length,onOpenJobs:()=>xe({kind:"jobs"}),progressPct:hn,etaSeconds:gt,paused:mn,tooltip:xn,ocrReady:gn,onPause:async()=>{try{const{apiIndexPause:h}=await he(async()=>{const{apiIndexPause:g}=await Promise.resolve().then(()=>pe);return{apiIndexPause:g}},void 0,import.meta.url);await h(s)}catch{}},onResume:async()=>{try{const{apiIndexResume:h}=await he(async()=>{const{apiIndexResume:g}=await Promise.resolve().then(()=>pe);return{apiIndexResume:g}},void 0,import.meta.url);await h(s)}catch{}},onOpenThemeModal:()=>da(!0)}),yn&&e.jsx("div",{className:"px-4 pt-2",children:e.jsxs("div",{className:"sticky top-0 z-20 bg-yellow-50 text-yellow-800 border border-yellow-200 rounded px-3 py-1 text-xs flex items-center justify-between",children:[e.jsxs("span",{children:["Press ",e.jsx("span",{className:"font-mono",children:"?"})," for help and shortcuts"]}),e.jsx("button",{type:"button",className:"text-yellow-800 hover:text-yellow-900","aria-label":"Dismiss help hint",onClick:()=>{vn(!1);try{localStorage.setItem("ps_hint_help_seen","1")}catch{}},children:"×"})]})}),e.jsxs("div",{className:"flex-1 overflow-auto",ref:la,children:[J==="results"&&e.jsx(Oa,{sectionName:"Search Results",children:e.jsxs("div",{className:"p-4",children:[j&&j.length>0&&(Y||"").trim()&&e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[j.length," results"]}),e.jsx("button",{type:"button",className:"chip",title:"Save this search as a Smart Collection",onClick:async()=>{const h=(prompt("Save current search as Smart (name):")||"").trim();if(h)try{const g=(C||"").split(",").map(ce=>ce.trim()).filter(Boolean),P={query:(Y||"").trim(),favoritesOnly:k,tags:g,useCaptions:l,useOcr:d,hasText:y,camera:w||void 0,isoMin:T||void 0,isoMax:f||void 0,fMin:N||void 0,fMax:b||void 0,place:v||void 0},W=(se||[]).filter(Boolean);W.length===1?P.person=W[0]:W.length>1&&(P.persons=W);const{apiSetSmart:_,apiGetSmart:re}=await he(async()=>{const{apiSetSmart:ce,apiGetSmart:fe}=await Promise.resolve().then(()=>pe);return{apiSetSmart:ce,apiGetSmart:fe}},void 0,import.meta.url);await _(s,h,P);try{const ce=await re(s);V.setSmart(ce.smart||{})}catch{}$.setNote(`Saved smart collection: ${h}`)}catch(g){$.setNote(g?.message||"Failed to save smart collection")}},children:"Save as Smart Collection"})]}),j&&j.length===0&&Y?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(fs,{type:"no-results",searchQuery:Y,onAction:()=>{ne(""),V.setQuery("")},onOpenFilters:()=>mt(!0),onOpenAdvanced:()=>xe({kind:"advanced"}),onClearSearch:()=>{k&&V.setFavOnly(!1),C&&V.setTagFilter(""),as(""),rs(""),U.setPlace(""),U.setCamera(""),U.setIsoMin(0),U.setIsoMax(0),U.setFMin(0),U.setFMax(0),U.setHasText(!1),G.setPersons([])},hasActiveFilters:Cn,sampleQueries:["golden hour","city skyline","family dinner","blue car"],onRunSample:h=>Be(h),onOpenHelp:()=>Ue(!0)}),e.jsx(Ma,{onSearch:Be})]}):ve==="grid"?e.jsx(Kr,{dir:s,engine:r,items:(j||[]).map(h=>({path:h.path,score:h.score})),selected:q,onToggleSelect:vt,onOpen:h=>pa(h),scrollContainerRef:la,focusIndex:be??void 0,onLayout:h=>rn(g=>cn(g,h)?g:h),ratingMap:ms,showInfoOverlay:at}):e.jsx(vl,{dir:s,engine:r,items:(j||[]).map(h=>({path:h.path,score:h.score})),selected:q,onToggleSelect:vt,onOpen:h=>pa(h),showInfoOverlay:at,bucket:Oe})]})}),J==="library"&&e.jsx(Oa,{sectionName:"Library",children:e.jsx(Dn,{})}),J==="people"&&e.jsx("div",{className:"p-4",children:e.jsx(hl,{dir:s,engine:r,clusters:de||[],persons:se,setPersons:G.setPersons,busy:te,setBusy:$.setBusy,setNote:$.setNote,onLoadFaces:ps,onOpenPhotos:h=>{V.setResults(h.map(g=>({path:g,score:0}))),X("results"),$.setNote(`Viewing ${h.length} photos from face cluster`)}})}),J==="map"&&e.jsx("div",{className:"p-4",children:e.jsx(ml,{points:H||[],onLoadMap:Pn})}),J==="collections"&&e.jsx("div",{className:"p-4",children:e.jsx(xl,{dir:s,engine:r,collections:O,onLoadCollections:async()=>{const{apiGetCollections:h}=await he(async()=>{const{apiGetCollections:P}=await Promise.resolve().then(()=>pe);return{apiGetCollections:P}},void 0,import.meta.url),g=await h(s);V.setCollections(g.collections||{})},onOpen:h=>{const g=O?.[h]||[];V.setResults(g.map(P=>({path:P,score:0}))),X("results"),$.setNote(`${g.length} in ${h}`)},onDelete:async h=>{try{const{apiDeleteCollection:g,apiGetCollections:P}=await he(async()=>{const{apiDeleteCollection:_,apiGetCollections:re}=await Promise.resolve().then(()=>pe);return{apiDeleteCollection:_,apiGetCollections:re}},void 0,import.meta.url);await g(s,h);const W=await P(s);V.setCollections(W.collections||{}),Ge({message:`Deleted collection ${h}`})}catch(g){$.setNote(g instanceof Error?g.message:"Delete failed")}}})}),J==="saved"&&e.jsxs("div",{className:"p-4",children:[e.jsx(fl,{saved:z,onRun:(h,g,P)=>{ne(g),P&&V.setTopK(P),Be(g)},onDelete:async h=>{try{const{apiDeleteSaved:g,apiGetSaved:P}=await he(async()=>{const{apiDeleteSaved:_,apiGetSaved:re}=await Promise.resolve().then(()=>pe);return{apiDeleteSaved:_,apiGetSaved:re}},void 0,import.meta.url);await g(s,h);const W=await P(s);V.setSaved(W.saved||[])}catch(g){$.setNote(g instanceof Error?g.message:"Delete failed")}}}),e.jsxs("div",{className:"mt-4 bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Presets"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:rt,children:"Refresh"}),e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:()=>{try{const h=JSON.stringify(us||[],null,2),g=new Blob([h],{type:"application/json"}),P=URL.createObjectURL(g),W=document.createElement("a");W.href=P,W.download="photo-search-presets.json",document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(P)}catch{}},children:"Export"}),e.jsxs("label",{className:"px-2 py-1 rounded border cursor-pointer",children:["Import",e.jsx("input",{type:"file",accept:"application/json",className:"hidden",onChange:async h=>{const g=h.target.files?.[0];if(g)try{const P=await g.text(),W=JSON.parse(P);if(Array.isArray(W)){const{apiAddPreset:_}=await he(async()=>{const{apiAddPreset:re}=await Promise.resolve().then(()=>pe);return{apiAddPreset:re}},void 0,import.meta.url);for(const re of W)re&&typeof re.name=="string"&&typeof re.query=="string"&&await _(s,re.name,re.query);await rt(),Ge({message:`Imported ${W.length} preset(s)`})}else $.setNote("Invalid JSON format")}catch{$.setNote("Import failed")}finally{h.currentTarget.value=""}}})]})]})]}),us.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No presets yet. Use Advanced Search to create one."}):e.jsx("div",{className:"mt-2 divide-y",children:us.map(h=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:h.name,children:h.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:h.query,children:h.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{ne(h.query),xa(h.query)},className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{type:"button",onClick:async()=>{try{const{apiDeletePreset:g}=await he(async()=>{const{apiDeletePreset:P}=await Promise.resolve().then(()=>pe);return{apiDeletePreset:P}},void 0,import.meta.url);await g(s,h.name),await rt()}catch{}},className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},h.name))})]})]}),J==="memories"&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"font-semibold",children:"Recent Favorites"})}),E.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No favorites yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:E.slice(0,24).map(h=>e.jsx("img",{src:Ne(s,r,h,196),alt:fc(h),className:"w-full h-24 object-cover rounded"},h))})]}),e.jsx("div",{children:e.jsx($a,{dir:s,engine:r,setBusy:$.setBusy,setNote:$.setNote,setResults:V.setResults})})]}),J==="tasks"&&e.jsx("div",{className:"p-4",children:e.jsx(yl,{})}),J==="smart"&&e.jsx("div",{className:"p-4",children:e.jsx(gl,{dir:s,engine:r,topK:R,smart:K,setSmart:V.setSmart,setResults:V.setResults,setSearchId:V.setSearchId,setNote:$.setNote,query:I,favOnly:k,tagFilter:C,useCaps:l,useOcr:d,hasText:y,camera:w,isoMin:String(T||""),isoMax:String(f||""),fMin:String(N||""),fMax:String(b||""),place:v,persons:se})}),J==="trips"&&e.jsx("div",{className:"p-4",children:e.jsx($a,{dir:s,engine:r,setBusy:$.setBusy,setNote:$.setNote,setResults:V.setResults})}),J==="videos"&&e.jsx("div",{className:"p-4",children:e.jsx(Vl,{currentDir:s,provider:r})})]}),e.jsx(Bl,{items:En,note:F,diag:Q,engine:r}),e.jsx(Ml,{show:ss,onClose:()=>mt(!1),onApply:()=>{mt(!1),Be(Y)},favOnly:k,setFavOnly:V.setFavOnly,tagFilter:C,setTagFilter:V.setTagFilter,camera:w,setCamera:U.setCamera,isoMin:String(T||""),setIsoMin:h=>U.setIsoMin(parseFloat(h)||0),isoMax:String(f||""),setIsoMax:h=>U.setIsoMax(parseFloat(h)||0),dateFrom:Le,setDateFrom:as,dateTo:Ae,setDateTo:rs,fMin:String(N||""),setFMin:h=>U.setFMin(parseFloat(h)||0),fMax:String(b||""),setFMax:h=>U.setFMax(parseFloat(h)||0),place:v,setPlace:U.setPlace,useCaps:l,setUseCaps:U.setUseCaps,useOcr:d,setUseOcr:U.setUseOcr,hasText:y,setHasText:U.setHasText}),ke?.kind==="shareManage"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:h=>{h.key==="Escape"&&xe(null)},children:e.jsx(Aa,{onEscape:()=>xe(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"Manage Shares"}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>xe(null),children:"Close"})]}),e.jsx(Fl,{dir:s})]})})}),ke?.kind==="export"&&e.jsx(Gl,{selected:q,dir:s,onClose:()=>xe(null),uiActions:$}),ke?.kind==="enhanced-share"&&e.jsx(uc,{selected:q,dir:s,onClose:()=>xe(null),uiActions:$}),ke?.kind==="share"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:h=>{h.key==="Escape"&&xe(null)},children:e.jsx(Aa,{onEscape:()=>xe(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Share (v1)"}),e.jsxs("form",{onSubmit:async h=>{if(h.preventDefault(),!s)return;const g=Array.from(q);if(g.length===0){alert("Select photos to share");return}const P=h.target,W=parseInt(P.elements.namedItem("expiry").value||"24",10),_=P.elements.namedItem("pw").value.trim(),re=P.elements.namedItem("viewonly").checked;try{const{apiCreateShare:ce}=await he(async()=>{const{apiCreateShare:je}=await Promise.resolve().then(()=>pe);return{apiCreateShare:je}},void 0,import.meta.url),fe=await ce(s,r,g,{expiryHours:Number.isNaN(W)?24:W,password:_||void 0,viewOnly:re});await navigator.clipboard.writeText(window.location.origin+fe.url),$.setNote("Share link copied to clipboard")}catch(ce){$.setNote(ce instanceof Error?ce.message:"Share failed")}xe(null)},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"expiry-input",children:"Expiry (hours)"}),e.jsx("input",{id:"expiry-input",name:"expiry",type:"number",min:1,defaultValue:24,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"pw-input",children:"Password (optional)"}),e.jsx("input",{id:"pw-input",name:"pw",type:"password",className:"w-full border rounded px-2 py-1",placeholder:"••••••"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"viewonly",defaultChecked:!0})," ","View-only (disable downloads)"]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>xe(null),"aria-label":"Cancel sharing",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Create shareable link",children:"Create Link"})]})]})]})})}),ke?.kind==="tag"&&e.jsx(Yl,{onClose:()=>xe(null),onTagSelected:Mn}),ke?.kind==="folder"&&e.jsx(Xl,{dir:s,useOsTrash:p,useFast:u,fastKind:c,useCaps:l,useOcr:d,hasText:y,highContrast:xs,onClose:()=>xe(null),settingsActions:{...U,setHighContrast:()=>{}},uiActions:$,doIndex:yt,prepareFast:h=>In(h),buildOCR:Fn,buildMetadata:$n}),ke?.kind==="likeplus"&&e.jsx(ec,{selected:q,dir:s,engine:r,topK:R,onClose:()=>xe(null),setSelectedView:h=>X(h),photoActions:V,uiActions:$}),ke?.kind==="save"&&e.jsx(sc,{dir:s,searchText:Y,query:I,topK:R,onClose:()=>xe(null),setSelectedView:h=>X(h),photoActions:V,uiActions:$}),ke?.kind==="collect"&&e.jsx(rc,{selected:q,dir:s,collections:O,onClose:()=>xe(null),setToast:Ge,photoActions:V,uiActions:$}),ke?.kind==="removeCollect"&&e.jsx(ic,{selected:q,dir:s,collections:O,onClose:()=>xe(null),setToast:Ge,photoActions:V,uiActions:$}),we!==null&&j&&j[we]&&(Me.isVideoFile(j[we].path)?e.jsx(dl,{videoPath:j[we].path,videoUrl:`/api/media/${encodeURIComponent(j[we].path)}`,onPrevious:()=>Ye(-1),onNext:()=>Ye(1),onClose:()=>We(null)}):e.jsx(cl,{dir:s,engine:r,path:j[we].path,onPrev:()=>Ye(-1),onNext:()=>Ye(1),onClose:()=>We(null),onReveal:async()=>{try{const{apiOpen:h}=await he(async()=>{const{apiOpen:P}=await Promise.resolve().then(()=>pe);return{apiOpen:P}},void 0,import.meta.url),g=j&&we!==null?j[we]?.path:void 0;g&&await h(s,g)}catch{}},onFavorite:async()=>{try{const h=j&&we!==null?j[we]?.path:void 0;h&&(await kt(s,h,!E.includes(h)),await Ke())}catch{}},onMoreLikeThis:async()=>{try{const{apiSearchLike:h}=await he(async()=>{const{apiSearchLike:W}=await Promise.resolve().then(()=>pe);return{apiSearchLike:W}},void 0,import.meta.url),g=j&&we!==null?j[we]?.path:void 0;if(!g)return;$.setBusy("Searching similar…");const P=await h(s,g,r,R);V.setResults(P.results||[]),X("results")}catch(h){$.setNote(h instanceof Error?h.message:"Search failed")}finally{$.setBusy("")}}})),e.jsx("button",{type:"button",onClick:()=>xe({kind:"jobs"}),className:"fixed bottom-4 right-4 bg-blue-600 text-white rounded-full shadow px-4 py-2",title:"Open Jobs","aria-label":"Open the jobs panel",children:"Jobs"}),ke?.kind==="jobs"&&e.jsx(jl,{open:!0,onClose:()=>xe(null)}),ke?.kind==="advanced"&&e.jsx(Hl,{open:!0,onClose:()=>xe(null),onApply:h=>{ne(h),xa(h),xe(null)},onSave:async(h,g)=>{try{const{apiAddPreset:P}=await he(async()=>{const{apiAddPreset:W}=await Promise.resolve().then(()=>pe);return{apiAddPreset:W}},void 0,import.meta.url);await P(s,h,g),Ge({message:`Saved preset ${h}`}),await rt()}catch(P){$.setNote(P instanceof Error?P.message:"Save failed")}},allTags:x||[],cameras:ca?.cameras||[],people:(de||[]).filter(h=>h.name).map(h=>String(h.name))}),e.jsx(cc,{isOpen:an,onClose:()=>Ue(!1),initialSection:"getting-started"}),e.jsx(gc,{isOpen:bn,onClose:()=>da(!1)}),!!te&&e.jsx("div",{className:"fixed inset-0 z-[1050] bg-black/40 flex items-center justify-center",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-sm",children:[e.jsx(Qr,{size:"lg",message:te,className:"text-center"}),F&&e.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300 text-center",children:F})]})}),st&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-[1070]",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"flex items-center gap-3 bg-gray-900 text-white px-4 py-2 rounded shadow",children:[e.jsx("span",{className:"text-sm",children:st.message}),st.actionLabel&&st.onAction&&e.jsx("button",{type:"button",className:"text-sm underline",onClick:st.onAction,children:st.actionLabel}),e.jsx("button",{type:"button","aria-label":"Close notification",className:"ml-1",onClick:()=>{Ge(null),Ot.current&&(window.clearTimeout(Ot.current),Ot.current=null)},children:"×"})]})}),e.jsx(Pl,{photoCount:M?.length||0,indexedCount:M?.length||0,searchProvider:r,isIndexing:pt,isConnected:!0,currentDirectory:s,activeJobs:is.filter(h=>h.status==="running").length}),e.jsx(Il,{jobs:is,onPause:h=>{Re(g=>g.map(P=>P.id===h?{...P,status:"paused"}:P))},onResume:h=>{Re(g=>g.map(P=>P.id===h?{...P,status:"running"}:P))},onCancel:h=>{Re(g=>g.map(P=>P.id===h?{...P,status:"cancelled"}:P))},onRetry:h=>{Re(g=>g.map(P=>P.id===h?{...P,status:"queued"}:P))},onClear:h=>{Re(g=>g.filter(P=>P.id!==h))},onClearAll:()=>{Re(h=>h.filter(g=>g.status==="running"||g.status==="queued"))}}),e.jsx(ql,{activeTab:on,onTabChange:h=>{switch(ln(h),h){case"home":X("library");break;case"search":X("results");break;case"favorites":X("results"),V.setFavOnly(!0);break;case"settings":X("tasks");break}},onShowFilters:()=>mt(!0),onShowUpload:()=>xe({kind:"folder"}),onShowLibrary:()=>xe({kind:"folder"}),showSecondaryActions:!0})]}),e.jsx(Cl,{isVisible:kn,onDismiss:()=>ua(!1),context:J,userActions:ft}),e.jsx(Tl,{isVisible:Sn,onComplete:()=>{ha(!1);try{localStorage.setItem("onboardingComplete","true")}catch{}},completedSteps:wn,onStepComplete:h=>{Nn(g=>{if(!g.includes(h)){const P=[...g,h];try{localStorage.setItem("onboardingSteps",JSON.stringify(P))}catch{}return P}return g})}}),pt&&e.jsx(El,{isVisible:!0,onComplete:()=>_t(!1),onCancel:()=>_t(!1),directory:s,engine:r}),e.jsx(en,{})]})})})}const yc=({darkMode:a=!1,onDarkModeToggle:t})=>{const[s,r]=o.useState("library"),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState(new Set),[p,y]=o.useState(!1),[v,w]=o.useState(null),[T,f]=o.useState(null),[N,b]=o.useState(!1),[C,x]=o.useState(!1),[m,S]=o.useState(0),[j,I]=o.useState("medium"),[E,k]=o.useState(!1),R=o.useRef(null);o.useEffect(()=>{z()},[]),o.useEffect(()=>{T&&Z()},[T]);const z=async()=>{try{const A=await Hs();console.log("Workspace loaded:",A)}catch(A){console.error("Failed to load workspace:",A)}},Z=async()=>{if(T){y(!0),w(null);try{console.log("Loading library from:",T);const A=await Ft(T);if(!A||!A.images)throw new Error("No images found in the selected folder");const se=A.images.map((de,H)=>({id:`photo-${H}`,path:de,thumbnail:Ne(de),title:de.split("/").pop()?.split(".")[0]||"Untitled",date:new Date().toLocaleDateString(),type:de.split(".").pop()?.toLowerCase()}));c(se),w(null),console.log(`Loaded ${se.length} photos`)}catch(A){console.error("Failed to load library:",A),w(A.message||"Failed to load photos from the selected folder"),c([])}finally{y(!1)}}},O=async A=>{if(A.preventDefault(),!!n.trim()){y(!0);try{const se=await Zt(n,20);if(se&&se.results){const de=se.results.map((H,Q)=>({id:`search-${Q}`,path:H.image,thumbnail:Ne(H.image),title:H.image.split("/").pop()?.split(".")[0],score:H.score}));c(de)}}catch(se){console.error("Search failed:",se)}finally{y(!1)}}},K=async()=>{if(window.electronAPI)try{const A=await window.electronAPI.selectFolder();A&&await M(A)}catch(A){console.error("Failed to select folder:",A)}else R.current?.click()},D=async A=>{const se=A.target.files;if(se&&se.length>0){const de=se[0].webkitRelativePath?.split("/")[0];if(de){const H=`/Users/pranay/Desktop/${de}`;await M(H)}}},M=async A=>{try{console.log("Adding path:",A),await Xe(A),f(A),w(null)}catch(se){console.error("Failed to add path:",se),w("Failed to add the selected folder")}},B=A=>{const se=new Set(l);se.has(A.id)?se.delete(A.id):se.add(A.id),d(se)},te=A=>{S(A),x(!0)},F=[{id:"library",label:"Library",icon:dt},{id:"memories",label:"Memories",icon:Gt},{id:"people",label:"People",icon:Ve},{id:"places",label:"Places",icon:er},{id:"recent",label:"Recent",icon:ct}],me=s==="memories"?u.filter(A=>A.favorite):u;return e.jsxs("div",{className:`flex h-screen ${a?"dark":""}`,style:{background:"var(--bg-primary)"},children:[e.jsxs("div",{className:`sidebar ${E?"w-16":""}`,style:{width:E?"64px":"260px"},children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[!E&&e.jsx("h1",{className:"text-title",style:{fontSize:"1.25rem",fontWeight:600},children:"Photos"}),e.jsx("button",{onClick:()=>k(!E),className:"btn-ghost",style:{padding:"8px"},children:E?e.jsx(St,{size:18}):e.jsx(wa,{size:18})})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[!E&&e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"LIBRARY"}),F.map(A=>{const se=A.icon;return e.jsxs("div",{onClick:()=>r(A.id),className:`nav-item ${s===A.id?"active":""}`,style:{justifyContent:E?"center":"flex-start",padding:E?"12px":"10px 16px"},children:[e.jsx(se,{size:20}),!E&&e.jsx("span",{children:A.label})]},A.id)})]}),!E&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"ALBUMS"}),e.jsxs("div",{className:"nav-item",children:[e.jsx(Na,{size:20}),e.jsx("span",{children:"All Albums"})]}),e.jsxs("div",{className:"nav-item",children:[e.jsx(qt,{size:20}),e.jsx("span",{children:"Favorites"})]})]})]}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid var(--border-subtle)"},children:[e.jsx("button",{onClick:K,className:"btn btn-primary",style:{width:"100%",justifyContent:"center",fontSize:E?"0":"14px",padding:E?"12px":"10px 16px"},children:E?e.jsx(it,{size:20}):e.jsxs(e.Fragment,{children:[e.jsx(it,{size:18}),e.jsx("span",{children:"Import Photos"})]})}),e.jsx("input",{ref:R,type:"file",webkitdirectory:"",directory:"",multiple:!0,onChange:D,style:{display:"none"}}),!E&&e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[e.jsx("button",{onClick:()=>b(!N),className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:e.jsx(Pt,{size:18})}),e.jsx("button",{onClick:t,className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:a?e.jsx(Ss,{size:18}):e.jsx(Za,{size:18})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",style:{background:"var(--bg-primary)"},children:[e.jsx("header",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-subtle)",background:"var(--bg-primary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("form",{onSubmit:O,className:"search-bar",style:{maxWidth:"500px"},children:[e.jsx(Ee,{size:18,style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)",color:"var(--text-tertiary)"}}),e.jsx("input",{type:"text",value:n,onChange:A=>i(A.target.value),placeholder:"Search photos...",className:"search-input"})]}),e.jsxs("div",{className:"flex items-center gap-12px",children:[l.size>0&&e.jsxs("div",{className:"flex items-center gap-8px",style:{marginRight:"16px"},children:[e.jsxs("span",{className:"text-caption",style:{color:"var(--text-secondary)"},children:[l.size," selected"]}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(Kt,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(_e,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px",color:"var(--error)"},children:e.jsx(lt,{size:16})})]}),e.jsx("div",{className:"flex items-center gap-4px",style:{padding:"4px",background:"var(--bg-tertiary)",borderRadius:"var(--radius-md)"},children:["small","medium","large"].map(A=>e.jsx("button",{onClick:()=>I(A),style:{padding:"6px 12px",background:j===A?"var(--bg-primary)":"transparent",border:"none",borderRadius:"var(--radius-sm)",color:j===A?"var(--text-primary)":"var(--text-secondary)",fontSize:"12px",fontWeight:500,cursor:"pointer",transition:"all var(--transition-fast)"},children:A.charAt(0).toUpperCase()+A.slice(1)},A))})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto",style:{padding:"24px"},children:[p&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse",style:{marginBottom:"16px"},children:e.jsx(Xt,{size:48,style:{color:"var(--text-tertiary)"}})}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)"},children:"Loading photos..."})]})}),v&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",style:{maxWidth:"400px"},children:[e.jsx(Qt,{size:48,style:{color:"var(--error)",marginBottom:"16px"}}),e.jsx("p",{className:"text-body",style:{color:"var(--error)",marginBottom:"24px"},children:v}),e.jsx("button",{onClick:K,className:"btn btn-primary",children:"Select Another Folder"})]})}),!p&&!v&&u.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Na,{size:64,style:{color:"var(--text-tertiary)",marginBottom:"24px"}}),e.jsx("h2",{className:"text-headline",style:{marginBottom:"12px",fontSize:"24px"},children:"No photos yet"}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)",marginBottom:"32px"},children:"Import your photos to get started"}),e.jsxs("button",{onClick:K,className:"btn btn-primary",style:{fontSize:"16px",padding:"12px 32px"},children:[e.jsx(it,{size:20}),"Select Photo Folder"]})]})}),!p&&!v&&u.length>0&&e.jsx("div",{className:"photo-grid",style:{gridTemplateColumns:j==="small"?"repeat(auto-fill, minmax(150px, 1fr))":j==="large"?"repeat(auto-fill, minmax(300px, 1fr))":"repeat(auto-fill, minmax(200px, 1fr))",gap:j==="small"?"4px":"8px"},children:me.map((A,se)=>e.jsxs("div",{className:"photo-item",onClick:()=>te(se),style:{borderRadius:j==="small"?"4px":"8px",position:"relative"},children:[A.thumbnail?e.jsx("img",{src:A.thumbnail,alt:A.title,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{className:"skeleton",style:{width:"100%",height:"100%"}}),e.jsx("div",{onClick:de=>{de.stopPropagation(),B(A)},style:{position:"absolute",top:"8px",left:"8px",width:"24px",height:"24px",borderRadius:"50%",background:l.has(A.id)?"var(--accent-primary)":"rgba(255, 255, 255, 0.9)",border:l.has(A.id)?"none":"2px solid rgba(255, 255, 255, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",opacity:l.has(A.id)?1:0,transition:"opacity var(--transition-fast)"},className:"photo-select",children:l.has(A.id)&&e.jsx(ot,{size:14,style:{color:"white"}})})]},A.id))})]})]}),C&&u[m]&&e.jsxs("div",{onClick:()=>x(!1),style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"var(--z-modal)"},children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),x(!1)},style:{position:"absolute",top:"24px",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(Ce,{size:20})}),m>0&&e.jsx("button",{onClick:A=>{A.stopPropagation(),S(m-1)},style:{position:"absolute",left:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(wa,{size:20})}),m<u.length-1&&e.jsx("button",{onClick:A=>{A.stopPropagation(),S(m+1)},style:{position:"absolute",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(St,{size:20})}),e.jsx("img",{src:u[m].path,alt:u[m].title,style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain"},onClick:A=>A.stopPropagation()})]}),e.jsx("style",{jsx:!0,children:`
        .photo-item:hover .photo-select {
          opacity: 1 !important;
        }
      `})]})},vc=()=>{const[a,t]=o.useState(()=>{const r=localStorage.getItem("darkMode");return r!==null?r==="true":window.matchMedia("(prefers-color-scheme: dark)").matches});o.useEffect(()=>{a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",a.toString())},[a]);const s=()=>{t(r=>!r)};return e.jsx(yc,{darkMode:a,onDarkModeToggle:s})};function jc(){return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Test App"}),e.jsx("p",{children:"This is a minimal test to see if React is working."})]})}function wc(){const[a,t]=o.useState([]),[s,r]=o.useState(null),[n,i]=o.useState("grid"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[p,y]=o.useState([]),[v,w]=o.useState(!1),T=Fe();o.useEffect(()=>{f()},[]);const f=async()=>{w(!0);try{const m=await T.getCollections(),S=Object.entries(m.collections).map(([j,I])=>({name:j,paths:I,count:I.length,preview:I[0]}));t(S)}catch(m){console.error("Failed to load collections:",m)}finally{w(!1)}},N=async()=>{if(l.trim())try{await T.setCollection(l,p),await f(),c(!1),d(""),y([])}catch(m){console.error("Failed to create collection:",m)}},b=async m=>{if(confirm(`Delete collection "${m}"?`))try{await T.deleteCollection(m),await f(),s===m&&r(null)}catch(S){console.error("Failed to delete collection:",S)}},C=({collection:m})=>e.jsxs("div",{className:"collection-card",onClick:()=>r(m.name),children:[e.jsxs("div",{className:"collection-preview",children:[m.preview&&e.jsx("img",{src:T.getThumbnailUrl(m.preview),alt:m.name}),e.jsx("div",{className:"collection-overlay",children:e.jsx(dt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"collection-info",children:[e.jsx("h3",{children:m.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[m.count," items"]})]}),e.jsx("div",{className:"collection-actions",children:e.jsx("button",{onClick:S=>{S.stopPropagation(),b(m.name)},className:"btn-icon",children:e.jsx(lt,{className:"w-4 h-4"})})})]}),x=({collection:m})=>e.jsxs("div",{className:"collection-list-item",onClick:()=>r(m.name),children:[e.jsx(St,{className:"w-4 h-4 text-gray-400"}),e.jsx(vs,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:m.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[m.count," items"]})]}),e.jsx("button",{onClick:S=>{S.stopPropagation(),b(m.name)},className:"btn-icon",children:e.jsx(lt,{className:"w-4 h-4"})})]});return e.jsxs("div",{className:"collections-manager",children:[e.jsxs("div",{className:"manager-header",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Collections"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{onClick:()=>i("grid"),className:n==="grid"?"active":"",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i("list"),className:n==="list"?"active":"",children:e.jsx(Xa,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary",children:[e.jsx(za,{className:"w-4 h-4"}),"New Collection"]})]})]}),u&&e.jsxs("div",{className:"create-collection-panel",children:[e.jsx("input",{type:"text",placeholder:"Collection name...",value:l,onChange:m=>d(m.target.value),className:"input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,className:"btn btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>{c(!1),d("")},className:"btn btn-secondary",children:"Cancel"})]})]}),v?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading collections..."})]}):e.jsx("div",{className:n==="grid"?"collections-grid":"collections-list",children:a.map(m=>n==="grid"?e.jsx(C,{collection:m},m.name):e.jsx(x,{collection:m},m.name))}),e.jsx("style",{jsx:!0,children:`
        .collections-manager {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .manager-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .view-toggle {
          display: flex;
          gap: 0.25rem;
          padding: 0.25rem;
          background: var(--bg-tertiary);
          border-radius: var(--radius-md);
        }

        .view-toggle button {
          padding: 0.5rem;
          background: transparent;
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .view-toggle button.active {
          background: var(--bg-primary);
          color: var(--accent-primary);
        }

        .create-collection-panel {
          background: var(--bg-secondary);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          margin-bottom: 2rem;
          display: flex;
          gap: 1rem;
          align-items: center;
        }

        .collections-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 1.5rem;
        }

        .collection-card {
          background: var(--bg-elevated);
          border-radius: var(--radius-lg);
          overflow: hidden;
          cursor: pointer;
          transition: all 0.3s;
        }

        .collection-card:hover {
          transform: translateY(-4px);
          box-shadow: var(--shadow-lg);
        }

        .collection-preview {
          position: relative;
          aspect-ratio: 1;
          background: var(--bg-tertiary);
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .collection-preview img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .collection-overlay {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.5);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-sm);
        }

        .collection-info {
          padding: 1rem;
        }

        .collection-info h3 {
          font-weight: 600;
          margin-bottom: 0.25rem;
        }

        .collection-actions {
          padding: 0 1rem 1rem;
          display: flex;
          gap: 0.5rem;
        }

        .collections-list {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .collection-list-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-elevated);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .collection-list-item:hover {
          background: var(--bg-tertiary);
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--error);
          color: white;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 300px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Nc(){const[a,t]=o.useState([]),[s,r]=o.useState(null),[n,i]=o.useState(null),[u,c]=o.useState(""),[l,d]=o.useState(!1),[p,y]=o.useState(!1),[v,w]=o.useState({totalFaces:0,namedPeople:0}),T=Fe();o.useEffect(()=>{f()},[]);const f=async()=>{d(!0);try{const x=await T.getFaceClusters();t(x.clusters);const m=x.clusters.reduce((j,I)=>j+I.size,0),S=x.clusters.filter(j=>j.name).length;w({totalFaces:m,namedPeople:S})}catch(x){console.error("Failed to load face clusters:",x)}finally{d(!1)}},N=async()=>{y(!0);try{const x=await T.buildFaces();console.log(`Built faces: ${x.faces} faces in ${x.clusters} clusters`),await f()}catch(x){console.error("Failed to build face index:",x)}finally{y(!1)}},b=async x=>{if(u.trim())try{await T.nameFaceCluster(x,u),await f(),i(null),c("")}catch(m){console.error("Failed to name cluster:",m)}},C=({cluster:x})=>e.jsxs("div",{className:`face-cluster-card ${s===x.id?"selected":""}`,onClick:()=>r(x.id),children:[e.jsx("div",{className:"cluster-header",children:n===x.id?e.jsxs("div",{className:"name-editor",children:[e.jsx("input",{type:"text",value:u,onChange:m=>c(m.target.value),placeholder:"Enter name...",className:"name-input",autoFocus:!0,onClick:m=>m.stopPropagation()}),e.jsx("button",{onClick:m=>{m.stopPropagation(),b(x.id)},className:"btn-icon",children:e.jsx(ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),i(null),c("")},className:"btn-icon",children:e.jsx(Ce,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"cluster-name",children:x.name||`Person ${x.id.slice(0,8)}`}),e.jsx("button",{onClick:m=>{m.stopPropagation(),i(x.id),c(x.name||"")},className:"btn-icon",children:e.jsx(fi,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"cluster-stats",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[x.size," photos"]})}),e.jsx("div",{className:"face-examples",children:x.examples.slice(0,4).map(([m,S],j)=>e.jsx("div",{className:"face-thumbnail",children:e.jsx("img",{src:T.getFaceThumbnailUrl(m,S,96),alt:`Face ${j+1}`})},j))})]});return e.jsxs("div",{className:"face-detection",children:[e.jsxs("div",{className:"detection-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ve,{className:"w-6 h-6"}),"People"]}),e.jsxs("p",{className:"text-gray-500 mt-1",children:[v.totalFaces," faces detected • ",v.namedPeople," people identified"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:N,disabled:p,className:"btn btn-secondary",children:[e.jsx(Fs,{className:`w-4 h-4 ${p?"animate-spin":""}`}),p?"Building...":"Rebuild Index"]})})]}),l?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading faces..."})]}):a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Ve,{className:"w-16 h-16 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mt-4",children:"No faces detected yet"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Build the face index to detect and group people in your photos"}),e.jsxs("button",{onClick:N,disabled:p,className:"btn btn-primary mt-4",children:[e.jsx(gi,{className:"w-4 h-4"}),"Build Face Index"]})]}):e.jsx("div",{className:"clusters-grid",children:a.map(x=>e.jsx(C,{cluster:x},x.id))}),e.jsx("style",{jsx:!0,children:`
        .face-detection {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .detection-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .clusters-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 1.5rem;
        }

        .face-cluster-card {
          background: var(--bg-elevated);
          border: 2px solid transparent;
          border-radius: var(--radius-lg);
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.3s;
        }

        .face-cluster-card:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .face-cluster-card.selected {
          border-color: var(--accent-primary);
          box-shadow: 0 0 0 3px var(--accent-light);
        }

        .cluster-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.5rem;
        }

        .cluster-name {
          font-size: 1.125rem;
          font-weight: 600;
        }

        .name-editor {
          display: flex;
          gap: 0.5rem;
          width: 100%;
        }

        .name-input {
          flex: 1;
          padding: 0.25rem 0.5rem;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-sm);
          background: var(--bg-primary);
          font-size: 1rem;
        }

        .cluster-stats {
          margin-bottom: 1rem;
        }

        .face-examples {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 0.5rem;
        }

        .face-thumbnail {
          aspect-ratio: 1;
          border-radius: var(--radius-md);
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .face-thumbnail img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          text-align: center;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .animate-spin {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function kc(){const[a,t]=o.useState("library"),[s,r]=o.useState(null),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState([]),[p,y]=o.useState([]),[v,w]=o.useState([]),[T,f]=o.useState("/Users/pranay/Desktop"),[N,b]=o.useState(null),[C,x]=o.useState(!1),[m,S]=o.useState({});o.useEffect(()=>{const O={dir:T,provider:"openai",openaiKey:localStorage.getItem("openai_api_key")||"",hfToken:localStorage.getItem("hf_token")||""};al(O),j()},[T]);const j=async()=>{const O=Fe();try{const K=await O.getWorkspace();w(K.folders),await I();const D=await O.getFavorites();y(D.favorites)}catch(K){console.error("Failed to load initial data:",K)}},I=async()=>{x(!0);try{const K=await Fe().getLibrary(120,0);d(K.paths)}catch(O){console.error("Failed to load library:",O)}finally{x(!1)}},E=async()=>{if(n.trim()){x(!0);try{const K=await Fe().search(n,24);c(K.results),t("search")}catch(O){console.error("Search failed:",O)}finally{x(!1)}}},k=async O=>{x(!0);const K=Fe();try{let D;switch(O){case"search":D=await K.buildIndex(32),console.log(`Indexed ${D.total} images`);break;case"faces":D=await K.buildFaces(),console.log(`Found ${D.faces} faces in ${D.clusters} clusters`);break;case"ocr":D=await K.buildOCR(["en"]),console.log(`Extracted text from ${D.updated} images`);break;case"metadata":D=await K.buildMetadata(),console.log(`Extracted metadata from ${D.updated} images`);break;case"captions":D=await K.buildCaptions("Salesforce/blip-image-captioning-large"),console.log(`Generated captions for ${D.updated} images`);break;case"trips":D=await K.buildTrips(),console.log(`Found ${D.trips.length} trips`);break;case"fast-annoy":D=await K.buildFastIndex("annoy");break;case"fast-faiss":D=await K.buildFastIndex("faiss");break;case"fast-hnsw":D=await K.buildFastIndex("hnsw");break}await I()}catch(D){console.error(`Failed to build ${O} index:`,D)}finally{x(!1)}},R=async()=>{const O=prompt("Enter folder path:");if(O)try{const D=await Fe().addToWorkspace(O);w(D.folders)}catch(K){console.error("Failed to add workspace folder:",K)}},z=async()=>{x(!0);try{const K=await Fe().runDiagnostics();b(K),t("diagnostics")}catch(O){console.error("Failed to run diagnostics:",O)}finally{x(!1)}},Z=()=>{switch(a){case"collections":return e.jsx(wc,{});case"people":return e.jsx(Nc,{});case"editor":return s?e.jsx(Yr,{imagePath:s,onClose:()=>t("library"),onSave:O=>console.log("Saved:",O)}):null;case"search":return e.jsxs("div",{className:"search-results",children:[e.jsxs("h2",{children:['Search Results for "',n,'"']}),e.jsx("div",{className:"photo-grid",children:u.map((O,K)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(O.path),t("editor")},children:[e.jsx("img",{src:Fe().getThumbnailUrl(O.path),alt:""}),e.jsx("div",{className:"photo-score",children:O.score.toFixed(2)})]},K))})]});case"library":return e.jsxs("div",{className:"library-view",children:[e.jsxs("div",{className:"library-header",children:[e.jsx("h2",{children:"Photo Library"}),e.jsxs("span",{className:"text-gray-500",children:[l.length," photos"]})]}),e.jsx("div",{className:"photo-grid",children:l.map((O,K)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(O),t("editor")},children:[e.jsx("img",{src:Fe().getThumbnailUrl(O),alt:""}),p.includes(O)&&e.jsx("div",{className:"favorite-badge",children:e.jsx(qt,{className:"w-4 h-4",fill:"currentColor"})})]},K))})]});case"diagnostics":return e.jsxs("div",{className:"diagnostics-view",children:[e.jsx("h2",{children:"System Diagnostics"}),N&&e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Storage"}),e.jsxs("p",{children:[N.free_gb.toFixed(2)," GB free"]}),e.jsxs("p",{children:["OS: ",N.os]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Indexes"}),N.engines.map(O=>e.jsxs("div",{children:[e.jsxs("p",{children:[O.key,": ",O.count," items"]}),O.fast&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Fast: Annoy=",O.fast.annoy?"✓":"✗","FAISS=",O.fast.faiss?"✓":"✗","HNSW=",O.fast.hnsw?"✓":"✗"]})]},O.key))]})]})]});default:return null}};return e.jsxs("div",{className:"app-container",children:[e.jsxs("div",{className:"sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h1",{className:"text-xl font-bold",children:"PhotoVault Pro"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All 47 APIs Integrated"})]}),e.jsx("div",{className:"search-section",children:e.jsx("input",{type:"text",placeholder:"Search photos...",value:n,onChange:O=>i(O.target.value),onKeyPress:O=>O.key==="Enter"&&E(),className:"search-input"})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:`nav-item ${a==="library"?"active":""}`,onClick:()=>t("library"),children:[e.jsx(bi,{className:"w-5 h-5"}),"Library"]}),e.jsxs("div",{className:`nav-item ${a==="collections"?"active":""}`,onClick:()=>t("collections"),children:[e.jsx(dt,{className:"w-5 h-5"}),"Collections"]}),e.jsxs("div",{className:`nav-item ${a==="people"?"active":""}`,onClick:()=>t("people"),children:[e.jsx(Ve,{className:"w-5 h-5"}),"People"]}),e.jsxs("div",{className:`nav-item ${a==="places"?"active":""}`,onClick:()=>t("places"),children:[e.jsx(Is,{className:"w-5 h-5"}),"Places"]}),e.jsxs("div",{className:`nav-item ${a==="favorites"?"active":""}`,onClick:()=>t("favorites"),children:[e.jsx(qt,{className:"w-5 h-5"}),"Favorites"]}),e.jsxs("div",{className:`nav-item ${a==="trips"?"active":""}`,onClick:()=>t("trips"),children:[e.jsx(er,{className:"w-5 h-5"}),"Trips"]})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsx("h3",{className:"section-title",children:"Build Indexes"}),e.jsxs("button",{onClick:()=>k("search"),className:"index-btn",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Search Index"]}),e.jsxs("button",{onClick:()=>k("faces"),className:"index-btn",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Face Detection"]}),e.jsxs("button",{onClick:()=>k("ocr"),className:"index-btn",children:[e.jsx(yi,{className:"w-4 h-4"}),"OCR Text"]}),e.jsxs("button",{onClick:()=>k("metadata"),className:"index-btn",children:[e.jsx(Ga,{className:"w-4 h-4"}),"Metadata"]}),e.jsxs("button",{onClick:()=>k("captions"),className:"index-btn",children:[e.jsx(vi,{className:"w-4 h-4"}),"AI Captions"]})]}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsxs("button",{onClick:z,className:"nav-item",children:[e.jsx(Ts,{className:"w-5 h-5"}),"Diagnostics"]}),e.jsxs("button",{onClick:R,className:"nav-item",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Add Folder"]})]})]}),e.jsxs("main",{className:"main-content",children:[C&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),Z()]}),e.jsx("style",{jsx:!0,children:`
        .app-container {
          display: flex;
          height: 100vh;
          background: var(--bg-primary);
        }

        .main-content {
          flex: 1;
          overflow-y: auto;
          position: relative;
        }

        .search-section {
          padding: 1rem;
        }

        .sidebar-section {
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .section-title {
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.75rem;
          text-transform: uppercase;
          letter-spacing: 0.05em;
        }

        .index-btn {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          width: 100%;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-md);
          font-size: 0.875rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .index-btn:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .sidebar-footer {
          margin-top: auto;
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .library-view, .search-results, .diagnostics-view {
          padding: 2rem;
        }

        .library-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .library-header h2 {
          font-size: 2rem;
          font-weight: 700;
        }

        .photo-item {
          position: relative;
        }

        .photo-score {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: var(--radius-sm);
          font-size: 0.75rem;
        }

        .favorite-badge {
          position: absolute;
          top: 0.5rem;
          right: 0.5rem;
          background: var(--warning);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-full);
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 1.5rem;
        }

        .stat-card {
          background: var(--bg-elevated);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          border: 1px solid var(--border-subtle);
        }

        .stat-card h3 {
          font-size: 1.125rem;
          font-weight: 600;
          margin-bottom: 1rem;
        }

        .loading-overlay {
          position: absolute;
          inset: 0;
          background: rgba(255, 255, 255, 0.9);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 100;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}const Sc=o.createContext(null);function Cc({children:a}){const t=qr(),[s,r]=o.useState(""),[n,i]=o.useState([]),[u,c]=o.useState({favOnly:!1}),l=o.useCallback(v=>{c(w=>({...w,...v}))},[]),d=o.useCallback(v=>{i(v);try{t?.setResults?.(v)}catch{}},[t]),p=o.useCallback(v=>{r(v);try{t?.setQuery?.(v)}catch{}},[t]),y=o.useMemo(()=>({state:{query:s,results:n,filters:u},actions:{setQuery:p,setResults:d,setFilters:l}}),[s,n,u,p,d,l]);return e.jsx(Sc.Provider,{value:y,children:a})}const Tc=o.createContext(null);function Ec({children:a}){const t=Ur()||[],s=!!zr(),[r,n]=o.useState(!1),i=Br(),u=o.useCallback(async d=>{const p=d?.dir||i?.state?.dir,y=d?.provider||i?.state?.engine||"local";if(p)try{n(!0),await Et(p,y)}finally{n(!1)}},[i]),c=o.useCallback(async d=>{const p=d?.dir||i?.state?.dir,y=d?.provider||i?.state?.engine||"local";p&&await Ft(p,y,d?.limit??120,d?.offset??0)},[i]),l=o.useMemo(()=>({state:{paths:t,hasMore:s,isIndexing:r},actions:{index:u,load:c}}),[t,s,r,u,c]);return e.jsx(Tc.Provider,{value:l,children:a})}const Pc=o.createContext(null);function Ic({children:a}){const[t,s]=o.useState("local"),[r,n]=o.useState(!1),[i,u]=o.useState("faiss"),[c,l]=o.useState(!1),[d,p]=o.useState(!1),[y,v]=o.useState(60),w=o.useMemo(()=>({state:{engine:t,useFast:r,fastKind:i,useCaptions:c,useOcr:d,topK:y},actions:{setEngine:s,setUseFast:n,setFastKind:u,setUseCaptions:l,setUseOcr:p,setTopK:v}}),[t,r,i,c,d,y]);return e.jsx(Pc.Provider,{value:w,children:a})}function Fc({children:a}){return e.jsx(Qi,{children:e.jsx(lo,{children:e.jsx(Ic,{children:e.jsx(Rl,{children:e.jsx(Ec,{children:e.jsx(Cc,{children:a})})})})})})}const $c={};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(a=>{console.log("ServiceWorker registered:",a.scope),setInterval(()=>{a.update()},6e4),a.addEventListener("updatefound",()=>{const t=a.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&confirm("New version available! Refresh to update?")&&window.location.reload()})})}).catch(a=>{console.error("ServiceWorker registration failed:",a)})});window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),console.log("App can be installed")});function Mc(){const t=new URLSearchParams(window.location.search).get("ui")??$c?.VITE_UI??"modern";return t==="test"?e.jsx(jc,{}):t==="new"?e.jsx(vc,{}):t==="modular"?e.jsx(kc,{}):e.jsx(bc,{})}sr(document.getElementById("root")).render(e.jsx(Fc,{children:Mc()}));
