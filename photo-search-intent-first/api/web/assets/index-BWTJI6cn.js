var Rn=Object.defineProperty;var Ln=(a,t,s)=>t in a?Rn(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var oe=(a,t,s)=>Ln(a,typeof t!="symbol"?t+"":t,s);import{j as e,P as dt,H as Xt,S as Zt,D as Me,R as Ts,A as An,a as Un,b as zn,c as Bn,C as qn,M as Va,d as Ha,X as Te,e as Es,f as Ns,g as kt,h as ut,i as Ps,k as va,l as ja,V as Vn,m as Hn,I as Is,n as Wn,o as Gn,p as Wa,F as ks,G as Kn,T as He,q as wa,r as zt,W as $s,s as Bt,t as Yn,u as We,v as es,w as Qn,x as Jn,L as Xn,y as Ga,z as Ka,U as ct,B as Ce,E as ts,J as Zn,K as Ct,N as qt,O as ei,Q as Ya,Y as ht,Z as Ms,_ as Vt,$ as Qa,a0 as ti,a1 as si,a2 as Fs,a3 as Ja,a4 as Ds,a5 as mt,a6 as Ge,a7 as _s,a8 as Xa,a9 as ai,aa as ri,ab as ni,ac as Za,ad as Os,ae as er,af as Na,ag as ii,ah as oi,ai as li,aj as ci,ak as tr,al as Pt,am as Ht,an as di,ao as ui,ap as ka,aq as Sa,ar as hi,as as Ca,at as mi,au as xi,av as pi,aw as gi,ax as sr,ay as fi,az as bi,aA as Ta,aB as ar,aC as Ea,aD as yi,aE as vi,aF as ji,aG as wi,aH as Ni}from"./ui-phFrDw52.js";import{a as ki,r as o,b as Si,R as tt}from"./vendor-DfJzhmxv.js";import{c as rr}from"./utils-0qZyvErh.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var nr,Pa=ki;nr=Pa.createRoot,Pa.hydrateRoot;const Ci="modulepreload",Ti=function(a,t){return new URL(a,t).href},Ia={},pe=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){const u=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");n=Promise.allSettled(s.map(d=>{if(d=Ti(d,r),d in Ia)return;Ia[d]=!0;const p=d.endsWith(".css"),b=p?'[rel="stylesheet"]':"";if(!!r)for(let v=u.length-1;v>=0;v--){const f=u[v];if(f.href===d&&(!p||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${b}`))return;const k=document.createElement("link");if(k.rel=p?"stylesheet":Ci,p||(k.as="script"),k.crossOrigin="",k.href=d,l&&k.setAttribute("nonce",l),document.head.appendChild(k),p)return new Promise((v,f)=>{k.addEventListener("load",v),k.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(u){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=u,window.dispatchEvent(c),!c.defaultPrevented)throw u}return n.then(u=>{for(const c of u||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})};function Ei(a,t){const[s]=o.useState(()=>{let r=null;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{a(...n),r=null},t)}});return s}function Pi(a,t=300){const[s,r]=o.useState(a);return o.useEffect(()=>{if(a.length<=2){r(a);return}const n=setTimeout(()=>{r(a)},t);return()=>{clearTimeout(n)}},[a,t]),s}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Tt(){return Tt=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},Tt.apply(this,arguments)}var Ze;(function(a){a.Pop="POP",a.Push="PUSH",a.Replace="REPLACE"})(Ze||(Ze={}));const $a="popstate";function Ii(a){a===void 0&&(a={});function t(n,i){let{pathname:u="/",search:c="",hash:l=""}=It(n.location.hash.substr(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),Ss("",{pathname:u,search:c,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){let u=n.document.querySelector("base"),c="";if(u&&u.getAttribute("href")){let l=n.location.href,d=l.indexOf("#");c=d===-1?l:l.slice(0,d)}return c+"#"+(typeof i=="string"?i:ir(i))}function r(n,i){$i(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return Fi(t,s,r,a)}function _e(a,t){if(a===!1||a===null||typeof a>"u")throw new Error(t)}function $i(a,t){if(!a){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Mi(){return Math.random().toString(36).substr(2,8)}function Ma(a,t){return{usr:a.state,key:a.key,idx:t}}function Ss(a,t,s,r){return s===void 0&&(s=null),Tt({pathname:typeof a=="string"?a:a.pathname,search:"",hash:""},typeof t=="string"?It(t):t,{state:s,key:t&&t.key||r||Mi()})}function ir(a){let{pathname:t="/",search:s="",hash:r=""}=a;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function It(a){let t={};if(a){let s=a.indexOf("#");s>=0&&(t.hash=a.substr(s),a=a.substr(0,s));let r=a.indexOf("?");r>=0&&(t.search=a.substr(r),a=a.substr(0,r)),a&&(t.pathname=a)}return t}function Fi(a,t,s,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:i=!1}=r,u=n.history,c=Ze.Pop,l=null,d=p();d==null&&(d=0,u.replaceState(Tt({},u.state,{idx:d}),""));function p(){return(u.state||{idx:null}).idx}function b(){c=Ze.Pop;let S=p(),T=S==null?null:S-d;d=S,l&&l({action:c,location:f.location,delta:T})}function y(S,T){c=Ze.Push;let P=Ss(f.location,S,T);s&&s(P,S),d=p()+1;let m=Ma(P,d),h=f.createHref(P);try{u.pushState(m,"",h)}catch(j){if(j instanceof DOMException&&j.name==="DataCloneError")throw j;n.location.assign(h)}i&&l&&l({action:c,location:f.location,delta:1})}function k(S,T){c=Ze.Replace;let P=Ss(f.location,S,T);s&&s(P,S),d=p();let m=Ma(P,d),h=f.createHref(P);u.replaceState(m,"",h),i&&l&&l({action:c,location:f.location,delta:0})}function v(S){let T=n.location.origin!=="null"?n.location.origin:n.location.href,P=typeof S=="string"?S:ir(S);return P=P.replace(/ $/,"%20"),_e(T,"No window.location.(origin|href) available to create URL for href: "+P),new URL(P,T)}let f={get action(){return c},get location(){return a(n,u)},listen(S){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener($a,b),l=S,()=>{n.removeEventListener($a,b),l=null}},createHref(S){return t(n,S)},createURL:v,encodeLocation(S){let T=v(S);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:y,replace:k,go(S){return u.go(S)}};return f}var Fa;(function(a){a.data="data",a.deferred="deferred",a.redirect="redirect",a.error="error"})(Fa||(Fa={}));function Di(a,t){if(t==="/")return a;if(!a.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,r=a.charAt(s);return r&&r!=="/"?null:a.slice(s)||"/"}function _i(a,t){t===void 0&&(t="/");let{pathname:s,search:r="",hash:n=""}=typeof a=="string"?It(a):a;return{pathname:s?s.startsWith("/")?s:Oi(s,t):t,search:zi(r),hash:Bi(n)}}function Oi(a,t){let s=t.replace(/\/+$/,"").split("/");return a.split("/").forEach(n=>{n===".."?s.length>1&&s.pop():n!=="."&&s.push(n)}),s.length>1?s.join("/"):"/"}function vs(a,t,s,r){return"Cannot include a '"+a+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ri(a){return a.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function Li(a,t){let s=Ri(a);return t?s.map((r,n)=>n===s.length-1?r.pathname:r.pathnameBase):s.map(r=>r.pathnameBase)}function Ai(a,t,s,r){r===void 0&&(r=!1);let n;typeof a=="string"?n=It(a):(n=Tt({},a),_e(!n.pathname||!n.pathname.includes("?"),vs("?","pathname","search",n)),_e(!n.pathname||!n.pathname.includes("#"),vs("#","pathname","hash",n)),_e(!n.search||!n.search.includes("#"),vs("#","search","hash",n)));let i=a===""||n.pathname==="",u=i?"/":n.pathname,c;if(u==null)c=s;else{let b=t.length-1;if(!r&&u.startsWith("..")){let y=u.split("/");for(;y[0]==="..";)y.shift(),b-=1;n.pathname=y.join("/")}c=b>=0?t[b]:"/"}let l=_i(n,c),d=u&&u!=="/"&&u.endsWith("/"),p=(i||u===".")&&s.endsWith("/");return!l.pathname.endsWith("/")&&(d||p)&&(l.pathname+="/"),l}const Ui=a=>a.join("/").replace(/\/\/+/g,"/"),zi=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Bi=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a,or=["post","put","patch","delete"];new Set(or);const qi=["get",...or];new Set(qi);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wt(){return Wt=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},Wt.apply(this,arguments)}const lr=o.createContext(null),Rs=o.createContext(null),Ls=o.createContext(null),As=o.createContext({outlet:null,matches:[],isDataRoute:!1});function Us(){return o.useContext(Ls)!=null}function zs(){return Us()||_e(!1),o.useContext(Ls).location}function cr(a){o.useContext(Rs).static||o.useLayoutEffect(a)}function dr(){let{isDataRoute:a}=o.useContext(As);return a?Ki():Vi()}function Vi(){Us()||_e(!1);let a=o.useContext(lr),{basename:t,future:s,navigator:r}=o.useContext(Rs),{matches:n}=o.useContext(As),{pathname:i}=zs(),u=JSON.stringify(Li(n,s.v7_relativeSplatPath)),c=o.useRef(!1);return cr(()=>{c.current=!0}),o.useCallback(function(d,p){if(p===void 0&&(p={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let b=Ai(d,JSON.parse(u),i,p.relative==="path");a==null&&t!=="/"&&(b.pathname=b.pathname==="/"?t:Ui([t,b.pathname])),(p.replace?r.replace:r.push)(b,p.state,p)},[t,r,u,i,a])}var ur=function(a){return a.UseBlocker="useBlocker",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a}(ur||{}),hr=function(a){return a.UseBlocker="useBlocker",a.UseLoaderData="useLoaderData",a.UseActionData="useActionData",a.UseRouteError="useRouteError",a.UseNavigation="useNavigation",a.UseRouteLoaderData="useRouteLoaderData",a.UseMatches="useMatches",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a.UseRouteId="useRouteId",a}(hr||{});function Hi(a){let t=o.useContext(lr);return t||_e(!1),t}function Wi(a){let t=o.useContext(As);return t||_e(!1),t}function Gi(a){let t=Wi(),s=t.matches[t.matches.length-1];return s.route.id||_e(!1),s.route.id}function Ki(){let{router:a}=Hi(ur.UseNavigateStable),t=Gi(hr.UseNavigateStable),s=o.useRef(!1);return cr(()=>{s.current=!0}),o.useCallback(function(n,i){i===void 0&&(i={}),s.current&&(typeof n=="number"?a.navigate(n):a.navigate(n,Wt({fromRouteId:t},i)))},[a,t])}function Yi(a,t){a?.v7_startTransition,a?.v7_relativeSplatPath}function Qi(a){let{basename:t="/",children:s=null,location:r,navigationType:n=Ze.Pop,navigator:i,static:u=!1,future:c}=a;Us()&&_e(!1);let l=t.replace(/^\/*/,"/"),d=o.useMemo(()=>({basename:l,navigator:i,static:u,future:Wt({v7_relativeSplatPath:!1},c)}),[l,c,i,u]);typeof r=="string"&&(r=It(r));let{pathname:p="/",search:b="",hash:y="",state:k=null,key:v="default"}=r,f=o.useMemo(()=>{let S=Di(p,l);return S==null?null:{location:{pathname:S,search:b,hash:y,state:k,key:v},navigationType:n}},[l,p,b,y,k,v,n]);return f==null?null:o.createElement(Rs.Provider,{value:d},o.createElement(Ls.Provider,{children:s,value:f}))}new Promise(()=>{});/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Ji="6";try{window.__reactRouterVersion=Ji}catch{}const Xi="startTransition",Da=Si[Xi];function Zi(a){let{basename:t,children:s,future:r,window:n}=a,i=o.useRef();i.current==null&&(i.current=Ii({window:n,v5Compat:!0}));let u=i.current,[c,l]=o.useState({action:u.action,location:u.location}),{v7_startTransition:d}=r||{},p=o.useCallback(b=>{d&&Da?Da(()=>l(b)):l(b)},[l,d]);return o.useLayoutEffect(()=>u.listen(p),[u,p]),o.useEffect(()=>Yi(r),[r]),o.createElement(Qi,{basename:t,children:s,location:c.location,navigationType:c.action,navigator:u,future:r})}var _a;(function(a){a.UseScrollRestoration="useScrollRestoration",a.UseSubmit="useSubmit",a.UseSubmitFetcher="useSubmitFetcher",a.UseFetcher="useFetcher",a.useViewTransitionState="useViewTransitionState"})(_a||(_a={}));var Oa;(function(a){a.UseFetcher="useFetcher",a.UseFetchers="useFetchers",a.UseScrollRestoration="useScrollRestoration"})(Oa||(Oa={}));const eo={};function ss(){return typeof window<"u"&&(window.electronAPI!==void 0||window.process?.type==="renderer"||navigator.userAgent.toLowerCase().includes("electron"))}const ue=eo?.VITE_API_BASE||typeof window<"u"&&window.location&&window.location.origin||"http://127.0.0.1:8000";async function le(a,t){const s=await fetch(`${ue}${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(await s.text());return s.json()}async function Et(a,t,s=32,r,n){return le("/index",{dir:a,provider:t,batch_size:s,hf_token:r,openai_key:n})}async function to(a,t,s,r){const n=new URLSearchParams({dir:a,provider:t});s&&n.set("hf_token",s),r&&n.set("openai_key",r);const i=await fetch(`${ue}/index/status?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function so(a){return le("/index/pause",{dir:a})}async function ao(a){return le("/index/resume",{dir:a})}async function as(a,t,s,r=24,n){if(!t?.trim())throw new Error("Search query cannot be empty");if(!a?.trim())throw new Error("Directory must be specified");if(r<1||r>1e3)throw new Error("Top K must be between 1 and 1000");try{const i=new URLSearchParams({dir:a,query:t,provider:s,top_k:String(r)});n?.hfToken&&i.set("hf_token",n.hfToken),n?.openaiKey&&i.set("openai_key",n.openaiKey),n?.favoritesOnly&&i.set("favorites_only","true"),n?.tags&&i.set("tags",n.tags.join(",")),n?.dateFrom!==void 0&&i.set("date_from",String(n.dateFrom)),n?.dateTo!==void 0&&i.set("date_to",String(n.dateTo)),n?.useFast&&i.set("use_fast","true"),n?.fastKind&&i.set("fast_kind",n.fastKind),n?.useCaptions&&i.set("use_captions","true"),n?.useOcr&&i.set("use_ocr","true"),n?.camera&&i.set("camera",n.camera),n?.isoMin!==void 0&&i.set("iso_min",String(n.isoMin)),n?.isoMax!==void 0&&i.set("iso_max",String(n.isoMax)),n?.fMin!==void 0&&i.set("f_min",String(n.fMin)),n?.fMax!==void 0&&i.set("f_max",String(n.fMax)),n?.flash&&i.set("flash",n.flash),n?.wb&&i.set("wb",n.wb),n?.metering&&i.set("metering",n.metering),n?.altMin!==void 0&&i.set("alt_min",String(n.altMin)),n?.altMax!==void 0&&i.set("alt_max",String(n.altMax)),n?.headingMin!==void 0&&i.set("heading_min",String(n.headingMin)),n?.headingMax!==void 0&&i.set("heading_max",String(n.headingMax)),n?.place&&i.set("place",n.place),n?.hasText&&i.set("has_text","true"),n?.person&&i.set("person",n.person),n?.persons&&i.set("persons",n.persons.join(",")),n?.sharpOnly&&i.set("sharp_only","true"),n?.excludeUnder&&i.set("exclude_underexp","true"),n?.excludeOver&&i.set("exclude_overexp","true");const u=await fetch(`${ue}/search?${i.toString()}`);if(!u.ok)throw new Error(await u.text());const c=await u.json();try{const{searchHistoryService:l}=await pe(async()=>{const{searchHistoryService:d}=await Promise.resolve().then(()=>Wl);return{searchHistoryService:d}},void 0,import.meta.url);l.addToHistory({query:t.trim(),timestamp:Date.now(),resultCount:c.results?.length||0,filters:{tags:n?.tags,favOnly:n?.favoritesOnly,dateFrom:n?.dateFrom,dateTo:n?.dateTo,person:n?.person,place:n?.place}})}catch(l){console.warn("Failed to save search to history:",l)}return c}catch(i){if(i instanceof Error){if(i.message.includes("network"))throw new Error("Network error: Please check your connection");if(i.message.includes("timeout"))throw new Error("Search timeout: Try a simpler query or check your connection");if(i.message.includes("401"))throw new Error("Authentication error: Please check your API keys");if(i.message.includes("403"))throw new Error("Access denied: Please check your permissions");if(i.message.includes("500"))throw new Error("Server error: Please try again later")}throw i}}async function mr(a,t,s,r=24,n,i=.5){return le("/search_like_plus",{dir:a,path:t,provider:s,top_k:r,text:n,weight:i})}async function Bs(a,t,s,r){return le("/share",{dir:a,provider:t,paths:s,expiry_hours:r?.expiryHours??24,password:r?.password,view_only:r?.viewOnly??!0})}async function xr(a){const t=a?`${ue}/share?dir=${encodeURIComponent(a)}`:`${ue}/share`,s=await fetch(t);if(!s.ok)throw new Error(await s.text());return s.json()}async function pr(a){return le("/share/revoke",{token:a})}async function Gt(a,t=200){const s=await fetch(`${ue}/analytics?dir=${encodeURIComponent(a)}&limit=${t}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function gr(a,t,s,r,n){return le("/captions/build",{dir:a,vlm_model:t,provider:s,hf_token:r,openai_key:n})}async function fr(a,t,s,r,n){return le("/feedback",{dir:a,search_id:t,query:s,positives:r,note:n})}async function qs(a){const t=await fetch(`${ue}/favorites?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function St(a,t,s){return le("/favorites",{dir:a,path:t,favorite:s})}async function Vs(a){const t=await fetch(`${ue}/saved?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function br(a,t,s,r){return le("/saved",{dir:a,name:t,query:s,top_k:r})}async function yr(a,t){return le("/saved/delete",{dir:a,name:t})}async function ro(a){const t=await fetch(`${ue}/presets?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function no(a,t,s){return le("/presets",{dir:a,name:t,query:s})}async function io(a,t){return le("/presets/delete",{dir:a,name:t})}async function Hs(a){const t=await fetch(`${ue}/map?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Ws(a,t,s,r){const n=new URLSearchParams({dir:a});t&&n.set("provider",t),r&&n.set("hf_token",r),s&&n.set("openai_key",s);const i=await fetch(`${ue}/diagnostics?${n.toString()}`);if(!i.ok)throw new Error(await i.text());return i.json()}async function $t(a,t,s=120,r=0,n){const i=new URLSearchParams({dir:a,provider:t,limit:String(s),offset:String(r)});n?.hfToken&&i.set("hf_token",n.hfToken),n?.openaiKey&&i.set("openai_key",n.openaiKey);const u=await fetch(`${ue}/library?${i.toString()}`);if(!u.ok)throw new Error(await u.text());return u.json()}async function Gs(a,t,s,r,n){return le("/fast/build",{dir:a,kind:t,provider:s,hf_token:r,openai_key:n})}async function Ks(a,t,s,r,n){return le("/ocr/build",{dir:a,provider:t,languages:s,hf_token:r,openai_key:n})}async function vr(a,t=5){const s=await fetch(`${ue}/lookalikes?dir=${encodeURIComponent(a)}&max_distance=${t}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function jr(a,t){return le("/lookalikes/resolve",{dir:a,group_paths:t})}async function Ys(){const a=await fetch(`${ue}/workspace`);if(!a.ok)throw new Error(await a.text());return a.json()}async function et(a){return le("/workspace/add",{path:a})}async function wr(a){return le("/workspace/remove",{path:a})}async function xt(a,t){const s=await fetch(`${ue}/metadata/detail?dir=${encodeURIComponent(a)}&path=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}async function Qs(a,t,s,r=24,n){return le("/search_workspace",{dir:a,provider:s,query:t,top_k:r,favorites_only:n?.favoritesOnly,tags:n?.tags,date_from:n?.dateFrom,date_to:n?.dateTo,place:n?.place,has_text:n?.hasText,person:n?.person,persons:n?.persons})}async function Js(a){const t=await fetch(`${ue}/tags?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Nr(a,t,s){return le("/tags",{dir:a,path:t,tags:s})}function Ne(a,t,s,r=256){if(ss())return`file://${s.startsWith("/")?s:`${a}/${s}`}`;const n=new URLSearchParams({dir:a,provider:t,path:s,size:String(r)});return`${ue}/thumb?${n.toString()}`}function Xs(a,t,s,r,n=196){if(ss())return`file://${s.startsWith("/")?s:`${a}/${s}`}`;const i=new URLSearchParams({dir:a,provider:t,path:s,emb:String(r),size:String(n)});return`${ue}/thumb_face?${i.toString()}`}async function kr(a,t){return le("/open",{dir:a,path:t})}async function Sr(a,t,s){return le("/edit/ops",{dir:a,path:t,rotate:s.rotate||0,flip:s.flip,crop:s.crop})}async function Cr(a,t,s=2,r="pil"){return le("/edit/upscale",{dir:a,path:t,scale:s,engine:r})}async function pt(a,t,s,r="copy",n=!1,i=!1,u){return le("/export",{dir:a,paths:t,dest:s,mode:r,strip_exif:n,overwrite:i,strip_gps:u?.stripGps,keep_copyright_only:u?.keepCopyrightOnly,preset:u?.preset,resize_long:u?.resizeLong,quality:u?.quality})}async function Zs(a,t,s,r){return le("/metadata/build",{dir:a,provider:t,hf_token:s,openai_key:r})}async function ea(a){const t=await fetch(`${ue}/metadata?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Tr(a,t,s,r=24){return le("/search_like",{dir:a,path:t,provider:s,top_k:r})}async function Er(a){const t=await fetch(`${ue}/collections?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Kt(a,t,s){return le("/collections",{dir:a,name:t,paths:s})}async function Pr(a,t){return le("/collections/delete",{dir:a,name:t})}async function Ir(a){const t=await fetch(`${ue}/smart_collections?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function $r(a,t,s){return le("/smart_collections",{dir:a,name:t,rules:s})}async function Mr(a,t){return le("/smart_collections/delete",{dir:a,name:t})}async function Fr(a,t,s,r=24){return le("/smart_collections/resolve",{dir:a,name:t,provider:s,top_k:r})}async function Dr(a,t,s=160){return le("/ocr/snippets",{dir:a,paths:t,limit:s})}async function oo(a){const t=await fetch(`${ue}/ocr/status?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function ta(a,t){return le("/faces/build",{dir:a,provider:t})}async function sa(a){const t=await fetch(`${ue}/faces/clusters?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function aa(a,t,s){return le("/faces/name",{dir:a,cluster_id:t,name:s})}async function _r(a,t){return le("/trips/build",{dir:a,provider:t})}async function Or(a){const t=await fetch(`${ue}/trips?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Yt(){const a=await fetch(`${ue}/todo`);if(!a.ok)throw new Error(await a.text());return a.json()}async function ra(a,t){return le("/autotag",{dir:a,provider:t})}async function na(a,t,s){const r=await fetch(`${ue}/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:a,paths:t,os_trash:!!s})});if(!r.ok)throw new Error(await r.text());return r.json()}async function ia(a){const t=await fetch(`${ue}/undo_delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:a})});if(!t.ok)throw new Error(await t.text());return t.json()}async function Rr(a){const t=await fetch(`${ue}/videos?dir=${encodeURIComponent(a)}`);if(!t.ok)throw new Error(await t.text());return t.json()}async function Lr(a,t){const s=await fetch(`${ue}/video/metadata?dir=${encodeURIComponent(a)}&path=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}function Ar(a,t,s=1,r=256){if(ss())return`file://${t.startsWith("/")?t:`${a}/${t}`}`;const n=new URLSearchParams({dir:a,path:t,frame_time:String(s),size:String(r)});return`${ue}/video/thumbnail?${n.toString()}`}async function Ur(a,t="local"){return le("/videos/index",{dir:a,provider:t})}async function lo(a,t,s=!1){return le("/batch/delete",{dir:a,paths:t,os_trash:s})}async function co(a,t,s,r="add"){return le("/batch/tag",{dir:a,paths:t,tags:s,operation:r})}async function zr(a,t){const s=await fetch(`${ue}/faces/photos?dir=${encodeURIComponent(a)}&cluster_id=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(await s.text());return s.json()}const ge=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:ue,apiAddPreset:no,apiAddSaved:br,apiAnalytics:Gt,apiAutotag:ra,apiBatchDelete:lo,apiBatchTag:co,apiBuildCaptions:gr,apiBuildFaces:ta,apiBuildFast:Gs,apiBuildMetadata:Zs,apiBuildOCR:Ks,apiCreateShare:Bs,apiDelete:na,apiDeleteCollection:Pr,apiDeletePreset:io,apiDeleteSaved:yr,apiDeleteSmart:Mr,apiDiagnostics:Ws,apiEditOps:Sr,apiExport:pt,apiFacesClusters:sa,apiFacesName:aa,apiFeedback:fr,apiGetCollections:Er,apiGetFacePhotos:zr,apiGetFavorites:qs,apiGetMetadata:ea,apiGetPresets:ro,apiGetSaved:Vs,apiGetSmart:Ir,apiGetTags:Js,apiGetVideoMetadata:Lr,apiIndex:Et,apiIndexPause:so,apiIndexResume:ao,apiIndexStatus:to,apiIndexVideos:Ur,apiLibrary:$t,apiListShares:xr,apiListVideos:Rr,apiLookalikes:vr,apiMap:Hs,apiMetadataDetail:xt,apiOcrSnippets:Dr,apiOcrStatus:oo,apiOpen:kr,apiResolveLookalike:jr,apiResolveSmart:Fr,apiRevokeShare:pr,apiSearch:as,apiSearchLike:Tr,apiSearchLikePlus:mr,apiSearchWorkspace:Qs,apiSetCollection:Kt,apiSetFavorite:St,apiSetSmart:$r,apiSetTags:Nr,apiTodo:Yt,apiTripsBuild:_r,apiTripsList:Or,apiUndoDelete:ia,apiUpscale:Cr,apiWorkspaceAdd:et,apiWorkspaceList:Ys,apiWorkspaceRemove:wr,isElectron:ss,thumbFaceUrl:Xs,thumbUrl:Ne,videoThumbnailUrl:Ar},Symbol.toStringTag,{value:"Module"})),uo={settings:{dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"faiss",useCaps:!1,vlmModel:"gpt-4o",useOcr:!1,hasText:!1,useOsTrash:!1,camera:"",isoMin:0,isoMax:25600,fMin:.7,fMax:32,place:"",showInfoOverlay:!1,resultView:"grid",timelineBucket:"day",includeVideos:!0},photo:{results:[],searchId:"",query:"",topK:24,fav:[],favOnly:!1,tags:{allTags:[],tagsMap:{},tagFilter:""},saved:[],collections:{},smart:{},library:[],libHasMore:!0},ui:{busy:"",note:"",viewMode:"grid",showWelcome:!1,showHelp:!1},workspace:{workspace:"",wsToggle:!1,persons:[],clusters:[],groups:[],points:[],diag:null}},Br=o.createContext(null),ho=({children:a})=>{const[t,s]=o.useState(uo),r=o.useCallback(c=>{s(l=>({...l,settings:{...l.settings,...c}}))},[]),n=o.useCallback(c=>{s(l=>({...l,photo:{...l.photo,...typeof c=="function"?c(l):c}}))},[]),i=o.useCallback(c=>{s(l=>({...l,ui:{...l.ui,...c}}))},[]),u=o.useCallback(c=>{s(l=>({...l,workspace:{...l.workspace,...c}}))},[]);return e.jsx(Br.Provider,{value:{state:t,setSettings:r,setPhoto:n,setUI:i,setWorkspace:u},children:a})},re=()=>{const a=o.useContext(Br);if(!a)throw new Error("useSimpleStore must be used within SimpleStoreProvider");return a},mo=()=>re().state.settings.dir,xo=()=>re().state.settings.engine,po=()=>re().state.settings.hfToken,go=()=>re().state.settings.openaiKey,fo=()=>re().state.settings.engine.startsWith("hf"),bo=()=>re().state.settings.engine==="openai",yo=()=>re().state.settings.camera,vo=()=>re().state.settings.isoMin,jo=()=>re().state.settings.isoMax,wo=()=>re().state.settings.fMin,No=()=>re().state.settings.fMax,ko=()=>re().state.settings.place,So=()=>re().state.settings.showInfoOverlay,Co=()=>re().state.settings.useCaps,To=()=>re().state.settings.useOcr,Eo=()=>re().state.settings.hasText,Po=()=>re().state.settings.useFast,Io=()=>re().state.settings.fastKind,$o=()=>re().state.settings.useOsTrash,Mo=()=>re().state.photo.results,Fo=()=>re().state.photo.query,Do=()=>re().state.photo.topK,_o=()=>re().state.photo.fav,Oo=()=>re().state.photo.favOnly,Ro=()=>re().state.photo.tags.tagFilter,Lo=()=>re().state.photo.tags.allTags,Ao=()=>re().state.photo.tags.tagsMap,Uo=()=>re().state.photo.saved,zo=()=>re().state.photo.collections,Bo=()=>re().state.photo.smart,qr=()=>re().state.photo.library,Vr=()=>re().state.photo.libHasMore,qo=()=>re().state.ui.busy,Vo=()=>re().state.ui.note,Ho=()=>re().state.ui.showWelcome,Wo=()=>re().state.ui.showHelp,Go=()=>re().state.workspace.wsToggle,Ko=()=>re().state.workspace.persons,Yo=()=>re().state.workspace.clusters,Qo=()=>re().state.workspace.points,Jo=()=>re().state.workspace.diag,Hr=()=>{const{setSettings:a}=re();return tt.useMemo(()=>({setDir:t=>a({dir:t}),setEngine:t=>a({engine:t}),setHfToken:t=>a({hfToken:t}),setOpenaiKey:t=>a({openaiKey:t}),setUseFast:t=>a({useFast:t}),setFastKind:t=>a({fastKind:t}),setUseCaps:t=>a({useCaps:t}),setVlmModel:t=>a({vlmModel:t}),setUseOcr:t=>a({useOcr:t}),setHasText:t=>a({hasText:t}),setUseOsTrash:t=>a({useOsTrash:t}),setCamera:t=>a({camera:t}),setIsoMin:t=>a({isoMin:t}),setIsoMax:t=>a({isoMax:t}),setFMin:t=>a({fMin:t}),setFMax:t=>a({fMax:t}),setPlace:t=>a({place:t}),setShowInfoOverlay:t=>a({showInfoOverlay:t}),setResultView:t=>a({resultView:t}),setTimelineBucket:t=>a({timelineBucket:t}),setIncludeVideos:t=>a({includeVideos:t})}),[a])},Wr=()=>{const{setPhoto:a}=re();return tt.useMemo(()=>({setResults:t=>a({results:t}),setSearchId:t=>a({searchId:t}),setQuery:t=>a({query:t}),setTopK:t=>a({topK:t}),setFavorites:t=>a({fav:t}),setFavOnly:t=>a({favOnly:t}),setAllTags:t=>a(s=>({tags:{...s.photo.tags,allTags:t}})),setTagsMap:t=>a(s=>({tags:{...s.photo.tags,tagsMap:t}})),setTagFilter:t=>a(s=>({tags:{...s.photo.tags,tagFilter:t}})),setSaved:t=>a({saved:t}),setCollections:t=>a({collections:t}),setSmart:t=>a({smart:t}),setLibrary:t=>a({library:t}),setLibHasMore:t=>a({libHasMore:t}),appendLibrary:t=>a(s=>({library:[...s.photo.library,...t]})),resetSearch:()=>a({results:[],searchId:"",query:""})}),[a])},Xo=()=>{const{setUI:a}=re();return tt.useMemo(()=>({setBusy:t=>a({busy:t}),setNote:t=>a({note:t}),setViewMode:t=>a({viewMode:t}),setShowWelcome:t=>a({showWelcome:t}),setShowHelp:t=>a({showHelp:t})}),[a])},Zo=()=>{const{setWorkspace:a}=re();return tt.useMemo(()=>({setWorkspace:t=>a({workspace:t}),setWsToggle:t=>a({wsToggle:t}),setPersons:t=>a({persons:t}),setClusters:t=>a({clusters:t}),setGroups:t=>a({groups:t}),setPoints:t=>a({points:t}),setDiag:t=>a({diag:t})}),[a])},el=a=>(t,s,r)=>{const n=r.subscribe;return r.subscribe=(u,c,l)=>{let d=u;if(c){const p=l?.equalityFn||Object.is;let b=u(r.getState());d=y=>{const k=u(y);if(!p(b,k)){const v=b;c(b=k,v)}},l?.fireImmediately&&c(b,b)}return n(d)},a(t,s,r)},Gr=el;function tl(a,t){let s;try{s=a()}catch{return}return{getItem:n=>{var i;const u=l=>l===null?null:JSON.parse(l,void 0),c=(i=s.getItem(n))!=null?i:null;return c instanceof Promise?c.then(u):u(c)},setItem:(n,i)=>s.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>s.removeItem(n)}}const Cs=a=>t=>{try{const s=a(t);return s instanceof Promise?s:{then(r){return Cs(r)(s)},catch(r){return this}}}catch(s){return{then(r){return this},catch(r){return Cs(r)(s)}}}},sl=(a,t)=>(s,r,n)=>{let i={storage:tl(()=>localStorage),partialize:f=>f,version:0,merge:(f,S)=>({...S,...f}),...t},u=!1;const c=new Set,l=new Set;let d=i.storage;if(!d)return a((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...f)},r,n);const p=()=>{const f=i.partialize({...r()});return d.setItem(i.name,{state:f,version:i.version})},b=n.setState;n.setState=(f,S)=>(b(f,S),p());const y=a((...f)=>(s(...f),p()),r,n);n.getInitialState=()=>y;let k;const v=()=>{var f,S;if(!d)return;u=!1,c.forEach(P=>{var m;return P((m=r())!=null?m:y)});const T=((S=i.onRehydrateStorage)==null?void 0:S.call(i,(f=r())!=null?f:y))||void 0;return Cs(d.getItem.bind(d))(i.name).then(P=>{if(P)if(typeof P.version=="number"&&P.version!==i.version){if(i.migrate){const m=i.migrate(P.state,P.version);return m instanceof Promise?m.then(h=>[!0,h]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,P.state];return[!1,void 0]}).then(P=>{var m;const[h,j]=P;if(k=i.merge(j,(m=r())!=null?m:y),s(k,!0),h)return p()}).then(()=>{T?.(k,void 0),k=r(),u=!0,l.forEach(P=>P(k))}).catch(P=>{T?.(void 0,P)})};return n.persist={setOptions:f=>{i={...i,...f},f.storage&&(d=f.storage)},clearStorage:()=>{d?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>v(),hasHydrated:()=>u,onHydrate:f=>(c.add(f),()=>{c.delete(f)}),onFinishHydration:f=>(l.add(f),()=>{l.delete(f)})},i.skipHydration||v(),k||y},Kr=sl,Ee=rr()(Kr(Gr((a,t)=>({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0,setThemeMode:s=>a({themeMode:s}),setColorScheme:s=>a({colorScheme:s}),setDensity:s=>a({density:s}),setCustomColors:s=>a({customColors:s}),resetTheme:()=>a({themeMode:"auto",colorScheme:"blue",density:"normal",customColors:void 0})})),{name:"photo-search-theme",partialize:a=>({themeMode:a.themeMode,colorScheme:a.colorScheme,density:a.density,customColors:a.customColors})})),rs=rr()(Kr(Gr((a,t)=>({dir:"",engine:"local",hfToken:"",openaiKey:"",useFast:!1,fastKind:"",useCaps:!1,vlmModel:"Qwen/Qwen2-VL-2B-Instruct",useOcr:!1,hasText:!1,useOsTrash:!1,showExplain:!1,showInfoOverlay:!1,highContrast:!1,camera:"",isoMin:"",isoMax:"",fMin:"",fMax:"",place:"",setDir:s=>a({dir:s}),setEngine:s=>a({engine:s}),setHfToken:s=>a({hfToken:s}),setOpenaiKey:s=>a({openaiKey:s}),setUseFast:s=>a({useFast:s}),setFastKind:s=>a({fastKind:s}),setUseCaps:s=>a({useCaps:s}),setVlmModel:s=>a({vlmModel:s}),setUseOcr:s=>a({useOcr:s}),setHasText:s=>a({hasText:s}),setUseOsTrash:s=>a({useOsTrash:s}),setShowExplain:s=>a({showExplain:s}),setShowInfoOverlay:s=>a({showInfoOverlay:s}),setHighContrast:s=>a({highContrast:s}),setCamera:s=>a({camera:s}),setIsoMin:s=>a({isoMin:s}),setIsoMax:s=>a({isoMax:s}),setFMin:s=>a({fMin:s}),setFMax:s=>a({fMax:s}),setPlace:s=>a({place:s})})),{name:"photo-search-settings",partialize:a=>({dir:a.dir,engine:a.engine,useFast:a.useFast,fastKind:a.fastKind,useCaps:a.useCaps,vlmModel:a.vlmModel,useOcr:a.useOcr,hasText:a.hasText,useOsTrash:a.useOsTrash,showExplain:a.showExplain,showInfoOverlay:a.showInfoOverlay,camera:a.camera,isoMin:a.isoMin,isoMax:a.isoMax,fMin:a.fMin,fMax:a.fMax,place:a.place})})),Yr=()=>rs(a=>a.dir),al=()=>rs(a=>a.engine),oa=()=>rs(a=>a.highContrast);class De{static isVideoFile(t){const s=t.toLowerCase().substring(t.lastIndexOf("."));return this.supportedFormats.includes(s)}static async extractMetadata(t){return new Promise((s,r)=>{const n=document.createElement("video");n.preload="metadata",n.onloadedmetadata=()=>{const i={duration:n.duration,width:n.videoWidth,height:n.videoHeight,codec:this.detectCodec(t),fps:30,bitrate:0,hasAudio:n.mozHasAudio||n.webkitAudioDecodedByteCount>0||n.audioTracks?.length>0||!0};n.remove(),s(i)},n.onerror=()=>{n.remove(),r(new Error("Failed to load video metadata"))},n.src=t})}static async generateThumbnail(t,s=2,r=320,n=240){return new Promise((i,u)=>{const c=document.createElement("video"),l=document.createElement("canvas"),d=l.getContext("2d");if(!d){u(new Error("Canvas context not available"));return}c.crossOrigin="anonymous",c.currentTime=s,c.onseeked=()=>{l.width=r,l.height=n;const p=c.videoWidth/c.videoHeight,b=r/n;let y=r,k=n,v=0,f=0;p>b?(k=r/p,f=(n-k)/2):(y=n*p,v=(r-y)/2),d.drawImage(c,v,f,y,k);const S=l.toDataURL("image/jpeg",.8);c.remove(),l.remove(),i(S)},c.onerror=()=>{c.remove(),l.remove(),u(new Error("Failed to generate thumbnail"))},c.src=t})}static async extractKeyframes(t,s=10,r=160,n=90){const u=(await this.extractMetadata(t)).duration/(s+1),c=[];for(let l=1;l<=s;l++)try{const d=u*l,p=await this.generateThumbnail(t,d,r,n);c.push(p)}catch(d){console.warn(`Failed to extract keyframe at ${u*l}s:`,d)}return c}static detectCodec(t){const s=t.toLowerCase().substring(t.lastIndexOf(".")+1);return{mp4:"H.264",mov:"H.264/ProRes",webm:"VP8/VP9",mkv:"H.264/H.265",avi:"Various",wmv:"WMV",flv:"FLV"}[s]||"Unknown"}static async getVideoInfo(t,s){if(this.videoCache.has(t))return this.videoCache.get(t);try{const r=await this.extractMetadata(s),n=await this.generateThumbnail(s),i={path:t,type:"video",format:t.substring(t.lastIndexOf(".")+1).toUpperCase(),metadata:r,thumbnailUrl:n,streamUrl:s};if(this.videoCache.set(t,i),this.videoCache.size>100){const u=this.videoCache.keys().next().value;this.videoCache.delete(u)}return i}catch(r){throw console.error("Failed to get video info:",r),r}}static clearCache(){this.videoCache.clear()}static formatDuration(t){const s=Math.floor(t/3600),r=Math.floor(t%3600/60),n=Math.floor(t%60);return s>0?`${s}:${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${r}:${n.toString().padStart(2,"0")}`}static getResolutionLabel(t,s){return s>=2160?"4K":s>=1440?"2K":s>=1080?"Full HD":s>=720?"HD":s>=480?"SD":"Low"}}oe(De,"supportedFormats",[".mp4",".mov",".avi",".webm",".mkv",".m4v",".mpg",".mpeg",".wmv",".flv"]),oe(De,"videoCache",new Map);class rl{constructor(t={}){oe(this,"intersectionObserver",null);oe(this,"imageCache",new Map);oe(this,"loadingQueue",new Set);oe(this,"maxCacheSize",100*1024*1024);oe(this,"currentCacheSize",0);oe(this,"options");this.options={threshold:t.threshold??.1,rootMargin:t.rootMargin??"50px",quality:t.quality??"medium",enableProgressiveLoading:t.enableProgressiveLoading??!0},this.initIntersectionObserver()}initIntersectionObserver(){typeof window>"u"||!window.IntersectionObserver||(this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(s=>{if(s.isIntersecting){const r=s.target,n=r.dataset.src;n&&!r.src&&(this.loadImage(n,r),this.intersectionObserver?.unobserve(r))}})},{threshold:this.options.threshold,rootMargin:this.options.rootMargin}))}observeImage(t,s){if(!this.intersectionObserver){this.loadImage(s,t);return}t.dataset.src=s,this.options.enableProgressiveLoading&&(t.style.backgroundColor="#f3f4f6",t.style.backgroundImage="linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",t.style.backgroundSize="200% 100%",t.style.animation="shimmer 2s infinite linear"),this.intersectionObserver.observe(t)}async loadImage(t,s){if(this.loadingQueue.has(t))return;const r=this.imageCache.get(t);if(r){this.applyImageToElement(r.url,s),this.imageCache.delete(t),this.imageCache.set(t,r);return}this.loadingQueue.add(t);try{const n=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(!n.ok)throw new Error(`Failed to load image: ${n.status}`);const i=await n.blob(),u=URL.createObjectURL(i),c={blob:i,url:u,timestamp:Date.now(),size:i.size};this.addToCache(t,c),this.applyImageToElement(u,s)}catch(n){console.warn("Failed to load image:",t,n),s.style.backgroundColor="#fee2e2",s.alt="Failed to load"}finally{this.loadingQueue.delete(t)}}applyImageToElement(t,s){s.onload=()=>{s.style.backgroundColor="",s.style.backgroundImage="",s.style.animation=""},s.src=t}addToCache(t,s){for(this.currentCacheSize+=s.size;this.currentCacheSize>this.maxCacheSize&&this.imageCache.size>0;){const[r,n]=this.imageCache.entries().next().value;this.imageCache.delete(r),this.currentCacheSize-=n.size,URL.revokeObjectURL(n.url)}this.imageCache.set(t,s)}preloadImages(t,s="low"){s==="low"?window.requestIdleCallback?window.requestIdleCallback(()=>{this.preloadImageBatch(t)}):setTimeout(()=>this.preloadImageBatch(t),100):this.preloadImageBatch(t)}async preloadImageBatch(t){const s=t.filter(r=>!this.imageCache.has(r)&&!this.loadingQueue.has(r)).slice(0,10).map(r=>this.preloadSingleImage(r));await Promise.allSettled(s)}async preloadSingleImage(t){if(!(this.imageCache.has(t)||this.loadingQueue.has(t))){this.loadingQueue.add(t);try{const s=await fetch(t,{credentials:"same-origin",cache:"force-cache"});if(s.ok){const r=await s.blob(),n=URL.createObjectURL(r),i={blob:r,url:n,timestamp:Date.now(),size:r.size};this.addToCache(t,i)}}catch{}finally{this.loadingQueue.delete(t)}}}clearCache(){for(const t of this.imageCache.values())URL.revokeObjectURL(t.url);this.imageCache.clear(),this.currentCacheSize=0}getCacheStats(){return{size:this.imageCache.size,totalSize:this.currentCacheSize,maxSize:this.maxCacheSize,hitRate:this.imageCache.size>0?Array.from(this.imageCache.values()).filter(t=>Date.now()-t.timestamp<3e5).length/this.imageCache.size:0}}destroy(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.clearCache(),this.loadingQueue.clear()}}const Qr=new rl;if(typeof document<"u"){const a=document.createElement("style");a.textContent=`
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
  `,document.head.appendChild(a)}const la=o.memo(({src:a,alt:t,onLoad:s,onError:r,className:n="",enableProgressiveLoading:i=!0,quality:u="medium",...c})=>{const l=o.useRef(null),[d,p]=o.useState(!1),[b,y]=o.useState(!1);o.useEffect(()=>{const v=l.current;if(!v||!a)return;const f=()=>{p(!0),s?.()},S=()=>{y(!0),r?.()};return v.addEventListener("load",f),v.addEventListener("error",S),Qr.observeImage(v,a),()=>{v.removeEventListener("load",f),v.removeEventListener("error",S)}},[a,s,r]);const k=`
    ${n}
    ${i&&!d?"transition-opacity duration-300 opacity-0":""}
    ${d?"opacity-100":""}
    ${b?"bg-red-100":""}
  `.trim();return e.jsx("img",{ref:l,alt:t,className:k,...c,style:{...c.style,...i&&!d?{backgroundColor:"#f3f4f6",backgroundImage:"linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%)",backgroundSize:"200% 100%",animation:"shimmer 2s infinite linear"}:{}}})});la.displayName="LazyImage";const Jr=o.memo(({dir:a,engine:t,items:s,gap:r=8,targetRowHeight:n=196,scrollContainerRef:i,selected:u,onToggleSelect:c,onOpen:l,focusIndex:d=null,onLayout:p,ratingMap:b,showInfoOverlay:y})=>{const k=o.useRef(null),[v,f]=o.useState(0),[S,T]=o.useState({}),[P,m]=o.useState(null),[h,j]=o.useState({}),C=4/3,[E,w]=o.useState({});o.useEffect(()=>{const W=i.current;if(!W)return;const J=new ResizeObserver(()=>f(W.clientWidth));return J.observe(W),f(W.clientWidth),()=>J.disconnect()},[i]),o.useEffect(()=>{let W=!1;return s.slice(0,200).forEach(({path:A})=>{if(S[A])return;const G=new Image;G.onload=()=>{!W&&G.naturalWidth&&G.naturalHeight&&T($=>({...$,[A]:G.naturalWidth/G.naturalHeight}))},G.src=Ne(a,t,A,256)}),()=>{W=!0}},[s,a,t]);const N=o.useMemo(()=>{if(!v||s.length===0)return[];const W=[];let J=[],A=0;const $=Math.max(0,v-2*16);if(s.forEach((K,X)=>{const R=S[K.path]||C;if(J.push(K),A+=R,A*n+r*(J.length-1)>=$){const ce=Math.max(120,Math.floor(($-r*(J.length-1))/A));W.push({items:J,height:ce}),J=[],A=0}}),J.length>0){const K=Math.min(n,Math.floor(($-r*(J.length-1))/Math.max(1,A)));W.push({items:J,height:K})}return W},[s,S,v,r,n]),_=o.useMemo(()=>{const W=[];if(!s.length||N.length===0)return W;let J=0;for(const A of N){const G=[];for(let $=0;$<A.items.length;$++)G.push(J++);W.push(G)}return W},[N,s.length]);o.useEffect(()=>{p&&p(_)},[_,p]);const z=(W,J)=>{const A=J.touches[0],G=Date.now();h[W]?.longPressTimer&&clearTimeout(h[W].longPressTimer);const $={startX:A.clientX,startY:A.clientY,startTime:G,isLongPress:!1,longPressTimer:window.setTimeout(()=>{j(K=>({...K,[W]:{...K[W],isLongPress:!0}})),m(W)},500)};j(K=>({...K,[W]:$}))},ee=(W,J)=>{const A=J.touches[0],G=h[W];if(!G)return;const $=Math.abs(A.clientX-G.startX),K=Math.abs(A.clientY-G.startY);($>10||K>10)&&G.longPressTimer&&(clearTimeout(G.longPressTimer),j(X=>({...X,[W]:{...X[W],longPressTimer:null}})))},O=(W,J)=>{const A=h[W];if(!A)return;A.longPressTimer&&clearTimeout(A.longPressTimer);const $=Date.now()-A.startTime;A.isLongPress||($<200&&c(W),setTimeout(()=>{j(K=>{const X={...K};return delete X[W],X})},100))},Y=(W,J)=>{switch(m(null),J){case"open":l(W);break;case"favorite":console.log("Favorite:",W);break;case"share":console.log("Share:",W);break;case"download":console.log("Download:",W);break}},[F,M]=o.useState(0),V=i.current?.clientHeight||0;o.useEffect(()=>{const W=i.current;if(!W)return;const J=()=>M(W.scrollTop);return W.addEventListener("scroll",J,{passive:!0}),M(W.scrollTop),()=>W.removeEventListener("scroll",J)},[i]);const{totalH:se,offsets:B}=o.useMemo(()=>{let W=0;const J=[];for(const A of N)J.push(W),W+=A.height+r;return{totalH:W,offsets:J}},[N,r]),me=600,L=o.useMemo(()=>{const W=Math.max(0,F-me);let J=0;for(;J<B.length&&B[J]+N[J].height<W;)J++;return J},[B,N,F]),Z=o.useMemo(()=>{const W=F+V+me;let J=L;for(;J<B.length&&B[J]<W;)J++;return Math.min(J+5,N.length)},[B,N,F,V,L]);o.useEffect(()=>{const W=N.slice(Z,Z+3).flatMap(J=>J.items.map(A=>Ne(a,t,A.path,256)));W.length>0&&Qr.preloadImages(W,"low")},[Z,N,a,t]),o.useEffect(()=>{if(!y)return;const W=[];N.slice(L,Z).forEach(($,K)=>{$.items.forEach(X=>{W.push(X.path)})});const J=W.filter($=>!E[$]);if(J.length===0)return;const A=J.slice(0,16);let G=!1;return Promise.all(A.map(async $=>{try{const K=await xt(a,$);!G&&K&&K.meta&&w(X=>X[$]?X:{...X,[$]:K.meta})}catch{}})),()=>{G=!0}},[y,N,L,Z,a,E]),o.useEffect(()=>{if(!y)return;const W=s.slice(0,48).map(A=>A.path).filter(A=>!E[A]);if(W.length===0)return;let J=!1;return Promise.all(W.slice(0,24).map(async A=>{try{const G=await xt(a,A);!J&&G&&G.meta&&w($=>$[A]?$:{...$,[A]:G.meta})}catch{}})),()=>{J=!0}},[y,s,a]);const ie=d!==null?`photo-${d}`:void 0;return e.jsx("div",{id:"modern-results-grid",ref:k,className:"relative",style:{height:se},role:"grid","aria-multiselectable":"true","aria-activedescendant":ie,tabIndex:0,children:N.slice(L,Z).map((W,J)=>{const A=L+J,G=B[A],$=Math.max(0,v-2*16),K=W.items.reduce((R,U)=>R+(S[U.path]||C),0),X=Math.max(120,Math.floor(($-r*(W.items.length-1))/Math.max(.01,K)));return e.jsx("div",{className:"absolute left-0 right-0",style:{top:G},children:e.jsx("div",{className:"flex",style:{gap:r},children:W.items.map((R,U)=>{const ce=_[A]?.[U],Q=S[R.path]||C,ne=Math.floor(X*Q),H=u.has(R.path),he=d!==null&&ce===d,ye=R.path.split("/").pop()||R.path;return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden transition-all duration-200 hover:shadow ${H?"ring-2 ring-blue-500":""} ${he?"outline outline-2 outline-indigo-500":""} ${h[R.path]?"scale-95":""}`,style:{width:ne,height:X},onClick:()=>c(R.path),onDoubleClick:()=>l(R.path),onTouchStart:te=>z(R.path,te),onTouchMove:te=>ee(R.path,te),onTouchEnd:te=>O(R.path),title:R.path,"data-photo-idx":ce,id:`photo-${ce}`,role:"gridcell","aria-selected":H,tabIndex:he?0:-1,children:[e.jsx(la,{src:Ne(a,t,R.path,256),alt:R.path,className:"w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",enableProgressiveLoading:!0}),De.isVideoFile(R.path)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(dt,{className:"w-6 h-6 text-white ml-1"})})}),y&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:ye,children:ye}),e.jsx("div",{className:"flex items-center gap-1",children:(()=>{const te=E[R.path],ve=[];return te&&(te.camera&&ve.push(String(te.camera)),typeof te.fnumber=="number"&&ve.push(`f/${te.fnumber}`),typeof te.iso=="number"&&ve.push(`ISO ${te.iso}`)),typeof R.score=="number"&&ve.push(R.score.toFixed(2)),ve.slice(0,3).map((Ke,Oe)=>e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:Ke},Oe))})()})]}),b&&typeof b[R.path]=="number"&&b[R.path]>0&&e.jsxs("div",{className:"absolute bottom-1 left-1 px-1 py-0.5 rounded bg-black/50 text-yellow-300 text-[10px] flex items-center gap-0.5",children:[e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M12 .587l3.668 7.431 8.2 1.193-5.934 5.787 1.401 8.168L12 18.896l-7.335 3.87 1.401-8.168L.132 9.211l8.2-1.193z"})}),e.jsx("span",{children:b[R.path]})]}),H&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),P===R.path&&e.jsxs("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center gap-3",onClick:()=>m(null),children:[e.jsx("div",{className:"text-white text-sm font-medium mb-2",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:te=>{te.stopPropagation(),Y(R.path,"open")},onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),te.stopPropagation(),Y(R.path,"open"))},className:"w-12 h-12 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Open",children:e.jsx(dt,{className:"w-5 h-5 ml-0.5"})}),e.jsx("button",{type:"button",onClick:te=>{te.stopPropagation(),Y(R.path,"favorite")},onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),te.stopPropagation(),Y(R.path,"favorite"))},className:"w-12 h-12 bg-pink-500 hover:bg-pink-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Favorite",children:e.jsx(Xt,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:te=>{te.stopPropagation(),Y(R.path,"share")},onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),te.stopPropagation(),Y(R.path,"share"))},className:"w-12 h-12 bg-green-500 hover:bg-green-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Share",children:e.jsx(Zt,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:te=>{te.stopPropagation(),Y(R.path,"download")},onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),te.stopPropagation(),Y(R.path,"download"))},className:"w-12 h-12 bg-purple-500 hover:bg-purple-600 rounded-full flex items-center justify-center text-white transition-colors",title:"Download",children:e.jsx(Me,{className:"w-5 h-5"})})]}),e.jsx("button",{type:"button",onClick:te=>{te.stopPropagation(),m(null)},onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),te.stopPropagation(),m(null))},className:"mt-4 text-white/70 hover:text-white text-xs",children:"Tap anywhere to close"})]})]},R.path)})})},A)})})});Jr.displayName="JustifiedResults";class nl{constructor(t){oe(this,"config");this.config=t}async search(t,s=24){return as(this.config.dir,t,this.config.provider,s)}async searchWorkspace(t,s=24){return Qs(this.config.dir,t,this.config.provider,s)}async searchSimilar(t,s=24){return Tr(this.config.dir,t,this.config.provider,s)}async searchSimilarPlus(t,s,r=.5,n=24){return mr(this.config.dir,t,this.config.provider,n,s,r)}async buildIndex(t=32){return Et(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async buildFastIndex(t){return Gs(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async buildCaptions(t){return gr(this.config.dir,t,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getCollections(){return Er(this.config.dir)}async setCollection(t,s){return Kt(this.config.dir,t,s)}async deleteCollection(t){return Pr(this.config.dir,t)}async getSmartCollections(){return Ir(this.config.dir)}async setSmartCollection(t,s){return $r(this.config.dir,t,s)}async deleteSmartCollection(t){return Mr(this.config.dir,t)}async resolveSmartCollection(t,s=24){return Fr(this.config.dir,t,this.config.provider,s)}async buildTrips(){return _r(this.config.dir,this.config.provider)}async getTrips(){return Or(this.config.dir)}async buildFaces(){return ta(this.config.dir,this.config.provider)}async getFaceClusters(){return sa(this.config.dir)}async nameFaceCluster(t,s){return aa(this.config.dir,t,s)}async buildOCR(t){return Ks(this.config.dir,this.config.provider,t,this.config.hfToken,this.config.openaiKey)}async getOCRSnippets(t,s=160){return Dr(this.config.dir,t,s)}async getMetadata(){return ea(this.config.dir)}async getMetadataDetail(t){return xt(this.config.dir,t)}async buildMetadata(){return Zs(this.config.dir,this.config.provider,this.config.hfToken,this.config.openaiKey)}async getTags(){return Js(this.config.dir)}async setTags(t,s){return Nr(this.config.dir,t,s)}async getMapData(){return Hs(this.config.dir)}async getFavorites(){return qs(this.config.dir)}async setFavorite(t,s){return St(this.config.dir,t,s)}async getSavedSearches(){return Vs(this.config.dir)}async addSavedSearch(t,s,r){return br(this.config.dir,t,s,r)}async deleteSavedSearch(t){return yr(this.config.dir,t)}async editImage(t,s){return Sr(this.config.dir,t,s)}async upscaleImage(t,s=2,r="pil"){return Cr(this.config.dir,t,s,r)}async exportImages(t,s,r="copy",n=!1,i=!1){return pt(this.config.dir,t,s,r,n,i)}async openExternal(t){return kr(this.config.dir,t)}async getLibrary(t=120,s=0){return $t(this.config.dir,this.config.provider,t,s,{hfToken:this.config.hfToken,openaiKey:this.config.openaiKey})}async getWorkspace(){return Ys()}async addToWorkspace(t){return et(t)}async removeFromWorkspace(t){return wr(t)}async deleteImages(t,s=!0){return na(this.config.dir,t,s)}async undoDelete(){return ia(this.config.dir)}async findLookalikes(t=5){return vr(this.config.dir,t)}async resolveLookalikes(t){return jr(this.config.dir,t)}async runDiagnostics(){return Ws(this.config.dir,this.config.provider,this.config.openaiKey,this.config.hfToken)}async submitFeedback(t,s,r,n){return fr(this.config.dir,t,s,r,n)}async getTodos(){return Yt()}getThumbnailUrl(t){return Ne(this.config.dir,this.config.provider,t)}getFaceThumbnailUrl(t,s,r=196){return Xs(this.config.dir,this.config.provider,t,s,r)}async autoTag(){return ra(this.config.dir,this.config.provider)}}let Qt=null;function il(a){return Qt=new nl(a),Qt}function $e(){if(!Qt)throw new Error("PhotoVault API not initialized. Call initializeAPI first.");return Qt}function Xr({imagePath:a,onClose:t,onSave:s}){const[r,n]=o.useState(a),[i,u]=o.useState(a),[c,l]=o.useState(0),[d,p]=o.useState(!1),[b,y]=o.useState(!1),[k,v]=o.useState(!1),[f,S]=o.useState({x:0,y:0,w:100,h:100}),[T,P]=o.useState(2),[m,h]=o.useState("pil"),[j,C]=o.useState(!1),[E,w]=o.useState([a]),[N,_]=o.useState(0),[z,ee]=o.useState(!1),[O,Y]=o.useState({brightness:100,contrast:100,saturation:100}),F=$e(),M=o.useRef(null),V=o.useRef(null),se=async K=>{C(!0);try{const X={rotate:K},R=await F.editImage(r,X);ie(R.out_path),n(R.out_path),l(0)}catch(X){console.error("Failed to rotate image:",X)}finally{C(!1)}},B=async K=>{C(!0);try{const X={flip:K},R=await F.editImage(r,X);ie(R.out_path),n(R.out_path),K==="h"?p(!1):y(!1)}catch(X){console.error("Failed to flip image:",X)}finally{C(!1)}},me=async()=>{if(M.current){C(!0);try{const K=M.current,R={crop:{x:Math.round(f.x/100*K.naturalWidth),y:Math.round(f.y/100*K.naturalHeight),w:Math.round(f.w/100*K.naturalWidth),h:Math.round(f.h/100*K.naturalHeight)}},U=await F.editImage(r,R);ie(U.out_path),n(U.out_path),v(!1)}catch(K){console.error("Failed to crop image:",K)}finally{C(!1)}}},L=async()=>{C(!0);try{const K=await F.upscaleImage(r,T,m);ie(K.out_path),n(K.out_path)}catch(K){console.error("Failed to upscale image:",K)}finally{C(!1)}},Z=async()=>{if(!(O.brightness===100&&O.contrast===100&&O.saturation===100)){C(!0);try{alert("Adjustments would be applied here. In a full implementation, this would process the image with the selected adjustments.")}catch(K){console.error("Failed to apply adjustments:",K)}finally{C(!1)}}},ie=K=>{const X=E.slice(0,N+1);X.push(K),w(X),_(X.length-1)},W=()=>{N>0&&(_(N-1),n(E[N-1]))},J=()=>{N<E.length-1&&(_(N+1),n(E[N+1]))},A=()=>{n(i),w([i]),_(0),Y({brightness:100,contrast:100,saturation:100})},G=()=>{s&&s(r),t&&t()},$=async()=>{try{const K=prompt("Enter export destination folder:");if(!K)return;const X=await F.exportImages([r],K,"copy",!1,!1);alert(`Exported to: ${X.dest}`)}catch(K){console.error("Failed to export image:",K)}};return e.jsxs("div",{className:"image-editor",children:[e.jsxs("div",{className:"editor-toolbar",children:[e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:()=>se(90),disabled:j,className:"toolbar-btn",title:"Rotate 90",children:e.jsx(Ts,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>B("h"),disabled:j,className:"toolbar-btn",title:"Flip Horizontal",children:[e.jsx(An,{className:"w-4 h-4"}),e.jsx(Un,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>B("v"),disabled:j,className:"toolbar-btn",title:"Flip Vertical",children:[e.jsx(zn,{className:"w-4 h-4"}),e.jsx(Bn,{className:"w-4 h-4"})]}),e.jsx("button",{onClick:()=>v(!k),disabled:j,className:`toolbar-btn ${k?"active":""}`,title:"Crop",children:e.jsx(qn,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"toolbar-group",children:e.jsx("button",{onClick:()=>ee(!z),className:"toolbar-btn",title:"Before/After Toggle",children:e.jsx("span",{children:"Before/After"})})}),e.jsxs("div",{className:"toolbar-group",children:[e.jsxs("select",{value:T,onChange:K=>P(Number(K.target.value)),className:"toolbar-select",children:[e.jsx("option",{value:2,children:"2x"}),e.jsx("option",{value:4,children:"4x"})]}),e.jsxs("select",{value:m,onChange:K=>h(K.target.value),className:"toolbar-select",children:[e.jsx("option",{value:"pil",children:"PIL"}),e.jsx("option",{value:"realesrgan",children:"RealESRGAN"})]}),e.jsx("button",{onClick:L,disabled:j,className:"toolbar-btn",title:"Upscale",children:e.jsx(Va,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{onClick:W,disabled:N===0||j,className:"toolbar-btn",children:"Undo"}),e.jsx("button",{onClick:J,disabled:N===E.length-1||j,className:"toolbar-btn",children:"Redo"})]}),e.jsxs("div",{className:"toolbar-group ml-auto",children:[e.jsx("button",{onClick:A,className:"toolbar-btn",title:"Revert to Original",children:"Revert"}),e.jsxs("button",{onClick:$,className:"toolbar-btn",children:[e.jsx(Me,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:G,className:"btn btn-primary",children:[e.jsx(Ha,{className:"w-4 h-4"}),"Save"]}),t&&e.jsx("button",{onClick:t,className:"toolbar-btn",children:e.jsx(Te,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"adjustment-panel",children:[e.jsxs("div",{className:"adjustment-control",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsx("label",{children:"Brightness"}),e.jsx("input",{type:"range",min:"0",max:"200",value:O.brightness,onChange:K=>Y({...O,brightness:parseInt(K.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[O.brightness,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(Ns,{className:"w-4 h-4"}),e.jsx("label",{children:"Contrast"}),e.jsx("input",{type:"range",min:"0",max:"200",value:O.contrast,onChange:K=>Y({...O,contrast:parseInt(K.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[O.contrast,"%"]})]}),e.jsxs("div",{className:"adjustment-control",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("label",{children:"Saturation"}),e.jsx("input",{type:"range",min:"0",max:"200",value:O.saturation,onChange:K=>Y({...O,saturation:parseInt(K.target.value)}),className:"adjustment-slider"}),e.jsxs("span",{children:[O.saturation,"%"]})]}),e.jsx("button",{onClick:Z,disabled:j,className:"btn btn-secondary",children:"Apply Adjustments"})]}),e.jsxs("div",{className:"editor-canvas",children:[j&&e.jsxs("div",{className:"processing-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),e.jsxs("div",{className:"image-container",children:[z?e.jsxs("div",{className:"before-after-container",children:[e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"Before"}),e.jsx("img",{src:F.getThumbnailUrl(i),alt:"Original"})]}),e.jsxs("div",{className:"before-after-panel",children:[e.jsx("h3",{children:"After"}),e.jsx("img",{src:F.getThumbnailUrl(r),alt:"Edited"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{ref:M,src:F.getThumbnailUrl(r),alt:"Editing",style:{transform:`rotate(${c}deg) ${d?"scaleX(-1)":""} ${b?"scaleY(-1)":""}`,filter:`brightness(${O.brightness}%) contrast(${O.contrast}%) saturate(${O.saturation}%)`}}),e.jsx("canvas",{ref:V,style:{display:"none"}})]}),k&&e.jsx("div",{className:"crop-overlay",style:{left:`${f.x}%`,top:`${f.y}%`,width:`${f.w}%`,height:`${f.h}%`},children:e.jsxs("div",{className:"crop-controls",children:[e.jsxs("button",{onClick:me,className:"btn btn-primary btn-sm",children:[e.jsx(ut,{className:"w-3 h-3"}),"Apply"]}),e.jsxs("button",{onClick:()=>v(!1),className:"btn btn-secondary btn-sm",children:[e.jsx(Te,{className:"w-3 h-3"}),"Cancel"]})]})})]})]}),e.jsx("style",{jsx:!0,children:`
        .image-editor {
          display: flex;
          flex-direction: column;
          height: 100vh;
          background: var(--bg-primary);
        }

        .editor-toolbar {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .toolbar-group {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .toolbar-group.ml-auto {
          margin-left: auto;
        }

        .toolbar-btn {
          display: flex;
          align-items: center;
          gap: 0.25rem;
          padding: 0.5rem 0.75rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .toolbar-btn:hover:not(:disabled) {
          background: var(--bg-tertiary);
          border-color: var(--accent-primary);
        }

        .toolbar-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .toolbar-btn.active {
          background: var(--accent-primary);
          color: white;
        }

        .toolbar-select {
          padding: 0.5rem;
          background: var(--bg-primary);
          border: 1px solid var(--border-default);
          border-radius: var(--radius-md);
        }

        .adjustment-panel {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 0.5rem 1rem;
          background: var(--bg-secondary);
          border-bottom: 1px solid var(--border-subtle);
          flex-wrap: wrap;
        }

        .adjustment-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .adjustment-control label {
          font-size: 0.875rem;
          white-space: nowrap;
        }

        .adjustment-slider {
          width: 100px;
        }

        .editor-canvas {
          flex: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .processing-overlay {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 10;
          color: white;
        }

        .image-container {
          position: relative;
          max-width: 90%;
          max-height: 90%;
        }

        .before-after-container {
          display: flex;
          gap: 2rem;
          max-width: 100%;
          max-height: 100%;
        }

        .before-after-panel {
          flex: 1;
          text-align: center;
        }

        .before-after-panel h3 {
          margin-bottom: 0.5rem;
          color: white;
        }

        .before-after-panel img {
          max-width: 100%;
          max-height: 80vh;
          object-fit: contain;
        }

        .image-container img {
          max-width: 100%;
          max-height: 100%;
          transition: transform 0.3s;
        }

        .crop-overlay {
          position: absolute;
          border: 2px solid var(--accent-primary);
          background: rgba(0, 122, 255, 0.1);
          cursor: move;
        }

        .crop-controls {
          position: absolute;
          bottom: -40px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 0.5rem;
          white-space: nowrap;
        }

        .btn-sm {
          padding: 0.25rem 0.5rem;
          font-size: 0.875rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .editor-toolbar {
            flex-direction: column;
            align-items: stretch;
          }
          
          .toolbar-group {
            flex-wrap: wrap;
            justify-content: center;
          }
          
          .adjustment-panel {
            flex-direction: column;
            align-items: stretch;
          }
          
          .adjustment-control {
            justify-content: space-between;
          }
        }
      `})]})}class lt{static async verifyFaces(t,s,r){const n=[];for(const i of s){let u={clusterId:"",confidence:0};for(const[c,l]of r){const d=this.calculateFaceSimilarity(i.embedding,l.centroid);d>u.confidence&&(u={clusterId:c,confidence:d})}u.confidence>this.faceThreshold&&n.push({clusterId:u.clusterId,confidence:u.confidence,suggested:!0,faceBox:i.box})}return n}static async detectPets(t){const s=[],r=[{type:"dog",breed:"Golden Retriever",confidence:.92},{type:"cat",breed:"Siamese",confidence:.88}];for(const n of r)n.confidence>this.petThreshold&&s.push({...n,box:{x:100,y:100,width:200,height:200}});return s}static async analyzeScene(t){const s={wedding:["bride","groom","ceremony","cake","dress"],birthday:["cake","candles","balloons","party","celebration"],hiking:["mountain","trail","backpack","forest","outdoors"],beach:["ocean","sand","waves","sunset","swimming"],sports:["ball","field","court","team","game"],concert:["stage","crowd","lights","music","performance"],graduation:["cap","gown","diploma","ceremony","academic"]},r={primary:"outdoor",categories:["nature","landscape"],activities:[],events:[],objects:[{name:"mountain",confidence:.95},{name:"trees",confidence:.89},{name:"sky",confidence:.92}],confidence:.88};for(const[n,i]of Object.entries(s))i.filter(c=>r.objects.some(l=>l.name.includes(c))).length>=2&&r.events.push(n);return r.objects.some(n=>n.name.includes("sport"))&&r.activities.push("sports"),r.objects.some(n=>n.name.includes("mountain")||n.name.includes("trail"))&&r.activities.push("hiking"),r}static async assessQuality(t,s){const r={overall:0,sharpness:0,exposure:0,composition:0,colorBalance:0,noise:0,issues:[]};return s?(r.sharpness=this.calculateSharpness(s),r.exposure=this.calculateExposure(s),r.composition=this.calculateComposition(s),r.colorBalance=this.calculateColorBalance(s),r.noise=this.calculateNoise(s)):(r.sharpness=Math.random()*100,r.exposure=Math.random()*100,r.composition=Math.random()*100,r.colorBalance=Math.random()*100,r.noise=100-Math.random()*30),r.overall=r.sharpness*this.qualityWeights.sharpness+r.exposure*this.qualityWeights.exposure+r.composition*this.qualityWeights.composition+r.colorBalance*this.qualityWeights.colorBalance+r.noise*this.qualityWeights.noise,r.sharpness<40&&r.issues.push("Blurry"),r.exposure<30&&r.issues.push("Underexposed"),r.exposure>85&&r.issues.push("Overexposed"),r.composition<40&&r.issues.push("Poor composition"),r.noise<70&&r.issues.push("Noisy"),r}static async generateAutoTags(t){const s=[];t.scene&&(s.push({tag:t.scene.primary,confidence:t.scene.confidence}),t.scene.categories.forEach(n=>s.push({tag:n,confidence:t.scene.confidence*.9})),t.scene.activities.forEach(n=>s.push({tag:n,confidence:.85})),t.scene.events.forEach(n=>s.push({tag:n,confidence:.9}))),t.quality&&(t.quality.overall>80&&s.push({tag:"high-quality",confidence:.95}),t.quality.sharpness>85&&s.push({tag:"sharp",confidence:.9}),t.quality.issues.forEach(n=>s.push({tag:n.toLowerCase(),confidence:.8}))),t.pets&&t.pets.length>0&&t.pets.forEach(n=>{s.push({tag:n.type,confidence:n.confidence}),n.breed&&s.push({tag:n.breed,confidence:n.confidence*.8})});const r=new Map;return s.forEach(n=>{const i=r.get(n.tag);(!i||n.confidence>i)&&r.set(n.tag,n.confidence)}),Array.from(r.entries()).map(([n,i])=>({tag:n,confidence:i})).sort((n,i)=>i.confidence-n.confidence)}static calculateFaceSimilarity(t,s){let r=0,n=0,i=0;for(let u=0;u<t.length;u++)r+=t[u]*s[u],n+=t[u]*t[u],i+=s[u]*s[u];return r/(Math.sqrt(n)*Math.sqrt(i))}static calculateSharpness(t){const{data:s,width:r,height:n}=t;let i=0,u=0,c=0;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const p=(l*r+d)*4,y=-((s[p]+s[p+1]+s[p+2])/3)+(s[((l-1)*r+d)*4]+s[((l+1)*r+d)*4]+s[(l*r+(d-1))*4]+s[(l*r+(d+1))*4])/4;u+=y,c++}u/=c;for(let l=1;l<n-1;l++)for(let d=1;d<r-1;d++){const p=(l*r+d)*4,y=-((s[p]+s[p+1]+s[p+2])/3)+(s[((l-1)*r+d)*4]+s[((l+1)*r+d)*4]+s[(l*r+(d-1))*4]+s[(l*r+(d+1))*4])/4;i+=Math.pow(y-u,2)}return i/=c,Math.min(100,Math.sqrt(i)*10)}static calculateExposure(t){const{data:s}=t,r=new Array(256).fill(0);for(let l=0;l<s.length;l+=4){const d=(s[l]+s[l+1]+s[l+2])/3;r[Math.floor(d)]++}const n=s.length/4,i=r.slice(0,20).reduce((l,d)=>l+d,0)/n,u=r.slice(235,256).reduce((l,d)=>l+d,0)/n;let c=100;return c-=i*200,c-=u*200,Math.max(0,Math.min(100,c))}static calculateComposition(t){const{width:s,height:r}=t;return 70+Math.random()*30}static calculateColorBalance(t){const{data:s}=t;let r=0,n=0,i=0;const u=s.length/4;for(let k=0;k<s.length;k+=4)r+=s[k],n+=s[k+1],i+=s[k+2];const c=r/u,l=n/u,d=i/u,p=Math.max(c,l,d),b=Math.min(c,l,d);return(1-(p-b)/p)*100}static calculateNoise(t){const{data:s,width:r,height:n}=t;let i=0,u=0;for(let c=1;c<n-1;c+=10)for(let l=1;l<r-1;l+=10){const d=(c*r+l)*4,p=(s[d]+s[d+1]+s[d+2])/3;let b=0;for(let y=-1;y<=1;y++)for(let k=-1;k<=1;k++){const v=((c+y)*r+(l+k))*4,f=(s[v]+s[v+1]+s[v+2])/3;b+=Math.pow(f-p,2)}i+=Math.sqrt(b/9),u++}return i/=u,Math.max(0,100-i)}}oe(lt,"faceThreshold",.85),oe(lt,"petThreshold",.7),oe(lt,"sceneThreshold",.6),oe(lt,"qualityWeights",{sharpness:.3,exposure:.25,composition:.25,colorBalance:.15,noise:.05});function ol({imagePath:a,detectedFaces:t=[],knownPeople:s,onVerify:r,onCreateNew:n}){const[i,u]=o.useState([]),[c,l]=o.useState(0),[d,p]=o.useState(""),[b,y]=o.useState(!1),[k,v]=o.useState(!1);o.useEffect(()=>{async function T(){if(t.length){v(!0);try{const P=await lt.verifyFaces(a,t,s);u(P)}catch(P){console.error("Face verification failed:",P)}finally{v(!1)}}}T()},[a,t,s]);const f=(T,P)=>{r(T,P),u(m=>m.map(h=>h.clusterId===T?{...h,verified:P}:h))},S=()=>{d.trim()&&(n(d),p(""),y(!1))};return t.length?k?e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Analyzing faces..."})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Face Recognition"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," face",t.length!==1?"s":""," detected"]})]}),t.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:t.map((T,P)=>e.jsx("button",{onClick:()=>l(P),className:`relative w-16 h-16 rounded overflow-hidden border-2 transition-colors ${c===P?"border-blue-500":"border-gray-300"}`,children:e.jsx("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium",children:P+1})})},P))}),i[c]&&e.jsxs("div",{className:"space-y-3",children:[i[c].suggested?e.jsx("div",{className:"p-3 bg-blue-50 rounded",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Suggested: ",s.get(i[c].clusterId)?.name||"Unknown"]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Confidence: ",(i[c].confidence*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(i[c].clusterId,!0),className:`px-3 py-1 text-xs rounded ${i[c].verified===!0?"bg-green-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:" Correct"}),e.jsx("button",{onClick:()=>f(i[c].clusterId,!1),className:`px-3 py-1 text-xs rounded ${i[c].verified===!1?"bg-red-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:" Wrong"})]})]})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-600",children:"No match found"})}),b?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:T=>p(T.target.value),onKeyPress:T=>T.key==="Enter"&&S(),placeholder:"Enter person's name",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:border-blue-500",autoFocus:!0}),e.jsx("button",{onClick:S,className:"px-3 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Add"}),e.jsx("button",{onClick:()=>{y(!1),p("")},className:"px-3 py-2 text-sm bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"})]}):e.jsx("button",{onClick:()=>y(!0),className:"w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50",children:"+ Tag as new person"})]})]}):e.jsx("div",{className:"p-4 bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No faces detected in this photo"})})}function ll({imagePath:a,show:t,imageData:s}){const[r,n]=o.useState(null),[i,u]=o.useState(!1);if(o.useEffect(()=>{if(!t)return;async function p(){u(!0);try{const b=await lt.assessQuality(a,s);n(b)}catch(b){console.error("Quality assessment failed:",b)}finally{u(!1)}}p()},[a,t,s]),!t)return null;const c=p=>p>=80?"text-green-600":p>=60?"text-yellow-600":p>=40?"text-orange-600":"text-red-600",l=p=>p>=80?"Excellent":p>=60?"Good":p>=40?"Fair":"Poor",d=(p,b)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:b}),e.jsx("span",{className:c(p),children:p.toFixed(0)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all ${p>=80?"bg-green-500":p>=60?"bg-yellow-500":p>=40?"bg-orange-500":"bg-red-500"}`,style:{width:`${p}%`}})})]});return i?e.jsx("div",{className:"absolute top-2 left-2 bg-white/90 backdrop-blur rounded-lg p-3 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Analyzing quality..."})]})}):r?e.jsxs("div",{className:"absolute top-2 left-2 bg-white/95 backdrop-blur rounded-lg p-3 shadow-lg max-w-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:"Quality Score"}),e.jsx("p",{className:`text-2xl font-bold ${c(r.overall)}`,children:r.overall.toFixed(0)})]}),e.jsx("div",{className:`text-sm ${c(r.overall)}`,children:l(r.overall)})]}),e.jsxs("div",{className:"space-y-2",children:[d(r.sharpness,"Sharpness"),d(r.exposure,"Exposure"),d(r.composition,"Composition"),d(r.colorBalance,"Color Balance"),d(r.noise,"Noise Level")]}),r.issues.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Issues Detected:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.issues.map((p,b)=>e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded",children:p},b))})]})]}):null}const cl={minSwipeDistance:50,maxSwipeTime:300,minPinchDistance:10,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!0,pullToRefreshThreshold:80};class dl{constructor(t={}){oe(this,"config");oe(this,"touchStartPoints",[]);oe(this,"gestureState",{isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0});oe(this,"touchStartTime",0);oe(this,"lastTouchEndTime",0);oe(this,"doubleTapTimer",null);oe(this,"pullStartY",0);oe(this,"isPulling",!1);oe(this,"onSwipeCallback");oe(this,"onPinchCallback");oe(this,"onPanCallback");oe(this,"onDoubleTapCallback");oe(this,"onPullToRefreshCallback");this.config={...cl,...t}}onSwipe(t){return this.onSwipeCallback=t,this}onPinch(t){return this.onPinchCallback=t,this}onPan(t){return this.onPanCallback=t,this}onDoubleTap(t){return this.onDoubleTapCallback=t,this}onPullToRefresh(t){return this.onPullToRefreshCallback=t,this}handleTouchStart(t){this.touchStartTime=Date.now(),this.touchStartPoints=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));const s=Date.now();this.doubleTapTimer&&s-this.lastTouchEndTime<300?(this.handleDoubleTap(this.touchStartPoints[0].x,this.touchStartPoints[0].y),this.clearDoubleTapTimer()):this.startDoubleTapTimer(),this.gestureState.lastScale=this.gestureState.scale,this.gestureState.lastTranslateX=this.gestureState.translateX,this.gestureState.lastTranslateY=this.gestureState.translateY,this.config.enablePullToRefresh&&this.isAtTopOfPage()&&(this.pullStartY=this.touchStartPoints[0].y,this.isPulling=!0)}handleTouchMove(t){t.preventDefault();const s=Array.from(t.touches).map(r=>({x:r.clientX,y:r.clientY,id:r.identifier}));s.length===1?this.handleSingleTouchMove(s[0]):s.length===2&&this.handlePinchMove(s)}handleTouchEnd(t){const s=Date.now()-this.touchStartTime;this.lastTouchEndTime=Date.now(),this.gestureState.isSwiping&&s<this.config.maxSwipeTime&&this.handleSwipe(t.changedTouches[0]),this.gestureState.isPinching=!1,this.gestureState.isPanning=!1,this.gestureState.isSwiping=!1,this.isPulling=!1}handleSingleTouchMove(t){const s=this.touchStartPoints[0];if(!s)return;const r=t.x-s.x,n=t.y-s.y,i=Math.sqrt(r*r+n*n);if(this.isPulling&&this.config.enablePullToRefresh&&t.y-this.pullStartY>this.config.pullToRefreshThreshold){this.triggerPullToRefresh(),this.isPulling=!1;return}if(this.gestureState.scale>1){this.gestureState.isPanning=!0,this.gestureState.translateX=this.gestureState.lastTranslateX+r,this.gestureState.translateY=this.gestureState.lastTranslateY+n,this.onPanCallback&&this.onPanCallback(r,n);return}i>this.config.minSwipeDistance&&!this.gestureState.isPanning&&(this.gestureState.isSwiping=!0)}handlePinchMove(t){if(t.length!==2)return;const s=this.touchStartPoints.find(u=>u.id===t[0].id),r=this.touchStartPoints.find(u=>u.id===t[1].id);if(!s||!r)return;const n=this.getDistance(s,r),i=this.getDistance(t[0],t[1]);if(Math.abs(i-n)>this.config.minPinchDistance){this.gestureState.isPinching=!0;const u=i/n*this.gestureState.lastScale,c=Math.max(this.config.minScale,Math.min(this.config.maxScale,u)),l=(t[0].x+t[1].x)/2,d=(t[0].y+t[1].y)/2;this.gestureState.scale=c,this.onPinchCallback&&this.onPinchCallback(c,l,d)}}handleSwipe(t){const s=this.touchStartPoints[0];if(!s)return;const r=t.clientX-s.x,n=t.clientY-s.y,i=Math.abs(r),u=Math.abs(n);if(i>u&&i>this.config.minSwipeDistance){const c={left:r<0,right:r>0,up:!1,down:!1};this.onSwipeCallback&&this.onSwipeCallback(c)}}handleDoubleTap(t,s){this.onDoubleTapCallback&&this.onDoubleTapCallback(t,s)}triggerPullToRefresh(){this.onPullToRefreshCallback&&this.onPullToRefreshCallback()}getDistance(t,s){const r=s.x-t.x,n=s.y-t.y;return Math.sqrt(r*r+n*n)}isAtTopOfPage(){return window.scrollY<=10}startDoubleTapTimer(){this.clearDoubleTapTimer(),this.doubleTapTimer=window.setTimeout(()=>{this.doubleTapTimer=null},300)}clearDoubleTapTimer(){this.doubleTapTimer&&(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null)}reset(){this.gestureState={isPinching:!1,isPanning:!1,isSwiping:!1,scale:1,translateX:0,translateY:0,lastScale:1,lastTranslateX:0,lastTranslateY:0},this.touchStartPoints=[],this.isPulling=!1}getScale(){return this.gestureState.scale}getTranslation(){return{x:this.gestureState.translateX,y:this.gestureState.translateY}}isGestureActive(){return this.gestureState.isPinching||this.gestureState.isPanning||this.gestureState.isSwiping}}function ul(a,t){const s=React.useRef();return React.useEffect(()=>{if(!a.current)return;s.current=new dl(t);const r=a.current,n=c=>{s.current?.handleTouchStart(c)},i=c=>{s.current?.handleTouchMove(c)},u=c=>{s.current?.handleTouchEnd(c)};return r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("touchmove",i,{passive:!1}),r.addEventListener("touchend",u,{passive:!1}),()=>{r.removeEventListener("touchstart",n),r.removeEventListener("touchmove",i),r.removeEventListener("touchend",u)}},[a,t]),s.current}function hl({dir:a,engine:t,path:s,onPrev:r,onNext:n,onClose:i,onReveal:u,onFavorite:c,onMoreLikeThis:l}){if(!s)return null;const d=o.useRef(null),p=o.useRef(null),[b,y]=o.useState(1),[k,v]=o.useState(0),[f,S]=o.useState(0),[T,P]=o.useState(!1),m=o.useRef({x:0,y:0,tx:0,ty:0}),[h,j]=o.useState(!1),[C,E]=o.useState(!1),[w,N]=o.useState(null),[_,z]=o.useState(!1),[ee,O]=o.useState(s),[Y,F]=o.useState(!1),[M,V]=o.useState(!1),[se,B]=o.useState(null),[me,L]=o.useState(!1),Z=ul(d,{minSwipeDistance:50,maxSwipeTime:300,maxScale:5,minScale:.5,doubleTapZoom:2,enablePullToRefresh:!1});o.useEffect(()=>{Z&&Z.onSwipe(H=>{H.left?n():H.right&&r()}).onPinch((H,he,ye)=>{ie(H-b,he,ye)}).onDoubleTap((H,he)=>{b===1?ie(1,H,he):K()})},[Z,r,n,b]);function ie(H,he,ye){const te=b,ve=Math.min(5,Math.max(1,+(te+H).toFixed(2)));if(ve===te)return;const Ke=p.current;if(Ke&&he!==void 0&&ye!==void 0){const Oe=Ke.getBoundingClientRect(),ns=he-Oe.left,Mt=ye-Oe.top,Ft=ve/te;v(k+(ns-ns*Ft)),S(f+(Mt-Mt*Ft))}y(ve)}function W(H){H.preventDefault();const he=H.deltaY<0?.1:-.1;ie(he,H.clientX,H.clientY)}function J(H){b!==1&&(P(!0),m.current={x:H.clientX,y:H.clientY,tx:k,ty:f})}function A(H){if(!T)return;const he=H.clientX-m.current.x,ye=H.clientY-m.current.y;v(m.current.tx+he),S(m.current.ty+ye)}function G(){P(!1)}function $(){P(!1)}function K(){y(1),v(0),S(0)}function X(){ie(.2)}function R(){ie(-.2)}function U(H){b===1?ie(1,H.clientX,H.clientY):K()}function ce(H){if(H.touches.length===1){const he=H.touches[0];B({x:he.clientX,y:he.clientY}),L(!1)}}function Q(H){if(!se||H.touches.length!==1)return;const he=H.touches[0],ye=he.clientX-se.x,te=he.clientY-se.y,ve=Math.abs(ye),Ke=Math.abs(te);ve>Ke&&ve>30&&L(!0)}function ne(H){if(!se||!me){B(null),L(!1);return}const ye=H.changedTouches[0].clientX-se.x;Math.abs(ye)>50&&(ye>0?r():n()),B(null),L(!1)}return o.useEffect(()=>{d.current?.focus()},[s]),o.useEffect(()=>{let H=!1;async function he(){if(!(!h||!s))try{E(!0);const ye=await xt(a,s);H||N(ye.meta||{})}catch{H||N(null)}finally{H||E(!1)}}return he(),()=>{H=!0}},[h,a,s]),e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center",onClick:i,onKeyDown:H=>{H.key==="Escape"&&(H.stopPropagation(),i())},children:e.jsxs("div",{className:"relative max-w-6xl w-full p-4",onClick:H=>H.stopPropagation(),ref:d,role:"dialog","aria-modal":"true","aria-label":s,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 text-white",children:[e.jsx("div",{className:"truncate text-sm",children:s}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"bg-white/20 rounded px-2 py-1",children:""}),e.jsx("button",{type:"button",onClick:n,className:"bg-white/20 rounded px-2 py-1",children:""}),e.jsx("button",{type:"button",onClick:()=>j(H=>!H),className:`rounded px-2 py-1 ${h?"bg-blue-600 text-white":"bg-white/20"}`,children:"Info"}),e.jsx("button",{type:"button",onClick:()=>F(H=>!H),className:`rounded px-2 py-1 ${Y?"bg-green-600 text-white":"bg-white/20"}`,children:"Quality"}),e.jsx("button",{type:"button",onClick:()=>V(H=>!H),className:`rounded px-2 py-1 ${M?"bg-purple-600 text-white":"bg-white/20"}`,children:"Faces"}),e.jsx("button",{type:"button",onClick:i,className:"bg-white text-black rounded px-2 py-1",children:"Close"})]})]}),e.jsxs("div",{className:"relative bg-black/40 rounded overflow-hidden",onWheel:W,onMouseDown:J,onMouseMove:A,onMouseUp:G,onMouseLeave:$,onDoubleClick:U,onTouchStart:ce,onTouchMove:Q,onTouchEnd:ne,style:{cursor:b>1&&T?"grabbing":b>1?"grab":"default"},children:[e.jsx("img",{ref:p,src:Ne(a,t,s,1024),className:"w-full h-auto select-none",style:{transform:`translate(${k}px, ${f}px) scale(${b})`,transformOrigin:"0 0"},alt:s,draggable:!1}),e.jsx(ll,{imagePath:s,show:Y})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/10 rounded p-1",children:[e.jsx("button",{type:"button",onClick:R,className:"px-2 py-1 bg-white/20 text-white rounded",children:""}),e.jsxs("div",{className:"text-white text-sm w-12 text-center",children:[Math.round(b*100),"%"]}),e.jsx("button",{type:"button",onClick:X,className:"px-2 py-1 bg-white/20 text-white rounded",children:"+"}),e.jsx("button",{type:"button",onClick:K,className:"px-2 py-1 bg-white/20 text-white rounded",children:"Reset"})]}),e.jsx("button",{type:"button",onClick:u,className:"px-3 py-1 bg-gray-200 rounded",children:"Reveal in Finder/Explorer"}),e.jsx("button",{type:"button",onClick:()=>z(!0),className:"px-3 py-1 bg-green-600 text-white rounded",children:" Edit"}),e.jsx("button",{type:"button",onClick:c,className:"px-3 py-1 bg-pink-600 text-white rounded",children:" Favorite"}),l&&e.jsx("button",{type:"button",onClick:l,className:"px-3 py-1 bg-blue-600 text-white rounded",children:"More like this"})]}),h&&e.jsx("div",{className:"mt-3 bg-white text-gray-900 rounded p-3 max-h-72 overflow-auto",children:C?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading EXIF"}):w?e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[w.camera&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Camera"}),e.jsx("div",{className:"font-medium",children:w.camera})]}),w.lens&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Lens"}),e.jsx("div",{className:"font-medium",children:w.lens})]}),w.iso&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"ISO"}),e.jsx("div",{className:"font-medium",children:w.iso})]}),w.fnumber&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Aperture"}),e.jsxs("div",{className:"font-medium",children:["f/",w.fnumber]})]}),w.shutter&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Shutter"}),e.jsx("div",{className:"font-medium",children:w.shutter})]}),w.datetime&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Date"}),e.jsx("div",{className:"font-medium",children:new Date(w.datetime*1e3).toLocaleString()})]}),w.place&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-500",children:"Place"}),e.jsx("div",{className:"font-medium",children:w.place})]}),Array.isArray(w.tags)&&w.tags.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-gray-500",children:"Tags"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:w.tags.map(H=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 rounded text-xs",children:H},H))})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"No metadata."})}),M&&e.jsx("div",{className:"mt-3 bg-white text-gray-900 rounded p-3",children:e.jsx(ol,{imagePath:s,detectedFaces:w?.faces||[],knownPeople:new Map,onVerify:(H,he)=>{console.log("Face verified:",H,he)},onCreateNew:H=>{console.log("New person created:",H)}})}),_&&e.jsx(Xr,{imagePath:s,onSave:H=>{O(H),z(!1)},onClose:()=>z(!1)})]})})}function ml({videoPath:a,videoUrl:t,onClose:s,onNext:r,onPrevious:n}){const i=o.useRef(null),u=o.useRef(null),[c,l]=o.useState(null),[d,p]=o.useState(!1),[b,y]=o.useState(!1),[k,v]=o.useState(0),[f,S]=o.useState(0),[T,P]=o.useState(1),[m,h]=o.useState(!0),[j,C]=o.useState(!0),[E,w]=o.useState(0),[N,_]=o.useState(!1),[z,ee]=o.useState([]),[O,Y]=o.useState(null),[F,M]=o.useState(!1),V=o.useRef();o.useEffect(()=>(se(),()=>{V.current&&clearTimeout(V.current)}),[a,t]);const se=async()=>{C(!0);try{const Q=await De.getVideoInfo(a,t);l(Q),De.extractKeyframes(t,10,120,68).then(ne=>ee(ne)).catch(console.error)}catch(Q){console.error("Failed to load video info:",Q)}finally{C(!1)}},B=()=>{i.current&&(d?i.current.pause():i.current.play(),p(!d))},me=()=>{i.current&&(i.current.muted=!b,y(!b))},L=Q=>{const ne=parseFloat(Q.target.value);P(ne),i.current&&(i.current.volume=ne,y(ne===0))},Z=Q=>{if(i.current&&u.current){const ne=u.current.getBoundingClientRect(),he=(Q.clientX-ne.left)/ne.width*f;i.current.currentTime=he,v(he)}},ie=()=>{if(i.current&&(v(i.current.currentTime),i.current.buffered.length>0)){const Q=i.current.buffered.end(i.current.buffered.length-1);w(Q/f*100)}},W=()=>{i.current&&S(i.current.duration)},J=Q=>{i.current&&(i.current.currentTime+=Q)},A=()=>{i.current&&(document.fullscreenElement?document.exitFullscreen():i.current.requestFullscreen())},G=()=>{h(!0),V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{d&&h(!1)},3e3)},$=Q=>{switch(Q.key){case" ":Q.preventDefault(),B();break;case"ArrowLeft":J(-10);break;case"ArrowRight":J(10);break;case"ArrowUp":P(Math.min(1,T+.1));break;case"ArrowDown":P(Math.max(0,T-.1));break;case"m":me();break;case"f":A();break;case"Escape":s();break}},K=Q=>{if(Q.touches.length===1){const ne=Q.touches[0];Y({x:ne.clientX,y:ne.clientY}),M(!1)}},X=Q=>{if(!O||Q.touches.length!==1)return;const ne=Q.touches[0],H=ne.clientX-O.x,he=ne.clientY-O.y,ye=Math.abs(H),te=Math.abs(he);ye>te&&ye>30&&M(!0)},R=Q=>{if(!O||!F){Y(null),M(!1);return}const H=Q.changedTouches[0].clientX-O.x;Math.abs(H)>50&&(H>0?n&&n():r&&r()),Y(null),M(!1)},U=Q=>De.formatDuration(Q),ce=f>0?k/f*100:0;return e.jsxs("div",{className:"video-lightbox",onMouseMove:G,onKeyDown:$,onTouchStart:K,onTouchMove:X,onTouchEnd:R,tabIndex:0,children:[e.jsx("div",{className:"video-container",children:j?e.jsxs("div",{className:"loading-spinner",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading video..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:i,src:t,onTimeUpdate:ie,onLoadedMetadata:W,onEnded:()=>p(!1),onClick:B,className:"video-player"}),e.jsxs("div",{className:`video-controls ${m?"visible":"hidden"}`,children:[e.jsxs("div",{className:"timeline-container",children:[e.jsxs("div",{ref:u,className:"progress-bar",onClick:Z,children:[e.jsx("div",{className:"buffered-bar",style:{width:`${E}%`}}),e.jsx("div",{className:"progress-fill",style:{width:`${ce}%`}}),e.jsx("div",{className:"progress-handle",style:{left:`${ce}%`}}),z.length>0&&e.jsx("div",{className:"keyframes",children:z.map((Q,ne)=>e.jsx("img",{src:Q,className:"keyframe",style:{left:`${(ne+1)*(100/(z.length+1))}%`},alt:""},ne))})]}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:U(k)}),e.jsx("span",{className:"separator",children:"/"}),e.jsx("span",{children:U(f)})]})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsxs("div",{className:"controls-left",children:[e.jsx("button",{onClick:B,className:"control-btn",children:d?e.jsx(Ps,{}):e.jsx(dt,{})}),e.jsx("button",{onClick:()=>J(-10),className:"control-btn",children:e.jsx(va,{})}),e.jsx("button",{onClick:()=>J(10),className:"control-btn",children:e.jsx(ja,{})}),e.jsxs("div",{className:"volume-control",children:[e.jsx("button",{onClick:me,className:"control-btn",children:b||T===0?e.jsx(Vn,{}):e.jsx(Hn,{})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:T,onChange:L,className:"volume-slider"})]})]}),e.jsxs("div",{className:"controls-right",children:[e.jsx("button",{onClick:()=>_(!N),className:"control-btn",children:e.jsx(Is,{})}),e.jsx("button",{onClick:A,className:"control-btn",children:e.jsx(Va,{})}),e.jsx("a",{href:t,download:a.split("/").pop(),className:"control-btn",children:e.jsx(Me,{})})]})]})]}),N&&c&&e.jsxs("div",{className:"video-info-overlay",children:[e.jsx("h3",{children:a.split("/").pop()}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{children:["Format: ",c.format]}),e.jsxs("div",{children:["Resolution: ",c.metadata.width,"",c.metadata.height]}),e.jsxs("div",{children:["Duration: ",U(c.metadata.duration)]}),e.jsxs("div",{children:["Codec: ",c.metadata.codec]}),e.jsxs("div",{children:["Quality: ",De.getResolutionLabel(c.metadata.width,c.metadata.height)]}),e.jsxs("div",{children:["Audio: ",c.metadata.hasAudio?"Yes":"No"]})]})]})]})}),n&&e.jsx("button",{onClick:n,className:"nav-btn nav-prev",children:e.jsx(va,{})}),r&&e.jsx("button",{onClick:r,className:"nav-btn nav-next",children:e.jsx(ja,{})}),e.jsx("button",{onClick:s,className:"close-btn",children:""}),e.jsx("style",{jsx:!0,children:`
        .video-lightbox {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.95);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
        }

        .video-container {
          position: relative;
          width: 90%;
          max-width: 1200px;
          height: 80vh;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .video-player {
          width: 100%;
          height: 100%;
          object-fit: contain;
          cursor: pointer;
        }

        .video-controls {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
          padding: 2rem 1rem 1rem;
          transition: opacity 0.3s;
        }

        .video-controls.hidden {
          opacity: 0;
          pointer-events: none;
        }

        .timeline-container {
          margin-bottom: 1rem;
        }

        .progress-bar {
          position: relative;
          height: 6px;
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
          cursor: pointer;
          margin-bottom: 0.5rem;
        }

        .progress-bar:hover {
          height: 10px;
        }

        .buffered-bar {
          position: absolute;
          height: 100%;
          background: rgba(255, 255, 255, 0.3);
          border-radius: 3px;
        }

        .progress-fill {
          position: absolute;
          height: 100%;
          background: var(--accent-primary);
          border-radius: 3px;
        }

        .progress-handle {
          position: absolute;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 14px;
          height: 14px;
          background: white;
          border-radius: 50%;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .keyframes {
          position: absolute;
          top: -80px;
          left: 0;
          right: 0;
          height: 68px;
          opacity: 0;
          transition: opacity 0.2s;
          pointer-events: none;
        }

        .progress-bar:hover .keyframes {
          opacity: 1;
        }

        .keyframe {
          position: absolute;
          height: 68px;
          width: 120px;
          object-fit: cover;
          border: 2px solid white;
          border-radius: 4px;
          transform: translateX(-50%);
        }

        .time-display {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: white;
          font-size: 0.875rem;
        }

        .control-buttons {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .controls-left, .controls-right {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .control-btn {
          background: none;
          border: none;
          color: white;
          cursor: pointer;
          padding: 0.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: opacity 0.2s;
        }

        .control-btn:hover {
          opacity: 0.7;
        }

        .control-btn svg {
          width: 20px;
          height: 20px;
        }

        .volume-control {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .volume-slider {
          width: 80px;
          opacity: 0;
          transition: opacity 0.2s;
        }

        .volume-control:hover .volume-slider {
          opacity: 1;
        }

        .video-info-overlay {
          position: absolute;
          top: 2rem;
          left: 2rem;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 1.5rem;
          border-radius: 8px;
          max-width: 400px;
        }

        .video-info-overlay h3 {
          margin-bottom: 1rem;
          font-size: 1.125rem;
        }

        .info-grid {
          display: grid;
          gap: 0.5rem;
          font-size: 0.875rem;
        }

        .nav-btn {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(0, 0, 0, 0.5);
          border: none;
          color: white;
          padding: 1rem;
          cursor: pointer;
          transition: background 0.2s;
        }

        .nav-btn:hover {
          background: rgba(0, 0, 0, 0.8);
        }

        .nav-prev {
          left: 1rem;
        }

        .nav-next {
          right: 1rem;
        }

        .close-btn {
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: none;
          border: none;
          color: white;
          font-size: 2rem;
          cursor: pointer;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .loading-spinner {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 1rem;
          color: white;
        }

        .spinner {
          width: 48px;
          height: 48px;
          border: 3px solid rgba(255, 255, 255, 0.2);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function xl({dir:a,engine:t,library:s,onLoadLibrary:r,selected:n=new Set,onToggleSelect:i,onOpen:u,tagsMap:c={}}){const[l,d]=o.useState("name"),[p,b]=o.useState("asc"),[y,k]=o.useState(!1),v=o.useCallback(h=>{const j=h.split("/").pop()||h,C=j.split(".").pop()?.toLowerCase()||"",w=(c[h]||[]).find(_=>_.startsWith("rating:")),N=w?parseInt(w.split(":")[1]):0;return{name:j,ext:C,rating:N,isVideo:De.isVideoFile(h)}},[c]),f=o.useMemo(()=>s.length?[...s].sort((h,j)=>{const C=v(h),E=v(j);let w=0;switch(l){case"name":w=C.name.localeCompare(E.name);break;case"rating":w=E.rating-C.rating;break;case"date":w=h.localeCompare(j);break;case"size":w=C.name.localeCompare(E.name);break;case"camera":w=C.name.localeCompare(E.name);break;default:w=0}return p==="desc"?-w:w}):[],[s,l,p,v]),S=o.useMemo(()=>{const h=s.length,j=s.filter(N=>De.isVideoFile(N)).length,C=h-j,E=n.size,w={1:0,2:0,3:0,4:0,5:0};return s.forEach(N=>{const z=(c[N]||[]).find(ee=>ee.startsWith("rating:"));if(z){const ee=parseInt(z.split(":")[1]);ee>=1&&ee<=5&&w[ee]++}}),{total:h,photos:C,videos:j,selected:E,ratings:w}},[s,n,c]),T=h=>{l===h?b(j=>j==="asc"?"desc":"asc"):(d(h),b("asc"))},P=()=>{i&&s.forEach(h=>{n.has(h)||i(h)})},m=()=>{i&&Array.from(n).forEach(h=>{i(h)})};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"font-semibold",children:"Library"}),e.jsx("button",{onClick:()=>k(!y),className:`p-1 rounded ${y?"bg-blue-100 text-blue-600":"text-gray-500 hover:bg-gray-100"}`,title:"Toggle statistics",children:e.jsx(Wn,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Gn,{className:"w-3 h-3 text-gray-400"}),e.jsxs("select",{value:l,onChange:h=>T(h.target.value),className:"text-xs border rounded px-1 py-0.5",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"rating",children:"Rating"}),e.jsx("option",{value:"size",children:"Size"}),e.jsx("option",{value:"camera",children:"Camera"})]}),e.jsx("button",{onClick:()=>b(h=>h==="asc"?"desc":"asc"),className:"text-xs text-gray-500 hover:text-gray-700",title:`Sort ${p==="asc"?"descending":"ascending"}`,children:p==="asc"?"":""})]}),i&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("button",{onClick:P,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"All"}),e.jsx("button",{onClick:m,className:"bg-gray-200 rounded px-2 py-0.5 hover:bg-gray-300",children:"None"})]}),e.jsx("button",{onClick:()=>r(120,0),className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Reload"})]})]}),y&&s.length>0&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 rounded text-xs",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Total: ",S.total]}),e.jsxs("div",{className:"text-gray-600",children:["Photos: ",S.photos]}),e.jsxs("div",{className:"text-gray-600",children:["Videos: ",S.videos]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Selected: ",S.selected]}),e.jsx("div",{className:"text-gray-600",children:S.selected>0&&`${(S.selected/S.total*100).toFixed(1)}%`})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Ratings:"}),e.jsx("div",{className:"flex gap-1",children:Object.entries(S.ratings).map(([h,j])=>e.jsxs("span",{className:"text-gray-600",title:`${h} stars: ${j} photos`,children:[h,":",j]},h))})]})]})}),n.size>0&&e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[n.size," item",n.size!==1?"s":""," selected"]}),s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No items yet. Build the index, then click Reload."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:f.map((h,j)=>{const C=n.has(h),E=v(h);return e.jsxs("div",{className:`relative group cursor-pointer rounded overflow-hidden ${C?"ring-2 ring-blue-500":""}`,onClick:()=>u?u(h):void 0,children:[i&&e.jsx("button",{onClick:w=>{w.stopPropagation(),i(h)},className:`absolute top-1 left-1 z-10 w-5 h-5 rounded border-2 flex items-center justify-center
                      ${C?"bg-blue-600 border-blue-600":"bg-white/80 border-gray-300 opacity-0 group-hover:opacity-100"} transition-opacity`,children:C&&e.jsx(ut,{className:"w-3 h-3 text-white"})}),e.jsx("img",{src:Ne(a,t,h,196),alt:E.name,title:`${E.name}${E.rating>0?` - ${"".repeat(E.rating)}`:""}`,className:"w-full h-24 object-cover"}),E.isVideo&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/40 transition-colors",children:e.jsx("div",{className:"w-8 h-8 bg-black/60 rounded-full flex items-center justify-center",children:e.jsx(dt,{className:"w-4 h-4 text-white ml-0.5"})})}),E.rating>0&&e.jsx("div",{className:"absolute top-1 right-1 bg-black/60 text-white text-xs px-1 rounded",children:"".repeat(E.rating)}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"p-1 text-white text-xs truncate",children:E.name})})]},h)})})]})}function pl({dir:a,engine:t,clusters:s,persons:r,setPersons:n,busy:i,setBusy:u,setNote:c,onLoadFaces:l,onOpenPhotos:d}){const[p,b]=o.useState(null),[y,k]=o.useState([]),[v,f]=o.useState(!1),S=async T=>{try{u("Loading photos...");const P=await zr(a,T);k(P.photos),b(T),f(!0),u(""),c(`Found ${P.photos.length} photos in cluster`)}catch(P){u(""),c(P.message)}};return v&&p?e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Photos in Cluster"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(!1),className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Back"}),e.jsxs("button",{onClick:()=>d?.(y),className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:["View All (",y.length,")"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:y.map((T,P)=>e.jsx("img",{src:Ne(a,t,T,196),alt:`Photo ${P+1}`,className:"w-full h-24 object-cover rounded cursor-pointer hover:ring-2 hover:ring-blue-500",onClick:()=>d?.([T])},P))})]}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"People"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{try{u("Scanning faces");const T=await ta(a,t);u(""),c(`Faces: ${T.faces}, clusters: ${T.clusters}`),await l()}catch(T){u(""),c(T.message)}},className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build/Update"}),e.jsx("button",{onClick:l,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),s.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No face clusters yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-sm",children:s.map(T=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:T.name||`Cluster ${T.id}`,children:T.name||`Cluster ${T.id}`}),e.jsx("div",{className:"text-xs text-gray-600",children:T.size})]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-1",children:T.examples.map(([P,m],h)=>e.jsx("img",{src:Xs(a,t,P,m,196),className:"w-full h-16 object-cover rounded"},h))}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{const P=T.name||"";if(!P)return;const m=r.includes(P)?r.filter(h=>h!==P):[...r,P];n(m)},disabled:!T.name,className:`px-2 py-1 rounded text-xs ${T.name&&r.includes(T.name)?"bg-blue-700 text-white":T.name?"bg-blue-600 text-white":"bg-gray-200"}`,children:T.name&&r.includes(T.name)?"Remove":"Add"}),e.jsx("button",{onClick:async()=>{const P=prompt("Name this person as",T.name||"")||"";if(P.trim())try{await aa(a,String(T.id),P.trim()),await l()}catch{}},className:"px-2 py-1 rounded bg-gray-200 text-xs",children:"Name"})]}),e.jsxs("button",{onClick:()=>S(T.id),className:"px-2 py-1 rounded bg-green-600 text-white text-xs w-full",children:["View Photos (",T.size,")"]})]})]},T.id))}),r.length>0&&e.jsxs("div",{className:"mt-2 text-sm flex items-center gap-2 flex-wrap",children:[r.map(T=>e.jsxs("span",{className:"px-2 py-1 bg-blue-600 text-white rounded flex items-center gap-2",children:[T," ",e.jsx("button",{onClick:()=>n(r.filter(P=>P!==T)),className:"bg-white/20 rounded px-1",children:""})]},T)),e.jsx("button",{onClick:()=>n([]),className:"px-2 py-1 bg-gray-200 rounded",children:"Clear"})]})]})}function gl({points:a,onLoadMap:t}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Map (GPS)"}),e.jsx("button",{onClick:t,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Load"})]}),a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No GPS points found."}):e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 text-xs",children:a.map((s,r)=>e.jsxs("div",{className:"border rounded p-2",children:[s.lat.toFixed(5),", ",s.lon.toFixed(5)]},r))})]})}function fl({dir:a,engine:t,collections:s,onLoadCollections:r,onOpen:n,onDelete:i,onShare:u,onExport:c,selectedPhotos:l=[],onCollectionUpdate:d}){const[p,b]=o.useState(null),[y,k]=o.useState(null),[v,f]=o.useState(!1),[S,T]=o.useState(""),[P,m]=o.useState(!1),[h,j]=o.useState(null),C=o.useRef(0),E=o.useCallback(async()=>{if(!(!S.trim()||P)){m(!0);try{if(await Kt(a,S.trim(),l),T(""),f(!1),r(),d){const F={...s,[S.trim()]:l};d(F)}}catch(F){console.error("Failed to create collection:",F),alert(F instanceof Error?F.message:"Failed to create collection")}finally{m(!1)}}},[S,l,a,r,s,d]),w=o.useCallback((F,M)=>{const V={type:"collection",data:M,name:M};b(V),F.dataTransfer.effectAllowed="move",F.dataTransfer.setData("text/plain",JSON.stringify(V))},[]),N=o.useCallback((F,M)=>{F.preventDefault(),F.dataTransfer.dropEffect="copy",k(M)},[]),_=o.useCallback((F,M)=>{F.preventDefault(),C.current++,k(M)},[]),z=o.useCallback(F=>{C.current--,C.current===0&&k(null)},[]),ee=o.useCallback(async(F,M)=>{F.preventDefault(),C.current=0,k(null);try{const V=F.dataTransfer.getData("text/plain");let se;if(V)se=JSON.parse(V);else{if(!p)return;se=p}if(se.type==="photo"){const B=Array.isArray(se.data)?se.data:[se.data],me=s[M]||[],L=Array.from(new Set([...me,...B]));if(await Kt(a,M,L),r(),d){const Z={...s,[M]:L};d(Z)}}}catch(V){console.error("Failed to update collection:",V),alert("Failed to update collection")}finally{b(null)}},[s,a,r,d,p]),O=o.useCallback(async F=>{if(u)u(F,s[F]||[]);else try{const M=s[F]||[];if(M.length===0){alert("Collection is empty");return}const V=await Bs(a,t,M,{expiryHours:24,viewOnly:!0});await navigator.clipboard.writeText(window.location.origin+V.url),alert("Share link copied to clipboard!")}catch(M){console.error("Failed to share collection:",M),alert(M instanceof Error?M.message:"Failed to share collection")}},[u,s,a,t]),Y=o.useCallback(async F=>{if(c)c(F,s[F]||[]);else{const M=prompt(`Export collection "${F}" to folder:`,F);if(!M)return;try{const V=s[F]||[];if(V.length===0){alert("Collection is empty");return}await pt(a,V,M,"copy",!1,!1),alert(`Exported ${V.length} photos to ${M}`)}catch(V){console.error("Failed to export collection:",V),alert(V instanceof Error?V.message:"Failed to export collection")}}},[c,s,a]);return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-semibold",children:"Collections"}),l.length>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[l.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.length>0&&e.jsxs("button",{onClick:()=>f(!0),className:"bg-green-600 text-white rounded px-3 py-1 text-sm hover:bg-green-700 flex items-center gap-1",children:[e.jsx(Wa,{className:"w-3 h-3"}),"New"]}),e.jsx("button",{onClick:r,className:"bg-gray-200 rounded px-3 py-1 text-sm hover:bg-gray-300",children:"Refresh"})]})]}),v&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4 text-blue-600"}),e.jsx("input",{type:"text",placeholder:"Collection name",value:S,onChange:F=>T(F.target.value),className:"flex-1 border rounded px-2 py-1 text-sm",onKeyDown:F=>{F.key==="Enter"&&E(),F.key==="Escape"&&f(!1)},autoFocus:!0}),e.jsx("button",{onClick:E,disabled:!S.trim()||P,className:"bg-blue-600 text-white px-3 py-1 text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:P?"Creating...":"Create"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700 px-2 py-1 text-sm",children:"Cancel"})]}),l.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["Will add ",l.length," selected photo",l.length!==1?"s":""]})]}),Object.keys(s||{}).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ks,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"No collections yet"}),l.length>0?e.jsxs("button",{onClick:()=>f(!0),className:"text-sm text-blue-600 hover:text-blue-800",children:["Create your first collection with ",l.length," selected photo",l.length!==1?"s":""]}):e.jsx("div",{className:"text-xs text-gray-500",children:"Select photos and create collections to organize them"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:Object.keys(s).map(F=>{const M=y===F,V=s[F]||[];return e.jsxs("div",{draggable:!0,onDragStart:se=>w(se,F),onDragOver:se=>N(se,F),onDragEnter:se=>_(se,F),onDragLeave:z,onDrop:se=>ee(se,F),className:`border rounded-lg p-3 transition-all cursor-move ${M?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"} ${h===F?"ring-2 ring-blue-200":""}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(Kn,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:F,children:F}),e.jsxs("div",{className:"text-xs text-gray-600",children:[V.length," item",V.length!==1?"s":"",M&&e.jsx("span",{className:"ml-2 text-blue-600 font-medium",children:"Drop here to add"})]})]})]}),e.jsxs("div",{className:"flex gap-1 mb-3 overflow-hidden",children:[V.slice(0,4).map((se,B)=>e.jsx("img",{src:Ne(a,t,se,96),alt:se.split("/").pop()||se,className:`object-cover rounded ${V.length===1?"w-full h-20":V.length===2?"w-1/2 h-16":"w-1/4 h-12"}`},se)),V.length>4&&e.jsxs("div",{className:"w-1/4 h-12 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:["+",V.length-4]}),V.length===0&&e.jsx("div",{className:"w-full h-16 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500",children:"Empty collection"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>n(F),className:"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 text-xs",children:"Open"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>O(F),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-blue-600",title:"Share collection",disabled:V.length===0,children:e.jsx(Zt,{className:"w-3 h-3"})}),e.jsx("button",{type:"button",onClick:()=>Y(F),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-green-600",title:"Export collection",disabled:V.length===0,children:e.jsx(Me,{className:"w-3 h-3"})}),i&&e.jsx("button",{type:"button",onClick:()=>i(F),className:"p-1 rounded hover:bg-gray-100 text-gray-600 hover:text-red-600",title:"Delete collection",children:e.jsx(He,{className:"w-3 h-3"})})]})]})]},F)})}),l.length>0&&Object.keys(s||{}).length>0&&e.jsx("div",{className:"mt-3 text-xs text-center text-gray-500 border-t pt-2",children:" Drag photos onto collections to add them, or create a new collection above"})]})}function bl(){const a=zs(),t=dr(),s=o.useMemo(()=>a.pathname.split("/").filter(Boolean)[1]||"",[a.pathname]),[r,n]=o.useState(null),[i,u]=o.useState(""),[c,l]=o.useState(""),[d,p]=o.useState(!1);async function b(){p(!0),l("");try{const k=new URLSearchParams({token:s});i.trim()&&k.set("password",i.trim());const f=await(await fetch(`${ue}/share/detail?${k.toString()}`)).json();n(f),f.ok||(f.error==="expired"?l("This link has expired"):f.error==="password_required"?l("Password required or incorrect"):l("Unable to open share"))}catch(k){l(k instanceof Error?k.message:"Failed to load share")}finally{p(!1)}}if(o.useEffect(()=>{s&&b()},[s]),!s)return e.jsx("div",{className:"h-screen bg-gray-950 text-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl mb-2",children:"Invalid share link"}),e.jsx("button",{className:"px-3 py-1 rounded bg-gray-800 border border-gray-700",onClick:()=>t("/"),children:"Back"})]})});const y=r?.ok&&r?.paths&&r?.dir;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-gray-100",children:[e.jsxs("header",{className:"px-4 py-3 border-b border-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:"Shared Photos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r?.expires&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Expires ",new Date(r.expires).toLocaleString()]}),e.jsx("button",{className:"px-2 py-1 rounded bg-gray-800 border border-gray-700 text-sm",onClick:()=>t("/"),children:"Back"})]})]}),e.jsxs("main",{className:"p-4",children:[(!r||!r.ok&&r.error==="password_required")&&e.jsxs("div",{className:"max-w-md mx-auto",children:[c&&e.jsx("div",{className:"mb-2 text-red-400 text-sm",children:c}),e.jsx("label",{className:"block text-sm mb-1",children:"Password"}),e.jsx("input",{className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded",value:i,onChange:k=>u(k.target.value),placeholder:"Enter password (if required)",type:"password"}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:b,disabled:d,children:d?"Opening":"Open"})})]}),r&&!r.ok&&r.error==="expired"&&e.jsx("div",{className:"text-center text-gray-300",children:"This link has expired."}),y&&e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))"},children:r.paths.map(k=>e.jsx("div",{className:"border border-gray-800 rounded overflow-hidden bg-gray-900",children:e.jsx("img",{src:Ne(r.dir,r.provider||"local",k,256),alt:"photo",className:"w-full h-[140px] object-cover"})},k))})]})]})}function yl({dir:a,engine:t,topK:s,smart:r,setSmart:n,setResults:i,setSearchId:u,setNote:c,query:l,favOnly:d,tagFilter:p,useCaps:b,useOcr:y,hasText:k,camera:v,isoMin:f,isoMax:S,fMin:T,fMax:P,place:m,persons:h}){const j=async()=>{const N=(prompt("Save current search as Smart (name):")||"").trim();if(N)try{const _=p.split(",").map(M=>M.trim()).filter(Boolean),z={query:l,favoritesOnly:d,tags:_,useCaptions:b,useOcr:y,hasText:k,camera:v||void 0,isoMin:f?parseInt(f,10):void 0,isoMax:S?parseInt(S,10):void 0,fMin:T?parseFloat(T):void 0,fMax:P?parseFloat(P):void 0,place:m||void 0},ee=h.filter(Boolean);ee.length===1?z.person=ee[0]:ee.length>1&&(z.persons=ee);const{apiSetSmart:O,apiGetSmart:Y}=await pe(async()=>{const{apiSetSmart:M,apiGetSmart:V}=await Promise.resolve().then(()=>ge);return{apiSetSmart:M,apiGetSmart:V}},void 0,import.meta.url);await O(a,N,z);const F=await Y(a);n(F.smart||{}),c("Saved smart collection")}catch(_){c(_.message||"Failed to save smart")}},C=async()=>{try{const{apiGetSmart:N}=await pe(async()=>{const{apiGetSmart:z}=await Promise.resolve().then(()=>ge);return{apiGetSmart:z}},void 0,import.meta.url),_=await N(a);n(_.smart||{})}catch(N){c(N.message||"Failed to load smart")}},E=async N=>{try{const{apiResolveSmart:_}=await pe(async()=>{const{apiResolveSmart:ee}=await Promise.resolve().then(()=>ge);return{apiResolveSmart:ee}},void 0,import.meta.url),z=await _(a,N,t,s);i(z.results||[]),u(z.search_id||""),c(`Opened smart: ${N}`)}catch(_){c(_.message)}},w=async N=>{if(confirm(`Delete smart collection "${N}"?`))try{const{apiDeleteSmart:_,apiGetSmart:z}=await pe(async()=>{const{apiDeleteSmart:O,apiGetSmart:Y}=await Promise.resolve().then(()=>ge);return{apiDeleteSmart:O,apiGetSmart:Y}},void 0,import.meta.url);await _(a,N);const ee=await z(a);n(ee.smart||{})}catch(_){c(_.message)}};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Smart Collections"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"}),e.jsx("button",{onClick:j,className:"bg-blue-600 text-white rounded px-3 py-1 text-sm",children:"Save current as Smart"})]})]}),Object.keys(r||{}).length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No smart collections yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.keys(r).map(N=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:N,children:N}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E(N),className:"px-2 py-1 bg-blue-600 text-white rounded",children:"Open"}),e.jsx("button",{onClick:()=>w(N),className:"px-2 py-1 bg-red-600 text-white rounded",children:"Delete"})]})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 truncate",children:JSON.stringify(r[N])})]},N))})]})}function Ra({dir:a,engine:t,setBusy:s,setNote:r,setResults:n}){const i=async()=>{try{const{apiTripsBuild:l}=await pe(async()=>{const{apiTripsBuild:p}=await Promise.resolve().then(()=>ge);return{apiTripsBuild:p}},void 0,import.meta.url);s("Grouping trips");const d=await l(a,t);s(""),window._trips=d.trips||[],r(`Trips: ${d.trips?.length||0}`)}catch(l){s(""),r(l.message)}},u=async()=>{try{const{apiTripsList:l}=await pe(async()=>{const{apiTripsList:p}=await Promise.resolve().then(()=>ge);return{apiTripsList:p}},void 0,import.meta.url),d=await l(a);window._trips=d.trips||[],r(`Loaded ${d.trips.length} trips`)}catch(l){r(l.message)}},c=l=>{n((l.paths||[]).map(d=>({path:d,score:1}))),r("Opened trip")};return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Trips"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:i,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Build"}),e.jsx("button",{onClick:u,className:"bg-gray-200 rounded px-3 py-1 text-sm",children:"Refresh"})]})]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:window._trips?.slice(0,6)?.map((l,d)=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate",title:l.place||"",children:l.place||"Trip"}),e.jsx("div",{children:l.count})]}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-1",children:(l.paths||[]).slice(0,3).map((p,b)=>e.jsx("img",{src:Ne(a,t,p,196),className:"w-full h-16 object-cover rounded"},b))}),e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx("button",{onClick:()=>c(l),className:"bg-blue-600 text-white rounded px-3 py-1",children:"Open"})})]},l.id||d))})]})}function vl({saved:a,onRun:t,onDelete:s}){return e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"font-semibold",children:"Saved Searches"})}),!a||a.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No saved searches yet."}):e.jsx("div",{className:"mt-2 divide-y",children:a.map(r=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:r.name,children:r.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:r.query,children:r.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:()=>t(r.name,r.query,r.top_k),className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{onClick:()=>s(r.name),className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},r.name))})]})}function jl(a){const t=a.split(/\r?\n/),s=[];let r=[];function n(){r.length&&(s.push(e.jsx("ul",{className:"list-disc ml-6 space-y-1",children:r.map((i,u)=>e.jsx("li",{children:i},u))},`ul-${s.length}`)),r=[])}return t.forEach((i,u)=>{const c=i.match(/^(#+)\s+(.*)$/);if(c){n();const d=c[1].length,p=c[2],b=d===1?"h1":d===2?"h2":"h3";s.push(e.jsx(b,{className:"font-semibold mt-4",children:p},`h-${u}`));return}const l=i.match(/^[-*]\s+(.*)$/);if(l){const d=l[1],p=d.match(/^\[( |x|X)\]\s+(.*)$/);if(p){const b=p[1].toLowerCase()==="x",y=p[2];r.push(e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",disabled:!0,checked:b}),e.jsx("span",{children:y})]}))}else r.push(e.jsx("span",{children:d}));return}if(i.trim()===""){n(),s.push(e.jsx("div",{className:"h-2"},`sp-${u}`));return}n(),s.push(e.jsx("p",{children:i},`p-${u}`))}),n(),s}function wl(){const a=Yr(),t=al(),[s,r]=o.useState(""),[n,i]=o.useState(!0),[u,c]=o.useState(""),[l,d]=o.useState([]),[p,b]=o.useState(!1),[y,k]=o.useState(null),[v,f]=o.useState(!1),S=async()=>{try{i(!0);const h=await Yt();r(h.text||"")}catch(h){c(String(h))}finally{i(!1)}},T=async()=>{if(!a){d([]);return}try{f(!0);const h=await Gt(a,200);d(h.events||[])}catch{}finally{f(!1)}},P=h=>{try{const j=new Date(h).getTime(),C=Date.now(),E=Math.max(0,C-j),w=Math.floor(E/1e3);if(w<60)return`${w}s ago`;const N=Math.floor(w/60);if(N<60)return`${N}m ago`;const _=Math.floor(N/60);return _<24?`${_}h ago`:`${Math.floor(_/24)}d ago`}catch{return h}};o.useEffect(()=>{let h=!1;return Yt().then(j=>{h||(r(j.text||""),i(!1))}).catch(j=>{h||(c(String(j)),i(!1))}),()=>{h=!0}},[]),o.useEffect(()=>{let h=!1;if(!a){d([]);return}Gt(a,200).then(C=>{h||d(C.events||[])}).catch(()=>{});const j=window.setInterval(()=>{h||T()},3e4);return()=>{h=!0,window.clearInterval(j)}},[a]);const m=async()=>{if(a)try{b(!0),k(null);const h=await ra(a,t),j=typeof h.updated=="number"?h.updated:0;if(j>0)k(`Updated tags for ${j} photo${j===1?"":"s"}`);else if(h.tags){const C=Object.keys(h.tags||{}).length;k(`Generated tags for ${C} photo${C===1?"":"s"}`)}else k("No changes")}catch(h){k(`Error: ${h.message}`)}finally{b(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Project Tasks (TODO.md)"}),e.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:S,disabled:n,title:"Refresh TODO.md",children:"Refresh"})]}),n?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading"}):u?e.jsx("div",{className:"text-sm text-red-600",children:u}):e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:jl(s)}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Auto-tag Photos"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 border rounded p-3 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Generate smart tags for your photos using AI analysis. This will analyze photo content and automatically assign relevant tags."}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:m,disabled:p||!a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Generating Tags...":"Generate Auto Tags"})}),y&&e.jsx("div",{className:`p-2 rounded text-sm ${y.startsWith("Error:")?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"}`,children:y})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Recent Events"}),e.jsx("button",{className:"text-sm px-2 py-1 border rounded disabled:opacity-50",onClick:T,disabled:v||!a,title:"Refresh events",children:v?"Refreshing":"Refresh"})]}),e.jsx("div",{className:"border rounded divide-y",children:l.length===0?e.jsx("div",{className:"p-2 text-sm text-gray-600",children:"No recent events."}):l.map((h,j)=>e.jsxs("div",{className:"p-2 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:h.type}),e.jsx("span",{children:h.query?`"${h.query}"`:h.token?`share:${h.token.slice(0,6)}`:""})]}),e.jsx("div",{className:"text-gray-500",title:new Date(h.time).toLocaleString(),children:P(h.time)})]},j))})]})]})}function Nl({dir:a,engine:t,items:s,selected:r,onToggleSelect:n,onOpen:i,showInfoOverlay:u,bucket:c="day"}){const[l,d]=o.useState({}),[p,b]=o.useState(new Set);o.useEffect(()=>{const h=s.slice(0,200).map(E=>E.path).filter(E=>!l[E]&&!p.has(E)).slice(0,32);if(h.length===0)return;const j=new Set(p);h.forEach(E=>j.add(E)),b(j);let C=!1;return Promise.all(h.map(async E=>{try{const w=await xt(a,E);!C&&w&&w.meta&&d(N=>({...N,[E]:{mtime:w.meta.mtime,camera:w.meta.camera,fnumber:w.meta.fnumber,iso:w.meta.iso}}))}catch{}})).finally(()=>{C||b(E=>{const w=new Set(E);return h.forEach(N=>w.delete(N)),w})}),()=>{C=!0}},[s,a,l,p]);const y=o.useMemo(()=>{const h=z=>!z||!isFinite(z)?"Unknown":new Date(z*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),j=z=>!z||!isFinite(z)?"Unknown":new Date(z*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}),C=z=>{if(!z||!isFinite(z))return"Unknown";const ee=new Date(z*1e3),O=new Date(Date.UTC(ee.getFullYear(),ee.getMonth(),ee.getDate())),Y=O.getUTCDay()||7;O.setUTCDate(O.getUTCDate()+4-Y);const F=new Date(Date.UTC(O.getUTCFullYear(),0,1)),M=Math.ceil(((O.getTime()-F.getTime())/864e5+1)/7);return`${O.getUTCFullYear()}  W${String(M).padStart(2,"0")}`},E=z=>c==="month"?j(z):c==="week"?C(z):h(z),w=s.map(z=>({it:z,ts:l[z.path]?.mtime}));w.sort((z,ee)=>(ee.ts||0)-(z.ts||0));const N={};for(const{it:z,ts:ee}of w){const O=E(ee);N[O]||(N[O]=[]),N[O].push(z)}const _=Object.keys(N);return _.sort((z,ee)=>z==="Unknown"?1:ee==="Unknown"?-1:0),_.map(z=>({key:z,items:N[z]}))},[s,l,c]),k=o.useMemo(()=>{const h=new Set;if(c==="week")for(const j of y){const C=j.items[0]?.path,E=C?l[C]?.mtime:void 0;if(E&&isFinite(E)){const w=new Date(E*1e3);h.add(w.toLocaleDateString(void 0,{year:"numeric",month:"short"}))}}else for(const j of y){const C=j.key.split(" ");C.length>=2&&h.add(`${C[0]} ${C[1]}`)}return Array.from(h)},[y,c,l]),v=o.useMemo(()=>{const h={};if(c==="week")for(const j of y){const C=j.items[0]?.path,E=C?l[C]?.mtime:void 0;if(E&&isFinite(E)){const N=new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});h[N]=(h[N]||0)+j.items.length}}else for(const j of y){const C=j.key.split(" ").slice(0,2).join(" ");h[C]=(h[C]||0)+j.items.length}return h},[y,c,l]),f=o.useMemo(()=>Object.values(v).reduce((h,j)=>Math.max(h,j||0),0)||1,[v]),S=o.useRef({}),T=o.useRef(null),[P,m]=o.useState(null);return o.useEffect(()=>{const h=T.current;if(!h)return;const j=new IntersectionObserver(C=>{for(const E of C)if(E.isIntersecting){const w=E.target.dataset.month||null;w&&m(w)}},{root:h,threshold:.1});return Object.values(S.current).forEach(C=>C&&j.observe(C)),()=>j.disconnect()},[y]),o.useEffect(()=>{const h=j=>{try{const C=j?.detail?.kind;if(!C)return;const E=Date.now()/1e3;if(C==="today"){const w=c==="month"?new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const _=new Date(E*1e3),z=new Date(Date.UTC(_.getFullYear(),_.getMonth(),_.getDate())),ee=z.getUTCDay()||7;z.setUTCDate(z.getUTCDate()+4-ee);const O=new Date(Date.UTC(z.getUTCFullYear(),0,1)),Y=Math.ceil(((z.getTime()-O.getTime())/864e5+1)/7);return`${z.getUTCFullYear()}  W${String(Y).padStart(2,"0")}`})():new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"});S.current[w]?.scrollIntoView({behavior:"smooth",block:"start"})}else if(C==="this-month"){const w=new Date(E*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(S.current).find(_=>_?.dataset.month&&_.dataset.month.startsWith(w))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(C==="last-month"){const w=new Date,_=new Date(w.getFullYear(),w.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(S.current).find(ee=>ee?.dataset.month&&ee.dataset.month.startsWith(_))?.scrollIntoView({behavior:"smooth",block:"start"})}else if(C==="oldest"){const w=Object.keys(S.current);w.length>0&&S.current[w[w.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})}}catch{}};return window.addEventListener("timeline-jump",h),()=>window.removeEventListener("timeline-jump",h)},[c]),e.jsxs("div",{ref:T,className:"space-y-8 relative",style:{scrollSnapType:"y proximity"},children:[e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-4 z-10 bg-blue-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=Date.now()/1e3,j=c==="month"?new Date(h*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"}):c==="week"?(()=>{const E=new Date(h*1e3),w=new Date(Date.UTC(E.getFullYear(),E.getMonth(),E.getDate())),N=w.getUTCDay()||7;w.setUTCDate(w.getUTCDate()+4-N);const _=new Date(Date.UTC(w.getUTCFullYear(),0,1)),z=Math.ceil(((w.getTime()-_.getTime())/864e5+1)/7);return`${w.getUTCFullYear()}  W${String(z).padStart(2,"0")}`})():new Date(h*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"}),C=S.current[j];C&&C.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to today",children:"Today"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-14 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=Date.now()/1e3,j=new Date(h*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(S.current).find(E=>E?.dataset.month&&E.dataset.month.startsWith(j))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to this month",children:"This Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-20 z-10 bg-gray-700 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=new Date,C=new Date(h.getFullYear(),h.getMonth()-1,1).toLocaleDateString(void 0,{year:"numeric",month:"short"});Object.values(S.current).find(w=>w?.dataset.month&&w.dataset.month.startsWith(C))?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to last month",children:"Last Month"}),e.jsx("button",{type:"button",className:"hidden md:flex items-center gap-1 fixed right-4 bottom-24 z-10 bg-gray-600 text-white px-3 py-1 rounded shadow",onClick:()=>{const h=Object.keys(S.current);h.length>0&&S.current[h[h.length-1]]?.scrollIntoView({behavior:"smooth",block:"start"})},"aria-label":"Jump to oldest",children:"Oldest"}),k.length>1&&e.jsx("div",{className:"hidden md:flex flex-col gap-1 fixed right-4 top-1/2 -translate-y-1/2 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur p-2 rounded shadow max-h-[60vh] overflow-auto",children:k.map(h=>e.jsxs("button",{type:"button",className:`text-xs px-2 py-0.5 rounded flex items-center gap-1 ${P===h?"bg-blue-600 text-white":"text-blue-700 hover:bg-blue-100"}`,onClick:()=>{Object.values(S.current).find(C=>C?.dataset.month===h)?.scrollIntoView({behavior:"smooth",block:"start"})},children:[e.jsx("span",{children:h}),e.jsxs("span",{className:"opacity-70",children:["(",v[h]||0,")"]}),e.jsx("span",{className:"inline-block h-1 bg-current opacity-50",style:{width:`${Math.max(6,Math.round((v[h]||0)/f*60))}px`}})]},h))}),y.map(h=>e.jsxs("section",{"aria-label":h.key,ref:j=>{j&&(S.current[h.key]=j)},"data-month":h.key.split(" ").slice(0,2).join(" "),style:{scrollSnapAlign:"start"},children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur px-2 py-1 border-b text-sm font-medium",children:[h.key,"  ",h.items.length]}),e.jsx("div",{className:"mt-3 grid gap-2 grid-cols-[repeat(auto-fill,minmax(160px,1fr))]",children:h.items.map(j=>{const C=r.has(j.path),E=j.path.split("/").pop()||j.path,w=l[j.path];return e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden border ${C?"ring-2 ring-blue-500":"border-transparent"}`,onClick:()=>n(j.path),onDoubleClick:()=>i(j.path),title:j.path,children:[e.jsx(la,{src:Ne(a,t,j.path,256),alt:j.path,className:"w-full h-[160px] object-cover",enableProgressiveLoading:!0}),u&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-white px-1.5 py-1 text-[10px] flex items-center justify-between",children:[e.jsx("span",{className:"truncate mr-2",title:E,children:E}),e.jsxs("div",{className:"flex items-center gap-1",children:[w?.camera&&e.jsx("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:w.camera}),typeof w?.fnumber=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["f/",w.fnumber]}),typeof w?.iso=="number"&&e.jsxs("span",{className:"bg-white/20 rounded px-1 whitespace-nowrap",children:["ISO ",w.iso]})]})]})]},j.path)})})]},h.key))]})}function kl({open:a,onClose:t}){const s=Yr(),[r,n]=o.useState([]),[i,u]=o.useState(!1);return o.useEffect(()=>{let c;async function l(){if(s){u(!0);try{const d=await Gt(s,200);n(d.events||[])}catch{}u(!1),c=setTimeout(l,3500)}}return a&&l(),()=>{c&&clearTimeout(c)}},[s,a]),a?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:t}),e.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-full sm:w-[420px] bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-800 p-3 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Jobs"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:t,children:"Close"})]}),i&&e.jsx("div",{className:"text-sm text-gray-600",children:"Loading"}),e.jsxs("div",{className:"space-y-2",children:[r.map((c,l)=>e.jsxs("div",{className:"p-2 border rounded text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 rounded px-1 py-0.5 mr-2",children:c.type}),c.type==="export"&&e.jsxs("span",{children:[c.copied," copied, ",c.skipped," skipped",c.errors?`, ${c.errors} errors`:""]}),c.type==="backup_run"&&e.jsxs("span",{children:[c.copied," backed up, ",c.skipped," skipped"]}),c.type==="backup_restore"&&e.jsxs("span",{children:[c.restored," restored"]}),c.type==="captions_build"&&e.jsxs("span",{children:[c.updated," captions"]}),c.type==="ocr_build"&&e.jsxs("span",{children:[c.updated," OCR"]}),c.type==="fast_build"&&e.jsxs("span",{children:[c.kind," index ",c.ok?"ok":"failed"]}),c.type==="trips_build"&&e.jsxs("span",{children:[c.trips," trips"]}),c.type==="thumbs_build"&&e.jsxs("span",{children:[c.made," thumbs"]}),c.type==="metadata_build"&&e.jsxs("span",{children:[c.updated," metadata"]}),c.type==="share_created"&&e.jsxs("span",{children:["link  ",c.count," items"]}),c.type==="share_open"&&e.jsx("span",{children:"link opened"}),c.type==="search"&&e.jsxs("span",{children:["",c.query,""]})]}),e.jsx("div",{className:"text-gray-500",children:new Date(c.time).toLocaleString()})]},l)),r.length===0&&!i&&e.jsx("div",{className:"text-sm text-gray-600",children:"No recent jobs."})]})]})]}):null}function Sl({onStartDemo:a,onSelectFolder:t,onClose:s}){return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",onClick:r=>r.stopPropagation(),children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto flex items-center justify-center mb-6",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-12 h-12 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Find any photo instantly"}),e.jsx("p",{className:"text-gray-600 mb-8 max-w-xl mx-auto",children:`Just describe what you're looking for - like "that beach sunset" or "my daughter's birthday" - and we'll find it. No more endless scrolling!`}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Search naturally"}),e.jsx("p",{className:"text-gray-600 text-sm",children:`Type what you remember - "kids at the park" or "that amazing sunset" - we'll find it.`})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 text-left",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Find people instantly"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"We recognize faces so you can find all photos of someone special in seconds."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx("button",{onClick:a,className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:"See it in action"}),e.jsx("button",{onClick:t,className:"px-8 py-4 bg-white border-2 border-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-50 transition-all shadow-md",children:"Use my photos"})]}),e.jsx("button",{onClick:s,className:"mt-6 text-gray-500 hover:text-gray-700 transition-colors",children:"Maybe later"})]})})})})}function Cl(){try{const a=navigator.userAgent,t=a.includes("Windows")||a.includes("Win64"),s=a.includes("Macintosh")||a.includes("Mac OS");return t?["~/Pictures","~/Desktop","~/Downloads","~/OneDrive/Pictures"]:s?["~/Pictures","~/Desktop","~/Downloads","~/Documents/Screenshots"]:["~/Pictures","~/Downloads","~/Desktop"]}catch{return["~/Pictures","~/Downloads"]}}function Tl({open:a,onClose:t,onQuickStart:s,onCustom:r,onDemo:n,onTour:i}){const[u,c]=o.useState([]),[l,d]=o.useState(!1),[p,b]=o.useState(Cl()),y=re(),k=y.state.settings.includeVideos,v=y.setSettings,[f,S]=o.useState(k),T=o.useMemo(()=>u.reduce((E,w)=>E+(w.files||0),0),[u]),[P,m]=o.useState(!1),[h,j]=o.useState("");o.useEffect(()=>{if(!a)return;let E=!1;return(async()=>{d(!0);try{const N=await fetch(`${ue}/scan_count?include_videos=${f?"1":"0"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!N.ok)throw new Error(await N.text());const _=await N.json();E||c(_.items||[])}catch{E||c([])}finally{E||d(!1)}})(),()=>{E=!0}},[a,p,f]);const C=E=>{if(!E)return"0 B";const w=["B","KB","MB","GB","TB"];let N=0,_=E;for(;_>=1024&&N<w.length-1;)_/=1024,N++;return`${_.toFixed(_<10?1:0)} ${w[N]}`};return a?e.jsxs("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center",children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1101] bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl p-5",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Welcome  lets find your photos"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Get started fast (no cloud, localonly)."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:" Quick Start (Recommended)"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Index common locations (local only)"}),e.jsx("ul",{className:"text-xs text-gray-700 mb-2",children:u.map(E=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:E.path}),e.jsx("span",{children:E.exists?`${E.files}  ${C(E.bytes)} (Found)`:"Not found"})]},E.path))}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 mb-2",children:[e.jsx("input",{id:"incl-videos",type:"checkbox",checked:f,onChange:E=>{S(E.target.checked);try{v({includeVideos:E.target.checked})}catch{}}}),e.jsx("label",{htmlFor:"incl-videos",children:"Include videos (may take longer)"})]}),e.jsx("button",{className:"px-3 py-1 rounded bg-blue-600 text-white text-sm disabled:opacity-50",disabled:l||P,onClick:async()=>{m(!0),j("Starting indexing");try{s(p);const E=u.find(N=>N.exists)?.path||p[0],w=Date.now()+7e3;for(;Date.now()<w;){try{const N=await fetch(`${ue}/analytics?dir=${encodeURIComponent(E)}&limit=5`);if(N.ok){const z=((await N.json()).events||[]).find(ee=>ee.type==="index");if(z){j(`Indexed ${z.new}+${z.updated} (total ${z.total})`);break}}}catch{}await new Promise(N=>setTimeout(N,1e3))}}finally{setTimeout(()=>{m(!1),t()},1e3)}},children:l?"Calculating":P?h||"Starting":`Start indexing (${T} files  ${C(u.reduce((E,w)=>E+(w.bytes||0),0))})`}),!P&&!l&&e.jsx("div",{className:"mt-2 text-[11px] text-gray-600",children:"Runs in the background; you can start searching."})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-medium mb-1",children:" Custom Setup"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Choose specific folders to index"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:r,children:"Select Folders"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:" Demo Mode"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Try with sample photos first"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:n,children:"Try Demo"}),e.jsx("div",{className:"mt-4 font-medium mb-1",children:" Guided Tour"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Learn the basics in under a minute"}),e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:()=>i&&i(),children:"Start Tour"})]})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-600",children:"This runs locally; nothing leaves your device."}),e.jsx("div",{className:"text-xs text-gray-600",children:"You can add or remove folders anytime."}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:t,children:"Skip"})})]})]}):null}function El(){const[a,t]=o.useState(navigator.onLine),[s,r]=o.useState(!1),[n,i]=o.useState(!1),[u,c]=o.useState(!1),[l,d]=o.useState(!1);o.useEffect(()=>{const v=()=>t(!0),f=()=>t(!1);window.addEventListener("online",v),window.addEventListener("offline",f);const S=!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);return r(S),c("ontouchstart"in window),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(()=>{d(!0)}),window.matchMedia("(display-mode: standalone)").matches&&i(!0),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",f)}},[]);const p=[{name:"Touch Gestures",icon:wa,status:u,description:"Pinch-to-zoom, swipe navigation"},{name:"Camera Access",icon:zt,status:s,description:"Native photo capture"},{name:"Offline Support",icon:a?$s:Bt,status:l,description:"Works without internet"},{name:"PWA Installation",icon:Yn,status:n,description:"Install as app"}],b=async()=>{try{if("caches"in window){const v=await caches.open("test-cache");await v.put("/test",new Response("Hello from cache!"));const S=await(await v.match("/test"))?.text();alert(`Cache test: ${S||"Failed"}`)}else alert("Cache API not supported")}catch(v){alert(`Cache test failed: ${v}`)}},y=async()=>{try{const v=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});alert("Camera access successful!"),v.getTracks().forEach(f=>f.stop())}catch(v){alert(`Camera test failed: ${v}`)}},k=()=>{alert("Touch the screen to test gestures! Try pinching, swiping, or long-pressing.")};return e.jsx("div",{className:"p-4 max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Mobile PWA Features Test"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Test the mobile PWA features that were just implemented. This page helps verify that all the mobile enhancements are working correctly."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:p.map((v,f)=>{const S=v.icon;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(S,{className:`w-6 h-6 mr-2 ${v.status?"text-green-500":"text-gray-400"}`}),e.jsx("h3",{className:"font-semibold",children:v.name}),e.jsx("span",{className:`ml-auto px-2 py-1 text-xs rounded ${v.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:v.status?"Available":"Not Available"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:v.description})]},f)})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Interactive Tests"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:b,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:!l,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"Test Cache API"]}),e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",disabled:!s,children:[e.jsx(zt,{className:"w-4 h-4 inline mr-2"}),"Test Camera Access"]}),e.jsxs("button",{onClick:k,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",disabled:!u,children:[e.jsx(wa,{className:"w-4 h-4 inline mr-2"}),"Test Touch Gestures"]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Current Status"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Online Status:"," ",e.jsx("span",{className:a?"text-green-600":"text-red-600",children:a?"Online":"Offline"})]}),e.jsxs("div",{children:["Service Worker:"," ",e.jsx("span",{className:l?"text-green-600":"text-red-600",children:l?"Ready":"Not Ready"})]}),e.jsxs("div",{children:["Display Mode:"," ",e.jsx("span",{className:"text-blue-600",children:n?"Standalone (Installed)":"Browser"})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2",children:"Instructions"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:" Test this page on a mobile device for best results"}),e.jsx("li",{children:" Try installing the app to test PWA features"}),e.jsx("li",{children:" Go offline to test cached functionality"}),e.jsx("li",{children:" Use touch gestures on photos to test interactions"})]})]})]})})}function La({onSearch:a}){const t=["photos from last summer","my kids playing","that trip to Paris","birthday celebrations","sunset at the beach","our dog running","Christmas morning","backyard BBQ","first day of school","weekend adventures","family dinner","vacation memories","funny moments","beautiful landscapes","selfies with friends"];return e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Try searching for:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.map(s=>e.jsx("button",{type:"button",onClick:()=>a(s),className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-600 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 text-left",children:s},s))}),e.jsx("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:" Just describe what you're looking for in your own words"})]})}function Pl({onSelectDirectory:a,onImport:t,onHelp:s}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-6",children:[e.jsxs("button",{type:"button",onClick:a,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(We,{className:"w-8 h-8 text-blue-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Select Directory"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose a folder with your photos"})]}),e.jsxs("button",{type:"button",onClick:t,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(Me,{className:"w-8 h-8 text-green-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Import Photos"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Import from camera or device"})]}),e.jsxs("button",{type:"button",onClick:s,className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow text-left group",children:[e.jsx(es,{className:"w-8 h-8 text-purple-500 mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Get Help"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View tutorials and documentation"})]})]})}function js({type:a,searchQuery:t,onAction:s,onDemoAction:r,onClearSearch:n,onOpenFilters:i,onOpenAdvanced:u,onOpenHelp:c,onStartTour:l,onOpenJobs:d,sampleQueries:p,onRunSample:b,hasActiveFilters:y,indexingProgress:k=0,estimatedTime:v}){const[f,S]=o.useState(!1),T=["beach sunset","birthday cake","mountain hike","red car"],P=Array.isArray(p)&&p.length>0?p:T,h=(()=>{switch(a){case"no-directory":return{icon:e.jsx(We,{className:"w-16 h-16 text-gray-400"}),title:"Welcome to Photo Search",description:"Get started by selecting a folder containing your photos. We'll analyze them to make them searchable.",actionLabel:"Select Photo Folder",action:s,demoActionLabel:"Try Demo Photos",demoAction:r,tips:["Choose a folder with JPEG, PNG, or other common photo formats","We'll scan and analyze your photos using AI for natural language search","Your photos stay on your device - we only create searchable indexes","You can always add more folders later from the settings"]};case"no-photos":return{icon:e.jsx(ts,{className:"w-16 h-16 text-gray-400"}),title:"No Photos Found",description:"This folder doesn't contain any photos yet. Add some photos or select a different folder.",actionLabel:"Select Different Folder",action:s,tips:["Make sure your photos are in common formats like JPEG, PNG, or TIFF","Check that the folder contains actual photo files, not just subfolders","If you just added photos, try refreshing the library","You can also import photos from other locations"]};case"no-results":return{icon:e.jsx(Ce,{className:"w-16 h-16 text-gray-400"}),title:`No results for "${t}"`,description:"Try adjusting your search terms or filters. Here are some suggestions:",suggestions:["Use simpler words or phrases","Try searching for colors, objects, or locations","Check your spelling","Remove filters if any are applied","Try searching for people or events"],actionLabel:"Clear Search",action:s};case"indexing":return{icon:e.jsx(ct,{className:"w-16 h-16 text-blue-500 animate-pulse"}),title:"Indexing Your Photos",description:`Analyzing your photos to make them searchable. ${k}% complete.`,progress:k,estimatedTime:v,tips:["This process analyzes each photo using AI to understand its content","You'll be able to search by objects, scenes, colors, and more","The process typically takes about 30 seconds per 100 photos","You can continue using other features while indexing runs"]};default:return{icon:e.jsx(es,{className:"w-16 h-16 text-gray-400"}),title:"Something went wrong",description:"We're having trouble loading this content.",actionLabel:"Try Again",action:s}}})();return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8 text-center",role:a==="indexing"?"status":void 0,"aria-live":a==="indexing"?"polite":void 0,children:[e.jsx("div",{className:"mb-6",children:h.icon}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-3",children:h.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md leading-relaxed",children:h.description}),h.progress!==void 0&&e.jsxs("div",{className:"w-full max-w-md mb-6",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${h.progress}%`}})}),h.estimatedTime&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Estimated time remaining: ",h.estimatedTime]})]}),h.suggestions&&e.jsxs("div",{className:"mb-6 text-left max-w-md",children:[e.jsx("ul",{className:"space-y-2",children:h.suggestions.map((j,C)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:""}),j]},`suggestion-${j.substring(0,10)}-${C}`))}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[i&&e.jsxs("button",{type:"button",onClick:i,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx(Qn,{className:"w-4 h-4"})," Filters"]}),u&&e.jsxs("button",{type:"button",onClick:u,className:"px-3 py-1.5 rounded border text-sm flex items-center gap-1",children:[e.jsx(Jn,{className:"w-4 h-4"})," Advanced"]}),y&&n&&e.jsx("button",{type:"button",onClick:n,className:"px-3 py-1.5 rounded border text-sm",children:"Clear filters"})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:P.map(j=>e.jsx("button",{type:"button",onClick:()=>b&&b(j),className:"px-2 py-1.5 rounded bg-gray-100 dark:bg-gray-800 text-xs",children:j},j))})]}),e.jsxs("div",{className:"flex gap-3 mb-6 flex-wrap justify-center",children:[h.action&&e.jsx("button",{type:"button",onClick:h.action,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:h.actionLabel}),h.demoAction&&e.jsx("button",{type:"button",onClick:h.demoAction,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:h.demoActionLabel}),a==="no-directory"&&l&&e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Start Tour"}),a==="indexing"&&d&&e.jsx("button",{type:"button",onClick:d,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"View Progress"}),c&&e.jsxs("button",{type:"button",onClick:c,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[e.jsx(Xn,{className:"w-4 h-4"})," Help"]})]}),h.tips&&e.jsxs("div",{className:"max-w-md",children:[e.jsxs("button",{type:"button",onClick:()=>S(!f),className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:[f?e.jsx(Ga,{className:"w-4 h-4"}):e.jsx(Ka,{className:"w-4 h-4"}),f?"Hide tips":"Show tips"]}),f&&e.jsx("div",{className:"mt-4 text-left",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-3",children:" Tips"}),e.jsx("ul",{className:"space-y-2",children:h.tips.map((j,C)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:""}),j]},`tip-${j.substring(0,10)}-${C}`))})]})})]})]})}function Il({isVisible:a,onDismiss:t,context:s,userActions:r}){const[n,i]=o.useState(0),[u,c]=o.useState(!1),d={search:[{title:"Natural Language Search",content:"Try searching for 'sunset at beach' or 'family birthday party' - our AI understands what you're looking for naturally.",trigger:!r.includes("searched")},{title:"Search by Colors & Objects",content:"Search for colors like 'red car' or objects like 'mountains' - our AI can find visual elements in your photos.",trigger:r.includes("searched")&&!r.includes("filtered")},{title:"Advanced Filters",content:"Use the filter panel to narrow by date, camera, location, or rating for more precise results.",trigger:r.includes("searched")&&r.length>3}],library:[{title:"Getting Started",content:"Select a folder with your photos to begin. We'll analyze them to make them searchable.",trigger:!r.includes("selected_directory")},{title:"Indexing Process",content:"After selecting photos, we'll index them using AI. This takes about 30 seconds per 100 photos.",trigger:r.includes("selected_directory")&&!r.includes("indexed")},{title:"Browse Your Photos",content:"Once indexed, you can browse all your photos here. Use the search bar above to find specific ones.",trigger:r.includes("indexed")}],results:[{title:"Photo Actions",content:"Select photos to share, favorite, tag, or organize them into collections.",trigger:!r.includes("selected_photo")},{title:"Quick Actions",content:"Use keyboard shortcuts: Space to select, Enter to view full size, F to favorite.",trigger:r.includes("selected_photo")&&!r.includes("used_keyboard")},{title:"Save Searches",content:"Save your favorite searches to quickly access them later from the Saved Searches section.",trigger:r.includes("searched")&&r.length>5}],collections:[{title:"Organize Your Photos",content:"Create collections to group related photos together, like 'Vacation 2024' or 'Family Events'.",trigger:!r.includes("created_collection")},{title:"Smart Collections",content:"Set up smart collections that automatically include photos based on your criteria.",trigger:r.includes("created_collection")}],settings:[{title:"Customize Your Experience",content:"Configure AI models, indexing preferences, and interface settings to match your needs.",trigger:!r.includes("changed_setting")},{title:"Performance Tuning",content:"Adjust indexing speed and search accuracy based on your hardware and preferences.",trigger:r.includes("changed_setting")}]}[s]?.filter(y=>y.trigger)||[];if(o.useEffect(()=>{if(d.length>0&&!u){const b=setInterval(()=>{i(y=>(y+1)%d.length)},8e3);return()=>clearInterval(b)}},[d.length,u]),!a||d.length===0)return null;const p=d[n];return e.jsx("div",{className:"fixed bottom-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zn,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Tip"})]}),e.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Dismiss tip",children:e.jsx(Te,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:p.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed",children:p.content})]}),d.length>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-1",children:d.map((b,y)=>e.jsx("button",{type:"button",onClick:()=>i(y),className:`w-2 h-2 rounded-full transition-colors ${y===n?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`,"aria-label":`Go to tip ${y+1}`},`tip-${b.title}-${y}`))}),e.jsxs("button",{type:"button",onClick:()=>i((n+1)%d.length),className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:["Next",e.jsx(Ct,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:()=>{c(!0),t()},className:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Don't show tips like this"})})]})})}function $l({isVisible:a,onComplete:t,completedSteps:s,onStepComplete:r,onStepAction:n,inProgressStepId:i}){const[u,c]=o.useState(!1),l=[{id:"select_directory",title:"Select Photo Directory",description:"Choose a folder containing your photos",action:"Get Started"},{id:"index_photos",title:"Index Your Photos",description:"Let AI analyze your photos for search",action:"Start Indexing"},{id:"first_search",title:"Try Your First Search",description:'Search for something like "beach sunset"',action:"Search Now"},{id:"explore_features",title:"Explore Features",description:"Try collections, favorites, and sharing",action:"Explore"}],d=s.length,p=l.length,b=d===p;return o.useEffect(()=>{if(b){const y=setTimeout(t,2e3);return()=>clearTimeout(y)}},[b,t]),a?e.jsx("div",{className:"fixed top-4 right-4 z-40 max-w-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>c(!u),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${b?"bg-green-100 dark:bg-green-900/20":"bg-blue-100 dark:bg-blue-900/20"}`,children:b?e.jsx(qt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(es,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Getting Started"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d," of ",p," steps complete"]})]})]}),e.jsx(Ct,{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${d/p*100}%`}})})}),u&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-h-80 overflow-y-auto",children:l.map((y,k)=>{const v=s.includes(y.id),f=s.length===k;return e.jsx("div",{className:`px-4 py-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0 ${v?"bg-green-50 dark:bg-green-900/10":f?"bg-blue-50 dark:bg-blue-900/10":"bg-gray-50 dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 ${v?"bg-green-100 dark:bg-green-900/20":"bg-gray-200 dark:bg-gray-600"}`,children:v?e.jsx(qt,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:k+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-medium text-sm ${v?"text-green-800 dark:text-green-200":"text-gray-900 dark:text-white"}`,children:y.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:y.description}),!v&&f&&(i===y.id?e.jsx("span",{className:"mt-2 inline-flex items-center px-3 py-1 bg-gray-500 text-white text-xs rounded",children:"In progress"}):e.jsx("button",{type:"button",onClick:()=>n?n(y.id):r(y.id),className:"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",children:y.action}))]})]})},y.id)})})})]})}):null}function Ml({photoCount:a=0,indexedCount:t=0,searchProvider:s="local",isIndexing:r=!1,isConnected:n=!0,currentDirectory:i="",lastSync:u,activeJobs:c=0}){const[l,d]=o.useState(0),[p,b]=o.useState(0);o.useEffect(()=>{const v=setInterval(()=>{d(Math.random()*30+(r?40:10)),b(Math.random()*20+30)},2e3);return()=>clearInterval(v)},[r]);const y=v=>{if(!v)return"No directory selected";const f=v.split("/");return f.length>3?`.../${f.slice(-2).join("/")}`:v},k=v=>{if(!v)return"Never";const S=new Date().getTime()-v.getTime(),T=Math.floor(S/6e4);if(T<1)return"Just now";if(T<60)return`${T}m ago`;const P=Math.floor(T/60);return P<24?`${P}h ago`:`${Math.floor(P/24)}d ago`};return e.jsx("div",{className:"status-bar",children:e.jsxs("div",{className:"status-content",children:[e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(ei,{className:"status-icon"}),e.jsx("span",{className:"status-text",children:y(i)})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(ts,{className:"status-icon"}),e.jsxs("span",{children:[a.toLocaleString()," photos"]})]}),r?e.jsxs("div",{className:"status-item",children:[e.jsx("div",{className:"status-spinner"}),e.jsxs("span",{className:"status-text processing",children:["Indexing... ",t,"/",a]})]}):e.jsxs("div",{className:"status-item",children:[e.jsx(qt,{className:"status-icon"}),e.jsxs("span",{className:"status-text success",children:[t.toLocaleString()," indexed"]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Ce,{className:"status-icon"}),e.jsx("span",{className:"capitalize",children:s})]}),c>0&&e.jsxs("div",{className:"status-item",children:[e.jsx(Ya,{className:"status-icon"}),e.jsxs("span",{className:"status-text warning",children:[c," active job",c!==1?"s":""]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(ht,{className:"status-icon"}),e.jsxs("span",{children:["Synced ",k(u)]})]})]}),e.jsxs("div",{className:"status-section",children:[e.jsxs("div",{className:"status-item",children:[e.jsx(Ms,{className:"status-icon"}),e.jsxs("span",{children:[l.toFixed(0),"%"]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx(Vt,{className:"status-icon"}),e.jsxs("span",{children:[p.toFixed(0),"%"]})]}),e.jsx("div",{className:"status-item",children:n?e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"status-icon"}),e.jsx("span",{className:"status-text success",children:"Connected"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Bt,{className:"status-icon"}),e.jsx("span",{className:"status-text error",children:"Offline"})]})})]})]})})}function Fl({jobs:a,onPause:t,onResume:s,onCancel:r,onRetry:n,onClear:i,onClearAll:u}){const[c,l]=o.useState(!1),[d,p]=o.useState(new Set),b=a.filter(m=>m.status==="running"||m.status==="paused"),y=a.filter(m=>m.status==="completed"||m.status==="failed"||m.status==="cancelled"),k=m=>{const h=new Set(d);h.has(m)?h.delete(m):h.add(m),p(h)},v=m=>({index:e.jsx(Vt,{className:"w-4 h-4"}),search:e.jsx(Ce,{className:"w-4 h-4"}),edit:e.jsx(ts,{className:"w-4 h-4"}),export:e.jsx(Me,{className:"w-4 h-4"}),import:e.jsx(ct,{className:"w-4 h-4"}),backup:e.jsx(Vt,{className:"w-4 h-4"}),analyze:e.jsx(Ms,{className:"w-4 h-4"}),restore:e.jsx(Ts,{className:"w-4 h-4"})})[m],f=m=>({queued:"text-gray-500",running:"text-blue-500",paused:"text-yellow-500",completed:"text-green-500",failed:"text-red-500",cancelled:"text-gray-400"})[m],S=m=>{switch(m){case"queued":return e.jsx(ht,{className:"w-4 h-4"});case"running":return e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"});case"paused":return e.jsx(Ps,{className:"w-4 h-4"});case"completed":return e.jsx(qt,{className:"w-4 h-4"});case"failed":return e.jsx(ti,{className:"w-4 h-4"});case"cancelled":return e.jsx(Qa,{className:"w-4 h-4"})}},T=(m,h)=>{if(!m)return"";const C=(h||new Date).getTime()-m.getTime(),E=Math.floor(C/1e3),w=Math.floor(E/60),N=Math.floor(w/60);return N>0?`${N}h ${w%60}m`:w>0?`${w}m ${E%60}s`:`${E}s`},P=m=>{const h=Math.floor(m/60),j=Math.floor(h/60);return j>0?`${j} hour${j>1?"s":""}`:h>0?`${h} minute${h>1?"s":""}`:`${m} second${m>1?"s":""}`};return a.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:e.jsxs("button",{onClick:()=>l(!c),className:"bg-white dark:bg-gray-800 rounded-full shadow-lg p-3 flex items-center gap-2 hover:shadow-xl transition-shadow",children:[e.jsx(Ya,{className:"w-5 h-5 text-blue-500"}),b.length>0&&e.jsx("span",{className:"bg-blue-500 text-white text-xs rounded-full px-2 py-0.5",children:b.length})]})}),c&&e.jsxs("div",{className:"fixed bottom-20 right-4 w-96 max-h-[600px] bg-white dark:bg-gray-800 rounded-lg shadow-2xl z-40 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold",children:"What's happening"}),e.jsxs("div",{className:"flex items-center gap-2",children:[y.length>0&&e.jsx("button",{onClick:u,className:"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Clear All"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Te,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[b.length>0&&e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Working on"}),e.jsx("div",{className:"space-y-2",children:b.map(m=>e.jsx(Aa,{job:m,isExpanded:d.has(m.id),onToggleExpanded:()=>k(m.id),onPause:t,onResume:s,onCancel:r,getJobIcon:v,getStatusIcon:S,getStatusColor:f,formatDuration:T,formatTimeRemaining:P},m.id))})]}),y.length>0&&e.jsxs("div",{className:"p-3 border-t dark:border-gray-700",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Recently finished"}),e.jsx("div",{className:"space-y-2",children:y.map(m=>e.jsx(Aa,{job:m,isExpanded:d.has(m.id),onToggleExpanded:()=>k(m.id),onRetry:n,onClear:i,getJobIcon:v,getStatusIcon:S,getStatusColor:f,formatDuration:T,formatTimeRemaining:P},m.id))})]})]})]})]})}function Aa({job:a,isExpanded:t,onToggleExpanded:s,onPause:r,onResume:n,onCancel:i,onRetry:u,onClear:c,getJobIcon:l,getStatusIcon:d,getStatusColor:p,formatDuration:b,formatTimeRemaining:y}){const k=a.total?(a.progress||0)/a.total*100:0;return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("div",{className:"mt-0.5",children:l(a.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:a.title}),e.jsxs("div",{className:`flex items-center gap-1 ${p(a.status)}`,children:[d(a.status),e.jsx("span",{className:"text-xs capitalize",children:a.status})]})]}),a.status==="running"&&a.total&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:[a.progress||0," of ",a.total,a.type==="backup"?" photos saved":a.type==="index"?" photos found":a.type==="export"?" photos exported":" items"]}),e.jsxs("span",{children:[k.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all",style:{width:`${k}%`}})}),(a.estimatedTimeRemaining||a.speed)&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mt-1",children:[a.estimatedTimeRemaining&&e.jsxs("span",{children:["About ",y(a.estimatedTimeRemaining)," left"]}),a.speed&&e.jsx("span",{children:a.speed})]}),a.currentItem&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:[a.type==="backup"?"Saving: ":a.type==="index"?"Looking at: ":"Processing: ",a.currentItem]})]}),a.startTime&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[a.status==="completed"?"Finished in ":a.status==="failed"?"Failed after ":a.status==="running"?"Running for ":"",b(a.startTime,a.endTime),a.status==="completed"&&e.jsxs("span",{className:"ml-2",children:[a.successCount&&e.jsxs("span",{className:"text-green-500",children:[" ",a.successCount]}),a.warningCount&&e.jsxs("span",{className:"text-yellow-500 ml-1",children:[" ",a.warningCount]}),a.errorCount&&e.jsxs("span",{className:"text-red-500 ml-1",children:[" ",a.errorCount]})]})]}),t&&(a.error||a.description)&&e.jsx("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300",children:a.error?e.jsx("div",{className:"text-red-500",children:a.error}):e.jsx("div",{children:a.description})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[a.status==="running"&&a.canPause&&e.jsx("button",{onClick:()=>r?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Ps,{className:"w-3 h-3"})}),a.status==="paused"&&e.jsx("button",{onClick:()=>n?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(dt,{className:"w-3 h-3"})}),(a.status==="running"||a.status==="paused")&&a.canCancel&&e.jsx("button",{onClick:()=>i?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded text-red-500",children:e.jsx(Te,{className:"w-3 h-3"})}),a.status==="failed"&&a.canRetry&&e.jsx("button",{onClick:()=>u?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Ts,{className:"w-3 h-3"})}),(a.status==="completed"||a.status==="failed"||a.status==="cancelled")&&e.jsx("button",{onClick:()=>c?.(a.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(He,{className:"w-3 h-3"})}),(a.error||a.description)&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:t?e.jsx(Ga,{className:"w-3 h-3"}):e.jsx(Ka,{className:"w-3 h-3"})})]})]})})}function Dl({dir:a}){const[t,s]=o.useState([]),[r,n]=o.useState(!1),[i,u]=o.useState("");async function c(){n(!0),u("");try{const l=await xr(a||void 0);s(l.shares||[])}catch(l){u(l instanceof Error?l.message:"Failed to load shares")}finally{n(!1)}}return o.useEffect(()=>{c()},[a]),e.jsxs("div",{children:[i&&e.jsx("div",{className:"text-red-700 text-sm mb-2",children:i}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," link",t.length!==1?"s":""]}),e.jsx("button",{onClick:c,className:"px-2 py-1 border rounded text-sm",children:"Refresh"})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 pr-2",children:"Token"}),e.jsx("th",{className:"py-1 pr-2",children:"Created"}),e.jsx("th",{className:"py-1 pr-2",children:"Expires"}),e.jsx("th",{className:"py-1 pr-2",children:"Count"}),e.jsx("th",{className:"py-1 pr-2",children:"Access"}),e.jsx("th",{className:"py-1 pr-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[t.map(l=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 pr-2 font-mono text-xs",children:l.token}),e.jsx("td",{className:"py-1 pr-2",children:new Date(l.created).toLocaleString()}),e.jsxs("td",{className:"py-1 pr-2",children:[l.expires?new Date(l.expires).toLocaleString():"",l.expired?e.jsx("span",{className:"ml-1 text-red-700",children:"(expired)"}):null,!l.expired&&l.expires&&(()=>{const d=new Date(l.expires).getTime()-Date.now();return d>0&&d<24*3600*1e3?e.jsx("span",{className:"ml-1 text-amber-700",children:"(expires soon)"}):null})()]}),e.jsx("td",{className:"py-1 pr-2",children:l.count}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:l.view_only?"View-only":"Downloadable"}),l.has_password?e.jsx("span",{className:"text-xs bg-gray-200 rounded px-1",children:"Protected"}):null]})}),e.jsx("td",{className:"py-1 pr-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;window.open(d,"_blank")},children:"Open"}),e.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:async()=>{const d=`${window.location.origin}/share/${l.token}/view`;await navigator.clipboard.writeText(d),alert("Copied link to clipboard")},children:"Copy Link"}),e.jsx("button",{className:"px-2 py-0.5 border rounded text-red-700",onClick:async()=>{if(confirm("Revoke this share link?"))try{await pr(l.token),await c()}catch{}},children:"Revoke"})]})})]},l.token)),t.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"No share links yet."})}),r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-500",children:"Loading"})})]})]})})]})}function _l({cameras:a=[],popularISOs:t=[100,200,400,800,1600,3200],popularApertures:s=[1.4,1.8,2.8,4,5.6,8],yearRange:r,camera:n,setCamera:i,isoMin:u,setIsoMin:c,isoMax:l,setIsoMax:d,fMin:p,setFMin:b,fMax:y,setFMax:k,dateFrom:v,setDateFrom:f,dateTo:S,setDateTo:T,onApplyFilters:P,onClearFilters:m,compact:h=!1}){const[j,C]=o.useState("camera"),E=n||u||l||p||y||v||S,w=[{id:"camera",label:"Camera",icon:zt,content:e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>i(""),className:`px-2 py-1 text-xs rounded border ${n?"bg-white border-gray-300 hover:bg-gray-50":"bg-blue-600 text-white border-blue-600"}`,children:"Any Camera"}),a.slice(0,h?4:8).map(N=>e.jsx("button",{type:"button",onClick:()=>i(n===N?"":N),className:`px-2 py-1 text-xs rounded border truncate max-w-32 ${n===N?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,title:N,children:N.length>20?N.substring(0,20)+"...":N},N))]})})},{id:"aperture",label:"Aperture",icon:si,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select f-stop range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{b(""),k("")},className:`px-2 py-1 text-xs rounded border ${!p&&!y?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),s.map(N=>e.jsxs("button",{type:"button",onClick:()=>{const _=N.toString();p===_&&y===_?(b(""),k("")):(b(_),k(_))},className:`px-2 py-1 text-xs rounded border ${p===N.toString()&&y===N.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:["f/",N]},N))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:p,onChange:N=>b(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"1.4"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max f-stop"}),e.jsx("input",{type:"number",step:"0.1",min:"0.7",max:"32",value:y,onChange:N=>k(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"8.0"})]})]})]})},{id:"iso",label:"ISO",icon:Fs,content:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quick select ISO range:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{c(""),d("")},className:`px-2 py-1 text-xs rounded border ${!u&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any"}),e.jsx("button",{type:"button",onClick:()=>{c(""),d("800")},className:`px-2 py-1 text-xs rounded border ${!u&&l==="800"?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Low (800)"}),e.jsx("button",{type:"button",onClick:()=>{c("800"),d("")},className:`px-2 py-1 text-xs rounded border ${u==="800"&&!l?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"High (800)"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(N=>e.jsx("button",{type:"button",onClick:()=>{const _=N.toString();u===_&&l===_?(c(""),d("")):(c(_),d(_))},className:`px-2 py-1 text-xs rounded border ${u===N.toString()&&l===N.toString()?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:N},N))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Min ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:u,onChange:N=>c(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Max ISO"}),e.jsx("input",{type:"number",min:"50",max:"102400",step:"100",value:l,onChange:N=>d(N.target.value),className:"w-full text-xs border rounded px-2 py-1",placeholder:"3200"})]})]})]})},{id:"date",label:"Date",icon:Ja,content:e.jsxs("div",{className:"space-y-2",children:[r&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>{f(""),T("")},className:`px-2 py-1 text-xs rounded border ${!v&&!S?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:"Any Year"}),Array.from({length:Math.min(6,r[0]-r[1]+1)},(N,_)=>r[0]-_).map(N=>e.jsx("button",{type:"button",onClick:()=>{const _=`${N}-01-01`,z=`${N}-12-31`;v===_&&S===z?(f(""),T("")):(f(_),T(z))},className:`px-2 py-1 text-xs rounded border ${v===`${N}-01-01`&&S===`${N}-12-31`?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 hover:bg-gray-50"}`,children:N},N))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From"}),e.jsx("input",{type:"date",value:v,onChange:N=>f(N.target.value),className:"w-full text-xs border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To"}),e.jsx("input",{type:"date",value:S,onChange:N=>T(N.target.value),className:"w-full text-xs border rounded px-2 py-1"})]})]})]})}];return h?e.jsxs("div",{className:"bg-white border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Quick Filters"}),E&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:P,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700",children:"Apply"}),E&&e.jsx("button",{type:"button",onClick:m,className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",children:"Clear"})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:w.map(N=>{const _=N.icon;return e.jsxs("div",{className:"flex-shrink-0 min-w-48",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(_,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:N.label})]}),e.jsx("div",{className:"text-xs",children:N.content})]},N.id)})})]}):e.jsxs("div",{className:"bg-white border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Quick Filters"}),E&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:[[n,u,l,p,y,v,S].filter(Boolean).length," active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:P,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"Apply"}),E&&e.jsx("button",{type:"button",onClick:m,className:"text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300",children:"Clear All"})]})]}),e.jsx("div",{className:"flex border-b",children:w.map(N=>{const _=N.icon;return e.jsxs("button",{type:"button",onClick:()=>C(N.id),className:`flex-1 flex items-center justify-center gap-2 p-3 text-sm border-r last:border-r-0 ${j===N.id?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(_,{className:"w-4 h-4"}),N.label]},N.id)})}),e.jsx("div",{className:"p-4",children:w.find(N=>N.id===j)?.content})]})}function Ol(a,t){const s=Date.now();return{id:`preset_${s}_${Math.random().toString(36).substr(2,9)}`,name:a,createdAt:s,updatedAt:s,filters:t}}function Rl(a,t){const{filters:s}=a;s.favOnly!==void 0&&t.setFavOnly(s.favOnly),s.tagFilter!==void 0&&t.setTagFilter(s.tagFilter),s.place!==void 0&&t.setPlace(s.place),s.camera!==void 0&&t.setCamera(s.camera),s.isoMin!==void 0&&t.setIsoMin(s.isoMin),s.isoMax!==void 0&&t.setIsoMax(s.isoMax),s.fMin!==void 0&&t.setFMin(s.fMin),s.fMax!==void 0&&t.setFMax(s.fMax),s.dateFrom!==void 0&&t.setDateFrom(s.dateFrom),s.dateTo!==void 0&&t.setDateTo(s.dateTo),s.useCaps!==void 0&&t.setUseCaps(s.useCaps),s.useOcr!==void 0&&t.setUseOcr(s.useOcr),s.hasText!==void 0&&t.setHasText(s.hasText),s.ratingMin!==void 0&&t.setRatingMin(s.ratingMin)}function Ll({show:a,onClose:t,onApply:s,favOnly:r,setFavOnly:n,tagFilter:i,setTagFilter:u,camera:c,setCamera:l,isoMin:d,setIsoMin:p,isoMax:b,setIsoMax:y,dateFrom:k,setDateFrom:v,dateTo:f,setDateTo:S,fMin:T,setFMin:P,fMax:m,setFMax:h,place:j,setPlace:C,useCaps:E,setUseCaps:w,useOcr:N,setUseOcr:_,hasText:z,setHasText:ee,ratingMin:O,setRatingMin:Y,availableCameras:F,yearRange:M,filterPresets:V,onSavePreset:se,onLoadPreset:B,onDeletePreset:me}){const[L,Z]=o.useState(!1),[ie,W]=o.useState(""),[J,A]=o.useState(!1);if(!a)return null;const G=()=>({favOnly:r,tagFilter:i,place:j,camera:c,isoMin:d,isoMax:b,fMin:T,fMax:m,dateFrom:k,dateTo:f,useCaps:E,useOcr:N,hasText:z,ratingMin:O}),$=()=>{n(!1),u(""),C(""),l(""),p(""),y(""),P(""),h(""),v(""),S(""),w(!1),_(!1),ee(!1),Y(0)},K=()=>{if(!ie.trim())return;const R=Ol(ie.trim(),G());se(R),W(""),A(!1)},X=R=>{Rl(R,{setFavOnly:n,setTagFilter:u,setPlace:C,setCamera:l,setIsoMin:p,setIsoMax:y,setFMin:P,setFMax:h,setDateFrom:v,setDateTo:S,setUseCaps:w,setUseOcr:_,setHasText:ee,setRatingMin:Y}),Z(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40 flex",children:e.jsxs("div",{className:"ml-auto w-full max-w-md bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Ds,{className:"w-5 h-5"}),"Filters"]}),e.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-gray-100",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsx("button",{type:"button",className:`flex-1 py-3 text-sm font-medium ${L?"text-gray-500":"border-b-2 border-blue-500 text-blue-600"}`,onClick:()=>Z(!1),children:"Filters"}),e.jsx("button",{type:"button",className:`flex-1 py-3 text-sm font-medium ${L?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>Z(!0),children:"Presets"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:L?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-medium",children:"Saved Filter Presets"}),e.jsxs("button",{type:"button",onClick:()=>A(!0),className:"flex items-center gap-1 text-sm bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx(Ha,{className:"w-4 h-4"}),"Save Current"]})]}),J&&e.jsxs("div",{className:"border rounded p-3 bg-blue-50",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Save Current Filters"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ie,onChange:R=>W(R.target.value),placeholder:"Preset name",className:"flex-1 border rounded px-2 py-1 text-sm",autoFocus:!0}),e.jsx("button",{type:"button",onClick:K,disabled:!ie.trim(),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm disabled:opacity-50",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>{A(!1),W("")},className:"px-3 py-1 border rounded text-sm",children:"Cancel"})]})]}),V.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(We,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"No saved presets yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Save your filter combinations for quick access"})]}):e.jsx("div",{className:"space-y-2",children:V.map(R=>e.jsx("div",{className:"border rounded p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium truncate",title:R.name,children:R.name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Object.keys(R.filters).length," filters"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>X(R),className:"p-1 rounded hover:bg-gray-200",title:"Apply preset",children:e.jsx(Fs,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>me(R.id),className:"p-1 rounded hover:bg-red-100 text-red-600",title:"Delete preset",children:e.jsx(He,{className:"w-4 h-4"})})]})]})},R.id))})]}):e.jsxs(e.Fragment,{children:[e.jsx(_l,{cameras:F,yearRange:M,camera:c,setCamera:l,isoMin:d,setIsoMin:p,isoMax:b,setIsoMax:y,fMin:T,setFMin:P,fMax:m,setFMax:h,dateFrom:k,setDateFrom:v,dateTo:f,setDateTo:S,onApplyFilters:s,onClearFilters:$,compact:!0}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Basic Filters"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"flt-fav",children:"Favorites only"}),e.jsx("input",{id:"flt-fav",type:"checkbox",checked:r,onChange:R=>n(R.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-tags",children:"Tags (comma-separated)"}),e.jsx("input",{id:"flt-tags",className:"w-full border rounded px-2 py-1",value:i,onChange:R=>u(R.target.value),placeholder:"portrait, landscape, vacation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-place",children:"Location/Place"}),e.jsx("input",{id:"flt-place",className:"w-full border rounded px-2 py-1",value:j,onChange:R=>C(R.target.value),placeholder:"New York, Beach, Mountains"})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Search Features"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-caps",children:[e.jsx("span",{children:"Use AI captions"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search in generated image descriptions"})]}),e.jsx("input",{id:"flt-caps",type:"checkbox",checked:E,onChange:R=>w(R.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-ocr",children:[e.jsx("span",{children:"Use OCR"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Search for text within images"})]}),e.jsx("input",{id:"flt-ocr",type:"checkbox",checked:N,onChange:R=>_(R.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"flt-hastext",children:[e.jsx("span",{children:"Has text"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Only images containing readable text"})]}),e.jsx("input",{id:"flt-hastext",type:"checkbox",checked:z,onChange:R=>ee(R.target.checked)})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Minimum rating:"}),[0,1,2,3,4,5].map(R=>e.jsx("button",{type:"button",className:`px-2 py-1 rounded text-sm ${O===R?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,onClick:()=>Y(R),children:R===0?"Any":"".repeat(R)},R))]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Date Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-from-manual",children:"Date From"}),e.jsx("input",{id:"flt-date-from-manual",type:"date",className:"w-full border rounded px-2 py-1",value:k,onChange:R=>v(R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",htmlFor:"flt-date-to-manual",children:"Date To"}),e.jsx("input",{id:"flt-date-to-manual",type:"date",className:"w-full border rounded px-2 py-1",value:f,onChange:R=>S(R.target.value)})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t bg-gray-50",children:[e.jsx("button",{type:"button",onClick:$,className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear All Filters"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded border border-gray-300 hover:bg-gray-50",onClick:t,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",onClick:s,children:"Apply Filters"})]})]})]})})}function Al({selectedView:a,onViewChange:t,library:s=[],favorites:r=[],collections:n=[],clusters:i=[],savedSearches:u=[],smart:c=[],trips:l=[],isOpen:d=!1,onClose:p}){const b=[{id:"library",label:"All Photos",icon:mt,count:s?.length||0},{id:"results",label:"Search Results",icon:Ce},{id:"favorites",label:"Favorites",icon:Xt,count:r?.length||0}],y=[{id:"people",label:"People",icon:Ge,count:i?.length||0},{id:"map",label:"Places",icon:_s},{id:"calendar",label:"Calendar",icon:Ja},{id:"collections",label:"Collections",icon:Xa,count:n?.length||0},{id:"trips",label:"Trips",icon:ai,count:l?.length||0}],k=[{id:"smart",label:"Smart Collections",icon:ri,count:c?.length||0},{id:"saved",label:"Saved Searches",icon:Ce,count:u?.length||0},{id:"tasks",label:"Tasks",icon:ni}],v=f=>e.jsxs("button",{type:"button",onClick:()=>t(f.id),className:`nav-item ${a===f.id?"active":""}`,children:[e.jsxs("div",{className:"nav-item-content",children:[e.jsx(f.icon,{className:"nav-item-icon"}),e.jsx("span",{className:"nav-item-label",children:f.label})]}),f.count!==void 0&&e.jsx("span",{className:"nav-item-count",children:f.count})]},f.id);return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:p}),e.jsxs("div",{className:`sidebar-container ${d?"open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"sidebar-title",children:"PhotoVault"}),e.jsx("p",{className:"sidebar-subtitle",children:"AI-Powered Photo Management"})]}),e.jsx("button",{type:"button",onClick:p,className:"sidebar-close",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Library"}),e.jsx("div",{className:"nav-items",children:b.map(v)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Organize"}),e.jsx("div",{className:"nav-items",children:y.map(v)})]}),e.jsxs("div",{className:"nav-section",children:[e.jsx("h3",{className:"nav-section-title",children:"Smart Features"}),e.jsx("div",{className:"nav-items",children:k.map(v)})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsx("button",{type:"button",className:"sidebar-settings-button",onClick:()=>window.location.href="/settings",children:"Settings"})})]})]})}class Ul extends o.Component{constructor(s){super(s);oe(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});oe(this,"handleReload",()=>{window.location.reload()});oe(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),this.setState(n=>({errorInfo:r,errorCount:n.errorCount+1})),this.props.onError&&this.props.onError(s,r),typeof window<"u"&&window.logErrorToService&&window.logErrorToService({error:s.toString(),errorInfo:r.componentStack,timestamp:new Date().toISOString()})}render(){return this.state.hasError?this.props.fallback?e.jsx(e.Fragment,{children:this.props.fallback}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx(Za,{className:"w-6 h-6 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-center text-gray-900 mb-2",children:"Oops! Something unexpected happened"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Don't worry - your photos are safe. Let's get you back on track."}),!1,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:this.handleReset,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Os,{className:"w-4 h-4"}),"Try again"]}),e.jsx("button",{onClick:this.handleReload,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Reload page"}),e.jsxs("button",{onClick:this.handleGoHome,className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(er,{className:"w-4 h-4"}),"Go to home"]})]}),this.state.errorCount>2&&e.jsx("p",{className:"mt-4 text-xs text-center text-gray-500",children:"Having trouble? A quick refresh usually helps."})]})}):this.props.children}}class Ua extends o.Component{constructor(s){super(s);oe(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error(`Error in ${this.props.sectionName||"section"}:`,s),this.setState({errorInfo:r})}render(){return this.state.hasError?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Za,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-red-900",children:["Couldn't load ",this.props.sectionName||"this section"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:this.state.error?.message||"Something went wrong, but we can fix it"}),e.jsx("button",{onClick:this.handleReset,className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"Try again"})]})]})}):this.props.children}}class zl{constructor(){oe(this,"QUEUE_KEY","offline_action_queue");oe(this,"MAX_RETRIES",3);oe(this,"isOnline");oe(this,"syncInProgress",!1);oe(this,"listeners",new Set);this.isOnline=navigator.onLine,this.setupEventListeners(),this.checkConnection()}setupEventListeners(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),setInterval(()=>this.checkConnection(),3e4)}async checkConnection(){try{const t=await fetch("/api/ping",{method:"HEAD",cache:"no-cache"});this.setOnlineStatus(t.ok)}catch{this.setOnlineStatus(!1)}}setOnlineStatus(t){this.isOnline!==t&&(this.isOnline=t,this.notifyListeners(t),t&&this.syncQueue())}handleOnline(){console.log("[Offline Service] Connection restored"),this.setOnlineStatus(!0)}handleOffline(){console.log("[Offline Service] Connection lost"),this.setOnlineStatus(!1)}notifyListeners(t){this.listeners.forEach(s=>s(t))}onStatusChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}getStatus(){return this.isOnline}async queueAction(t){const s={...t,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),retries:0},r=this.getQueue();return r.push(s),this.saveQueue(r),this.isOnline&&this.syncQueue(),s.id}getQueue(){try{const t=localStorage.getItem(this.QUEUE_KEY);return t?JSON.parse(t):[]}catch{return[]}}saveQueue(t){try{localStorage.setItem(this.QUEUE_KEY,JSON.stringify(t))}catch(s){console.error("[Offline Service] Failed to save queue:",s)}}async syncQueue(){if(!this.isOnline||this.syncInProgress)return;this.syncInProgress=!0;const t=this.getQueue(),s=[];for(const r of t)try{await this.processAction(r),console.log(`[Offline Service] Synced action: ${r.id}`)}catch(n){console.error(`[Offline Service] Failed to sync action: ${r.id}`,n),r.retries++,r.retries<this.MAX_RETRIES?s.push(r):console.error(`[Offline Service] Max retries reached for action: ${r.id}`)}this.saveQueue(s),this.syncInProgress=!1,s.length>0&&setTimeout(()=>this.syncQueue(),6e4)}async processAction(t){const{apiSearch:s,apiSetCollection:r,apiBatchTag:n,apiBatchDelete:i}=await pe(async()=>{const{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}=await Promise.resolve().then(()=>ge);return{apiSearch:u,apiSetCollection:c,apiBatchTag:l,apiBatchDelete:d}},void 0,import.meta.url);switch(t.type){case"search":await s(t.payload.dir,t.payload.query,t.payload.topK);break;case"collection":await r(t.payload.dir,t.payload.name,t.payload.paths);break;case"tag":await n(t.payload.dir,t.payload.paths,t.payload.tags,t.payload.operation);break;case"delete":await i(t.payload.dir,t.payload.paths,t.payload.useOsTrash);break;default:throw new Error(`Unknown action type: ${t.type}`)}}async precacheImages(t){if("caches"in window)try{await(await caches.open("photovault-images")).addAll(t)}catch(s){console.error("[Offline Service] Failed to precache images:",s)}}async getCachedImage(t){if(!("caches"in window))return null;try{return await(await caches.open("photovault-images")).match(t)}catch{return null}}async registerBackgroundSync(t){if(!(!("serviceWorker"in navigator)||!("sync"in ServiceWorkerRegistration.prototype)))try{await(await navigator.serviceWorker.ready).sync.register(t),console.log(`[Offline Service] Background sync registered: ${t}`)}catch(s){console.error("[Offline Service] Failed to register background sync:",s)}}async clearOfflineData(){if(localStorage.removeItem(this.QUEUE_KEY),"caches"in window){const t=await caches.keys();await Promise.all(t.filter(s=>s.startsWith("photovault-")).map(s=>caches.delete(s)))}console.log("[Offline Service] Offline data cleared")}}const ws=new zl;function Bl(){const[a,t]=o.useState(!0),[s,r]=o.useState(!1),[n,i]=o.useState(!1);return o.useEffect(()=>(t(ws.getStatus()),ws.onStatusChange(c=>{t(c),r(!0),c&&(i(!0),ws.syncQueue().then(()=>{i(!1)})),setTimeout(()=>r(!1),3e3)})),[]),a&&!s&&!n?null:e.jsxs(e.Fragment,{children:[!a&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg shadow-lg",children:[e.jsx(Bt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Offline Mode"})]}),s&&e.jsx("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg transition-all duration-300 ${a?"bg-green-500 text-white":"bg-orange-500 text-white"}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Back Online"}),n&&e.jsx("div",{className:"text-sm opacity-90",children:"Syncing changes..."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Bt,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"You're Offline"}),e.jsx("div",{className:"text-sm opacity-90",children:"Changes will sync when reconnected"})]})]})}),n&&a&&!s&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Syncing offline changes..."})]})]})}function Zr({size:a="md",message:t,className:s="",inline:r=!1}){const n={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"};return r?e.jsxs("span",{className:`inline-flex items-center gap-2 ${s}`,children:[e.jsx(Na,{className:`${n[a]} animate-spin text-blue-600`}),t&&e.jsx("span",{className:"text-sm text-gray-600",children:t})]}):e.jsxs("div",{className:`flex flex-col items-center justify-center ${s}`,children:[e.jsx(Na,{className:`${n[a]} animate-spin text-blue-600`}),t&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t})]})}const en=o.createContext(null);function ql({children:a}){const[t,s]=o.useState(!0),[r,n]=o.useState(()=>localStorage.getItem("ps_theme")||"light"),[i,u]=o.useState({help:!1,onboarding:!1});o.useEffect(()=>{localStorage.setItem("ps_theme",r),r==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[r]);const c=o.useMemo(()=>({state:{sidebarOpen:t,theme:r,modals:i},actions:{toggleSidebar:()=>s(l=>!l),setTheme:n,openModal:l=>u(d=>({...d,[l]:!0})),closeModal:l=>u(d=>({...d,[l]:!1}))}}),[t,r,i]);return e.jsx(en.Provider,{value:c,children:a})}function Vl(){const a=o.useContext(en);if(!a)throw new Error("useUIContext must be used within UIProvider");return a}class Hl{constructor(){oe(this,"STORAGE_KEY","photo_search_history");oe(this,"MAX_HISTORY_ENTRIES",100);oe(this,"MAX_SUGGESTIONS",20)}getHistory(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?s:[]}catch{return[]}}addToHistory(t){try{const r=this.getHistory().filter(i=>i.query.toLowerCase()!==t.query.toLowerCase());r.unshift(t);const n=r.slice(0,this.MAX_HISTORY_ENTRIES);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(s){console.warn("Failed to save search history:",s)}}getSuggestions(t){const s=t.toLowerCase().trim();if(!s)return this.getRecentSuggestions();const r=this.getHistory(),n=[];return r.forEach(u=>{u.query.toLowerCase().includes(s)&&n.push({query:u.query,type:"history",score:this.calculateHistoryScore(u,s),metadata:{lastUsed:u.timestamp,useCount:this.getUseCount(u.query)}})}),this.generateSimilarQueries(s,r).forEach(u=>{n.push({query:u,type:"similar",score:this.calculateSimilarityScore(s,u)})}),n.sort((u,c)=>c.score-u.score).slice(0,this.MAX_SUGGESTIONS)}getRecentSuggestions(){return this.getHistory().slice(0,10).map(s=>({query:s.query,type:"history",score:this.calculateRecencyScore(s),metadata:{lastUsed:s.timestamp,useCount:this.getUseCount(s.query)}}))}calculateHistoryScore(t,s){const r=this.calculateRecencyScore(t),n=this.getUseCount(t.query)/10,i=this.calculateMatchScore(t.query,s);return r*.3+n*.3+i*.4}calculateRecencyScore(t){const r=Date.now()-t.timestamp,n=30*24*60*60*1e3;return Math.max(0,1-r/n)}calculateMatchScore(t,s){const r=t.toLowerCase(),n=s.toLowerCase();if(r===n)return 1;if(r.startsWith(n))return .9;if(r.includes(n))return .7;const i=r.split(/\s+/),u=n.split(/\s+/);return i.filter(l=>u.includes(l)).length/Math.max(i.length,u.length)}calculateSimilarityScore(t,s){return this.calculateMatchScore(s,t)*.6}getUseCount(t){return this.getHistory().filter(r=>r.query.toLowerCase()===t.toLowerCase()).length}generateSimilarQueries(t,s){const r=t.split(/\s+/),n=[];return s.forEach(i=>{const u=i.query.toLowerCase().split(/\s+/);r.filter(l=>u.some(d=>d.includes(l.toLowerCase()))).length>0&&i.query.toLowerCase()!==t.toLowerCase()&&n.push(i.query)}),Array.from(new Set(n)).slice(0,5)}clearHistory(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(t){console.warn("Failed to clear search history:",t)}}getPopularSearches(t=10){const s=this.getHistory(),r=new Map;return s.forEach(n=>{const i=n.query.toLowerCase();r.set(i,(r.get(i)||0)+1)}),Array.from(r.entries()).sort((n,i)=>i[1]-n[1]).slice(0,t).map(([n])=>n)}}const Jt=new Hl,Wl=Object.freeze(Object.defineProperty({__proto__:null,searchHistoryService:Jt},Symbol.toStringTag,{value:"Module"})),Gl=({onSearch:a,onClose:t})=>{const[s,r]=o.useState([]),[n,i]=o.useState(!1);o.useEffect(()=>{u()},[]);const u=()=>{const b=Jt.getHistory();r(b)},c=b=>{a(b),t()},l=()=>{Jt.clearHistory(),r([]),i(!1)},d=b=>{const k=Date.now()-b,v=Math.floor(k/(1e3*60)),f=Math.floor(k/(1e3*60*60)),S=Math.floor(k/(1e3*60*60*24));return v<1?"Just now":v<60?`${v}m ago`:f<24?`${f}h ago`:S<7?`${S}d ago`:new Date(b).toLocaleDateString()},p=b=>new Date(b).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"search-history-panel",children:[e.jsxs("div",{className:"search-history-header",children:[e.jsxs("div",{className:"search-history-title",children:[e.jsx(ht,{className:"w-5 h-5"}),e.jsx("span",{children:"Search History"})]}),e.jsxs("div",{className:"search-history-actions",children:[e.jsx("button",{onClick:()=>i(!0),className:"clear-history-btn",title:"Clear search history",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsx("button",{onClick:t,className:"close-btn",title:"Close",children:e.jsx(Te,{className:"w-4 h-4"})})]})]}),n&&e.jsx("div",{className:"clear-confirm-overlay",children:e.jsxs("div",{className:"clear-confirm-dialog",children:[e.jsx("p",{children:"Are you sure you want to clear your search history?"}),e.jsxs("div",{className:"clear-confirm-actions",children:[e.jsx("button",{onClick:()=>i(!1),className:"cancel-btn",children:"Cancel"}),e.jsx("button",{onClick:l,className:"confirm-btn",children:"Clear History"})]})]})}),e.jsx("div",{className:"search-history-content",children:s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(ht,{className:"w-12 h-12 text-gray-300"}),e.jsx("p",{children:"No search history yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your recent searches will appear here"})]}):e.jsx("div",{className:"search-history-list",children:s.map((b,y)=>e.jsx("div",{className:"search-history-item",children:e.jsxs("button",{onClick:()=>c(b.query),className:"search-history-button",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"search-query-container",children:[e.jsx("span",{className:"search-query",children:b.query}),e.jsxs("div",{className:"search-meta",children:[e.jsxs("span",{className:"result-count",children:[b.resultCount," results"]}),e.jsx("span",{className:"search-time",title:p(b.timestamp),children:d(b.timestamp)})]})]})]})},y))})}),e.jsx("style",{jsx:!0,children:`
        .search-history-panel {
          position: fixed;
          top: 0;
          right: 0;
          bottom: 0;
          width: 100%;
          max-width: 400px;
          background: white;
          border-left: 1px solid #e5e7eb;
          display: flex;
          flex-direction: column;
          z-index: 1000;
          box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .search-history-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
          background: #f9fafb;
        }

        .search-history-title {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: 600;
          font-size: 1.125rem;
        }

        .search-history-actions {
          display: flex;
          gap: 0.5rem;
        }

        .clear-history-btn,
        .close-btn {
          padding: 0.5rem;
          border-radius: 0.375rem;
          background: transparent;
          border: none;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s;
        }

        .clear-history-btn:hover {
          background: #fee2e2;
          color: #ef4444;
        }

        .close-btn:hover {
          background: #f3f4f6;
          color: #374151;
        }

        .search-history-content {
          flex: 1;
          overflow-y: auto;
        }

        .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          padding: 2rem;
          text-align: center;
          color: #6b7280;
        }

        .empty-state p {
          margin: 1rem 0 0.5rem;
        }

        .search-history-list {
          padding: 0.5rem;
        }

        .search-history-item {
          margin-bottom: 0.25rem;
        }

        .search-history-button {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          width: 100%;
          padding: 0.75rem;
          border-radius: 0.5rem;
          border: none;
          background: transparent;
          text-align: left;
          cursor: pointer;
          transition: background-color 0.2s;
        }

        .search-history-button:hover {
          background: #f3f4f6;
        }

        .search-query-container {
          flex: 1;
          min-width: 0;
        }

        .search-query {
          display: block;
          font-size: 0.875rem;
          font-weight: 500;
          color: #1f2937;
          margin-bottom: 0.25rem;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .search-meta {
          display: flex;
          gap: 0.75rem;
          font-size: 0.75rem;
          color: #6b7280;
        }

        .result-count::after {
          content: "";
          margin-left: 0.75rem;
        }

        .clear-confirm-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1001;
        }

        .clear-confirm-dialog {
          background: white;
          border-radius: 0.5rem;
          padding: 1.5rem;
          max-width: 300px;
          width: 90%;
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .clear-confirm-dialog p {
          margin-bottom: 1.5rem;
          text-align: center;
          font-size: 0.875rem;
          color: #374151;
        }

        .clear-confirm-actions {
          display: flex;
          gap: 0.75rem;
          justify-content: center;
        }

        .cancel-btn,
        .confirm-btn {
          padding: 0.5rem 1rem;
          border-radius: 0.375rem;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .cancel-btn {
          background: #f3f4f6;
          color: #374151;
        }

        .cancel-btn:hover {
          background: #e5e7eb;
        }

        .confirm-btn {
          background: #ef4444;
          color: white;
        }

        .confirm-btn:hover {
          background: #dc2626;
        }

        @media (max-width: 640px) {
          .search-history-panel {
            max-width: 100%;
          }
        }
      `})]})},tn=o.memo(({searchText:a,setSearchText:t,onSearch:s,clusters:r=[],allTags:n=[],meta:i={}})=>{const[u,c]=o.useState(!1),[l,d]=o.useState([]),[p,b]=o.useState(!1),y=o.useRef(null),k=Pi(a,150);o.useEffect(()=>{if(u){const m=Jt.getSuggestions(k);d(m)}},[k,u]);const v=m=>{s(m),c(!1)},f=m=>{const j=Date.now()-m,C=Math.floor(j/(1e3*60)),E=Math.floor(j/(1e3*60*60)),w=Math.floor(j/(1e3*60*60*24));return C<60?`${C}m ago`:E<24?`${E}h ago`:`${w}d ago`},T=u?(()=>{const m=a.toLowerCase(),h=[];l.length>0&&l.forEach(w=>{(!m||w.query.toLowerCase().includes(m))&&h.push({cat:w.type==="history"?"Recent":"Similar",label:w.query,icon:w.type==="history"?ht:oi,subtitle:w.metadata?.lastUsed?`${w.metadata.useCount||1} times, ${f(w.metadata.lastUsed)}`:void 0,type:"history"})});const j=(r||[]).map(w=>w.name).filter(Boolean);for(const w of j)(!m||w.toLowerCase().includes(m))&&h.push({cat:"People",label:w,type:"metadata"});for(const w of n||[])(!m||w.toLowerCase().includes(m))&&h.push({cat:"Tag",label:w,type:"metadata"});for(const w of i.cameras||[])(!m||w.toLowerCase().includes(m))&&h.push({cat:"Camera",label:w,type:"metadata"});for(const w of i.places||[])(!m||String(w).toLowerCase().includes(m))&&h.push({cat:"Place",label:String(w),type:"metadata"});const C=h.filter(w=>w.type==="history").slice(0,8),E=h.filter(w=>w.type==="metadata").slice(0,12);return[...C,...E].slice(0,20)})():[],P=(()=>{const m=[],h=(a||"").trim();if(!h)return m;try{let j=0;for(const w of h)if(w==="("?j++:w===")"&&j--,j<0){m.push("Unbalanced parentheses");break}j>0&&m.push("Unbalanced parentheses");const C=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),E=h.split(/\s+/);for(const w of E){const N=w.indexOf(":");if(N>0){const _=w.slice(0,N).toLowerCase();C.has(_)||m.push(`Unknown field: ${_}`)}}}catch{}return Array.from(new Set(m))})();return e.jsxs("div",{className:"search-bar-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(Ce,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"What are you looking for? Try 'kids at the park' or 'last summer'",value:a,onChange:m=>{t(m.target.value),c(!0)},onKeyDown:m=>{m.key==="Enter"&&v(a)},onFocus:()=>c(!0),onBlur:()=>setTimeout(()=>c(!1),120),ref:y,className:"search-input"}),e.jsx("button",{type:"button",onClick:()=>b(!0),className:"history-button",title:"View search history",children:e.jsx(ii,{className:"history-icon"})}),P.length>0&&e.jsx("div",{className:"ml-2 text-red-600 text-xs",title:P.join(`
`),"aria-label":"Query warnings",children:"!"})]}),P.length>0&&e.jsx("div",{className:"text-[11px] text-red-600 mt-1 px-1",children:P.slice(0,2).map((m,h)=>e.jsx("div",{children:m},h))}),u&&e.jsx("div",{className:"suggestions-dropdown",children:T.length===0?e.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No suggestions"}):T.map(m=>e.jsxs("button",{type:"button",className:"suggestion-item",onMouseDown:h=>{h.preventDefault();let j=m.label;m.cat==="People"?j=`person:"${m.label}"`:m.cat==="Camera"?j=`camera:"${m.label}"`:m.cat==="Place"?j=`place:"${m.label}"`:m.cat==="Tag"&&(j=`tag:${m.label}`);const C=(a||"").trim(),E=C?`${C} ${j}`:j;t(E),c(!1),setTimeout(()=>v(E),0)},children:[e.jsxs("div",{className:"suggestion-content",children:[m.icon&&e.jsx(m.icon,{className:"suggestion-icon"}),e.jsxs("div",{className:"suggestion-text",children:[e.jsxs("div",{className:"suggestion-main",children:[e.jsxs("span",{className:"suggestion-category",children:[m.cat,":"]}),e.jsx("span",{className:"suggestion-label",children:m.label})]}),m.subtitle&&e.jsx("div",{className:"suggestion-subtitle",children:m.subtitle})]})]}),e.jsx("span",{className:"suggestion-hint",children:""})]},`${m.cat}:${m.label}`))}),p&&e.jsx(Gl,{onSearch:m=>{t(m),v(m)},onClose:()=>b(!1)})]})});tn.displayName="SearchBar";const za={};function Kl({searchText:a,setSearchText:t,onSearch:s,clusters:r,allTags:n,meta:i,busy:u,gridSize:c,setGridSize:l,selectedView:d,setSelectedView:p,currentFilter:b,setCurrentFilter:y,ratingMin:k,setRatingMin:v,setModal:f,setIsMobileMenuOpen:S,setShowFilters:T,selected:P,setSelected:m,dir:h,engine:j,topK:C,useOsTrash:E,showInfoOverlay:w,onToggleInfoOverlay:N,resultView:_,onChangeResultView:z,timelineBucket:ee,onChangeTimelineBucket:O,diag:Y,isIndexing:F,onIndex:M,activeJobs:V,onOpenJobs:se,progressPct:B,etaSeconds:me,paused:L,onPause:Z,onResume:ie,tooltip:W,ocrReady:J,photoActions:A,uiActions:G,toastTimerRef:$,setToast:K,onOpenThemeModal:X}){const{state:R}=Vl();return e.jsxs("div",{className:"top-bar top-bar-mobile",children:[u&&e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill"})}),e.jsxs("div",{className:"top-bar-content",children:[e.jsxs("div",{className:"top-bar-left",children:[e.jsx("button",{type:"button",className:"mobile-menu-button",onClick:()=>S(!0),"aria-label":"Open menu",children:e.jsx(li,{className:"w-5 h-5"})}),e.jsx(tn,{searchText:a,setSearchText:t,onSearch:s,clusters:r,allTags:n,meta:i}),e.jsxs("div",{className:"quick-filters hidden md:flex items-center gap-2 ml-2",children:[(i?.cameras||[]).slice(0,3).map(U=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const ce=`camera:"${U}"`,Q=(a||"").trim(),ne=Q?`${Q} ${ce}`:ce;t(ne),s(ne)},title:`Filter camera: ${U}`,children:String(U)},`cam-${U}`)),(n||[]).slice(0,6).map(U=>e.jsxs("button",{type:"button",className:"chip",onClick:()=>{const ce=`tag:${U}`,Q=(a||"").trim(),ne=Q?`${Q} ${ce}`:ce;t(ne),s(ne)},title:`Filter tag: ${U}`,children:["#",U]},`tag-${U}`)),(r||[]).filter(U=>U.name).slice(0,6).map(U=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const Q=`person:"${String(U.name)}"`,ne=(a||"").trim(),H=ne?`${ne} ${Q}`:Q;t(H),s(H)},title:`Filter person: ${String(U.name)}`,children:String(U.name)},`person-${U.name}`)),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const U="has_text:true",ce=(a||"").trim(),Q=ce?`${ce} ${U}`:U;t(Q),s(Q)},title:"Filter photos that contain text",children:"Text"}),e.jsx("button",{type:"button",className:"chip",onClick:()=>{const U="(filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi) AND duration:>30",ce=(a||"").trim(),Q=ce?`${ce} ${U}`:U;t(Q),s(Q)},title:"Find videos longer than 30 seconds",children:"Videos > 30s"})]}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>T(U=>!U),"aria-label":"Show filters",children:[e.jsx(Ds,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Filters"})]}),/(camera:|tag:|person:|has_text:|iso:|fnumber:|width:|height:|place:)/i.test(a||"")&&e.jsx("button",{type:"button",className:"chip",onClick:()=>{const U=(a||"").replace(/\b(camera|tag|person|has_text|iso|fnumber|width|height|place):[^\s]+/gi,"").replace(/\s{2,}/g," ").trim();t(U),s(U)},title:"Clear filter tokens from query","aria-label":"Clear filter tokens",children:"Clear filters"}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>f({kind:"save"}),title:"Save this search for later","aria-label":"Save current search",children:[e.jsx(ci,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Remember"})]})]}),e.jsxs("div",{className:"top-bar-right",children:[Y&&(Y.engines?.length||0)>=1&&e.jsxs("div",{className:"indexed-chip relative",children:[e.jsx("span",{className:"indexed-label",children:"Indexed"}),e.jsx("span",{className:"indexed-count",children:Y.engines?.[0]?.count||0}),e.jsx("button",{type:"button",className:"indexed-action",onClick:()=>M&&M(),disabled:!!F,"aria-label":F?"Indexing photos (indeterminate)":Y.engines?.[0]?.count?"Reindex your library":"Start indexing your library",title:F?"Indexing runs in the background. You can keep working.":Y.engines?.[0]?.count?"Reindex photos":"Start indexing",children:F?"Indexing":Y.engines?.[0]?.count?"Reindex":"Index"}),F&&e.jsx("div",{className:"indexed-progress","aria-hidden":!0,children:e.jsx("div",{className:"indexed-progress-bar",style:typeof B=="number"&&B>=0&&B<=1?{width:`${Math.max(4,Math.round(B*100))}%`}:void 0})}),F&&typeof me=="number"&&isFinite(me)&&me>0&&e.jsxs("span",{className:"ml-2 text-[11px] text-gray-600",title:"Estimated time remaining",children:["~",Math.max(1,Math.ceil(me/60)),"m"]}),F&&e.jsx("button",{type:"button",className:"ml-2 chip",onClick:()=>L?ie?.():Z?.(),"aria-label":L?"Resume indexing":"Pause indexing",title:L?"Resume indexing":"Pause indexing",children:L?"Resume":"Pause"}),W&&e.jsx("div",{className:"tooltip-card",role:"tooltip","aria-hidden":!0,children:(W.split("  ")||[]).map((U,ce)=>e.jsx("div",{className:"tooltip-line",children:U},ce))})]}),J&&e.jsx("span",{className:"chip",title:"OCR ready: search text inside images",children:"OCR"}),typeof V=="number"&&V>0&&e.jsxs("button",{type:"button",className:"chip",onClick:()=>se&&se(),title:"View running tasks","aria-label":`Open Jobs (${V})`,children:["Jobs (",V,")"]}),e.jsx("div",{className:"grid-size-control",children:["small","medium","large"].map(U=>e.jsx("button",{type:"button",onClick:()=>l(U),className:`grid-size-button ${c===U?"active":""}`,"aria-label":`Set grid size to ${U}`,children:U.charAt(0).toUpperCase()+U.slice(1)},U))}),e.jsxs("div",{className:"view-mode-control",children:[e.jsx("button",{type:"button",onClick:()=>p("results"),className:`view-mode-button ${d==="results"?"active":""}`,"aria-label":"Grid view",children:e.jsx(mt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>p("library"),className:`view-mode-button ${d==="library"?"active":""}`,"aria-label":"List view",children:e.jsx(tr,{className:"w-4 h-4"})})]}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Settings & Indexing",onClick:()=>f({kind:"folder"}),"aria-label":"Open settings and indexing options",children:e.jsx(Pt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"mobile-menu-button",title:"Open theme settings","aria-label":"Open theme settings",onClick:()=>X?.(),children:e.jsx(kt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"filter-chips",children:["All","Today","This Week","This Month","Favorites","People","Screenshots"].map(U=>e.jsx("button",{type:"button",onClick:()=>{y(U.toLowerCase()),U==="Favorites"&&(A.setFavOnly(!0),s(a))},className:`chip ${b===U.toLowerCase()?"active":""}`,"aria-label":`Filter by ${U}`,children:U},U))}),e.jsxs("div",{className:"rating-filter",children:[e.jsx("span",{children:"Min rating:"}),[0,1,2,3,4,5].map(U=>e.jsx("button",{type:"button",className:`rating-button ${k===U?"active":""}`,onClick:()=>v(U),"aria-label":`Filter by minimum rating of ${U}`,children:U===0?"Any":`${"".repeat(U)}`},U))]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"View:"}),e.jsx("button",{type:"button",className:`view-button ${_==="grid"?"active":""}`,onClick:()=>z("grid"),"aria-pressed":_==="grid",children:"Grid"}),e.jsx("button",{type:"button",className:`view-button ${_==="timeline"?"active":""}`,onClick:()=>z("timeline"),"aria-pressed":_==="timeline",children:"Timeline"})]}),e.jsxs("div",{className:"text-[11px] text-gray-600 mt-1",children:["Boolean: AND, OR, NOT, ( )  Fields:"," ",e.jsx("span",{className:"font-mono",children:"camera:"})," ",e.jsx("span",{className:"font-mono",children:"place:"})," ",e.jsx("span",{className:"font-mono",children:"tag:"})," ",e.jsx("span",{className:"font-mono",children:"rating:"})," ",e.jsx("span",{className:"font-mono",children:"person:"})," ",e.jsx("span",{className:"font-mono",children:"has_text:"})," ",e.jsx("span",{className:"font-mono",children:"filetype:"}),"  Numeric:"," ",e.jsx("span",{className:"font-mono",children:"iso:"})," ",e.jsx("span",{className:"font-mono",children:"fnumber:"})," ",e.jsx("span",{className:"font-mono",children:"width:"})," ",e.jsx("span",{className:"font-mono",children:"height:"})," ",e.jsx("span",{className:"font-mono",children:"mtime:"})," ",e.jsx("span",{className:"font-mono",children:"brightness:"})," ",e.jsx("span",{className:"font-mono",children:"sharpness:"})," ",e.jsx("span",{className:"font-mono",children:"exposure:"})," ",e.jsx("span",{className:"font-mono",children:"focal:"})," ",e.jsx("span",{className:"font-mono",children:"duration:"})," (supports >=, <=, >, <, =)"]}),e.jsx("div",{className:"preset-filters hidden md:flex flex-wrap gap-2 mt-1",children:[{label:"High ISO",expr:"iso:>=1600"},{label:"Shallow DoF",expr:"fnumber:<2.8"},{label:"Text in Image",expr:"has_text:true"},{label:"Large",expr:"width:>=3000 height:>=2000"},{label:"Recent (30d)",expr:`mtime:>=${Math.floor(Date.now()/1e3-30*24*3600)}`},{label:"Underexposed",expr:"brightness:<50"},{label:"Sharp Only",expr:"sharpness:>=60"},{label:"Video > 30s",expr:"filetype:mp4 OR filetype:mov OR filetype:webm OR filetype:mkv OR filetype:avi AND duration:>30"}].map(U=>e.jsx("button",{type:"button",className:"chip",onClick:()=>{const ce=U.expr,Q=(a||"").trim(),ne=Q?`${Q} ${ce}`:ce;t(ne),s(ne)},title:U.expr,children:U.label},U.label))}),_==="timeline"&&e.jsxs("div",{className:"view-toggle",children:[e.jsx("span",{children:"Bucket:"}),["day","week","month"].map(U=>e.jsx("button",{type:"button",className:`view-button ${ee===U?"active":""}`,onClick:()=>O&&O(U),"aria-pressed":ee===U,children:U[0].toUpperCase()+U.slice(1)},U))]}),P.size>0&&e.jsxs("div",{className:"selected-actions",children:[e.jsxs("span",{className:"selected-count",children:[P.size," photo",P.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"export"}),"aria-label":"Export selected photos",children:[e.jsx(Me,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"enhanced-share"}),"aria-label":"Share selected photos",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Share"]}),za?.VITE_FF_SHARING_V1==="1"&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"share"}),"aria-label":"Share selected photos",children:[e.jsx(Ce,{className:"w-4 h-4"})," Share"]}),za?.VITE_FF_SHARING_V1==="1"&&e.jsx("button",{type:"button",className:"action-button",onClick:()=>f({kind:"shareManage"}),"aria-label":"Manage shared links",children:"Manage Shares"}),e.jsxs("button",{type:"button",className:`action-button ${w?"active":""}`,onClick:N,"aria-pressed":w,"aria-label":"Toggle info overlay on grid items",children:[e.jsx(Is,{className:"w-4 h-4"})," Info"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>f({kind:"advanced"}),"aria-label":"Open advanced search",children:"Advanced"}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"tag"}),"aria-label":"Tag selected photos",children:[e.jsx(Xa,{className:"w-4 h-4"}),"Tag"]}),P.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:async()=>{const U=Array.from(P)[0],{apiSearchLike:ce}=await pe(async()=>{const{apiSearchLike:Q}=await Promise.resolve().then(()=>ge);return{apiSearchLike:Q}},void 0,import.meta.url);G.setBusy("Searching similar");try{const Q=await ce(h,U,j,C);A.setResults(Q.results||[]),p("results")}catch(Q){G.setNote(Q instanceof Error?Q.message:"Search failed")}finally{G.setBusy("")}},"aria-label":"Find similar photos to the selected photo",children:[e.jsx(Ce,{className:"w-4 h-4"})," Similar"]}),P.size===1&&e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"likeplus"}),"aria-label":"Find similar photos with additional text query",children:[e.jsx(Ce,{className:"w-4 h-4"})," Similar + Text"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"collect"}),"aria-label":"Add selected photos to a collection",children:[e.jsx(We,{className:"w-4 h-4"})," Add to Collection"]}),e.jsxs("button",{type:"button",className:"action-button",onClick:()=>f({kind:"removeCollect"}),"aria-label":"Remove selected photos from a collection",children:[e.jsx(We,{className:"w-4 h-4 rotate-180"})," Remove from Collection"]}),e.jsxs("button",{type:"button",className:"action-button danger",onClick:async()=>{if(P.size!==0&&confirm(`Move ${P.size} item(s) to Trash?`))try{G.setBusy("Deleting");const U=await na(h,Array.from(P),E);G.setNote(`Moved ${U.moved} to ${E?"OS Trash":"Trash"}`),m(new Set),E?K({message:`Moved ${U.moved} to OS Trash`}):($.current&&window.clearTimeout($.current),K({message:`Moved ${U.moved} to Trash`,actionLabel:"Undo",onAction:async()=>{try{const ce=await ia(h);G.setNote(`Restored ${ce.restored}`)}catch{}K(null),$.current&&(window.clearTimeout($.current),$.current=null)}}),$.current=window.setTimeout(()=>{K(null),$.current=null},1e4))}catch(U){G.setNote(U instanceof Error?U.message:"Delete failed")}finally{G.setBusy("")}},"aria-label":"Delete selected photos",children:[e.jsx(He,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function Yl({items:a,note:t,diag:s,engine:r}){const n=a.length,i=(s?.engines||[]).find(c=>c.key===r),u=i?.fast&&(i.fast.annoy||i.fast.faiss||i.fast.hnsw);return e.jsx("div",{className:"stats-bar",children:e.jsxs("div",{className:"stats-content",children:[e.jsxs("div",{className:"stats-left",children:[e.jsxs("span",{children:[n," photos"]}),t?e.jsx("span",{className:"text-gray-800",children:t}):null]}),e.jsxs("div",{className:"stats-right",children:[e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${i?.count?"ready":"empty"}`}),e.jsxs("span",{children:["AI Index ",i?.count?"Ready":"Empty"]})]}),e.jsxs("div",{className:"status-indicator",children:[e.jsx("div",{className:`status-dot ${u?"fast-ready":"empty"}`}),e.jsxs("span",{children:["Fast Index ",u?"Ready":""]})]})]})]})})}function Ql({activeTab:a,onTabChange:t,onShowFilters:s,onShowUpload:r,onShowLibrary:n,showSecondaryActions:i=!0}){const u=[{id:"home",icon:er,label:"Home"},{id:"search",icon:Ce,label:"Search"},{id:"favorites",icon:Xt,label:"Favorites"},{id:"settings",icon:Pt,label:"Settings"}];return e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 md:hidden",children:[i&&e.jsxs("div",{className:"flex items-center justify-around py-2 px-4 border-b border-gray-100",children:[e.jsxs("button",{type:"button",onClick:s,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-blue-600 transition-colors","aria-label":"Show filters",children:[e.jsx(Ds,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Filters"})]}),e.jsxs("button",{type:"button",onClick:r,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-green-600 transition-colors","aria-label":"Upload",children:[e.jsx(ct,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Upload"})]}),e.jsxs("button",{type:"button",onClick:n,className:"flex flex-col items-center gap-1 p-2 text-gray-600 hover:text-purple-600 transition-colors","aria-label":"Library",children:[e.jsx(We,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Library"})]})]}),e.jsx("div",{className:"flex items-center justify-around py-2 px-4",children:u.map(({id:c,icon:l,label:d})=>e.jsxs("button",{type:"button",onClick:()=>t(c),className:`flex flex-col items-center gap-1 p-2 min-w-[64px] transition-colors ${a===c?"text-blue-600":"text-gray-600 hover:text-gray-900"}`,"aria-label":d,"aria-current":a===c,children:[e.jsx(l,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs font-medium",children:d}),a===c&&e.jsx("div",{className:"w-1 h-1 bg-blue-600 rounded-full mt-1"})]},c))})]})}function Jl({currentDir:a,provider:t}){const[s,r]=o.useState([]),[n,i]=o.useState(!1),[u,c]=o.useState(!1),[l,d]=o.useState(null),[p,b]=o.useState(null),[y,k]=o.useState(null);o.useEffect(()=>{a&&v()},[a]);const v=async()=>{try{i(!0),k(null);const m=await Rr(a);r(m.videos)}catch(m){k(m instanceof Error?m.message:"Failed to load videos")}finally{i(!1)}},f=async()=>{try{c(!0),k(null);const m=await Ur(a,t);alert(`Indexed ${m.indexed} out of ${m.total} videos`),await v()}catch(m){k(m instanceof Error?m.message:"Failed to index videos")}finally{c(!1)}},S=async m=>{d(m);try{const h=await Lr(a,m.path);b(h.metadata)}catch(h){console.error("Failed to load video metadata:",h),b(null)}},T=m=>{const h=["Bytes","KB","MB","GB","TB"];if(m===0)return"0 Bytes";const j=Math.floor(Math.log(m)/Math.log(1024));return Math.round(m/Math.pow(1024,j)*100)/100+" "+h[j]},P=m=>{const h=Math.floor(m/60),j=Math.floor(m%60);return`${h}:${j.toString().padStart(2,"0")}`};return n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(Zr,{})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Video Manager"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:v,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"Refresh"}),e.jsx("button",{onClick:f,disabled:u||s.length===0,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:u?"Indexing...":"Index Videos"})]})]}),y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:y}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Videos (",s.length,")"]}),s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No videos found in this directory"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.map((m,h)=>e.jsxs("div",{onClick:()=>S(m),className:`p-3 border rounded cursor-pointer transition-colors ${l?.path===m.path?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium truncate",title:m.path,children:m.path.split("/").pop()||m.path}),e.jsxs("div",{className:"text-sm text-gray-500",children:[T(m.size),"  ",new Date(m.mtime*1e3).toLocaleDateString()]})]},h))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Video Details"}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video bg-gray-100 rounded overflow-hidden",children:e.jsx("img",{src:Ar(a,l.path),alt:"Video thumbnail",className:"w-full h-full object-cover",onError:m=>{m.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjNjM2MzYzIi8+Cjwvc3ZnPgo="}})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded space-y-2",children:[e.jsx("div",{className:"font-medium",children:"File Information"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Path:"})," ",l.path]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",T(l.size)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Modified:"})," ",new Date(l.mtime*1e3).toLocaleString()]})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium mt-4",children:"Video Metadata"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Dimensions:"})," ",p.width,"  ",p.height]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Rate:"})," ",p.fps?.toFixed(2)," fps"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",P(p.duration)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frame Count:"})," ",p.frame_count?.toLocaleString()]})]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Select a video to view details"})]})]})]})}const sn=o.memo(()=>{const[a,t]=o.useState(null),[s,r]=o.useState(!1);return o.useEffect(()=>{},[]),o.useEffect(()=>{const n=i=>{i.ctrlKey&&i.shiftKey&&i.key==="P"&&r(u=>!u)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[]),null});sn.displayName="PerformanceMonitor";function Xl({open:a,onClose:t,onApply:s,onSave:r,allTags:n,cameras:i,people:u}){const[c,l]=o.useState(""),[d,p]=o.useState(""),[b,y]=o.useState(""),[k,v]=o.useState(""),[f,S]=o.useState(""),[T,P]=o.useState("any"),[m,h]=o.useState(""),[j,C]=o.useState(""),[E,w]=o.useState(""),[N,_]=o.useState(""),[z,ee]=o.useState(""),[O,Y]=o.useState(""),[F,M]=o.useState(""),V=o.useMemo(()=>{const B=[];return c.trim()&&B.push(c.trim()),d.trim()&&B.push(`camera:"${d.trim()}"`),b.trim()&&B.push(`place:"${b.trim()}"`),k.trim()&&B.push(`tag:${k.trim()}`),f.trim()&&B.push(`person:"${f.trim()}"`),T==="true"&&B.push("has_text:true"),T==="false"&&B.push("has_text:false"),m.trim()&&B.push(`iso:>=${m.trim()}`),j.trim()&&B.push(`fnumber:<${j.trim()}`),E.trim()&&B.push(`width:>=${E.trim()}`),N.trim()&&B.push(`height:>=${N.trim()}`),z.trim()&&B.push(`filetype:${z.trim().toLowerCase()}`),O.trim()&&B.push(`duration:>${O.trim()}`),B.join(" AND ")},[c,d,b,k,f,T,m,j,E,N,z,O]),se=o.useMemo(()=>{const B=[],me=V||"";let L=0;for(const Z of me)if(Z==="("?L++:Z===")"&&L--,L<0){B.push("Unbalanced parentheses");break}L>0&&B.push("Unbalanced parentheses");try{const Z=new Set(["camera","place","tag","rating","person","has_text","filetype","iso","fnumber","width","height","mtime","brightness","sharpness","exposure","focal","duration"]),ie=me.split(/\s+/);for(const W of ie){const J=W.indexOf(":");if(J>0){const A=W.slice(0,J).toLowerCase();Z.has(A)||B.push(`Unknown field: ${A}`)}}}catch{}return Array.from(new Set(B))},[V]);return a?e.jsxs("div",{className:"fixed inset-0 z-[1080] flex items-center justify-center",onKeyDown:B=>{B.key==="Escape"&&t()},children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close"}),e.jsxs("div",{className:"relative z-[1081] bg-white dark:bg-gray-900 rounded-lg shadow p-4 w-full max-w-2xl",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Advanced Search"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Base Text"}),e.jsx("input",{className:"input",value:c,onChange:B=>l(B.target.value),placeholder:'e.g., "golden hour" OR beach'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Camera"}),e.jsx("input",{list:"cam-list",className:"input",value:d,onChange:B=>p(B.target.value),placeholder:"Canon, Sony..."}),e.jsx("datalist",{id:"cam-list",children:i.map(B=>e.jsx("option",{value:B},B))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Place"}),e.jsx("input",{className:"input",value:b,onChange:B=>y(B.target.value),placeholder:"City, location..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Tag"}),e.jsx("input",{list:"tag-list",className:"input",value:k,onChange:B=>v(B.target.value),placeholder:"Any tag"}),e.jsx("datalist",{id:"tag-list",children:n.map(B=>e.jsx("option",{value:B},B))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Person"}),e.jsx("input",{list:"person-list",className:"input",value:f,onChange:B=>S(B.target.value),placeholder:"Person name"}),e.jsx("datalist",{id:"person-list",children:u.map(B=>e.jsx("option",{value:B},B))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Has Text"}),e.jsxs("select",{className:"input",value:T,onChange:B=>P(B.target.value),children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"ISO "}),e.jsx("input",{className:"input",value:m,onChange:B=>h(B.target.value),placeholder:"e.g., 1600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"f-number <"}),e.jsx("input",{className:"input",value:j,onChange:B=>C(B.target.value),placeholder:"e.g., 2.8"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Width "}),e.jsx("input",{className:"input",value:E,onChange:B=>w(B.target.value),placeholder:"e.g., 3000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Height "}),e.jsx("input",{className:"input",value:N,onChange:B=>_(B.target.value),placeholder:"e.g., 2000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Filetype"}),e.jsx("input",{className:"input",value:z,onChange:B=>ee(B.target.value),placeholder:"jpg, png, mp4, ..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Duration > (s)"}),e.jsx("input",{className:"input",value:O,onChange:B=>Y(B.target.value),placeholder:"e.g., 30"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Preview"}),e.jsx("div",{className:"text-sm font-mono bg-gray-100 dark:bg-gray-800 rounded p-2 break-words",style:{minHeight:"2.2rem"},children:V||""}),se.length>0&&e.jsx("ul",{className:"mt-2 text-xs text-red-600 list-disc pl-5",children:se.map((B,me)=>e.jsx("li",{children:B},me))})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",placeholder:"Preset name",value:F,onChange:B=>M(B.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{F.trim()&&(r(F.trim(),V),M(""))},children:"Save Preset"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:t,children:"Close"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(V),children:"Apply"})]})]})]})]}):null}const Zl=({onEscape:a,children:t})=>e.jsx("div",{children:t}),ec=({selected:a,dir:t,onClose:s,uiActions:r})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:n=>{n.key==="Escape"&&s()},children:e.jsx(Zl,{onEscape:s,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Export Selected"}),e.jsxs("form",{onSubmit:n=>{n.preventDefault();const i=n.target,u=i.elements.namedItem("dest").value.trim();if(!u)return;const c=i.elements.namedItem("preset")?.value||"web",l=i.elements.namedItem("strip_all")?.checked||!1,d=i.elements.namedItem("strip_gps")?.checked||!1,p=i.elements.namedItem("keep_copy")?.checked||!1,b=i.elements.namedItem("overwrite")?.checked||!1;(async()=>{try{const y=Array.from(a),k=c;let v,f;if(k==="custom"){const T=parseInt(i.elements.namedItem("custom_long")?.value||""),P=parseInt(i.elements.namedItem("custom_quality")?.value||"");v=isNaN(T)?void 0:T,f=isNaN(P)?void 0:P}const S=await pt(t,y,u,"copy",l,b,{stripGps:d,keepCopyrightOnly:p,preset:k,resizeLong:v,quality:f});r.setNote(`Exported ${S.copied}, skipped ${S.skipped}, errors ${S.errors}  ${S.dest}`)}catch(y){r.setNote(y instanceof Error?y.message:"Export failed")}})(),s()},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"dest-input",children:"Destination"}),e.jsx("input",{id:"dest-input",name:"dest",className:"w-full border rounded px-2 py-1",placeholder:"/absolute/path"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-sm font-medium mb-1",children:"Preset"}),e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"web",defaultChecked:!0})," Web"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"email"})," Email"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"print"})," Print"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"preset",value:"custom"})," Custom"]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Custom long edge"}),e.jsx("input",{type:"number",name:"custom_long",className:"border rounded px-2 py-1 w-28",placeholder:"1600"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-28",children:"Quality (1100)"}),e.jsx("input",{type:"number",name:"custom_quality",min:1,max:100,className:"border rounded px-2 py-1 w-28",placeholder:"85"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Privacy"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_all"})," Strip all EXIF/IPTC"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"strip_gps"})," Strip GPS only"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"keep_copy"})," Keep copyright only"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Options"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"overwrite"})," Overwrite existing files"]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:s,"aria-label":"Cancel export",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Export selected photos",children:"Export"})]})]})]})})}),tc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),sc=({onClose:a,onTagSelected:t})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:s=>{s.key==="Escape"&&a()},children:e.jsx(tc,{onEscape:a,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Tag Selected"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Enter comma-separated tags"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault();const n=s.target.elements.namedItem("tags").value.trim();n&&(t(n),a())},children:[e.jsx("label",{htmlFor:"tags-input",className:"sr-only",children:"Tags"}),e.jsx("input",{id:"tags-input",name:"tags",className:"w-full border rounded px-2 py-1",placeholder:"family, beach, 2024"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:a,"aria-label":"Cancel tagging",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save tags",children:"Save"})]})]})]})})});function ac({onFolderSelect:a,currentPath:t}){const[s,r]=o.useState(t||""),[n,i]=o.useState(!1),[u,c]=o.useState(null),[l,d]=o.useState(""),p=o.useCallback(async f=>{if(f.trim()){i(!0),d("");try{const S=await fetch(`${ue}/scan_count`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([f])});if(!S.ok)throw new Error("Failed to scan folder");const T=await S.json();T.items&&T.items.length>0&&c(T.items[0])}catch(S){d(S instanceof Error?S.message:"Failed to scan folder"),c(null)}finally{i(!1)}}},[]),b=o.useCallback(()=>{p(s)},[s,p]),y=o.useCallback(()=>{u&&u.exists&&u.files>0&&a(u.path)},[u,a]),k=f=>{if(f===0)return"0 Bytes";const S=1024,T=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(f)/Math.log(S));return parseFloat((f/Math.pow(S,P)).toFixed(2))+" "+T[P]},v=[{name:"Pictures",path:"~/Pictures"},{name:"Desktop",path:"~/Desktop"},{name:"Downloads",path:"~/Downloads"},{name:"Documents",path:"~/Documents"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Folder Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:f=>r(f.target.value),placeholder:"/path/to/your/photos or ~/Pictures",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:f=>f.key==="Enter"&&b()}),e.jsx("button",{onClick:b,disabled:n||!s.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4 animate-spin"}),"Scanning"]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4"}),"Scan"]})})]})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Qa,{className:"w-4 h-4"}),l]}),u&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Path:"}),e.jsx("span",{className:"text-sm text-gray-600 truncate",children:u.path})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx("span",{className:`text-sm ${u.exists?"text-green-600":"text-red-600"}`,children:u.exists?"Exists":"Not Found"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Photos Found:"}),e.jsx("span",{className:"text-sm text-gray-600",children:u.files})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Size:"}),e.jsx("span",{className:"text-sm text-gray-600",children:k(u.bytes)})]})]}),u.exists&&u.files>0&&e.jsxs("button",{onClick:y,className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:["Use This Folder (",u.files," photos)"]}),u.exists&&u.files===0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-sm text-yellow-800",children:"No photos found in this folder. Supported formats: JPG, PNG, GIF, TIF, WebP, HEIC, MP4, MOV, MKV, AVI, WebM"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Quick Select:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.map(f=>e.jsx("button",{onClick:()=>{r(f.path),p(f.path)},className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:f.name},f.path))})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Tip: You can also drag and drop a folder onto the app, or use the file picker in the main interface."})]})}const rc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),nc=({dir:a,useOsTrash:t,useFast:s,fastKind:r,useCaps:n,useOcr:i,hasText:u,highContrast:c,onClose:l,settingsActions:d,uiActions:p,doIndex:b,prepareFast:y,buildOCR:k,buildMetadata:v})=>{const[f,S]=o.useState(a),T=m=>{S(m)},P=async m=>{if(m.preventDefault(),f){d.setDir(f),l();try{await et(f),await b()}catch(h){console.error("Failed to add path or index:",h),p.setNote(h instanceof Error?h.message:"Failed to add path")}}};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:m=>{m.key==="Escape"&&l()},children:e.jsx(rc,{onEscape:l,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-4",children:"Set Photo Folder"}),e.jsx(ac,{onFolderSelect:T,currentPath:f}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("label",{htmlFor:"use-os-trash",className:"text-sm",children:"Use OS Trash (no Undo)"}),e.jsx("input",{id:"use-os-trash",type:"checkbox",checked:t,onChange:m=>d.setUseOsTrash(m.target.checked)})]}),e.jsxs("div",{className:"mt-4 border-t pt-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Preferences"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-fast",children:"Use Fast Index"}),e.jsx("input",{id:"pref-fast",type:"checkbox",checked:s,onChange:m=>d.setUseFast(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{htmlFor:"pref-fastkind",children:"Fast Kind"}),e.jsxs("select",{id:"pref-fastkind",className:"border rounded px-2 py-1",value:r,onChange:m=>d.setFastKind(m.target.value),children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"annoy",children:"Annoy"}),e.jsx("option",{value:"faiss",children:"FAISS"}),e.jsx("option",{value:"hnsw",children:"HNSW"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-caps",children:"Use Captions"}),e.jsx("input",{id:"pref-caps",type:"checkbox",checked:n,onChange:m=>d.setUseCaps(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-ocr",children:"Use OCR"}),e.jsx("input",{id:"pref-ocr",type:"checkbox",checked:i,onChange:m=>d.setUseOcr(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-hastext",children:"Default: Has Text"}),e.jsx("input",{id:"pref-hastext",type:"checkbox",checked:u,onChange:m=>d.setHasText(m.target.checked)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pref-high-contrast",children:"High Contrast"}),e.jsx("input",{id:"pref-high-contrast",type:"checkbox",checked:c,onChange:m=>d.setHighContrast(m.target.checked)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pref-vlm",className:"block mb-1",children:"VLM Model"}),e.jsx("input",{id:"pref-vlm",className:"w-full border rounded px-2 py-1",defaultValue:"",onChange:m=>{}})]})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:b,"aria-label":"Index files in the selected folder",children:"Index"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>y("annoy"),"aria-label":"Prepare fast index",children:"Fast"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:k,"aria-label":"Build OCR index",children:"OCR"}),e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:v,"aria-label":"Build metadata index",children:"Metadata"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:l,"aria-label":"Close settings",children:"Close"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save settings",children:"Save"})]})]})]})]})})})},ic=({onEscape:a,children:t})=>e.jsx("div",{children:t}),oc=({selected:a,dir:t,engine:s,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(ic,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Similar + Text"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const d=l.target,p=d.elements.namedItem("text").value.trim(),b=parseFloat(d.elements.namedItem("weight").value);if(a.size===1)try{const y=Array.from(a)[0],{apiSearchLikePlus:k}=await pe(async()=>{const{apiSearchLikePlus:f}=await Promise.resolve().then(()=>ge);return{apiSearchLikePlus:f}},void 0,import.meta.url);c.setBusy("Searching");const v=await k(t,y,s,r,p||void 0,Number.isNaN(b)?.5:b);u.setResults(v.results||[]),i("results")}catch(y){c.setNote(y instanceof Error?y.message:"Search failed")}finally{c.setBusy("")}n()},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"likeplus-text",children:"Text (optional)"}),e.jsx("input",{id:"likeplus-text",name:"text",className:"w-full border rounded px-2 py-1",placeholder:"e.g. beach at sunset"}),e.jsx("label",{className:"block text-sm mt-3 mb-1",htmlFor:"mix-weight",children:"Weight (image vs text)"}),e.jsx("input",{id:"mix-weight",name:"weight",type:"range",min:"0",max:"1",step:"0.05",defaultValue:"0.5",className:"w-full"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel similar search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Search for similar photos with text",children:"Search"})]})]})]})})}),lc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),cc=({dir:a,searchText:t,query:s,topK:r,onClose:n,setSelectedView:i,photoActions:u,uiActions:c})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:l=>{l.key==="Escape"&&n()},children:e.jsx(lc,{onEscape:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Save Search"}),e.jsxs("form",{onSubmit:async l=>{l.preventDefault();const p=l.target.elements.namedItem("name").value.trim();if(p){try{const{apiAddSaved:b,apiGetSaved:y}=await pe(async()=>{const{apiAddSaved:v,apiGetSaved:f}=await Promise.resolve().then(()=>ge);return{apiAddSaved:v,apiGetSaved:f}},void 0,import.meta.url);await b(a,p,t||s||"",r);const k=await y(a);u.setSaved(k.saved||[]),i("saved")}catch(b){c.setNote(b instanceof Error?b.message:"Save failed")}n()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"save-name",children:"Name"}),e.jsx("input",{id:"save-name",name:"name",className:"w-full border rounded px-2 py-1",placeholder:"e.g. Dogs on beach"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:n,"aria-label":"Cancel saving search",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Save search",children:"Save"})]})]})]})})}),dc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),uc=({selected:a,dir:t,collections:s,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(dc,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Add to Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiSetCollection:p,apiGetCollections:b}=await pe(async()=>{const{apiSetCollection:k,apiGetCollections:v}=await Promise.resolve().then(()=>ge);return{apiSetCollection:k,apiGetCollections:v}},void 0,import.meta.url);await p(t,d,Array.from(a));const y=await b(t);i.setCollections(y.collections||{}),n({message:`Added ${a.size} to ${d}`})}catch(p){u.setNote(p instanceof Error?p.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name",children:"Collection"}),e.jsx("input",{id:"col-name",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Type or choose"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(s||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel adding to collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Add to collection",children:"Add"})]})]})]})})}),hc=({onEscape:a,children:t})=>e.jsx("div",{children:t}),mc=({selected:a,dir:t,collections:s,onClose:r,setToast:n,photoActions:i,uiActions:u})=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:c=>{c.key==="Escape"&&r()},children:e.jsx(hc,{onEscape:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Remove from Collection"}),e.jsxs("form",{onSubmit:async c=>{c.preventDefault();const d=c.target.elements.namedItem("name").value.trim();if(d){try{const{apiGetCollections:p,apiSetCollection:b}=await pe(async()=>{const{apiGetCollections:S,apiSetCollection:T}=await Promise.resolve().then(()=>ge);return{apiGetCollections:S,apiSetCollection:T}},void 0,import.meta.url),k=(await p(t)).collections?.[d]||[],v=k.filter(S=>!a.has(S));await b(t,d,v);const f=await p(t);i.setCollections(f.collections||{}),n({message:`Removed ${k.length-v.length} from ${d}`})}catch(p){u.setNote(p instanceof Error?p.message:"Collection update failed")}r()}},children:[e.jsx("label",{className:"block text-sm mb-1",htmlFor:"col-name-remove",children:"Collection"}),e.jsx("input",{id:"col-name-remove",name:"name",list:"collections-list",className:"w-full border rounded px-2 py-1",placeholder:"Choose collection"}),e.jsx("datalist",{id:"collections-list",children:Object.keys(s||{}).map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:r,"aria-label":"Cancel removing from collection",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Remove from collection",children:"Remove"})]})]})]})})}),xc=[{key:"D",shift:!0,description:"Toggle dark mode",action:()=>{try{const t=document.documentElement.classList.toggle("dark");localStorage.setItem("ps_theme",t?"dark":"light")}catch{}}},{key:"/",description:"Focus search",action:()=>{document.querySelector('input[placeholder*="Try"]')?.focus()}},{key:"a",description:"Open Advanced Search",action:()=>{const a=document.querySelector('[aria-label*="Open advanced search"]');a&&a.click()}},{key:"t",description:"Timeline: Jump to Today",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"today"}}))}},{key:"m",description:"Timeline: Jump to This Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"this-month"}}))}},{key:"l",description:"Timeline: Jump to Last Month",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"last-month"}}))}},{key:"o",description:"Timeline: Jump to Oldest",action:()=>{window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:"oldest"}}))}},{key:"Escape",description:"Close modal/Clear selection",action:()=>{const a=document.querySelector('[aria-label*="Close"]');a?.click(),a||document.querySelector('button:has-text("Clear Selection")')?.click()}},{key:"g",shift:!0,description:"Toggle grid view",action:()=>{document.querySelector('[aria-label*="Grid"]')?.click()}},{key:"l",shift:!0,description:"Toggle list view",action:()=>{document.querySelector('[aria-label*="List"]')?.click()}},{key:"a",ctrl:!0,description:"Select all",action:()=>{document.querySelector('[aria-label*="Select all"]')?.click()},enabled:!0},{key:"d",ctrl:!0,description:"Deselect all",action:()=>{document.querySelector('[aria-label*="Clear selection"]')?.click()},enabled:!0},{key:"Delete",description:"Delete selected",action:()=>{document.querySelector('button:has-text("Delete")')?.click()}},{key:"f",ctrl:!0,description:"Focus filter",action:()=>{document.querySelector('[placeholder*="Filter"]')?.focus()},enabled:!0},{key:"n",ctrl:!0,description:"New collection",action:()=>{document.querySelector('button:has-text("New Collection")')?.click()},enabled:!0},{key:"e",ctrl:!0,description:"Export selected",action:()=>{document.querySelector('button:has-text("Export")')?.click()},enabled:!0},{key:"s",ctrl:!0,description:"Save search",action:()=>{document.querySelector('button:has-text("Save Search")')?.click()},enabled:!0},{key:"ArrowLeft",description:"Previous photo",action:()=>{document.querySelector('[aria-label*="Previous"]')?.click()}},{key:"ArrowRight",description:"Next photo",action:()=>{document.querySelector('[aria-label*="Next"]')?.click()}},{key:" ",description:"Play/Pause slideshow",action:()=>{document.querySelector('[aria-label*="Play"]')?.click()}},{key:"i",description:"Toggle info panel",action:()=>{document.querySelector('[aria-label*="Info"]')?.click()}},{key:"?",shift:!0,description:"Show keyboard shortcuts",action:()=>{document.querySelector('[aria-label*="Help"]')?.click()}},{key:"h",description:"Go home",action:()=>{window.location.href="/"}},{key:"1",description:"Photos view",action:()=>{document.querySelector('[href*="/photos"]')?.click()}},{key:"2",description:"Albums view",action:()=>{document.querySelector('[href*="/albums"]')?.click()}},{key:"3",description:"People view",action:()=>{document.querySelector('[href*="/people"]')?.click()}}];function an(){const a=xc,t=s=>{const r=[];return s.ctrl&&r.push("Ctrl"),s.alt&&r.push("Alt"),s.shift&&r.push("Shift"),s.meta&&r.push("Cmd"),r.push(s.key===" "?"Space":s.key),r.join("+")};return a.map(s=>({keys:t(s),description:s.description}))}function pc({isOpen:a,onClose:t}){const s=an();if(!a)return null;const r={Navigation:["/","1","2","3","Arrow","t","m","l","o"],Selection:["Ctrl+A","Ctrl+D","Space"],Actions:["Delete","Ctrl+E","Ctrl+S","Ctrl+N","a"],View:["Shift+G","Shift+L","i"],General:["Escape","Shift+?"]},n=i=>s.filter(u=>{const c=u.keys.toLowerCase();return i.some(l=>c.includes(l.toLowerCase()))});return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:i=>{i.key==="Escape"&&t()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close shortcuts",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(r).map(([i,u])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:i}),e.jsx("div",{className:"space-y-2",children:n(u).map((c,l)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded border border-gray-300 dark:border-gray-600",children:c.keys})]},l))})]},i))}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Pro Tips"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsxs("li",{children:[" Press ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"?"})," anytime to show this help"]}),e.jsx("li",{children:" Most shortcuts work globally except when typing in inputs"}),e.jsxs("li",{children:[" Use ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 rounded",children:"Escape"})," to close modals or clear selection"]}),e.jsx("li",{children:" Navigate photos with arrow keys in lightbox view"})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Press any key to try it out"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})})]})})}function gc({isOpen:a,onClose:t,initialSection:s="getting-started"}){const[r,n]=o.useState(s),[i,u]=o.useState(!1),c=an();if(!a)return null;const l=[{id:"getting-started",title:"Getting Started",icon:e.jsx(dt,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Welcome to Photo Search!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Your AI-powered photo search and management tool. Here's how to get started:"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["Tip: Press ",e.jsx("span",{className:"font-mono",children:"?"})," anytime to open this help."]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-1",children:"Select Your Photo Directory"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"Choose the folder containing your photos. The app will index them for fast searching."})]})]})}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-1",children:"Try the Demo Library"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400",children:`Don't have photos ready? Click "Try Demo" to explore with sample photos and see how search works.`})]})]})}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-800 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-semibold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-300 mb-1",children:"Start Searching"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-400",children:'Use natural language to search: "beach sunset", "family photos", "mountains", or "red car".'})]})]})})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 dark:text-yellow-300 mb-2",children:" Pro Tip"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:`The more specific your search terms, the better results you'll get. Try combining concepts like "golden hour beach wedding" or "snowy mountain landscape".`})]})]})},{id:"features",title:"Features",icon:e.jsx(Fs,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Powerful Features"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Discover what makes Photo Search special:"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Ce,{className:"w-6 h-6 text-blue-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"AI-Powered Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search by visual content, not just filenames. Find photos using natural language descriptions."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Ge,{className:"w-6 h-6 text-green-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Face Recognition"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Automatically detect and group photos by people. Find all photos of specific individuals."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(_s,{className:"w-6 h-6 text-red-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Location Search"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Search photos by location data. Find all photos taken in Paris, at the beach, or at home."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Ht,{className:"w-6 h-6 text-yellow-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Smart Collections"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Create dynamic collections based on search criteria. Automatically updated as you add new photos."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(Pt,{className:"w-6 h-6 text-purple-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Filter by date, camera, lens, ISO, aperture, and more. Combine with AI search for precise results."})]})]})]})]})},{id:"shortcuts",title:"Keyboard Shortcuts",icon:e.jsx(di,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"py-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Most Useful"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:c.slice(0,12).map((d,p)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-200",children:d.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600",children:d.keys})]},p))}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"View All Shortcuts"})})]})},{id:"troubleshooting",title:"Troubleshooting",icon:e.jsx(es,{className:"w-5 h-5"}),content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Common Issues & Solutions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Having trouble? Here are solutions to common problems:"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-red-900 dark:text-red-300 mb-2",children:" No Search Results"}),e.jsxs("ul",{className:"text-sm text-red-700 dark:text-red-400 space-y-1",children:[e.jsx("li",{children:" Try more general search terms"}),e.jsx("li",{children:" Check if your photos are indexed (look for the indexing progress)"}),e.jsx("li",{children:" Try searching for colors, objects, or activities"}),e.jsx("li",{children:" Use the demo library to test search functionality"})]})]}),e.jsxs("div",{className:"border border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-300 mb-2",children:" Photos Not Loading"}),e.jsxs("ul",{className:"text-sm text-orange-700 dark:text-orange-400 space-y-1",children:[e.jsx("li",{children:" Ensure the photo directory is accessible"}),e.jsx("li",{children:" Check file permissions"}),e.jsx("li",{children:" Try re-selecting the directory"}),e.jsx("li",{children:" Restart the application if thumbnails don't appear"})]})]}),e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:" Slow Performance"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[e.jsx("li",{children:" Large photo libraries may take time to index initially"}),e.jsx("li",{children:' Use the "Fast" indexing option for quicker but less accurate results'}),e.jsx("li",{children:" Close other applications to free up memory"}),e.jsx("li",{children:" Consider using smaller batch sizes for indexing"})]})]}),e.jsxs("div",{className:"border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300 mb-2",children:" Face Recognition Issues"}),e.jsxs("ul",{className:"text-sm text-green-700 dark:text-green-400 space-y-1",children:[e.jsx("li",{children:" Face detection works best with clear, well-lit photos"}),e.jsx("li",{children:" Ensure faces are not obstructed or at extreme angles"}),e.jsx("li",{children:" Re-index your photos after making changes"}),e.jsx("li",{children:" Check the People view to see detected faces"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Still Need Help?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"If you're still experiencing issues, try:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2 space-y-1",children:[e.jsx("li",{children:" Restarting the application"}),e.jsx("li",{children:" Checking the browser console for error messages"}),e.jsx("li",{children:" Ensuring your browser supports modern web features"}),e.jsx("li",{children:" Clearing browser cache and cookies"})]})]})]})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:t,onKeyDown:d=>{d.key==="Escape"&&t()},role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ui,{className:"w-6 h-6 text-blue-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Help Center"})]}),e.jsx("button",{type:"button",onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close help",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:e.jsx("div",{className:"flex gap-1",children:l.map(d=>e.jsxs("button",{type:"button",onClick:()=>n(d.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${r===d.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[d.icon,d.title]},d.id))})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:l.find(d=>d.id===r)?.content}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Need more help? Check out the demo library to explore features."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors text-sm font-medium",children:"Keyboard Shortcuts"}),e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Got it"})]})]})})]})}),e.jsx(pc,{isOpen:i,onClose:()=>u(!1)})]})}const fc={facebook:{name:"Facebook",icon:e.jsx(gi,{className:"w-5 h-5"}),maxSize:2048,aspectRatio:"1.91:1"},instagram:{name:"Instagram",icon:e.jsx(pi,{className:"w-5 h-5"}),maxSize:1080,aspectRatio:"1:1"},twitter:{name:"Twitter",icon:e.jsx(xi,{className:"w-5 h-5"}),maxSize:1200,aspectRatio:"16:9"}},Ba={web:{name:"Web",description:"Optimized for websites",maxSize:1920,quality:85},email:{name:"Email",description:"Small size for email",maxSize:1024,quality:80},print:{name:"Print",description:"High quality for printing",maxSize:3e3,quality:95},instagram:{name:"Instagram",description:"Square format for Instagram",maxSize:1080,quality:90},twitter:{name:"Twitter",description:"Wide format for Twitter",maxSize:1200,quality:85},facebook:{name:"Facebook",description:"Wide format for Facebook",maxSize:2048,quality:90}},bc=({selected:a,dir:t,onClose:s,uiActions:r})=>{const[n,i]=o.useState("link"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[p,b]=o.useState(!1),[y,k]=o.useState({expiryHours:24,viewOnly:!1}),[v,f]=o.useState("web"),[S,T]=o.useState(""),[P,m]=o.useState(""),[h,j]=o.useState(""),C=o.useRef(null),E=a.size,w=E>1,N=async()=>{if(!(!t||E===0)){c(!0);try{const M=Array.from(a),V=await Bs(t,"local",M,y),se=`${window.location.origin}/share/${V.token}/view`;d(se),await navigator.clipboard.writeText(se),b(!0),r.setNote("Share link created and copied to clipboard!")}catch(M){r.setNote(M instanceof Error?M.message:"Share failed")}finally{c(!1)}}},_=async()=>{if(!(!t||E===0||!S)){c(!0);try{const M=Array.from(a),V=Ba[v],se=await pt(t,M,S,"copy",!1,!1,{preset:v==="instagram"||v==="twitter"||v==="facebook"?"web":v,resizeLong:V.maxSize,quality:V.quality});r.setNote(`Exported ${se.copied} photos to ${S}`),s()}catch(M){r.setNote(M instanceof Error?M.message:"Export failed")}finally{c(!1)}}},z=async()=>{l||await N()},ee=async()=>{const M=P.split(/[\n,;]+/).map(me=>me.trim()).filter(Boolean);if(M.length===0){r.setNote("Add at least one recipient");return}await z();const V=w?`Photos (${E})`:"Photo",se=`${h?h+`

`:""}${l}`,B=`mailto:${encodeURIComponent(M.join(","))}?subject=${encodeURIComponent(V)}&body=${encodeURIComponent(se)}`;try{window.location.href=B,s()}catch(me){r.setNote(me instanceof Error?me.message:"Could not open email client")}},O=M=>{if(!l)return;const V=`Check out ${w?`these ${E} photos`:"this photo"}!`,se={facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(l)}`,twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(V)}&url=${encodeURIComponent(l)}`,instagram:`instagram://library?AssetPath=${encodeURIComponent(l)}`};window.open(se[M],"_blank","width=600,height=400")},Y=o.useCallback(()=>{!l||!C.current||(C.current.innerHTML=`<div style="font-family: monospace; font-size: 12px; line-height: 1; white-space: pre;">${F()}</div>`)},[l]),F=M=>`
    
         
       
     
     
          
     
     
       
           
     
    `.trim();return tt.useEffect(()=>{l&&Y()},[l,Y]),e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center",children:e.jsx(Zt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Share ",w?`${E} Photos`:"Photo"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose how you'd like to share your photos"})]})]}),e.jsx("button",{type:"button",onClick:s,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{id:"link",icon:e.jsx(ka,{className:"w-5 h-5"}),label:"Share Link",desc:"Create shareable link"},{id:"email",icon:e.jsx(Sa,{className:"w-5 h-5"}),label:"Email",desc:"Send via email"},{id:"social",icon:e.jsx(Ge,{className:"w-5 h-5"}),label:"Social Media",desc:"Share on social platforms"},{id:"export",icon:e.jsx(Me,{className:"w-5 h-5"}),label:"Export",desc:"Download to folder"}].map(M=>e.jsx("button",{type:"button",onClick:()=>i(M.id),className:`p-4 rounded-xl border-2 transition-all ${n===M.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n===M.id?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:M.icon}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:M.label}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:M.desc})]})]})},M.id))})}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[n==="link"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Link Expires In"}),e.jsxs("select",{id:"expiry-select",value:y.expiryHours,onChange:M=>k(V=>({...V,expiryHours:parseInt(M.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[e.jsx("option",{value:1,children:"1 hour"}),e.jsx("option",{value:24,children:"24 hours"}),e.jsx("option",{value:168,children:"1 week"}),e.jsx("option",{value:720,children:"1 month"}),e.jsx("option",{value:8760,children:"1 year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password (Optional)"}),e.jsx("input",{id:"password-input",type:"password",value:y.password||"",onChange:M=>k(V=>({...V,password:M.target.value||void 0})),placeholder:"Leave empty for no password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"viewOnly",checked:y.viewOnly,onChange:M=>k(V=>({...V,viewOnly:M.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"viewOnly",className:"text-sm text-gray-700 dark:text-gray-300",children:"View-only (prevent downloads)"})]}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 dark:text-green-200",children:[e.jsx(ut,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Share link created!"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"}),e.jsxs("button",{type:"button",onClick:async()=>{await navigator.clipboard.writeText(l),b(!0),setTimeout(()=>b(!1),2e3)},className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded flex items-center gap-1",children:[p?e.jsx(ut,{className:"w-4 h-4"}):e.jsx(hi,{className:"w-4 h-4"}),p?"Copied!":"Copy"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ca,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"QR Code"})]}),e.jsx("div",{ref:C,className:"flex justify-center",children:e.jsx("div",{className:"w-32 h-32 bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(Ca,{className:"w-16 h-16 text-gray-400"})})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-2",children:"Scan to open on mobile"})]})]}):e.jsx("button",{type:"button",onClick:N,disabled:u,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Share Link..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ka,{className:"w-5 h-5"}),"Create Share Link"]})})]}),n==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Addresses"}),e.jsx("textarea",{id:"email-input",value:P,onChange:M=>m(M.target.value),placeholder:"Enter email addresses separated by commas",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email-message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message (Optional)"}),e.jsx("textarea",{id:"email-message",placeholder:"Add a personal message...",value:h,onChange:M=>j(M.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 h-20"})]}),e.jsxs("button",{type:"button",onClick:ee,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center justify-center gap-2",children:[e.jsx(Sa,{className:"w-5 h-5"}),"Send Email"]})]}),n==="social"&&e.jsx("div",{className:"space-y-4",children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Share your photos on social media:"}),Object.entries(fc).map(([M,V])=>e.jsxs("button",{type:"button",onClick:()=>O(M),className:"w-full p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:V.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium",children:V.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[V.aspectRatio,"  Max ",V.maxSize,"px"]})]}),e.jsx(mi,{className:"w-5 h-5 text-gray-400"})]},M))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"First create a share link, then share on social media"}),e.jsx("button",{type:"button",onClick:()=>i("link"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Create Share Link First"})]})}),n==="export"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"export-destination",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Destination"}),e.jsx("input",{id:"export-destination",type:"text",value:S,onChange:M=>T(M.target.value),placeholder:"/absolute/path/to/export/folder",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Export Preset"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Ba).map(([M,V])=>e.jsxs("button",{type:"button",onClick:()=>f(M),className:`p-3 border rounded-lg text-left ${v===M?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:V.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:V.description}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["Max ",V.maxSize,"px  ",V.quality,"% quality"]})]},M))})]}),e.jsx("button",{type:"button",onClick:_,disabled:u||!S,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-5 h-5"}),"Export ",E," Photo",w?"s":""]})})]})]})]})})},yc={blue:{primary:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#3b82f6"},green:{primary:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#22c55e"},purple:{primary:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#a855f7"},orange:{primary:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#f97316"},gray:{primary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},secondary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},accent:"#6b7280"}};function vc({children:a}){const t=Ee(l=>l.themeMode),s=Ee(l=>l.colorScheme),r=Ee(l=>l.density),n=Ee(l=>l.customColors),i=oa(),u=o.useMemo(()=>t==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t,[t]),c=o.useMemo(()=>{const l=n?{primary:n.primary,secondary:n.secondary,accent:n.accent}:yc[s],d={};return n?(d["--color-primary"]=n.primary,d["--color-primary-hover"]=n.primary,d["--color-primary-active"]=n.primary):Object.entries(l.primary).forEach(([p,b])=>{d[`--color-primary-${p}`]=b}),n?d["--color-secondary"]=n.secondary:Object.entries(l.secondary).forEach(([p,b])=>{d[`--color-secondary-${p}`]=b}),d["--color-accent"]=n?n.accent:l.accent,u==="dark"?(d["--color-background"]="#0f172a",d["--color-surface"]="#1e293b",d["--color-surface-hover"]="#334155",d["--color-border"]="#334155",d["--color-border-hover"]="#475569",d["--color-text-primary"]="#f8fafc",d["--color-text-secondary"]="#cbd5e1",d["--color-text-tertiary"]="#94a3b8"):(d["--color-background"]="#ffffff",d["--color-surface"]="#f8fafc",d["--color-surface-hover"]="#f1f5f9",d["--color-border"]="#e2e8f0",d["--color-border-hover"]="#cbd5e1",d["--color-text-primary"]="#0f172a",d["--color-text-secondary"]="#475569",d["--color-text-tertiary"]="#64748b"),i&&(d["--color-background"]="#000000",d["--color-surface"]="#000000",d["--color-surface-hover"]="#000000",d["--color-border"]="#ffffff",d["--color-border-hover"]="#ffffff",d["--color-text-primary"]="#ffffff",d["--color-text-secondary"]="#ffffff",d["--color-text-tertiary"]="#ffffff",d["--color-primary"]="#ffffff",d["--color-accent"]="#00ff00"),d},[u,s,n,i]);return o.useEffect(()=>{const l=document.documentElement;Object.entries(c).forEach(([d,p])=>{l.style.setProperty(d,p)}),l.classList.remove("light","dark"),l.classList.add(u),l.classList.remove("density-compact","density-normal","density-spacious"),l.classList.add(`density-${r}`),i?l.classList.add("high-contrast"):l.classList.remove("high-contrast")},[c,u,r,i]),o.useEffect(()=>{if(t!=="auto")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>{document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(l.matches?"dark":"light")};return l.addEventListener("change",d),()=>l.removeEventListener("change",d)},[t]),e.jsx(e.Fragment,{children:a})}const jc=[{id:"blue",name:"Blue",color:"#3b82f6"},{id:"green",name:"Green",color:"#22c55e"},{id:"purple",name:"Purple",color:"#a855f7"},{id:"orange",name:"Orange",color:"#f97316"},{id:"gray",name:"Gray",color:"#6b7280"}],wc=[{id:"compact",name:"Compact",description:"Tighter spacing, smaller elements"},{id:"normal",name:"Normal",description:"Balanced spacing and sizing"},{id:"spacious",name:"Spacious",description:"More breathing room, larger elements"}];function Nc({isOpen:a,onClose:t}){const[s,r]=o.useState("appearance"),n=Ee(m=>m.themeMode),i=Ee(m=>m.colorScheme),u=Ee(m=>m.density),c=Ee(m=>m.customColors),l=Ee(m=>m.setThemeMode),d=Ee(m=>m.setColorScheme),p=Ee(m=>m.setDensity),b=Ee(m=>m.setCustomColors),y=Ee(m=>m.resetTheme),k=oa(),v=rs(m=>m.setHighContrast),[f,S]=o.useState(c||{primary:"#3b82f6",secondary:"#64748b",accent:"#3b82f6"});if(!a)return null;const T=(m,h)=>{const j={...f,[m]:h};S(j),b(j)},P=m=>{d(m),m!=="custom"&&b(void 0)};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-xl flex items-center justify-center",children:e.jsx(kt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Theme Settings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Customize your app appearance"})]})]}),e.jsx("button",{type:"button",onClick:t,className:"w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center","aria-label":"Close theme settings",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[{id:"appearance",name:"Appearance",icon:Pt},{id:"colors",name:"Colors",icon:kt},{id:"accessibility",name:"Accessibility",icon:Ns}].map(m=>e.jsxs("button",{type:"button",onClick:()=>r(m.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${s===m.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300"}`,children:[e.jsx(m.icon,{className:"w-4 h-4"}),m.name]},m.id))}),e.jsxs("div",{className:"p-6 max-h-96 overflow-y-auto",children:[s==="appearance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Theme Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{id:"light",name:"Light",icon:Es},{id:"dark",name:"Dark",icon:sr},{id:"auto",name:"Auto",icon:fi}].map(m=>e.jsxs("button",{type:"button",onClick:()=>l(m.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${n===m.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx(m.icon,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:m.name})]},m.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Density"}),e.jsx("div",{className:"space-y-3",children:wc.map(m=>e.jsx("button",{type:"button",onClick:()=>p(m.id),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${u===m.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:m.name}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:m.description})]}),u===m.id&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full"})]})},m.id))})]})]}),s==="colors"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Color Scheme"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jc.map(m=>e.jsxs("button",{type:"button",onClick:()=>P(m.id),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i===m.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-gray-300 dark:border-gray-600",style:{backgroundColor:m.color}}),e.jsx("span",{className:"text-sm font-medium",children:m.name})]},m.id)),e.jsxs("button",{type:"button",onClick:()=>P("custom"),className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${i==="custom"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-dashed border-gray-400 dark:border-gray-500 flex items-center justify-center",children:e.jsx(kt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})}),e.jsx("span",{className:"text-sm font-medium",children:"Custom"})]})]})]}),i==="custom"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Custom Colors"}),e.jsx("div",{className:"space-y-4",children:[{key:"primary",label:"Primary"},{key:"secondary",label:"Secondary"},{key:"accent",label:"Accent"}].map(({key:m,label:h})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:`${m}-color`,className:"text-sm font-medium text-gray-700 dark:text-gray-300 min-w-16",children:h}),e.jsx("input",{id:`${m}-color`,type:"color",value:f[m],onChange:j=>T(m,j.target.value),className:"w-12 h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),e.jsx("input",{type:"text",value:f[m],onChange:j=>T(m,j.target.value),className:"flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"#000000"})]},m))})]})]}),s==="accessibility"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"High Contrast Mode"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ns,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"High Contrast"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Increases contrast for better accessibility"})]})]}),e.jsx("button",{type:"button",onClick:()=>v?.(!k),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${k?"bg-blue-600":"bg-gray-200 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${k?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Reset Theme"}),e.jsxs("button",{type:"button",onClick:()=>{y(),v?.(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx(bi,{className:"w-4 h-4"}),"Reset to Defaults"]})]})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors",children:"Close"})})]})})}const kc=a=>a.split("/").pop()||a;function qa({children:a,onEscape:t}){const s=tt.useRef(null);return tt.useEffect(()=>{const r=s.current;if(!r)return;const n=r.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'),i=Array.from(n).filter(c=>!c.hasAttribute("disabled"));i.length>0?(i.find(l=>l.getAttribute("tabindex")!=="-1")||i[0]).focus():(r.setAttribute("tabindex","-1"),r.focus());const u=c=>{if(c.key==="Escape"&&(c.stopPropagation(),c.preventDefault(),t&&t()),c.key==="Tab"){if(i.length===0)return;const l=i.indexOf(document.activeElement),d=c.shiftKey?-1:1;let p=l+d;p<0&&(p=i.length-1),p>=i.length&&(p=0),c.preventDefault(),i[p].focus()}};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[t]),e.jsx("div",{ref:s,children:a})}function Sc(){const[a,t]=o.useState(!1);o.useEffect(()=>(t(!0),()=>t(!1)),[]);const s=mo(),r=xo(),n=po(),i=go(),u=Po(),c=Io(),l=Co(),d=To(),p=$o(),b=Eo(),y=ko(),k=yo(),v=vo(),f=jo(),S=wo(),T=No(),P=Ro(),m=Lo(),h=fo(),j=bo(),C=Mo(),E=Fo(),w=_o(),N=Oo(),_=Do(),z=Uo(),ee=z,O=zo(),Y=Bo(),F=[],M=qr();Vr();const V=Ao(),se=qo(),B=Vo(),me=Ho();Wo();const L=Go(),Z=Ko(),ie=Yo(),W=Qo(),J=Jo(),A=Hr(),G=Wr(),$=Xo(),K=Zo(),[X,R]=o.useState("library"),U=zs(),ce=dr(),[Q,ne]=o.useState(""),[H,he]=o.useState(new Set),[ye,te]=o.useState("medium"),[ve,Ke]=o.useState("grid"),[Oe,ns]=o.useState("day"),[Mt,Ft]=o.useState("all"),[is,gt]=o.useState(!1),[Ae,os]=o.useState(""),[Ue,ls]=o.useState(""),[ke,xe]=o.useState(null),[ca,rn]=o.useState(!1),[nn,ze]=o.useState(!1),[we,Ye]=o.useState(null),[be,Be]=o.useState(null),[cs,on]=o.useState([]),Dt=o.useRef(cs),[ln,da]=o.useState(!1),[cn,dn]=o.useState("home");o.useEffect(()=>{Dt.current=cs},[cs]);const un=o.useCallback((x,g)=>x.length===g.length&&x.every((I,q)=>I.length===g[q].length&&I.every((D,ae)=>D===g[q][ae])),[]),ua=o.useRef(null),[ha,hn]=o.useState({cameras:[],places:[]}),[mn,ft]=o.useState(!1),[ds,Re]=o.useState([]),[bt,ma]=o.useState(!1),[xn,us]=o.useState(void 0),[yt,hs]=o.useState(void 0),[pn,ms]=o.useState(!1),[gn,fn]=o.useState(void 0),[bn,xs]=o.useState(!1),[st,yn]=o.useState(0),[at,Le]=o.useState(null),[vn,xa]=o.useState(!1),[jn,wn]=o.useState(()=>{try{return!localStorage.getItem("ps_hint_help_seen")}catch{return!0}}),[ps,Nn]=o.useState([]),_t=o.useRef(null),[vt,gs]=o.useState(()=>{try{const x=localStorage.getItem("userActions");return x?JSON.parse(x):[]}catch{return[]}}),[kn,Sn]=o.useState(()=>{try{const x=localStorage.getItem("onboardingSteps");return x?JSON.parse(x):[]}catch{return[]}}),qe=o.useCallback(x=>{const g={select_directory:[],index_photos:["select_directory"],first_search:["index_photos"],explore_features:["first_search"]};Sn(I=>{if(I.includes(x)||!(g[x]||[]).every(ae=>I.includes(ae)))return I;const D=[...I,x];try{localStorage.setItem("onboardingSteps",JSON.stringify(D))}catch{}return D})},[]),[Cn,pa]=o.useState(!1),[Tn,ga]=o.useState(!1),fs=o.useMemo(()=>{const x={},g=V||{};for(const I of Object.keys(g)){const D=(g[I]||[]).find(ae=>/^rating:[1-5]$/.test(ae));D&&(x[I]=parseInt(D.split(":")[1],10))}return x},[V]);o.useEffect(()=>{try{localStorage.getItem("ps_theme")==="dark"&&document.documentElement.classList.add("dark")}catch{}},[]);const bs=oa(),rt=So();o.useEffect(()=>{const x=g=>{const I=document.activeElement;if(!(I&&(I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.isContentEditable))){if(g.key.toLowerCase()==="i"){g.preventDefault(),A.setShowInfoOverlay&&A.setShowInfoOverlay(!rt);return}if(g.key.toLowerCase()==="a"){g.preventDefault(),xe({kind:"advanced"});return}if(g.key==="?"){g.preventDefault(),ze(q=>!q);return}if(X==="results"&&ve==="timeline"){const q=D=>window.dispatchEvent(new CustomEvent("timeline-jump",{detail:{kind:D}}));if(g.key.toLowerCase()==="t"){g.preventDefault(),q("today");return}if(g.key.toLowerCase()==="m"){g.preventDefault(),q("this-month");return}if(g.key.toLowerCase()==="l"){g.preventDefault(),q("last-month");return}if(g.key.toLowerCase()==="o"){g.preventDefault(),q("oldest");return}}}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[rt,A,X,ve]),o.useEffect(()=>{const x=document.body;bs?x.classList.add("high-contrast"):x.classList.remove("high-contrast")},[bs]);const En=o.useMemo(()=>{const x=!!(k||v||f||S||T||y),g=!!(Ae&&Ue),I=Array.isArray(Z)&&Z.length>0,q=!!(P&&P.trim()),D=st>0||b;return!!(N||x||g||I||q||D)},[k,v,f,S,T,y,Ae,Ue,Z,P,st,b,N]);o.useEffect(()=>{const g=(U.pathname||"/library").split("/").filter(Boolean)[0]||"library",I=g==="search"?"results":g==="library"?"library":g==="people"?"people":g==="collections"?"collections":g==="settings"?"tasks":"library";X!==I&&R(I)},[U.pathname,X]),o.useEffect(()=>{const x=U.pathname||"",g=X==="results"?"/search":X==="library"?"/library":X==="people"?"/people":X==="collections"?"/collections":"/settings";x!==g&&ce({pathname:g,search:U.search},{replace:!1})},[X,ce,U.search]),o.useEffect(()=>{if(!a)return;const x=new URLSearchParams(U.search),g=x.get("q")||"";g&&g!==Q&&ne(g);try{x.get("fav")==="1"&&G.setFavOnly(!0);const q=x.get("tags")||"";q&&G.setTagFilter(q);const D=x.get("date_from"),ae=x.get("date_to");D&&os(D),ae&&ls(ae);const de=x.get("place");de&&A.setPlace(de),x.get("has_text")==="1"&&A.setHasText(!0);const je=x.get("camera");je&&A.setCamera(je);const Pe=x.get("iso_min");Pe&&A.setIsoMin(parseFloat(Pe));const Ie=x.get("iso_max");Ie&&A.setIsoMax(parseFloat(Ie));const Lt=x.get("f_min");Lt&&A.setFMin(parseFloat(Lt));const Se=x.get("f_max");Se&&A.setFMax(parseFloat(Se));const At=x.get("person"),wt=x.get("persons");wt?K.setPersons(wt.split(",").map(Nt=>Nt.trim()).filter(Boolean)):At&&K.setPersons([At]);const Xe=x.get("rv");Xe&&A.setResultView&&A.setResultView(Xe);const Ut=x.get("tb");Ut&&A.setTimelineBucket&&A.setTimelineBucket(Ut)}catch{}},[U.search,a,Q,G,A,K]),o.useEffect(()=>{Q&&Q.trim()&&gs(x=>{if(!x.includes("searched")){const g=[...x,"searched"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return x})},[Q]),o.useEffect(()=>{s&&(gs(x=>{if(!x.includes("selected_directory")){const g=[...x,"selected_directory"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return x}),qe("select_directory"))},[s,qe]),o.useEffect(()=>{M&&M.length>0&&gs(x=>{if(!x.includes("indexed")){const g=[...x,"indexed"];try{localStorage.setItem("userActions",JSON.stringify(g))}catch{}return g}return x})},[M]),o.useEffect(()=>{["collections","saved","smart","memories","trips","videos","people","map"].includes(X)&&qe("explore_features")},[X,qe]),o.useEffect(()=>{pa(!!(vt.length===0||X==="results"&&!vt.includes("searched")||X==="library"&&s&&!vt.includes("searched")))},[X,vt,s]),o.useEffect(()=>{const g=!localStorage.getItem("onboardingComplete")&&s&&M&&M.length>0;ga(g||!1)},[s,M]);const[zc,Bc]=o.useState(0),Pn=120,In=o.useMemo(()=>(M||[]).map(x=>({path:x})),[M]),Qe=o.useCallback(async()=>{if(s)try{const x=await qs(s);G.setFavorites(x.favorites||[])}catch{}},[s,G]),Ot=o.useCallback(async()=>{if(s)try{const x=await Vs(s);G.setSaved(x.saved||[])}catch{}},[s,G]),nt=o.useCallback(async()=>{if(s)try{const{apiGetPresets:x}=await pe(async()=>{const{apiGetPresets:I}=await Promise.resolve().then(()=>ge);return{apiGetPresets:I}},void 0,import.meta.url),g=await x(s);Nn(g.presets||[])}catch{}},[s]),Fe=o.useCallback(async()=>{if(s)try{const x=await Js(s);G.setTagsMap(x.tags||{}),G.setAllTags(x.all||[])}catch{}},[s,G]),Rt=o.useCallback(async()=>{if(s)try{const x=await Ws(s,r,j?i:void 0,h?n:void 0);K.setDiag(x)}catch{}},[s,r,j,i,h,n,K]),ys=o.useCallback(async()=>{if(s)try{const x=await sa(s);K.setClusters(x.clusters||[])}catch{}},[s,K]),$n=o.useCallback(async()=>{if(s)try{const x=await Hs(s);K.setPoints(x.points||[])}catch{}},[s,K]),it=o.useCallback(async(x=120,g=0,I=!1)=>{try{if(!s)return;const q=await $t(s,r,x,g,{openaiKey:j?i:void 0,hfToken:h?n:void 0}),D=q.paths&&q.paths.length===x&&g+q.paths.length<q.total;I?q.paths&&q.paths.length>0&&G.appendLibrary(q.paths):G.setLibrary(q.paths||[]),G.setLibHasMore(D)}catch{}},[s,r,j,i,h,n,G]),fa=o.useCallback(async()=>{try{if(!s)return;const x=await ea(s);hn({cameras:x.cameras||[],places:x.places||[]})}catch{}},[s]);o.useEffect(()=>{let x=!1;return(async()=>{if(!s){xs(!1);return}try{const{apiOcrStatus:I}=await pe(async()=>{const{apiOcrStatus:D}=await Promise.resolve().then(()=>ge);return{apiOcrStatus:D}},void 0,import.meta.url),q=await I(s);x||xs(!!q.ready)}catch{x||xs(!1)}})(),()=>{x=!0}},[s]);const ot=o.useCallback(async()=>{$.setNote("Indexing started in background. You can continue using the app."),ma(!0);const x=`index-${Date.now()}`,g={id:x,type:"index",title:"Indexing Photos",description:`Analyzing photos in ${s}`,status:"running",startTime:new Date,canCancel:!0,total:(M||[]).length||void 0};Re(q=>[...q,g]);let I;I=setInterval(async()=>{await it(120,0)},3e3);try{const q=await Et(s,r,32,h?n:void 0,j?i:void 0);I&&clearInterval(I),$.setNote(`Indexing complete! New: ${q.new}, Updated: ${q.updated}, Total: ${q.total}`),Re(D=>D.map(ae=>ae.id===x?{...ae,status:"completed",endTime:new Date,progress:q.total}:ae)),qe("index_photos"),await it(120,0)}catch(q){I&&clearInterval(I),$.setNote(q instanceof Error?q.message:"Index failed"),Re(D=>D.map(ae=>ae.id===x?{...ae,status:"failed",endTime:new Date,error:q instanceof Error?q.message:"Index failed"}:ae))}finally{ma(!1)}},[s,r,h,n,j,i,it,$,qe]),Ve=o.useCallback(async x=>{const g=(x??Q??"").trim();if(g){G.setQuery(g);try{const I=new URLSearchParams;I.set("q",g),N&&I.set("fav","1"),P?.trim()&&I.set("tags",P),Ae&&Ue&&(I.set("date_from",Ae),I.set("date_to",Ue)),y?.trim()&&I.set("place",y),b&&I.set("has_text","1"),k?.trim()&&I.set("camera",k),v&&I.set("iso_min",String(v)),f&&I.set("iso_max",String(f)),S&&I.set("f_min",String(S)),T&&I.set("f_max",String(T));const q=Z.filter(Boolean);q.length===1&&I.set("person",q[0]),q.length>1&&I.set("persons",q.join(",")),ce({pathname:"/search",search:`?${I.toString()}`},{replace:!1})}catch{}$.setBusy("Searching"),$.setNote("");try{const I=P.split(",").map(je=>je.trim()).filter(Boolean),q=Z.filter(Boolean);let D;const ae=Ae?Math.floor(new Date(Ae).getTime()/1e3):void 0,de=Ue?Math.floor(new Date(Ue).getTime()/1e3):void 0;L?D=await Qs(s,g,r,_,{favoritesOnly:N,tags:I,dateFrom:ae,dateTo:de,place:y||void 0,hasText:b,...q.length===1?{person:q[0]}:q.length>1?{persons:q}:{}}):D=await as(s,g,r,_,{hfToken:h?n:void 0,openaiKey:j?i:void 0,favoritesOnly:N,tags:I,dateFrom:ae,dateTo:de,...u?{useFast:!0,fastKind:c||void 0}:{},useCaptions:l,useOcr:d,camera:k||void 0,isoMin:v||void 0,isoMax:f||void 0,fMin:S||void 0,fMax:T||void 0,place:y||void 0,hasText:b||void 0,...q.length===1?{person:q[0]}:q.length>1?{persons:q}:{}});let fe=D.results||[];st>0&&(fe=fe.filter(je=>(fs[je.path]||0)>=st)),G.setResults(fe),G.setSearchId(D.search_id||""),$.setNote(`Found ${D.results?.length||0} results.`),await Promise.all([Qe(),Ot(),Fe(),Rt()]),R("results"),qe("first_search")}catch(I){$.setNote(I instanceof Error?I.message:"Search failed")}finally{$.setBusy("")}}},[Q,G,ce,U.search,$,V,Z,Ae,Ue,L,s,r,_,N,y,b,h,n,j,i,u,c,l,d,k,v,f,S,T,st,fs,Qe,Ot,Fe,Rt,qe]),ba=Ei(Ve,300),Mn=o.useCallback(async x=>{$.setBusy(`Preparing ${x.toUpperCase()}`);try{await Gs(s,x,r,h?n:void 0,j?i:void 0),$.setNote(`${x.toUpperCase()} ready`)}catch(g){$.setNote(g instanceof Error?g.message:"Failed to build index")}finally{$.setBusy("")}},[s,r,h,n,j,i,$]),Fn=o.useCallback(async()=>{$.setBusy("Extracting text (OCR)");try{const x=await Ks(s,r,["en"],h?n:void 0,j?i:void 0);$.setNote(`OCR updated ${x.updated} images`),await Fe()}catch(x){$.setNote(x instanceof Error?x.message:"OCR failed")}finally{$.setBusy("")}},[s,r,h,n,j,i,Fe,$]),Dn=o.useCallback(async()=>{$.setBusy("Building metadata");try{const x=await Zs(s,r,h?n:void 0,j?i:void 0);$.setNote(`Metadata ready (${x.updated})`)}catch(x){$.setNote(x instanceof Error?x.message:"Metadata build failed")}finally{$.setBusy("")}},[s,r,h,n,j,i,$]);o.useEffect(()=>{if(!se||!s)return;let x,g="";const I=D=>{switch(D?.type){case"ocr_build":return`OCR updated ${D.updated}`;case"captions_build":return`Captions updated ${D.updated}`;case"fast_build":return`${String(D.kind).toUpperCase()} ${D.ok?"ready":"failed"}`;case"thumbs_build":return`Thumbs made ${D.made}`;case"trips_build":return`Trips ${D.trips}`;case"metadata_build":return`Metadata updated ${D.updated}`;case"export":return`Exported ${D.copied}, skipped ${D.skipped}`;default:return""}},q=async()=>{try{const{apiAnalytics:D}=await pe(async()=>{const{apiAnalytics:fe}=await Promise.resolve().then(()=>ge);return{apiAnalytics:fe}},void 0,import.meta.url),de=((await D(s,10)).events||[]).slice(-1)[0];if(de&&de.time!==g){g=de.time;const fe=I(de);fe&&$.setNote(fe)}}catch{}x=window.setTimeout(q,2e3)};return q(),()=>{x&&window.clearTimeout(x)}},[se,s,$]),o.useEffect(()=>{if(!bt||!s){us(void 0),hs(void 0),ms(!1);return}let x,g;const I=async()=>{try{const{apiIndexStatus:q}=await pe(async()=>{const{apiIndexStatus:Xe}=await Promise.resolve().then(()=>ge);return{apiIndexStatus:Xe}},void 0,import.meta.url),D=await q(s,r,h?n:void 0,j?i:void 0),ae=Number(D.insert_done||0),de=Number(D.insert_total||0),fe=Number(D.updated_done||0),je=Number(D.updated_total||0),Pe=ae+fe,Ie=Math.max(1,de+je),Lt=Math.min(1,Math.max(0,Pe/Ie));Ie>1&&us(Lt),ms(!!D.paused||D.state==="paused");const Se=[];Ie>1&&Se.push(`processed ${Pe}/${Ie}`),typeof D.indexed=="number"&&Se.push(`indexed ${D.indexed}`),typeof D.target=="number"&&D.target>0&&Se.push(`target ${D.target}`),typeof D.coverage=="number"&&Se.push(`coverage ${Math.round(D.coverage*100)}%`),typeof D.drift=="number"&&D.drift>0&&Se.push(`drift ${D.drift}`),D.state==="complete"&&(typeof D.new=="number"&&Se.push(`new ${D.new}`),typeof D.updated=="number"&&Se.push(`updated ${D.updated}`),D.last_index_time&&Se.push(`at ${D.last_index_time}`)),typeof yt=="number"&&isFinite(yt)&&yt>0&&Se.push(`eta ~${Math.max(1,Math.ceil(yt/60))}m`),Se.length>0&&fn(Se.join("  ")),!g&&D.start&&(g=Date.parse(D.start));const At=Date.now(),wt=g?Math.max(1,(At-g)/1e3):void 0;if(wt&&Pe>5){const Xe=Pe/wt,Ut=Math.max(0,Ie-Pe),Nt=Xe>0?Ut/Xe:void 0;Nt&&isFinite(Nt)&&hs(Nt)}D.state==="complete"&&(us(void 0),hs(void 0),ms(!1))}catch{}x=window.setTimeout(I,1e3)};return I(),()=>{x&&window.clearTimeout(x)}},[bt,s,r,h,n,j,i]),o.useEffect(()=>{try{const x=new URLSearchParams(U.search);x.set("rv",ve),x.set("tb",Oe),ce({pathname:U.pathname,search:`?${x.toString()}`},{replace:!0})}catch{}},[ve,Oe]);const jt=o.useCallback(x=>{he(g=>{const I=new Set(g);return I.has(x)?I.delete(x):I.add(x),I})},[]);o.useCallback(async x=>{if(!(!s||H.size===0))try{const g=await pt(s,Array.from(H),x,"copy",!1,!1);$.setNote(`Exported ${g.copied}, skipped ${g.skipped}, errors ${g.errors}  ${g.dest}`)}catch(g){$.setNote(g instanceof Error?g.message:"Export failed")}},[s,H,$]);const ya=o.useCallback(x=>{const g=(C||[]).findIndex(I=>I.path===x);g>=0&&Ye(g)},[C]),Je=o.useCallback(x=>{Ye(g=>{if(g===null)return null;const I=g+x;return!C||I<0||I>=C.length?g:I})},[C]),_n=o.useCallback(async x=>{if(!s||H.size===0)return;const g=x.split(",").map(I=>I.trim()).filter(Boolean);try{const{apiSetTags:I}=await pe(async()=>{const{apiSetTags:q}=await Promise.resolve().then(()=>ge);return{apiSetTags:q}},void 0,import.meta.url);await Promise.all(Array.from(H).map(q=>I(s,q,g))),$.setNote(`Updated tags for ${H.size} photos`),await Fe()}catch(I){$.setNote(I instanceof Error?I.message:"Tag update failed")}},[s,H,Fe,$]);o.useCallback(async x=>{if(!(!s||H.size===0))try{const{apiSetTags:g}=await pe(async()=>{const{apiSetTags:D}=await Promise.resolve().then(()=>ge);return{apiSetTags:D}},void 0,import.meta.url),I=/^rating:[1-5]$/,q=Array.from(H);await Promise.all(q.map(async D=>{const ae=(V?.[D]||[]).filter(fe=>!I.test(fe)),de=x===0?ae:[...ae,`rating:${x}`];await g(s,D,de)})),$.setNote(x===0?`Cleared rating for ${H.size}`:`Set rating ${x} for ${H.size}`),await Fe()}catch(g){$.setNote(g instanceof Error?g.message:"Rating update failed")}},[s,H,V,Fe,$]),o.useEffect(()=>{if(!a)return;const x=E||"";ne(g=>g===x?g:x)},[E,a]),o.useEffect(()=>{s&&(Qe(),Ot(),Fe(),Rt(),ys(),it(Pn,0),fa(),nt())},[s,Qe,Ot,Fe,Rt,ys,it,fa,nt]),o.useEffect(()=>{if(!a)return;const x=C?.length??0;Be(g=>{const I=x>0?g===null?0:Math.min(g,x-1):null;return Object.is(g,I)?g:I})},[C?.length,a]),o.useEffect(()=>{function x(g){const I=g.target;if(I&&(I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.isContentEditable)||ca||ke||is)return;if(g.key==="/"){g.preventDefault();return}if(g.key==="?"||g.shiftKey&&g.key==="/"){g.preventDefault(),rn(!0);return}if(!(X!=="results"||!((C?.length||0)>0))){if(g.key==="Escape"){Ye(null);return}if(we!==null){if((g.key==="ArrowLeft"||g.key==="k")&&(g.preventDefault(),Je(-1)),(g.key==="ArrowRight"||g.key==="j")&&(g.preventDefault(),Je(1)),g.key.toLowerCase()==="f"){g.preventDefault();const D=C?.[we]?.path;if(!D)return;St(s,D,!w.includes(D)).then(Qe).catch(()=>{})}return}if(g.key.toLowerCase()==="a"){g.preventDefault(),he(new Set((C??[]).map(D=>D.path)));return}if(g.key.toLowerCase()==="c"){g.preventDefault(),he(new Set);return}if(g.key.toLowerCase()==="f"&&be!==null){g.preventDefault();const D=C?.[be]?.path;if(!D)return;St(s,D,!w.includes(D)).then(Qe).catch(()=>{});return}if(g.key==="Enter"&&be!==null){g.preventDefault(),Ye(be);return}if(g.key===" "&&be!==null){g.preventDefault();const D=C?.[be]?.path;if(!D)return;jt(D);return}if(g.key==="ArrowLeft"){g.preventDefault(),be!==null&&Be(Math.max(0,be-1));return}if(g.key==="ArrowRight"){g.preventDefault(),be!==null&&Be(Math.min((C?.length??1)-1,be+1));return}if(g.key==="ArrowUp"&&be!==null){g.preventDefault();const D=Dt.current;let ae=D.findIndex(de=>de.includes(be));if(ae>0){const de=D[ae].indexOf(be),fe=D[ae-1],je=fe[Math.min(de,fe.length-1)];typeof je=="number"&&Be(je)}return}if(g.key==="ArrowDown"&&be!==null){g.preventDefault();const D=Dt.current;let ae=D.findIndex(de=>de.includes(be));if(ae>=0&&ae<D.length-1){const de=D[ae].indexOf(be),fe=D[ae+1],je=fe[Math.min(de,fe.length-1)];typeof je=="number"&&Be(je)}return}if(g.key==="Home"){g.preventDefault(),Be(0);return}if(g.key==="End"){g.preventDefault(),Be(C.length-1);return}if((g.key==="PageUp"||g.key==="PageDown")&&be!==null){g.preventDefault();const D=3,ae=Dt.current,de=ae.findIndex(fe=>fe.includes(be));if(de>=0){const fe=ae[de].indexOf(be),je=g.key==="PageUp"?Math.max(0,de-D):Math.min(ae.length-1,de+D),Pe=ae[je],Ie=Pe[Math.min(fe,Pe.length-1)];typeof Ie=="number"&&Be(Ie)}return}}}return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[X,C?.length,we,s,w,Je,jt,ca,ke,is]),o.useEffect(()=>{if(be===null)return;const g=document.getElementById("modern-results-grid")?.querySelector(`[data-photo-idx="${be}"]`);g&&g.scrollIntoView({block:"nearest",inline:"nearest"})},[be]);const On=()=>s?M&&M.length===0?e.jsx("div",{className:"p-4",children:e.jsx(js,{type:"no-photos",onAction:()=>xe({kind:"folder"}),onOpenHelp:()=>ze(!0)})}):e.jsxs("div",{className:"p-4",children:[e.jsx(xl,{dir:s,engine:r,library:M,onLoadLibrary:it,selected:H,onToggleSelect:jt,onOpen:x=>{const g=[{path:x,score:0}];G.setResults(g),Ye(0),R("results")},tagsMap:V}),!Q&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm text-gray-700 font-medium mb-2",children:"Try these searches"}),e.jsx(La,{onSearch:Ve})]})]}):e.jsxs("div",{className:"p-4",children:[e.jsx(js,{type:"no-directory",onAction:()=>xe({kind:"folder"}),onDemoAction:async()=>{A.setDir("/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data");try{await ot(),$.setNote("Demo library loaded! Try searching for 'beach sunset' or 'family photos'")}catch(g){console.error("Failed to setup demo:",g),$.setNote(g instanceof Error?g.message:"Failed to setup demo")}},onOpenHelp:()=>ze(!0),onStartTour:()=>ze(!0),sampleQueries:["beach sunset","birthday cake","mountain hike","red car"],onRunSample:x=>Ve(x)}),e.jsx(Pl,{onSelectDirectory:()=>xe({kind:"folder"}),onImport:()=>{},onHelp:()=>ze(!0)})]});return e.jsx(Ul,{children:e.jsx(vc,{children:(U.pathname||"").startsWith("/share/")?e.jsx(bl,{}):(U.pathname||"").startsWith("/mobile-test")?e.jsx(El,{}):e.jsxs("div",{className:"flex h-screen bg-white dark:bg-gray-950 dark:text-gray-100",children:[e.jsx(Bl,{}),me&&e.jsx(Sl,{onStartDemo:async()=>{const x="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";A.setDir(x),$.setShowWelcome(!1);try{await et(x),await ot()}catch(g){console.error("Failed to add demo path or index:",g),$.setNote(g instanceof Error?g.message:"Failed to setup demo")}},onSelectFolder:()=>{xe({kind:"folder"}),$.setShowWelcome(!1)},onClose:()=>$.setShowWelcome(!1)}),e.jsx(Tl,{open:!s&&mn,onClose:()=>{ft(!1),localStorage.setItem("hasSeenOnboarding","true")},onQuickStart:async x=>{try{const g=[];for(const I of x)try{const q=await fetch(`${ue}/scan_count`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([I])});q.ok&&(await q.json()).items?.[0]?.exists&&g.push(I)}catch{}if(g.length===0){ft(!1),localStorage.setItem("hasSeenOnboarding","true");return}A.setDir(g[0]);for(const I of g){try{await et(I)}catch{}(async()=>{try{await Et(I,r,24,h?n:void 0,j?i:void 0)}catch{}})()}ft(!1),localStorage.setItem("hasSeenOnboarding","true")}catch(g){$.setNote(g instanceof Error?g.message:"Quick start failed")}},onCustom:()=>{xe({kind:"folder"}),ft(!1),localStorage.setItem("hasSeenOnboarding","true")},onDemo:async()=>{try{const x="/Users/pranay/Projects/adhoc_projects/photo-search/e2e_data";A.setDir(x),await et(x),await ot()}catch(x){$.setNote(x instanceof Error?x.message:"Demo setup failed")}ft(!1),localStorage.setItem("hasSeenOnboarding","true")},onTour:()=>{ze(!0)}}),e.jsx(Al,{selectedView:X,onViewChange:x=>R(x),library:M,favorites:w,collections:Object.keys(O||{}),clusters:ie,savedSearches:ee,smart:Object.keys(Y||{}),trips:F,isOpen:ln,onClose:()=>da(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Kl,{searchText:Q,setSearchText:ne,onSearch:Ve,clusters:ie,allTags:m,meta:ha,diag:J,busy:!!se,gridSize:ye,setGridSize:te,selectedView:X,setSelectedView:x=>R(x),currentFilter:Mt,setCurrentFilter:Ft,ratingMin:st,setRatingMin:yn,setModal:x=>xe(x),setIsMobileMenuOpen:da,setShowFilters:gt,selected:H,setSelected:he,dir:s,engine:r,topK:_,useOsTrash:p,showInfoOverlay:rt,onToggleInfoOverlay:()=>A.setShowInfoOverlay?A.setShowInfoOverlay(!rt):void 0,resultView:ve,onChangeResultView:x=>A.setResultView?.(x),timelineBucket:Oe,onChangeTimelineBucket:x=>A.setTimelineBucket?.(x),photoActions:G,uiActions:$,toastTimerRef:_t,setToast:Le,isIndexing:bt,onIndex:ot,activeJobs:ds.filter(x=>x.status==="running").length,onOpenJobs:()=>xe({kind:"jobs"}),progressPct:xn,etaSeconds:yt,paused:pn,tooltip:gn,ocrReady:bn,onPause:async()=>{try{const{apiIndexPause:x}=await pe(async()=>{const{apiIndexPause:g}=await Promise.resolve().then(()=>ge);return{apiIndexPause:g}},void 0,import.meta.url);await x(s)}catch{}},onResume:async()=>{try{const{apiIndexResume:x}=await pe(async()=>{const{apiIndexResume:g}=await Promise.resolve().then(()=>ge);return{apiIndexResume:g}},void 0,import.meta.url);await x(s)}catch{}},onOpenThemeModal:()=>xa(!0)}),jn&&e.jsx("div",{className:"px-4 pt-2",children:e.jsxs("div",{className:"sticky top-0 z-20 bg-yellow-50 text-yellow-800 border border-yellow-200 rounded px-3 py-1 text-xs flex items-center justify-between",children:[e.jsxs("span",{children:["Press ",e.jsx("span",{className:"font-mono",children:"?"})," for help and shortcuts"]}),e.jsx("button",{type:"button",className:"text-yellow-800 hover:text-yellow-900","aria-label":"Dismiss help hint",onClick:()=>{wn(!1);try{localStorage.setItem("ps_hint_help_seen","1")}catch{}},children:""})]})}),e.jsxs("div",{className:"flex-1 overflow-auto",ref:ua,children:[X==="results"&&e.jsx(Ua,{sectionName:"Search Results",children:e.jsxs("div",{className:"p-4",children:[C&&C.length>0&&(Q||"").trim()&&e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[C.length," results"]}),e.jsx("button",{type:"button",className:"chip",title:"Save this search as a Smart Collection",onClick:async()=>{const x=(prompt("Save current search as Smart (name):")||"").trim();if(x)try{const g=(P||"").split(",").map(de=>de.trim()).filter(Boolean),I={query:(Q||"").trim(),favoritesOnly:N,tags:g,useCaptions:l,useOcr:d,hasText:b,camera:k||void 0,isoMin:v||void 0,isoMax:f||void 0,fMin:S||void 0,fMax:T||void 0,place:y||void 0},q=(Z||[]).filter(Boolean);q.length===1?I.person=q[0]:q.length>1&&(I.persons=q);const{apiSetSmart:D,apiGetSmart:ae}=await pe(async()=>{const{apiSetSmart:de,apiGetSmart:fe}=await Promise.resolve().then(()=>ge);return{apiSetSmart:de,apiGetSmart:fe}},void 0,import.meta.url);await D(s,x,I);try{const de=await ae(s);G.setSmart(de.smart||{})}catch{}$.setNote(`Saved smart collection: ${x}`)}catch(g){$.setNote(g?.message||"Failed to save smart collection")}},children:"Save as Smart Collection"})]}),C&&C.length===0&&Q?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(js,{type:"no-results",searchQuery:Q,onAction:()=>{ne(""),G.setQuery("")},onOpenFilters:()=>gt(!0),onOpenAdvanced:()=>xe({kind:"advanced"}),onClearSearch:()=>{N&&G.setFavOnly(!1),P&&G.setTagFilter(""),os(""),ls(""),A.setPlace(""),A.setCamera(""),A.setIsoMin(0),A.setIsoMax(0),A.setFMin(0),A.setFMax(0),A.setHasText(!1),K.setPersons([])},hasActiveFilters:En,sampleQueries:["golden hour","city skyline","family dinner","blue car"],onRunSample:x=>Ve(x),onOpenHelp:()=>ze(!0)}),e.jsx(La,{onSearch:Ve})]}):ve==="grid"?e.jsx(Jr,{dir:s,engine:r,items:(C||[]).map(x=>({path:x.path,score:x.score})),selected:H,onToggleSelect:jt,onOpen:x=>ya(x),scrollContainerRef:ua,focusIndex:be??void 0,onLayout:x=>on(g=>un(g,x)?g:x),ratingMap:fs,showInfoOverlay:rt}):e.jsx(Nl,{dir:s,engine:r,items:(C||[]).map(x=>({path:x.path,score:x.score})),selected:H,onToggleSelect:jt,onOpen:x=>ya(x),showInfoOverlay:rt,bucket:Oe})]})}),X==="library"&&e.jsx(Ua,{sectionName:"Library",children:e.jsx(On,{})}),X==="people"&&e.jsx("div",{className:"p-4",children:e.jsx(pl,{dir:s,engine:r,clusters:ie||[],persons:Z,setPersons:K.setPersons,busy:se,setBusy:$.setBusy,setNote:$.setNote,onLoadFaces:ys,onOpenPhotos:x=>{G.setResults(x.map(g=>({path:g,score:0}))),R("results"),$.setNote(`Viewing ${x.length} photos from face cluster`)}})}),X==="map"&&e.jsx("div",{className:"p-4",children:e.jsx(gl,{points:W||[],onLoadMap:$n})}),X==="collections"&&e.jsx("div",{className:"p-4",children:e.jsx(fl,{dir:s,engine:r,collections:O,onLoadCollections:async()=>{const{apiGetCollections:x}=await pe(async()=>{const{apiGetCollections:I}=await Promise.resolve().then(()=>ge);return{apiGetCollections:I}},void 0,import.meta.url),g=await x(s);G.setCollections(g.collections||{})},onOpen:x=>{const g=O?.[x]||[];G.setResults(g.map(I=>({path:I,score:0}))),R("results"),$.setNote(`${g.length} in ${x}`)},onDelete:async x=>{try{const{apiDeleteCollection:g,apiGetCollections:I}=await pe(async()=>{const{apiDeleteCollection:D,apiGetCollections:ae}=await Promise.resolve().then(()=>ge);return{apiDeleteCollection:D,apiGetCollections:ae}},void 0,import.meta.url);await g(s,x);const q=await I(s);G.setCollections(q.collections||{}),Le({message:`Deleted collection ${x}`})}catch(g){$.setNote(g instanceof Error?g.message:"Delete failed")}}})}),X==="saved"&&e.jsxs("div",{className:"p-4",children:[e.jsx(vl,{saved:z,onRun:(x,g,I)=>{ne(g),I&&G.setTopK(I),Ve(g)},onDelete:async x=>{try{const{apiDeleteSaved:g,apiGetSaved:I}=await pe(async()=>{const{apiDeleteSaved:D,apiGetSaved:ae}=await Promise.resolve().then(()=>ge);return{apiDeleteSaved:D,apiGetSaved:ae}},void 0,import.meta.url);await g(s,x);const q=await I(s);G.setSaved(q.saved||[])}catch(g){$.setNote(g instanceof Error?g.message:"Delete failed")}}}),e.jsxs("div",{className:"mt-4 bg-white border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold",children:"Presets"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:nt,children:"Refresh"}),e.jsx("button",{type:"button",className:"px-2 py-1 rounded border",onClick:()=>{try{const x=JSON.stringify(ps||[],null,2),g=new Blob([x],{type:"application/json"}),I=URL.createObjectURL(g),q=document.createElement("a");q.href=I,q.download="photo-search-presets.json",document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(I)}catch{}},children:"Export"}),e.jsxs("label",{className:"px-2 py-1 rounded border cursor-pointer",children:["Import",e.jsx("input",{type:"file",accept:"application/json",className:"hidden",onChange:async x=>{const g=x.target.files?.[0];if(g)try{const I=await g.text(),q=JSON.parse(I);if(Array.isArray(q)){const{apiAddPreset:D}=await pe(async()=>{const{apiAddPreset:ae}=await Promise.resolve().then(()=>ge);return{apiAddPreset:ae}},void 0,import.meta.url);for(const ae of q)ae&&typeof ae.name=="string"&&typeof ae.query=="string"&&await D(s,ae.name,ae.query);await nt(),Le({message:`Imported ${q.length} preset(s)`})}else $.setNote("Invalid JSON format")}catch{$.setNote("Import failed")}finally{x.currentTarget.value=""}}})]})]})]}),ps.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No presets yet. Use Advanced Search to create one."}):e.jsx("div",{className:"mt-2 divide-y",children:ps.map(x=>e.jsxs("div",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:x.name,children:x.name}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:x.query,children:x.query})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{ne(x.query),ba(x.query)},className:"px-2 py-1 rounded bg-blue-600 text-white text-sm",children:"Run"}),e.jsx("button",{type:"button",onClick:async()=>{try{const{apiDeletePreset:g}=await pe(async()=>{const{apiDeletePreset:I}=await Promise.resolve().then(()=>ge);return{apiDeletePreset:I}},void 0,import.meta.url);await g(s,x.name),await nt()}catch{}},className:"px-2 py-1 rounded bg-red-600 text-white text-sm",children:"Delete"})]})]},x.name))})]})]}),X==="memories"&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"font-semibold",children:"Recent Favorites"})}),w.length===0?e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"No favorites yet."}):e.jsx("div",{className:"mt-2 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2",children:w.slice(0,24).map(x=>e.jsx("img",{src:Ne(s,r,x,196),alt:kc(x),className:"w-full h-24 object-cover rounded"},x))})]}),e.jsx("div",{children:e.jsx(Ra,{dir:s,engine:r,setBusy:$.setBusy,setNote:$.setNote,setResults:G.setResults})})]}),X==="tasks"&&e.jsx("div",{className:"p-4",children:e.jsx(wl,{})}),X==="smart"&&e.jsx("div",{className:"p-4",children:e.jsx(yl,{dir:s,engine:r,topK:_,smart:Y,setSmart:G.setSmart,setResults:G.setResults,setSearchId:G.setSearchId,setNote:$.setNote,query:E,favOnly:N,tagFilter:P,useCaps:l,useOcr:d,hasText:b,camera:k,isoMin:String(v||""),isoMax:String(f||""),fMin:String(S||""),fMax:String(T||""),place:y,persons:Z})}),X==="trips"&&e.jsx("div",{className:"p-4",children:e.jsx(Ra,{dir:s,engine:r,setBusy:$.setBusy,setNote:$.setNote,setResults:G.setResults})}),X==="videos"&&e.jsx("div",{className:"p-4",children:e.jsx(Jl,{currentDir:s,provider:r})})]}),e.jsx(Yl,{items:In,note:B,diag:J,engine:r}),e.jsx(Ll,{show:is,onClose:()=>gt(!1),onApply:()=>{gt(!1),Ve(Q)},favOnly:N,setFavOnly:G.setFavOnly,tagFilter:P,setTagFilter:G.setTagFilter,camera:k,setCamera:A.setCamera,isoMin:String(v||""),setIsoMin:x=>A.setIsoMin(parseFloat(x)||0),isoMax:String(f||""),setIsoMax:x=>A.setIsoMax(parseFloat(x)||0),dateFrom:Ae,setDateFrom:os,dateTo:Ue,setDateTo:ls,fMin:String(S||""),setFMin:x=>A.setFMin(parseFloat(x)||0),fMax:String(T||""),setFMax:x=>A.setFMax(parseFloat(x)||0),place:y,setPlace:A.setPlace,useCaps:l,setUseCaps:A.setUseCaps,useOcr:d,setUseOcr:A.setUseOcr,hasText:b,setHasText:A.setHasText}),ke?.kind==="shareManage"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:x=>{x.key==="Escape"&&xe(null)},children:e.jsx(qa,{onEscape:()=>xe(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-2xl",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"Manage Shares"}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>xe(null),children:"Close"})]}),e.jsx(Dl,{dir:s})]})})}),ke?.kind==="export"&&e.jsx(ec,{selected:H,dir:s,onClose:()=>xe(null),uiActions:$}),ke?.kind==="enhanced-share"&&e.jsx(bc,{selected:H,dir:s,onClose:()=>xe(null),uiActions:$}),ke?.kind==="share"&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onKeyDown:x=>{x.key==="Escape"&&xe(null)},children:e.jsx(qa,{onEscape:()=>xe(null),children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-md",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Share (v1)"}),e.jsxs("form",{onSubmit:async x=>{if(x.preventDefault(),!s)return;const g=Array.from(H);if(g.length===0){alert("Select photos to share");return}const I=x.target,q=parseInt(I.elements.namedItem("expiry").value||"24",10),D=I.elements.namedItem("pw").value.trim(),ae=I.elements.namedItem("viewonly").checked;try{const{apiCreateShare:de}=await pe(async()=>{const{apiCreateShare:je}=await Promise.resolve().then(()=>ge);return{apiCreateShare:je}},void 0,import.meta.url),fe=await de(s,r,g,{expiryHours:Number.isNaN(q)?24:q,password:D||void 0,viewOnly:ae});await navigator.clipboard.writeText(window.location.origin+fe.url),$.setNote("Share link copied to clipboard")}catch(de){$.setNote(de instanceof Error?de.message:"Share failed")}xe(null)},children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"expiry-input",children:"Expiry (hours)"}),e.jsx("input",{id:"expiry-input",name:"expiry",type:"number",min:1,defaultValue:24,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",htmlFor:"pw-input",children:"Password (optional)"}),e.jsx("input",{id:"pw-input",name:"pw",type:"password",className:"w-full border rounded px-2 py-1",placeholder:""})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"viewonly",defaultChecked:!0})," ","View-only (disable downloads)"]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-3 py-1 rounded border",onClick:()=>xe(null),"aria-label":"Cancel sharing",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white","aria-label":"Create shareable link",children:"Create Link"})]})]})]})})}),ke?.kind==="tag"&&e.jsx(sc,{onClose:()=>xe(null),onTagSelected:_n}),ke?.kind==="folder"&&e.jsx(nc,{dir:s,useOsTrash:p,useFast:u,fastKind:c,useCaps:l,useOcr:d,hasText:b,highContrast:bs,onClose:()=>xe(null),settingsActions:{...A,setHighContrast:()=>{}},uiActions:$,doIndex:ot,prepareFast:x=>Mn(x),buildOCR:Fn,buildMetadata:Dn}),ke?.kind==="likeplus"&&e.jsx(oc,{selected:H,dir:s,engine:r,topK:_,onClose:()=>xe(null),setSelectedView:x=>R(x),photoActions:G,uiActions:$}),ke?.kind==="save"&&e.jsx(cc,{dir:s,searchText:Q,query:E,topK:_,onClose:()=>xe(null),setSelectedView:x=>R(x),photoActions:G,uiActions:$}),ke?.kind==="collect"&&e.jsx(uc,{selected:H,dir:s,collections:O,onClose:()=>xe(null),setToast:Le,photoActions:G,uiActions:$}),ke?.kind==="removeCollect"&&e.jsx(mc,{selected:H,dir:s,collections:O,onClose:()=>xe(null),setToast:Le,photoActions:G,uiActions:$}),we!==null&&C&&C[we]&&(De.isVideoFile(C[we].path)?e.jsx(ml,{videoPath:C[we].path,videoUrl:`/api/media/${encodeURIComponent(C[we].path)}`,onPrevious:()=>Je(-1),onNext:()=>Je(1),onClose:()=>Ye(null)}):e.jsx(hl,{dir:s,engine:r,path:C[we].path,onPrev:()=>Je(-1),onNext:()=>Je(1),onClose:()=>Ye(null),onReveal:async()=>{try{const{apiOpen:x}=await pe(async()=>{const{apiOpen:I}=await Promise.resolve().then(()=>ge);return{apiOpen:I}},void 0,import.meta.url),g=C&&we!==null?C[we]?.path:void 0;g&&await x(s,g)}catch{}},onFavorite:async()=>{try{const x=C&&we!==null?C[we]?.path:void 0;x&&(await St(s,x,!w.includes(x)),await Qe())}catch{}},onMoreLikeThis:async()=>{try{const{apiSearchLike:x}=await pe(async()=>{const{apiSearchLike:q}=await Promise.resolve().then(()=>ge);return{apiSearchLike:q}},void 0,import.meta.url),g=C&&we!==null?C[we]?.path:void 0;if(!g)return;$.setBusy("Searching similar");const I=await x(s,g,r,_);G.setResults(I.results||[]),R("results")}catch(x){$.setNote(x instanceof Error?x.message:"Search failed")}finally{$.setBusy("")}}})),e.jsx("button",{type:"button",onClick:()=>xe({kind:"jobs"}),className:"fixed bottom-4 right-4 bg-blue-600 text-white rounded-full shadow px-4 py-2",title:"Open Jobs","aria-label":"Open the jobs panel",children:"Jobs"}),ke?.kind==="jobs"&&e.jsx(kl,{open:!0,onClose:()=>xe(null)}),ke?.kind==="advanced"&&e.jsx(Xl,{open:!0,onClose:()=>xe(null),onApply:x=>{ne(x),ba(x),xe(null)},onSave:async(x,g)=>{try{const{apiAddPreset:I}=await pe(async()=>{const{apiAddPreset:q}=await Promise.resolve().then(()=>ge);return{apiAddPreset:q}},void 0,import.meta.url);await I(s,x,g),Le({message:`Saved preset ${x}`}),await nt()}catch(I){$.setNote(I instanceof Error?I.message:"Save failed")}},allTags:m||[],cameras:ha?.cameras||[],people:(ie||[]).filter(x=>x.name).map(x=>String(x.name))}),e.jsx(gc,{isOpen:nn,onClose:()=>ze(!1),initialSection:"getting-started"}),e.jsx(Nc,{isOpen:vn,onClose:()=>xa(!1)}),!!se&&e.jsx("div",{className:"fixed inset-0 z-[1050] bg-black/40 flex items-center justify-center",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-sm",children:[e.jsx(Zr,{size:"lg",message:se,className:"text-center"}),B&&e.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300 text-center",children:B})]})}),at&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-[1070]",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"flex items-center gap-3 bg-gray-900 text-white px-4 py-2 rounded shadow",children:[e.jsx("span",{className:"text-sm",children:at.message}),at.actionLabel&&at.onAction&&e.jsx("button",{type:"button",className:"text-sm underline",onClick:at.onAction,children:at.actionLabel}),e.jsx("button",{type:"button","aria-label":"Close notification",className:"ml-1",onClick:()=>{Le(null),_t.current&&(window.clearTimeout(_t.current),_t.current=null)},children:""})]})}),e.jsx(Ml,{photoCount:M?.length||0,indexedCount:M?.length||0,searchProvider:r,isIndexing:bt,isConnected:!0,currentDirectory:s,activeJobs:ds.filter(x=>x.status==="running").length}),e.jsx(Fl,{jobs:ds,onPause:x=>{Re(g=>g.map(I=>I.id===x?{...I,status:"paused"}:I))},onResume:x=>{Re(g=>g.map(I=>I.id===x?{...I,status:"running"}:I))},onCancel:x=>{Re(g=>g.map(I=>I.id===x?{...I,status:"cancelled"}:I))},onRetry:x=>{Re(g=>g.map(I=>I.id===x?{...I,status:"queued"}:I))},onClear:x=>{Re(g=>g.filter(I=>I.id!==x))},onClearAll:()=>{Re(x=>x.filter(g=>g.status==="running"||g.status==="queued"))}}),e.jsx(Ql,{activeTab:cn,onTabChange:x=>{switch(dn(x),x){case"home":R("library");break;case"search":R("results");break;case"favorites":R("results"),G.setFavOnly(!0);break;case"settings":R("tasks");break}},onShowFilters:()=>gt(!0),onShowUpload:()=>xe({kind:"folder"}),onShowLibrary:()=>xe({kind:"folder"}),showSecondaryActions:!0})]}),e.jsx(Il,{isVisible:Cn,onDismiss:()=>pa(!1),context:X,userActions:vt}),e.jsx($l,{isVisible:Tn,onComplete:()=>{ga(!1);try{localStorage.setItem("onboardingComplete","true")}catch{}},completedSteps:kn,inProgressStepId:bt?"index_photos":void 0,onStepComplete:()=>{},onStepAction:x=>{switch(x){case"select_directory":{R("library"),xe({kind:"folder"});break}case"index_photos":{R("library"),s?ot():xe({kind:"folder"});break}case"first_search":{R("results"),Le({message:"Try searching: beach sunset, birthday cake, mountain hike"});break}case"explore_features":{R("collections"),Le({message:"Explore collections, favorites, and sharing"});break}}}}),e.jsx(sn,{})]})})})}const Cc=({darkMode:a=!1,onDarkModeToggle:t})=>{const[s,r]=o.useState("library"),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState(new Set),[p,b]=o.useState(!1),[y,k]=o.useState(null),[v,f]=o.useState(null),[S,T]=o.useState(!1),[P,m]=o.useState(!1),[h,j]=o.useState(0),[C,E]=o.useState("medium"),[w,N]=o.useState(!1),_=o.useRef(null);o.useEffect(()=>{z()},[]),o.useEffect(()=>{v&&ee()},[v]);const z=async()=>{try{const L=await Ys();console.log("Workspace loaded:",L)}catch(L){console.error("Failed to load workspace:",L)}},ee=async()=>{if(v){b(!0),k(null);try{console.log("Loading library from:",v);const L=await $t(v);if(!L||!L.images)throw new Error("No images found in the selected folder");const Z=L.images.map((ie,W)=>({id:`photo-${W}`,path:ie,thumbnail:Ne(ie),title:ie.split("/").pop()?.split(".")[0]||"Untitled",date:new Date().toLocaleDateString(),type:ie.split(".").pop()?.toLowerCase()}));c(Z),k(null),console.log(`Loaded ${Z.length} photos`)}catch(L){console.error("Failed to load library:",L),k(L.message||"Failed to load photos from the selected folder"),c([])}finally{b(!1)}}},O=async L=>{if(L.preventDefault(),!!n.trim()){b(!0);try{const Z=await as(n,20);if(Z&&Z.results){const ie=Z.results.map((W,J)=>({id:`search-${J}`,path:W.image,thumbnail:Ne(W.image),title:W.image.split("/").pop()?.split(".")[0],score:W.score}));c(ie)}}catch(Z){console.error("Search failed:",Z)}finally{b(!1)}}},Y=async()=>{if(window.electronAPI)try{const L=await window.electronAPI.selectFolder();L&&await M(L)}catch(L){console.error("Failed to select folder:",L)}else _.current?.click()},F=async L=>{const Z=L.target.files;if(Z&&Z.length>0){const ie=Z[0].webkitRelativePath?.split("/")[0];if(ie){const W=`/Users/pranay/Desktop/${ie}`;await M(W)}}},M=async L=>{try{console.log("Adding path:",L),await et(L),f(L),k(null)}catch(Z){console.error("Failed to add path:",Z),k("Failed to add the selected folder")}},V=L=>{const Z=new Set(l);Z.has(L.id)?Z.delete(L.id):Z.add(L.id),d(Z)},se=L=>{j(L),m(!0)},B=[{id:"library",label:"Library",icon:mt},{id:"memories",label:"Memories",icon:Xt},{id:"people",label:"People",icon:Ge},{id:"places",label:"Places",icon:ar},{id:"recent",label:"Recent",icon:ht}],me=s==="memories"?u.filter(L=>L.favorite):u;return e.jsxs("div",{className:`flex h-screen ${a?"dark":""}`,style:{background:"var(--bg-primary)"},children:[e.jsxs("div",{className:`sidebar ${w?"w-16":""}`,style:{width:w?"64px":"260px"},children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[!w&&e.jsx("h1",{className:"text-title",style:{fontSize:"1.25rem",fontWeight:600},children:"Photos"}),e.jsx("button",{onClick:()=>N(!w),className:"btn-ghost",style:{padding:"8px"},children:w?e.jsx(Ct,{size:18}):e.jsx(Ta,{size:18})})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[!w&&e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"LIBRARY"}),B.map(L=>{const Z=L.icon;return e.jsxs("div",{onClick:()=>r(L.id),className:`nav-item ${s===L.id?"active":""}`,style:{justifyContent:w?"center":"flex-start",padding:w?"12px":"10px 16px"},children:[e.jsx(Z,{size:20}),!w&&e.jsx("span",{children:L.label})]},L.id)})]}),!w&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{className:"text-overline",style:{padding:"0 16px 8px",color:"var(--text-tertiary)",fontSize:"11px",letterSpacing:"0.06em"},children:"ALBUMS"}),e.jsxs("div",{className:"nav-item",children:[e.jsx(Ea,{size:20}),e.jsx("span",{children:"All Albums"})]}),e.jsxs("div",{className:"nav-item",children:[e.jsx(Ht,{size:20}),e.jsx("span",{children:"Favorites"})]})]})]}),e.jsxs("div",{style:{padding:"16px",borderTop:"1px solid var(--border-subtle)"},children:[e.jsx("button",{onClick:Y,className:"btn btn-primary",style:{width:"100%",justifyContent:"center",fontSize:w?"0":"14px",padding:w?"12px":"10px 16px"},children:w?e.jsx(ct,{size:20}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:18}),e.jsx("span",{children:"Import Photos"})]})}),e.jsx("input",{ref:_,type:"file",webkitdirectory:"",directory:"",multiple:!0,onChange:F,style:{display:"none"}}),!w&&e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[e.jsx("button",{onClick:()=>T(!S),className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:e.jsx(Pt,{size:18})}),e.jsx("button",{onClick:t,className:"btn btn-ghost",style:{flex:1,padding:"8px"},children:a?e.jsx(Es,{size:18}):e.jsx(sr,{size:18})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",style:{background:"var(--bg-primary)"},children:[e.jsx("header",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-subtle)",background:"var(--bg-primary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("form",{onSubmit:O,className:"search-bar",style:{maxWidth:"500px"},children:[e.jsx(Ce,{size:18,style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)",color:"var(--text-tertiary)"}}),e.jsx("input",{type:"text",value:n,onChange:L=>i(L.target.value),placeholder:"Search photos...",className:"search-input"})]}),e.jsxs("div",{className:"flex items-center gap-12px",children:[l.size>0&&e.jsxs("div",{className:"flex items-center gap-8px",style:{marginRight:"16px"},children:[e.jsxs("span",{className:"text-caption",style:{color:"var(--text-secondary)"},children:[l.size," selected"]}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(Zt,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px"},children:e.jsx(Me,{size:16})}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 12px",color:"var(--error)"},children:e.jsx(He,{size:16})})]}),e.jsx("div",{className:"flex items-center gap-4px",style:{padding:"4px",background:"var(--bg-tertiary)",borderRadius:"var(--radius-md)"},children:["small","medium","large"].map(L=>e.jsx("button",{onClick:()=>E(L),style:{padding:"6px 12px",background:C===L?"var(--bg-primary)":"transparent",border:"none",borderRadius:"var(--radius-sm)",color:C===L?"var(--text-primary)":"var(--text-secondary)",fontSize:"12px",fontWeight:500,cursor:"pointer",transition:"all var(--transition-fast)"},children:L.charAt(0).toUpperCase()+L.slice(1)},L))})]})]})}),e.jsxs("main",{className:"flex-1 overflow-auto",style:{padding:"24px"},children:[p&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse",style:{marginBottom:"16px"},children:e.jsx(ts,{size:48,style:{color:"var(--text-tertiary)"}})}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)"},children:"Loading photos..."})]})}),y&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",style:{maxWidth:"400px"},children:[e.jsx(Is,{size:48,style:{color:"var(--error)",marginBottom:"16px"}}),e.jsx("p",{className:"text-body",style:{color:"var(--error)",marginBottom:"24px"},children:y}),e.jsx("button",{onClick:Y,className:"btn btn-primary",children:"Select Another Folder"})]})}),!p&&!y&&u.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ea,{size:64,style:{color:"var(--text-tertiary)",marginBottom:"24px"}}),e.jsx("h2",{className:"text-headline",style:{marginBottom:"12px",fontSize:"24px"},children:"No photos yet"}),e.jsx("p",{className:"text-body",style:{color:"var(--text-secondary)",marginBottom:"32px"},children:"Import your photos to get started"}),e.jsxs("button",{onClick:Y,className:"btn btn-primary",style:{fontSize:"16px",padding:"12px 32px"},children:[e.jsx(ct,{size:20}),"Select Photo Folder"]})]})}),!p&&!y&&u.length>0&&e.jsx("div",{className:"photo-grid",style:{gridTemplateColumns:C==="small"?"repeat(auto-fill, minmax(150px, 1fr))":C==="large"?"repeat(auto-fill, minmax(300px, 1fr))":"repeat(auto-fill, minmax(200px, 1fr))",gap:C==="small"?"4px":"8px"},children:me.map((L,Z)=>e.jsxs("div",{className:"photo-item",onClick:()=>se(Z),style:{borderRadius:C==="small"?"4px":"8px",position:"relative"},children:[L.thumbnail?e.jsx("img",{src:L.thumbnail,alt:L.title,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{className:"skeleton",style:{width:"100%",height:"100%"}}),e.jsx("div",{onClick:ie=>{ie.stopPropagation(),V(L)},style:{position:"absolute",top:"8px",left:"8px",width:"24px",height:"24px",borderRadius:"50%",background:l.has(L.id)?"var(--accent-primary)":"rgba(255, 255, 255, 0.9)",border:l.has(L.id)?"none":"2px solid rgba(255, 255, 255, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",opacity:l.has(L.id)?1:0,transition:"opacity var(--transition-fast)"},className:"photo-select",children:l.has(L.id)&&e.jsx(ut,{size:14,style:{color:"white"}})})]},L.id))})]})]}),P&&u[h]&&e.jsxs("div",{onClick:()=>m(!1),style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"var(--z-modal)"},children:[e.jsx("button",{onClick:L=>{L.stopPropagation(),m(!1)},style:{position:"absolute",top:"24px",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(Te,{size:20})}),h>0&&e.jsx("button",{onClick:L=>{L.stopPropagation(),j(h-1)},style:{position:"absolute",left:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(Ta,{size:20})}),h<u.length-1&&e.jsx("button",{onClick:L=>{L.stopPropagation(),j(h+1)},style:{position:"absolute",right:"24px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:e.jsx(Ct,{size:20})}),e.jsx("img",{src:u[h].path,alt:u[h].title,style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain"},onClick:L=>L.stopPropagation()})]}),e.jsx("style",{jsx:!0,children:`
        .photo-item:hover .photo-select {
          opacity: 1 !important;
        }
      `})]})},Tc=()=>{const[a,t]=o.useState(()=>{const r=localStorage.getItem("darkMode");return r!==null?r==="true":window.matchMedia("(prefers-color-scheme: dark)").matches});o.useEffect(()=>{a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",a.toString())},[a]);const s=()=>{t(r=>!r)};return e.jsx(Cc,{darkMode:a,onDarkModeToggle:s})};function Ec(){return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Test App"}),e.jsx("p",{children:"This is a minimal test to see if React is working."})]})}function Pc(){const[a,t]=o.useState([]),[s,r]=o.useState(null),[n,i]=o.useState("grid"),[u,c]=o.useState(!1),[l,d]=o.useState(""),[p,b]=o.useState([]),[y,k]=o.useState(!1),v=$e();o.useEffect(()=>{f()},[]);const f=async()=>{k(!0);try{const h=await v.getCollections(),j=Object.entries(h.collections).map(([C,E])=>({name:C,paths:E,count:E.length,preview:E[0]}));t(j)}catch(h){console.error("Failed to load collections:",h)}finally{k(!1)}},S=async()=>{if(l.trim())try{await v.setCollection(l,p),await f(),c(!1),d(""),b([])}catch(h){console.error("Failed to create collection:",h)}},T=async h=>{if(confirm(`Delete collection "${h}"?`))try{await v.deleteCollection(h),await f(),s===h&&r(null)}catch(j){console.error("Failed to delete collection:",j)}},P=({collection:h})=>e.jsxs("div",{className:"collection-card",onClick:()=>r(h.name),children:[e.jsxs("div",{className:"collection-preview",children:[h.preview&&e.jsx("img",{src:v.getThumbnailUrl(h.preview),alt:h.name}),e.jsx("div",{className:"collection-overlay",children:e.jsx(mt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"collection-info",children:[e.jsx("h3",{children:h.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[h.count," items"]})]}),e.jsx("div",{className:"collection-actions",children:e.jsx("button",{onClick:j=>{j.stopPropagation(),T(h.name)},className:"btn-icon",children:e.jsx(He,{className:"w-4 h-4"})})})]}),m=({collection:h})=>e.jsxs("div",{className:"collection-list-item",onClick:()=>r(h.name),children:[e.jsx(Ct,{className:"w-4 h-4 text-gray-400"}),e.jsx(ks,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:h.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[h.count," items"]})]}),e.jsx("button",{onClick:j=>{j.stopPropagation(),T(h.name)},className:"btn-icon",children:e.jsx(He,{className:"w-4 h-4"})})]});return e.jsxs("div",{className:"collections-manager",children:[e.jsxs("div",{className:"manager-header",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Collections"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{onClick:()=>i("grid"),className:n==="grid"?"active":"",children:e.jsx(mt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i("list"),className:n==="list"?"active":"",children:e.jsx(tr,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary",children:[e.jsx(Wa,{className:"w-4 h-4"}),"New Collection"]})]})]}),u&&e.jsxs("div",{className:"create-collection-panel",children:[e.jsx("input",{type:"text",placeholder:"Collection name...",value:l,onChange:h=>d(h.target.value),className:"input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,className:"btn btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>{c(!1),d("")},className:"btn btn-secondary",children:"Cancel"})]})]}),y?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading collections..."})]}):e.jsx("div",{className:n==="grid"?"collections-grid":"collections-list",children:a.map(h=>n==="grid"?e.jsx(P,{collection:h},h.name):e.jsx(m,{collection:h},h.name))}),e.jsx("style",{jsx:!0,children:`
        .collections-manager {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .manager-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .view-toggle {
          display: flex;
          gap: 0.25rem;
          padding: 0.25rem;
          background: var(--bg-tertiary);
          border-radius: var(--radius-md);
        }

        .view-toggle button {
          padding: 0.5rem;
          background: transparent;
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .view-toggle button.active {
          background: var(--bg-primary);
          color: var(--accent-primary);
        }

        .create-collection-panel {
          background: var(--bg-secondary);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          margin-bottom: 2rem;
          display: flex;
          gap: 1rem;
          align-items: center;
        }

        .collections-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 1.5rem;
        }

        .collection-card {
          background: var(--bg-elevated);
          border-radius: var(--radius-lg);
          overflow: hidden;
          cursor: pointer;
          transition: all 0.3s;
        }

        .collection-card:hover {
          transform: translateY(-4px);
          box-shadow: var(--shadow-lg);
        }

        .collection-preview {
          position: relative;
          aspect-ratio: 1;
          background: var(--bg-tertiary);
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .collection-preview img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .collection-overlay {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.5);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-sm);
        }

        .collection-info {
          padding: 1rem;
        }

        .collection-info h3 {
          font-weight: 600;
          margin-bottom: 0.25rem;
        }

        .collection-actions {
          padding: 0 1rem 1rem;
          display: flex;
          gap: 0.5rem;
        }

        .collections-list {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .collection-list-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-elevated);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all 0.2s;
        }

        .collection-list-item:hover {
          background: var(--bg-tertiary);
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--error);
          color: white;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 300px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Ic(){const[a,t]=o.useState([]),[s,r]=o.useState(null),[n,i]=o.useState(null),[u,c]=o.useState(""),[l,d]=o.useState(!1),[p,b]=o.useState(!1),[y,k]=o.useState({totalFaces:0,namedPeople:0}),v=$e();o.useEffect(()=>{f()},[]);const f=async()=>{d(!0);try{const m=await v.getFaceClusters();t(m.clusters);const h=m.clusters.reduce((C,E)=>C+E.size,0),j=m.clusters.filter(C=>C.name).length;k({totalFaces:h,namedPeople:j})}catch(m){console.error("Failed to load face clusters:",m)}finally{d(!1)}},S=async()=>{b(!0);try{const m=await v.buildFaces();console.log(`Built faces: ${m.faces} faces in ${m.clusters} clusters`),await f()}catch(m){console.error("Failed to build face index:",m)}finally{b(!1)}},T=async m=>{if(u.trim())try{await v.nameFaceCluster(m,u),await f(),i(null),c("")}catch(h){console.error("Failed to name cluster:",h)}},P=({cluster:m})=>e.jsxs("div",{className:`face-cluster-card ${s===m.id?"selected":""}`,onClick:()=>r(m.id),children:[e.jsx("div",{className:"cluster-header",children:n===m.id?e.jsxs("div",{className:"name-editor",children:[e.jsx("input",{type:"text",value:u,onChange:h=>c(h.target.value),placeholder:"Enter name...",className:"name-input",autoFocus:!0,onClick:h=>h.stopPropagation()}),e.jsx("button",{onClick:h=>{h.stopPropagation(),T(m.id)},className:"btn-icon",children:e.jsx(ut,{className:"w-4 h-4"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),i(null),c("")},className:"btn-icon",children:e.jsx(Te,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"cluster-name",children:m.name||`Person ${m.id.slice(0,8)}`}),e.jsx("button",{onClick:h=>{h.stopPropagation(),i(m.id),c(m.name||"")},className:"btn-icon",children:e.jsx(vi,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"cluster-stats",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[m.size," photos"]})}),e.jsx("div",{className:"face-examples",children:m.examples.slice(0,4).map(([h,j],C)=>e.jsx("div",{className:"face-thumbnail",children:e.jsx("img",{src:v.getFaceThumbnailUrl(h,j,96),alt:`Face ${C+1}`})},C))})]});return e.jsxs("div",{className:"face-detection",children:[e.jsxs("div",{className:"detection-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ge,{className:"w-6 h-6"}),"People"]}),e.jsxs("p",{className:"text-gray-500 mt-1",children:[y.totalFaces," faces detected  ",y.namedPeople," people identified"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:S,disabled:p,className:"btn btn-secondary",children:[e.jsx(Os,{className:`w-4 h-4 ${p?"animate-spin":""}`}),p?"Building...":"Rebuild Index"]})})]}),l?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading faces..."})]}):a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Ge,{className:"w-16 h-16 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mt-4",children:"No faces detected yet"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Build the face index to detect and group people in your photos"}),e.jsxs("button",{onClick:S,disabled:p,className:"btn btn-primary mt-4",children:[e.jsx(yi,{className:"w-4 h-4"}),"Build Face Index"]})]}):e.jsx("div",{className:"clusters-grid",children:a.map(m=>e.jsx(P,{cluster:m},m.id))}),e.jsx("style",{jsx:!0,children:`
        .face-detection {
          padding: 2rem;
          height: 100%;
          overflow-y: auto;
        }

        .detection-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .clusters-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 1.5rem;
        }

        .face-cluster-card {
          background: var(--bg-elevated);
          border: 2px solid transparent;
          border-radius: var(--radius-lg);
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.3s;
        }

        .face-cluster-card:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .face-cluster-card.selected {
          border-color: var(--accent-primary);
          box-shadow: 0 0 0 3px var(--accent-light);
        }

        .cluster-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.5rem;
        }

        .cluster-name {
          font-size: 1.125rem;
          font-weight: 600;
        }

        .name-editor {
          display: flex;
          gap: 0.5rem;
          width: 100%;
        }

        .name-input {
          flex: 1;
          padding: 0.25rem 0.5rem;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-sm);
          background: var(--bg-primary);
          font-size: 1rem;
        }

        .cluster-stats {
          margin-bottom: 1rem;
        }

        .face-examples {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 0.5rem;
        }

        .face-thumbnail {
          aspect-ratio: 1;
          border-radius: var(--radius-md);
          overflow: hidden;
          background: var(--bg-tertiary);
        }

        .face-thumbnail img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .btn-icon {
          padding: 0.5rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .btn-icon:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          text-align: center;
        }

        .loading-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 400px;
          gap: 1rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .animate-spin {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function $c(){const[a,t]=o.useState("library"),[s,r]=o.useState(null),[n,i]=o.useState(""),[u,c]=o.useState([]),[l,d]=o.useState([]),[p,b]=o.useState([]),[y,k]=o.useState([]),[v,f]=o.useState("/Users/pranay/Desktop"),[S,T]=o.useState(null),[P,m]=o.useState(!1),[h,j]=o.useState({});o.useEffect(()=>{const O={dir:v,provider:"openai",openaiKey:localStorage.getItem("openai_api_key")||"",hfToken:localStorage.getItem("hf_token")||""};il(O),C()},[v]);const C=async()=>{const O=$e();try{const Y=await O.getWorkspace();k(Y.folders),await E();const F=await O.getFavorites();b(F.favorites)}catch(Y){console.error("Failed to load initial data:",Y)}},E=async()=>{m(!0);try{const Y=await $e().getLibrary(120,0);d(Y.paths)}catch(O){console.error("Failed to load library:",O)}finally{m(!1)}},w=async()=>{if(n.trim()){m(!0);try{const Y=await $e().search(n,24);c(Y.results),t("search")}catch(O){console.error("Search failed:",O)}finally{m(!1)}}},N=async O=>{m(!0);const Y=$e();try{let F;switch(O){case"search":F=await Y.buildIndex(32),console.log(`Indexed ${F.total} images`);break;case"faces":F=await Y.buildFaces(),console.log(`Found ${F.faces} faces in ${F.clusters} clusters`);break;case"ocr":F=await Y.buildOCR(["en"]),console.log(`Extracted text from ${F.updated} images`);break;case"metadata":F=await Y.buildMetadata(),console.log(`Extracted metadata from ${F.updated} images`);break;case"captions":F=await Y.buildCaptions("Salesforce/blip-image-captioning-large"),console.log(`Generated captions for ${F.updated} images`);break;case"trips":F=await Y.buildTrips(),console.log(`Found ${F.trips.length} trips`);break;case"fast-annoy":F=await Y.buildFastIndex("annoy");break;case"fast-faiss":F=await Y.buildFastIndex("faiss");break;case"fast-hnsw":F=await Y.buildFastIndex("hnsw");break}await E()}catch(F){console.error(`Failed to build ${O} index:`,F)}finally{m(!1)}},_=async()=>{const O=prompt("Enter folder path:");if(O)try{const F=await $e().addToWorkspace(O);k(F.folders)}catch(Y){console.error("Failed to add workspace folder:",Y)}},z=async()=>{m(!0);try{const Y=await $e().runDiagnostics();T(Y),t("diagnostics")}catch(O){console.error("Failed to run diagnostics:",O)}finally{m(!1)}},ee=()=>{switch(a){case"collections":return e.jsx(Pc,{});case"people":return e.jsx(Ic,{});case"editor":return s?e.jsx(Xr,{imagePath:s,onClose:()=>t("library"),onSave:O=>console.log("Saved:",O)}):null;case"search":return e.jsxs("div",{className:"search-results",children:[e.jsxs("h2",{children:['Search Results for "',n,'"']}),e.jsx("div",{className:"photo-grid",children:u.map((O,Y)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(O.path),t("editor")},children:[e.jsx("img",{src:$e().getThumbnailUrl(O.path),alt:""}),e.jsx("div",{className:"photo-score",children:O.score.toFixed(2)})]},Y))})]});case"library":return e.jsxs("div",{className:"library-view",children:[e.jsxs("div",{className:"library-header",children:[e.jsx("h2",{children:"Photo Library"}),e.jsxs("span",{className:"text-gray-500",children:[l.length," photos"]})]}),e.jsx("div",{className:"photo-grid",children:l.map((O,Y)=>e.jsxs("div",{className:"photo-item",onClick:()=>{r(O),t("editor")},children:[e.jsx("img",{src:$e().getThumbnailUrl(O),alt:""}),p.includes(O)&&e.jsx("div",{className:"favorite-badge",children:e.jsx(Ht,{className:"w-4 h-4",fill:"currentColor"})})]},Y))})]});case"diagnostics":return e.jsxs("div",{className:"diagnostics-view",children:[e.jsx("h2",{children:"System Diagnostics"}),S&&e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Storage"}),e.jsxs("p",{children:[S.free_gb.toFixed(2)," GB free"]}),e.jsxs("p",{children:["OS: ",S.os]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Indexes"}),S.engines.map(O=>e.jsxs("div",{children:[e.jsxs("p",{children:[O.key,": ",O.count," items"]}),O.fast&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Fast: Annoy=",O.fast.annoy?"":"","FAISS=",O.fast.faiss?"":"","HNSW=",O.fast.hnsw?"":""]})]},O.key))]})]})]});default:return null}};return e.jsxs("div",{className:"app-container",children:[e.jsxs("div",{className:"sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h1",{className:"text-xl font-bold",children:"PhotoVault Pro"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All 47 APIs Integrated"})]}),e.jsx("div",{className:"search-section",children:e.jsx("input",{type:"text",placeholder:"Search photos...",value:n,onChange:O=>i(O.target.value),onKeyPress:O=>O.key==="Enter"&&w(),className:"search-input"})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:`nav-item ${a==="library"?"active":""}`,onClick:()=>t("library"),children:[e.jsx(ji,{className:"w-5 h-5"}),"Library"]}),e.jsxs("div",{className:`nav-item ${a==="collections"?"active":""}`,onClick:()=>t("collections"),children:[e.jsx(mt,{className:"w-5 h-5"}),"Collections"]}),e.jsxs("div",{className:`nav-item ${a==="people"?"active":""}`,onClick:()=>t("people"),children:[e.jsx(Ge,{className:"w-5 h-5"}),"People"]}),e.jsxs("div",{className:`nav-item ${a==="places"?"active":""}`,onClick:()=>t("places"),children:[e.jsx(_s,{className:"w-5 h-5"}),"Places"]}),e.jsxs("div",{className:`nav-item ${a==="favorites"?"active":""}`,onClick:()=>t("favorites"),children:[e.jsx(Ht,{className:"w-5 h-5"}),"Favorites"]}),e.jsxs("div",{className:`nav-item ${a==="trips"?"active":""}`,onClick:()=>t("trips"),children:[e.jsx(ar,{className:"w-5 h-5"}),"Trips"]})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsx("h3",{className:"section-title",children:"Build Indexes"}),e.jsxs("button",{onClick:()=>N("search"),className:"index-btn",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Search Index"]}),e.jsxs("button",{onClick:()=>N("faces"),className:"index-btn",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Face Detection"]}),e.jsxs("button",{onClick:()=>N("ocr"),className:"index-btn",children:[e.jsx(wi,{className:"w-4 h-4"}),"OCR Text"]}),e.jsxs("button",{onClick:()=>N("metadata"),className:"index-btn",children:[e.jsx(zt,{className:"w-4 h-4"}),"Metadata"]}),e.jsxs("button",{onClick:()=>N("captions"),className:"index-btn",children:[e.jsx(Ni,{className:"w-4 h-4"}),"AI Captions"]})]}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsxs("button",{onClick:z,className:"nav-item",children:[e.jsx(Ms,{className:"w-5 h-5"}),"Diagnostics"]}),e.jsxs("button",{onClick:_,className:"nav-item",children:[e.jsx(We,{className:"w-5 h-5"}),"Add Folder"]})]})]}),e.jsxs("main",{className:"main-content",children:[P&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Processing..."})]}),ee()]}),e.jsx("style",{jsx:!0,children:`
        .app-container {
          display: flex;
          height: 100vh;
          background: var(--bg-primary);
        }

        .main-content {
          flex: 1;
          overflow-y: auto;
          position: relative;
        }

        .search-section {
          padding: 1rem;
        }

        .sidebar-section {
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .section-title {
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.75rem;
          text-transform: uppercase;
          letter-spacing: 0.05em;
        }

        .index-btn {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          width: 100%;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          background: var(--bg-tertiary);
          border: none;
          border-radius: var(--radius-md);
          font-size: 0.875rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .index-btn:hover {
          background: var(--accent-light);
          color: var(--accent-primary);
        }

        .sidebar-footer {
          margin-top: auto;
          padding: 1rem;
          border-top: 1px solid var(--border-subtle);
        }

        .library-view, .search-results, .diagnostics-view {
          padding: 2rem;
        }

        .library-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
        }

        .library-header h2 {
          font-size: 2rem;
          font-weight: 700;
        }

        .photo-item {
          position: relative;
        }

        .photo-score {
          position: absolute;
          bottom: 0.5rem;
          right: 0.5rem;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: var(--radius-sm);
          font-size: 0.75rem;
        }

        .favorite-badge {
          position: absolute;
          top: 0.5rem;
          right: 0.5rem;
          background: var(--warning);
          color: white;
          padding: 0.25rem;
          border-radius: var(--radius-full);
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 1.5rem;
        }

        .stat-card {
          background: var(--bg-elevated);
          padding: 1.5rem;
          border-radius: var(--radius-lg);
          border: 1px solid var(--border-subtle);
        }

        .stat-card h3 {
          font-size: 1.125rem;
          font-weight: 600;
          margin-bottom: 1rem;
        }

        .loading-overlay {
          position: absolute;
          inset: 0;
          background: rgba(255, 255, 255, 0.9);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          z-index: 100;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border-subtle);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}const Mc=o.createContext(null);function Fc({children:a}){const t=Wr(),[s,r]=o.useState(""),[n,i]=o.useState([]),[u,c]=o.useState({favOnly:!1}),l=o.useCallback(y=>{c(k=>({...k,...y}))},[]),d=o.useCallback(y=>{i(y);try{t?.setResults?.(y)}catch{}},[t]),p=o.useCallback(y=>{r(y);try{t?.setQuery?.(y)}catch{}},[t]),b=o.useMemo(()=>({state:{query:s,results:n,filters:u},actions:{setQuery:p,setResults:d,setFilters:l}}),[s,n,u,p,d,l]);return e.jsx(Mc.Provider,{value:b,children:a})}const Dc=o.createContext(null);function _c({children:a}){const t=qr()||[],s=!!Vr(),[r,n]=o.useState(!1),i=Hr(),u=o.useCallback(async d=>{const p=d?.dir||i?.state?.dir,b=d?.provider||i?.state?.engine||"local";if(p)try{n(!0),await Et(p,b)}finally{n(!1)}},[i]),c=o.useCallback(async d=>{const p=d?.dir||i?.state?.dir,b=d?.provider||i?.state?.engine||"local";p&&await $t(p,b,d?.limit??120,d?.offset??0)},[i]),l=o.useMemo(()=>({state:{paths:t,hasMore:s,isIndexing:r},actions:{index:u,load:c}}),[t,s,r,u,c]);return e.jsx(Dc.Provider,{value:l,children:a})}const Oc=o.createContext(null);function Rc({children:a}){const[t,s]=o.useState("local"),[r,n]=o.useState(!1),[i,u]=o.useState("faiss"),[c,l]=o.useState(!1),[d,p]=o.useState(!1),[b,y]=o.useState(60),k=o.useMemo(()=>({state:{engine:t,useFast:r,fastKind:i,useCaptions:c,useOcr:d,topK:b},actions:{setEngine:s,setUseFast:n,setFastKind:u,setUseCaptions:l,setUseOcr:p,setTopK:y}}),[t,r,i,c,d,b]);return e.jsx(Oc.Provider,{value:k,children:a})}function Lc({children:a}){return e.jsx(Zi,{children:e.jsx(ho,{children:e.jsx(Rc,{children:e.jsx(ql,{children:e.jsx(_c,{children:e.jsx(Fc,{children:a})})})})})})}const Ac={};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(a=>{console.log("ServiceWorker registered:",a.scope),setInterval(()=>{a.update()},6e4),a.addEventListener("updatefound",()=>{const t=a.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&confirm("New version available! Refresh to update?")&&window.location.reload()})})}).catch(a=>{console.error("ServiceWorker registration failed:",a)})});window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),console.log("App can be installed")});function Uc(){const t=new URLSearchParams(window.location.search).get("ui")??Ac?.VITE_UI??"modern";return t==="test"?e.jsx(Ec,{}):t==="new"?e.jsx(Tc,{}):t==="modular"?e.jsx($c,{}):e.jsx(Sc,{})}nr(document.getElementById("root")).render(e.jsx(Lc,{children:Uc()}));
